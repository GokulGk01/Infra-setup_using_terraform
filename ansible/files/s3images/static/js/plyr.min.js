"object"==typeof navigator&&function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Plyr",t):(e="undefined"!=typeof globalThis?globalThis:e||self).Plyr=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=n((function(e,t){!function(e){var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){var n=e;return t.hasOwnProperty(e)&&(n=t[e]),String.fromCharCode(n)},r=15,i=32,a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},s={17:2,18:4,21:6,22:8,23:10,19:13,20:15},o={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},u=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],d={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},c=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},f=function(e,t,n,r,i){this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1};f.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var h=function(e,t,n,r,i,a){this.uchar=e||" ",this.penState=new f(t,n,r,i,a)};h.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var g=function(){this.chars=[];for(var e=0;e<i;e++)this.chars.push(new h);this.pos=0,this.currPenState=new f};g.prototype={equals:function(e){for(var t=!0,n=0;n<i;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(d.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(d.log("ERROR","Too large cursor position "+this.pos),this.pos=i)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=i?d.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<i;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,n=0;n<i;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var p=function(){this.rows=[];for(var e=0;e<r;e++)this.rows.push(new g);this.currRow=14,this.nrRollUpRows=null,this.reset()};p.prototype={reset:function(){for(var e=0;e<r;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,n=0;n<r;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<r;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<r;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){d.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){d.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var n=this.rows[this.currRow];if(null!==e.indent){var r=e.indent,i=Math.max(r-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}var a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)},setBkgData:function(e){d.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){d.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),d.log("INFO","Rolling up")}else d.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],n="",i=-1,a=0;a<r;a++){var s=this.rows[a].getTextString();s&&(i=a+1,e?t.push("Row "+i+': "'+s+'"'):t.push(s.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new p,this.nonDisplayedMemory=new p,this.lastOutputScreen=new p,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,d.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";d.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(d.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){d.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){d.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){d.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){d.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){d.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){d.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){d.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){d.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){d.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){d.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){d.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(d.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,d.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){d.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}d.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=d.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var v=function(e,t,n){this.field=e||1,this.outputs=[t,n],this.channels=[new m(1,t),new m(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};v.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var n,r,i,a=!1;this.lastTime=e,d.setTime(e);for(var s=0;s<t.length;s+=2)if(r=127&t[s],i=127&t[s+1],r>=16&&r<=31&&r===this.lastCmdA&&i===this.lastCmdB)this.lastCmdA=null,this.lastCmdB=null,d.log("DEBUG","Repeated command ("+c([r,i])+") is dropped");else if(0!==r||0!==i){if(d.log("DATA","["+c([t[s],t[s+1]])+"] -> ("+c([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n)if(a=this.parseChars(r,i))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(a);else d.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,d.log("WARNING","Couldn't parse cleaned data "+c([r,i])+" orig: "+c([t[s],t[s+1]])))}else this.dataCounters.padding+=2},parseCmd:function(e,t){var n=null;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47)&&!((23===e||31===e)&&33<=t&&t<=35))return!1;n=20===e||21===e||23===e?1:2;var r=this.channels[n-1];return 20===e||21===e||28===e||29===e?32===t?r.cc_RCL():33===t?r.cc_BS():34===t?r.cc_AOF():35===t?r.cc_AON():36===t?r.cc_DER():37===t?r.cc_RU(2):38===t?r.cc_RU(3):39===t?r.cc_RU(4):40===t?r.cc_FON():41===t?r.cc_RDC():42===t?r.cc_TR():43===t?r.cc_RTD():44===t?r.cc_EDM():45===t?r.cc_CR():46===t?r.cc_ENM():47===t&&r.cc_EOC():r.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},parseMidrow:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return d.log("ERROR","Mismatch channel in midrow parsing"),!1;var r=this.channels[n-1];return r.insertChars([32]),r.cc_MIDROW(t),d.log("DEBUG","MIDROW ("+c([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var n,r=null;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127)&&!((16===e||24===e)&&64<=t&&t<=95))return!1;n=e<=23?1:2,r=64<=t&&t<=95?1===n?a[e]:o[e]:1===n?s[e]:l[e];var i=this.interpretPAC(r,t);return this.channels[n-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},interpretPAC:function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},parseChars:function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),17<=a&&a<=19){var s=t;s=17===a?t+80:18===a?t+112:t+144,d.log("INFO","Special char '"+n(s)+"' in channel "+r),i=[s],this.lastCmdA=e,this.lastCmdB=t}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(i){var o=c(i);d.log("DEBUG","Char codes =  "+o.join(","))}return i},parseBackgroundAttributes:function(e,t){var n,r,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=u[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(n),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}};e.logger=d,e.PenState=f,e.CaptionScreen=p,e.Cea608Parser=v,e.findCea608Nalus=function(e,t,n){for(var r=0,i=t,a=[],s=function(e,t,n,r){if(4!==e||t<8)return null;var i=n.getUint8(r),a=n.getUint16(r+1),s=n.getUint32(r+3),o=n.getUint8(r+7);return 181==i&&49==a&&1195456820==s&&3==o};i<t+n;){if(r=e.getUint32(i),6===(31&e.getUint8(i+4)))for(var o=i+5,l=-1;o<i+4+r-1;){l=0;for(var u=255;255===u;)l+=u=e.getUint8(o),o++;var d=0;for(u=255;255===u;)d+=u=e.getUint8(o),o++;s(l,d,e,o)&&a.push([o,d]),o+=d}i+=r+4}return a},e.extractCea608DataFromRange=function(e,t){var n=t[0],r=[[],[]];n+=8;var i=31&e.getUint8(n);n+=2;for(var a=0;a<i;a++){var s=e.getUint8(n),o=4&s,l=3&s;n++;var u=e.getUint8(n);n++;var d=e.getUint8(n);n++,o&&(127&u)+(127&d)!=0&&(0===l?(r[0].push(u),r[0].push(d)):1===l&&(r[1].push(u),r[1].push(d)))}return r}}(t)})),i=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return n(e,[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.FRAGMENTED_TEXT="fragmentedText",this.EMBEDDED_TEXT="embeddedText",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability"}}]),e}());t.default=r}));t(i);var o=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return n(e,[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.PATCH_LOCATION="PatchLocation",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId"}}]),e}());t.default=r}));t(o);var l=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return n(e,[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors"}}]),e}());t.default=r}));t(l);var u=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){var e=void 0,t=[],n={},r={};function i(e,n){for(var r in t){var i=t[r];if(i.context===e&&i.name===n)return i.instance}return null}function a(e,t){return t[e]}function s(e,t,n){e in n&&(n[e]=t)}function o(t,n,r){var i=void 0,a=t.__dashjs_factory_name,s=n[a];if(s){var o=s.instance;if(!s.override)return o.apply({context:n,factory:e},r);for(var l in i=t.apply({context:n},r),o=o.apply({context:n,factory:e,parent:i},r))i.hasOwnProperty(l)&&(i[l]=o[l])}else i=t.apply({context:n},r);return i.getClassName=function(){return a},i}return e={extend:function(e,t,n,r){!r[e]&&t&&(r[e]={instance:t,override:n})},getSingletonInstance:i,setSingletonInstance:function(e,n,r){for(var i in t){var a=t[i];if(a.context===e&&a.name===n)return void(t[i].instance=r)}t.push({name:n,context:e,instance:r})},deleteSingletonInstances:function(e){t=t.filter((function(t){return t.context!==e}))},getSingletonFactory:function(e){var r=a(e.__dashjs_factory_name,n);return r||(r=function(n){var r=void 0;return void 0===n&&(n={}),{getInstance:function(){return r||(r=i(n,e.__dashjs_factory_name)),r||(r=o(e,n,arguments),t.push({name:e.__dashjs_factory_name,context:n,instance:r})),r}}},n[e.__dashjs_factory_name]=r),r},getSingletonFactoryByName:function(e){return a(e,n)},updateSingletonFactory:function(e,t){s(e,t,n)},getClassFactory:function(e){var t=a(e.__dashjs_factory_name,r);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return o(e,t,arguments)}}},r[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return a(e,r)},updateClassFactory:function(e,t){s(e,t,r)}},e}();t.default=n}));t(u);var d=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!n||r&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}]),e}();t.default=r}));t(d);var c=n((function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.AST_IN_FUTURE="astInFuture",e.BUFFER_EMPTY="bufferStalled",e.BUFFER_LOADED="bufferLoaded",e.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",e.DYNAMIC_TO_STATIC="dynamicToStatic",e.ERROR="error",e.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",e.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",e.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",e.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",e.LOG="log",e.MANIFEST_LOADED="manifestLoaded",e.METRICS_CHANGED="metricsChanged",e.METRIC_CHANGED="metricChanged",e.METRIC_ADDED="metricAdded",e.METRIC_UPDATED="metricUpdated",e.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",e.PERIOD_SWITCH_STARTED="periodSwitchStarted",e.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",e.QUALITY_CHANGE_RENDERED="qualityChangeRendered",e.TRACK_CHANGE_RENDERED="trackChangeRendered",e.SOURCE_INITIALIZED="sourceInitialized",e.STREAM_INITIALIZING="streamInitializing",e.STREAM_UPDATED="streamUpdated",e.STREAM_INITIALIZED="streamInitialized",e.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",e.TEXT_TRACKS_ADDED="allTextTracksAdded",e.TEXT_TRACK_ADDED="textTrackAdded",e.TTML_PARSED="ttmlParsed",e.TTML_TO_PARSE="ttmlToParse",e.CAPTION_RENDERED="captionRendered",e.CAPTION_CONTAINER_RESIZE="captionContainerResize",e.CAN_PLAY="canPlay",e.PLAYBACK_ENDED="playbackEnded",e.PLAYBACK_ERROR="playbackError",e.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",e.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",e.PLAYBACK_PAUSED="playbackPaused",e.PLAYBACK_PLAYING="playbackPlaying",e.PLAYBACK_PROGRESS="playbackProgress",e.PLAYBACK_RATE_CHANGED="playbackRateChanged",e.PLAYBACK_SEEKED="playbackSeeked",e.PLAYBACK_SEEKING="playbackSeeking",e.PLAYBACK_SEEK_ASKED="playbackSeekAsked",e.PLAYBACK_STALLED="playbackStalled",e.PLAYBACK_STARTED="playbackStarted",e.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",e.PLAYBACK_WAITING="playbackWaiting",e.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",e.GAP_CAUSED_SEEK_TO_PERIOD_END="gapCausedSeekToPeriodEnd",e.GAP_CAUSED_INTERNAL_SEEK="gapCausedInternalSeek",e.EVENT_MODE_ON_START="eventModeOnStart",e.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",e.CONFORMANCE_VIOLATION="conformanceViolation",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=d)&&n.__esModule?n:{default:n}).default));t.default=r}));t(c);var f=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(c);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e={};function t(t,n,r){var i=-1;return e[t]?(e[t].some((function(e,t){if(e&&e.callback===n&&(!r||r===e.scope))return i=t,!0})),i):i}var n={on:function(n,r,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!n)throw new Error("event type cannot be null or undefined");if(!r||"function"!=typeof r)throw new Error("listener must be a function: "+r);var s=a.priority||0;if(!(t(n,r,i)>=0)){e[n]=e[n]||[];var o={callback:r,scope:i,priority:s};i&&i.getStreamId&&(o.streamId=i.getStreamId()),i&&i.getType&&(o.mediaType=i.getType()),a&&a.mode&&(o.mode=a.mode);var l=e[n].some((function(t,r){if(t&&s>t.priority)return e[n].splice(r,0,o),!0}));l||e[n].push(o)}},off:function(n,r,i){if(n&&r&&e[n]){var a=t(n,r,i);a<0||(e[n][a]=null)}},trigger:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e[t]){if((n=n||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");n.type=t,i.streamId&&(n.streamId=i.streamId),i.mediaType&&(n.mediaType=i.mediaType),e[t].filter((function(e){return!!e&&((!i.streamId||!e.streamId||e.streamId===i.streamId)&&((!i.mediaType||!e.mediaType||e.mediaType===i.mediaType)&&!(i.mode&&e.mode&&e.mode!==i.mode||!e.mode&&i.mode&&i.mode===r.default.EVENT_MODE_ON_RECEIVE)))})).forEach((function(e){return e&&e.callback.call(e.scope,n)}))}},reset:function(){e={}}};return n}a.__dashjs_factory_name="EventBus";var s=n.default.getSingletonFactory(a);s.EVENT_PRIORITY_LOW=0,s.EVENT_PRIORITY_HIGH=5e3,n.default.updateSingletonFactory(a.__dashjs_factory_name,s),t.default=s}));t(f);var h=n((function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",e.BUFFERING_COMPLETED="bufferingCompleted",e.BUFFER_CLEARED="bufferCleared",e.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",e.BYTES_APPENDED="bytesAppended",e.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",e.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",e.CURRENT_TRACK_CHANGED="currentTrackChanged",e.DATA_UPDATE_COMPLETED="dataUpdateCompleted",e.DATA_UPDATE_STARTED="dataUpdateStarted",e.INBAND_EVENTS="inbandEvents",e.INITIALIZATION_LOADED="initializationLoaded",e.INIT_FRAGMENT_LOADED="initFragmentLoaded",e.INIT_FRAGMENT_NEEDED="initFragmentNeeded",e.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",e.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",e.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",e.LOADING_COMPLETED="loadingCompleted",e.LOADING_PROGRESS="loadingProgress",e.LOADING_DATA_PROGRESS="loadingDataProgress",e.LOADING_ABANDONED="loadingAborted",e.MANIFEST_UPDATED="manifestUpdated",e.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",e.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",e.QUOTA_EXCEEDED="quotaExceeded",e.REPRESENTATION_UPDATE_STARTED="representationUpdateStarted",e.REPRESENTATION_UPDATE_COMPLETED="representationUpdateCompleted",e.SEGMENTS_LOADED="segmentsLoaded",e.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",e.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",e.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",e.STREAMS_COMPOSED="streamsComposed",e.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",e.STREAM_COMPLETED="streamCompleted",e.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",e.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",e.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",e.URL_RESOLUTION_FAILED="urlResolutionFailed",e.VIDEO_CHUNK_RECEIVED="videoChunkReceived",e.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",e.XLINK_ELEMENT_LOADED="xlinkElementLoaded",e.XLINK_READY="xlinkReady",e.SEGMENTBASE_INIT_REQUEST_NEEDED="segmentBaseInitRequestNeeded",e.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED="segmentBaseSegmentsListRequestNeeded",e.SEEK_TARGET="seekTarget",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=d)&&n.__esModule?n:{default:n}).default);t.default=r}));t(h);var g=n((function(e,t){var n;function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=h)&&n.__esModule?n:{default:n}).default),s=new a;t.default=s}));t(g);var p=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(f),r=a(g),i=a(u);function a(e){return e&&e.__esModule?e:{default:e}}var s=1,o=2,l=3,d=4,c=5;function h(e){e=e||{};var t,i=this.context,a=(0,n.default)(i).getInstance(),u=e.settings,f=[],h=void 0,g=void 0,p=void 0;function m(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function v(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];b.apply(void 0,[s,this].concat(t))}function y(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];b.apply(void 0,[o,this].concat(t))}function E(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];b.apply(void 0,[l,this].concat(t))}function _(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];b.apply(void 0,[d,this].concat(t))}function T(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];b.apply(void 0,[c,this].concat(t))}function b(e,t){var n="",i=null;h&&(i=(new Date).getTime(),n+="["+(i-p)+"]"),g&&t&&t.getClassName&&(n+="["+t.getClassName()+"]",t.getType&&(n+="["+t.getType()+"]")),n.length>0&&(n+=" ");for(var s=arguments.length,o=Array(s>2?s-2:0),l=2;l<s;l++)o[l-2]=arguments[l];Array.apply(null,o).forEach((function(e){n+=e+" "})),f[e]&&u.get().debug.logLevel>=e&&f[e](n),u&&u.get().debug.dispatchEvent&&a.trigger(r.default.LOG,{message:n,level:e})}return t={getLogger:function(e){return{fatal:v.bind(e),error:y.bind(e),warn:E.bind(e),info:_.bind(e),debug:T.bind(e)}},setLogTimestampVisible:function(e){h=e},setCalleeNameVisible:function(e){g=e}},h=!0,g=!0,p=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(f[s]=m(window.console.error),f[o]=m(window.console.error),f[l]=m(window.console.warn),f[d]=m(window.console.info),f[c]=m(window.console.debug)),t}h.__dashjs_factory_name="Debug";var p=i.default.getSingletonFactory(h);p.LOG_LEVEL_NONE=0,p.LOG_LEVEL_FATAL=s,p.LOG_LEVEL_ERROR=o,p.LOG_LEVEL_WARNING=l,p.LOG_LEVEL_INFO=d,p.LOG_LEVEL_DEBUG=c,i.default.updateSingletonFactory(h.__dashjs_factory_name,p),t.default=p}));t(p);var m=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(i),r=c(l),a=c(f),s=c(g),o=c(u),d=c(p);function c(e){return e&&e.__esModule?e:{default:e}}function h(){var e=this.context,t=(0,a.default)(e).getInstance(),i=void 0,o=void 0,l=void 0,u=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0,T=void 0,b=void 0,S=void 0,A=void 0,R=void 0,I=void 0,w=void 0,C=void 0,D=void 0,M=void 0;function N(e){if(!g||!isNaN(p)){var n=p;if(isNaN(n))if(E){n=e.liveStartTime;var r=u.getCurrentDVRInfo(),i=r?r.range:null;if(i){var a=V(!0);isNaN(a)||(o.info("Start time from URI parameters: "+a),n=Math.max(Math.min(n,a),i.start))}}else{n=y.start;var l=V(!1);!isNaN(l)&&l<n+y.duration&&(o.info("Start time from URI parameters: "+l),n=Math.max(n,l))}isNaN(n)||n===f.getTime()||(t.trigger(s.default.PLAYBACK_SEEKING,{seekTime:n}),U(n,!1,!0))}}function O(){return parseFloat((P()-B()).toFixed(5))}function P(){return y.start+y.duration}function L(){y&&f&&f.getElement()?f.play():T=!0}function k(){return y&&f?f.isPaused():null}function x(){y&&f&&f.pause()}function F(){return y&&f?f.isSeeking():null}function U(e,n,r){y&&f&&(e!==(isNaN(A)?f.getTime():A)&&((R=!0===r)||(A=e,t.trigger(s.default.PLAYBACK_SEEK_ASKED)),o.info("Requesting seek to time: "+e+(R?" (internal)":"")),f.setCurrentTime(e,n)))}function B(){return y&&f?f.getTime():null}function G(){var e=B();if(E&&!isNaN(S)){var t=S/1e3;e>t&&(e-=t)}return e}function j(){return y&&f?f.getPlaybackRate():null}function H(){return y&&f?f.getEnded():null}function q(){return E}function K(){if(!E||isNaN(S))return NaN;var e=G();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*h.getClientTimeOffset();return Math.max(((t-S-1e3*e)/1e3).toFixed(3),0)}function Y(){T=!1,g=!1,p=NaN,v=0,S=0,A=NaN,f&&(t.off(s.default.STREAM_INITIALIZED,N,this),t.off(s.default.DATA_UPDATE_COMPLETED,Q,this),t.off(s.default.BUFFER_LEVEL_STATE_CHANGED,ve,this),t.off(s.default.LOADING_PROGRESS,me,this),t.off(s.default.PLAYBACK_PROGRESS,ce,this),t.off(s.default.PLAYBACK_TIME_UPDATED,ce,this),t.off(s.default.PLAYBACK_ENDED,ue,this),t.off(s.default.STREAM_INITIALIZING,Ee,this),z(),f.removeEventListener("canplay",$),f.removeEventListener("play",Z),f.removeEventListener("waiting",J),f.removeEventListener("playing",ee),f.removeEventListener("pause",te),f.removeEventListener("error",de),f.removeEventListener("seeking",ne),f.removeEventListener("seeked",re),f.removeEventListener("timeupdate",ie),f.removeEventListener("progress",ae),f.removeEventListener("ratechange",se),f.removeEventListener("loadedmetadata",oe),f.removeEventListener("stalled",ye),f.removeEventListener("ended",le)),m=null,f=null,y=null,E=null}function V(e){var t=D.getURIFragmentData();if(!t||!t.t)return NaN;var n=l.getStreams()[0].getStreamInfo().start;t.t=t.t.split(",")[0];var r=-1!==t.t.indexOf("posix:")?"now"===t.t.substring(6)?Date.now()/1e3:parseInt(t.t.substring(6)):NaN;return e&&!isNaN(r)?r-S/1e3:parseInt(t.t)+n}function W(){if(null===m){m=setInterval((function(){var e;t.trigger(s.default.WALLCLOCK_TIME_UPDATED,{isDynamic:E,time:new Date}),q()&&k()&&(e=Date.now(),(!b||e>b+500)&&(b=e,ie()))}),M.get().streaming.wallclockTimeUpdateInterval)}}function z(){clearInterval(m),m=null}function X(e){if(!k()&&E&&0!==f.getReadyState()){var t=G(),n=function(e,t){var n=u.getCurrentDVRInfo(t),r=n?n.range:null;return r?(o.debug("Checking DVR window for at "+e+" with DVR window range "+r.start+" - "+r.end),e>r.end?Math.max(r.end-v,r.start):e>0&&e+.25<r.start&&Math.abs(e-r.start)<31536e4?r.start:e):NaN}(t,e);!isNaN(n)&&n!==t&&!F()&&(o.debug("UpdateCurrentTime: Seek to actual time: "+n+" from currentTime: "+t),U(n))}}function Q(e){if(!e.error){var t=c.convertDataToRepresentationInfo(e.currentRepresentation),n=t?t.mediaInfo.streamInfo:null;null!==n&&y.id===n.id&&(y=n,X())}}function $(){t.trigger(s.default.CAN_PLAY)}function Z(){o.info("Native video element event: play"),X(),W(),t.trigger(s.default.PLAYBACK_STARTED,{startTime:B()})}function J(){o.info("Native video element event: waiting"),t.trigger(s.default.PLAYBACK_WAITING,{playingTime:B()})}function ee(){o.info("Native video element event: playing"),t.trigger(s.default.PLAYBACK_PLAYING,{playingTime:B()})}function te(){o.info("Native video element event: pause"),t.trigger(s.default.PLAYBACK_PAUSED,{ended:H()})}function ne(){if(R)R=!1;else{var e=B();isNaN(A)||A===e||(e=A),A=NaN,o.info("Seeking to: "+e),W(),t.trigger(s.default.PLAYBACK_SEEKING,{seekTime:e})}}function re(){o.info("Native video element event: seeked"),t.trigger(s.default.PLAYBACK_SEEKED)}function ie(){y&&t.trigger(s.default.PLAYBACK_TIME_UPDATED,{timeToEnd:O(),time:B()})}function ae(){t.trigger(s.default.PLAYBACK_PROGRESS)}function se(){var e=j();o.info("Native video element event: ratechange: ",e),t.trigger(s.default.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function oe(){o.info("Native video element event: loadedmetadata"),t.trigger(s.default.PLAYBACK_METADATA_LOADED),W()}function le(){o.info("Native video element event: ended"),x(),z();var e=l?l.getActiveStreamInfo():null;e&&t.trigger(s.default.PLAYBACK_ENDED,{isLast:e.isLast})}function ue(e){if(m&&e.isLast){o.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var t=e.seekTime?e.seekTime:P();f.setCurrentTime(t),x(),z()}}function de(e){var n=e.target||e.srcElement;t.trigger(s.default.PLAYBACK_ERROR,{error:n.error})}function ce(){E&&fe()&&M.get().streaming.liveCatchup.playbackRate>0&&!k()&&!F()&&(function(){try{if(fe()&&M.get().streaming.liveCatchup.playbackRate>0&&B()>0){var e=ge(),t=K(),r=_.getLiveDelay(),i=_.getLiveCatchupLatencyThreshold(),a=M.get().streaming.liveCatchup.minDrift;return e===n.default.LIVE_CATCHUP_MODE_LOLP?function(e,t,n,r,i,a){try{var s=Math.abs(e-t);return(isNaN(a)||e<=a)&&(s>n||r<i)}catch(e){return!1}}(t,r,a,he(),M.get().streaming.liveCatchup.playbackBufferMin,i):function(e,t,n,r){try{return Math.abs(e-t)>r&&(isNaN(n)||e<=n)}catch(e){return!1}}(t,r,i,a)}}catch(e){return!1}}()?function(){if(f){var e=void 0,t=f.getPlaybackRate(),r=M.get().streaming.liveCatchup.playbackRate,i=K(),a=_.getLiveDelay(),s=he();if(ge()===n.default.LIVE_CATCHUP_MODE_LOLP){M.get().streaming.liveCatchup.minDrift;e=function(e,t,n,r,i,a,s){var l=e,u=void 0;if(a<i){var d=5*(a-i);u=1-l+2*l/(1+Math.pow(Math.E,-d)),o.debug("[LoL+ playback control_buffer-based] bufferLevel: "+a+", newRate: "+u)}else{var c=.02;if(Math.abs(t-n)<=c*n)u=1;else{var f=5*(t-n);u=1-l+2*l/(1+Math.pow(Math.E,-f))}o.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+u)}w&&a>n/2&&(w=!1);Math.abs(s-u)<=C&&(u=null);return{newRate:u}}(r,i,a,0,M.get().streaming.liveCatchup.playbackBufferMin,s,t)}else e=function(e,t,n,r,i){var a=e,s=t-n,o=5*s,l=2*a/(1+Math.pow(Math.E,-o)),u=1-a+l;w&&(r>n/2?w=!1:s>0&&(u=1));Math.abs(i-u)<=C&&(u=null);return{newRate:u}}(r,i,a,s,t);var l=e.newRate;l&&f.setPlaybackRate(l);var d=i-a;M.get().streaming.liveCatchup.maxDrift>0&&!I&&d>M.get().streaming.liveCatchup.maxDrift?(o.info("Low Latency catchup mechanism. Latency too high, doing a seek to live point"),I=!0,U(((c=u.getCurrentDVRInfo())?c.range:null).end-_.getLiveDelay(),!0,!1)):I=!1}var c}():pe())}function fe(){return M.get().streaming.liveCatchup.enabled||M.get().streaming.lowLatencyEnabled}function he(){var e=null;return l.getActiveStreamProcessors().forEach((function(t){var n=t.getBufferLevel();e=null===e?n:Math.min(e,n)})),e}function ge(){var e=M.get().streaming.liveCatchup.playbackBufferMin;return M.get().streaming.liveCatchup.mode!==n.default.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?n.default.LIVE_CATCHUP_MODE_DEFAULT:n.default.LIVE_CATCHUP_MODE_LOLP}function pe(){f&&f.setPlaybackRate(1)}function me(e){if(!1===e.stream&&M.get().streaming.lowLatencyEnabled&&!isNaN(e.request.duration)){var t=1.2*e.request.duration;if(t>_.getLiveDelay()){o.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",t.toFixed(2));var n={streaming:{liveDelay:t}};M.update(n)}}}function ve(e){e.streamId===y.id&&(fe()?e.state!==r.default.BUFFER_EMPTY||F()||w||(w=!0,pe()):f.setStallState(e.mediaType,e.state===r.default.BUFFER_EMPTY))}function ye(e){t.trigger(s.default.PLAYBACK_STALLED,{e:e})}function Ee(e){!function(e,t){if(e&&e.manifestInfo&&e.manifestInfo.serviceDescriptions){for(var r=void 0,i=0;i<e.manifestInfo.serviceDescriptions.length;i++){var a=e.manifestInfo.serviceDescriptions[i];if(a.schemeIdUri===n.default.SERVICE_DESCRIPTION_LL_SCHEME){r=a;break}}r&&t&&t.supplementalProperties&&"true"===t.supplementalProperties[n.default.SUPPLEMENTAL_PROPERTY_LL_SCHEME]&&(r.latency&&r.latency.target>0&&(o.debug("Apply LL properties coming from service description. Target Latency (ms):",r.latency.target),M.update({streaming:{lowLatencyEnabled:!0,liveDelay:r.latency.target/1e3,liveCatchup:{minDrift:r.latency.max>r.latency.target?(r.latency.max-r.latency.target)/1e3:void 0}}})),r.playbackRate&&r.playbackRate.max>1&&(o.debug("Apply LL properties coming from service description. Max PlaybackRate:",r.playbackRate.max),M.update({streaming:{lowLatencyEnabled:!0,liveCatchup:{playbackRate:r.playbackRate.max-1}}})))}}(e.streamInfo,e.mediaInfo)}return i={initialize:function(e,n,r){y=e,f.addEventListener("canplay",$),f.addEventListener("play",Z),f.addEventListener("waiting",J),f.addEventListener("playing",ee),f.addEventListener("pause",te),f.addEventListener("error",de),f.addEventListener("seeking",ne),f.addEventListener("seeked",re),f.addEventListener("timeupdate",ie),f.addEventListener("progress",ae),f.addEventListener("ratechange",se),f.addEventListener("loadedmetadata",oe),f.addEventListener("stalled",ye),f.addEventListener("ended",le),E=y.manifestInfo.isDynamic,I=!1,w=!1,g=!0===n,p=r,R=!1;var i="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",o=/safari/.test(i)&&!/chrome/.test(i);C=o?.25:.02,t.on(s.default.STREAM_INITIALIZED,N,this),t.on(s.default.DATA_UPDATE_COMPLETED,Q,this),t.on(s.default.LOADING_PROGRESS,me,this),t.on(s.default.BUFFER_LEVEL_STATE_CHANGED,ve,this),t.on(s.default.PLAYBACK_PROGRESS,ce,this),t.on(s.default.PLAYBACK_TIME_UPDATED,ce,this),t.on(s.default.PLAYBACK_ENDED,ue,this,{priority:a.default.EVENT_PRIORITY_HIGH}),t.on(s.default.STREAM_INITIALIZING,Ee,this),T&&(T=!1,L())},setConfig:function(e){e&&(e.streamController&&(l=e.streamController),e.dashMetrics&&(u=e.dashMetrics),e.mediaPlayerModel&&(_=e.mediaPlayerModel),e.adapter&&(c=e.adapter),e.videoModel&&(f=e.videoModel),e.timelineConverter&&(h=e.timelineConverter),e.uriFragmentModel&&(D=e.uriFragmentModel),e.settings&&(M=e.settings))},getStartTimeFromUriParameters:V,getTimeToStreamEnd:O,getTime:B,getNormalizedTime:G,getPlaybackRate:j,getPlayedRanges:function(){return y&&f?f.getPlayedRanges():null},getEnded:H,getIsDynamic:q,getStreamController:function(){return l},computeAndSetLiveDelay:function(e,t,n){var r,i=void 0,a=void 0,s=!isNaN(e)&&isFinite(e)?e:NaN,o=c.getSuggestedPresentationDelay();if(i=M.get().streaming.lowLatencyEnabled?0:_.getLiveDelay()?_.getLiveDelay():null===M.get().streaming.liveDelayFragmentCount||isNaN(M.get().streaming.liveDelayFragmentCount)||isNaN(s)?!0===M.get().streaming.useSuggestedPresentationDelay&&null!==o&&!isNaN(o)&&o>0?o:isNaN(s)?isNaN(n)?4*y.manifestInfo.minBufferTime:4*n:4*s:s*M.get().streaming.liveDelayFragmentCount,null!==(r=c.getAvailabilityStartTime())&&(S=r),t>0){var l=Math.max(t-10,t/2);a=Math.min(i,l)}else a=i;return v=a,a},getLiveDelay:function(){return v},setLiveDelay:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&e<v||(v=e)},getCurrentLiveLatency:K,play:L,isPaused:k,pause:x,isSeeking:F,getStreamEndTime:P,seek:U,updateCurrentTime:X,reset:Y},o=(0,d.default)(e).getInstance().getLogger(i),Y(),i}h.__dashjs_factory_name="PlaybackController",t.default=o.default.getSingletonFactory(h)}));t(m);var v=n((function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function e(){n(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null};r.GET="GET",r.HEAD="HEAD",r.MPD_TYPE="MPD",r.XLINK_EXPANSION_TYPE="XLinkExpansion",r.INIT_SEGMENT_TYPE="InitializationSegment",r.INDEX_SEGMENT_TYPE="IndexSegment",r.MEDIA_SEGMENT_TYPE="MediaSegment",r.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",r.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",r.LICENSE="license",r.OTHER_TYPE="other",t.HTTPRequest=r,t.HTTPRequestTrace=function e(){n(this,e),this.s=null,this.d=null,this.b=[]}}));t(v),v.HTTPRequest,v.HTTPRequestTrace;var y=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=t||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}return n(e,[{key:"isInitializationRequest",value:function(){return this.type&&this.type===v.HTTPRequest.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(e){this.type=e&&e.init?v.HTTPRequest.INIT_SEGMENT_TYPE:v.HTTPRequest.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}]),e}();r.ACTION_DOWNLOAD="download",r.ACTION_COMPLETE="complete",t.default=r}));t(y);var E=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(y);function i(e){return e&&e.__esModule?e:{default:e}}var a="loading",s="executed",o="failed";function l(e){var t=(e=e||{}).eventBus,n=e.events,i=e.dashMetrics,l=e.fragmentLoader,u=e.debug,d=e.streamInfo,c=e.type,f=void 0,h=void 0,g=void 0,p=void 0;function m(e){var t;return!!e&&(t=!1,g.some((function(n){if(i=e,a=n,!isNaN(i.index)&&i.startTime===a.startTime&&i.adaptationIndex===a.adaptationIndex&&i.type===a.type||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(e,n)||function(e,t){return e.action===r.default.ACTION_COMPLETE&&e.action===t.action}(e,n))return t=!0;var i,a})),t)}function v(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function y(e){g=g.filter((function(t){var n=v(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-n}))}function E(e,t){t<=e+.5||(g=g.filter((function(n){var r=v(n);return isNaN(n.startTime)||n.startTime>=t-r||isNaN(n.duration)||n.startTime+n.duration<=e+r})))}function _(e,t,n){for(var r=e.length-1;r>=0;r--){var i=e[r],a=i.startTime,s=a+i.duration;if(n=isNaN(n)?v(i):n,!isNaN(a)&&!isNaN(s)&&t+n>=a&&t-n<s||isNaN(a)&&isNaN(t))return i}return null}function T(e,t){i.addSchedulingInfo(e,t),i.addRequestsQueue(e.mediaType,p,g)}function b(e){e.sender===l&&(p.splice(p.indexOf(e.request),1),e.response&&!e.error&&g.push(e.request),T(e.request,e.error?o:s),t.trigger(n.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:d.id,mediaType:c}))}function S(e){e.sender===l&&t.trigger(n.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:d.id,mediaType:c})}function A(e){e.sender===l&&t.trigger(n.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:d.id,mediaType:c})}function R(){g=[],p=[]}return f={getStreamId:function(){return d.id},getType:function(){return c},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],n=[];return t.forEach((function(t){var r=function(e){var t=void 0;switch(e){case a:t=p;break;case s:t=g;break;default:t=[]}return t}(t);n=n.concat(function(e,t){if(t.hasOwnProperty("time"))return[_(e,t.time,t.threshold)];return e.filter((function(e){for(var n in t)if("state"!==n&&t.hasOwnProperty(n)&&e[n]!=t[n])return!1;return!0}))}(r,e))})),n},isFragmentLoaded:m,isFragmentLoadedOrPending:function(e){var t=!1,n=0,r=void 0;if(!(t=m(e)))for(n=0;n<p.length;n++)r=p[n],e.url===r.url&&e.startTime===r.startTime&&(t=!0);return t},removeExecutedRequestsBeforeTime:y,removeExecutedRequestsAfterTime:function(e){g=g.filter((function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<e}))},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var n=0,r=0,i=e.length;r<i;r++)E(n,e.start(r)),n=e.end(r);t>0&&E(n,t)}else y()},abortRequests:function(){h.debug("abort requests"),l.abort(),p=[]},executeRequest:function(e){switch(e.action){case r.default.ACTION_COMPLETE:g.push(e),T(e,s),h.debug("STREAM_COMPLETED"),t.trigger(n.STREAM_COMPLETED,{request:e},{streamId:e.mediaInfo.streamInfo.id,mediaType:e.mediaType});break;case r.default.ACTION_DOWNLOAD:T(e,a),p.push(e),function(e){t.trigger(n.FRAGMENT_LOADING_STARTED,{request:e},{streamId:d.id,mediaType:c}),l.load(e)}(e);break;default:h.warn("Unknown request action.")}},reset:function(){t.off(n.LOADING_COMPLETED,b,this),t.off(n.LOADING_DATA_PROGRESS,S,this),t.off(n.LOADING_ABANDONED,A,this),l&&l.reset(),R()},addExecutedRequest:function(e){g.push(e)}},h=u.getLogger(f),R(),t.on(n.LOADING_COMPLETED,b,f),t.on(n.LOADING_DATA_PROGRESS,S,f),t.on(n.LOADING_ABANDONED,A,f),f}l.__dashjs_factory_name="FragmentModel";var d=n.default.getClassFactory(l);d.FRAGMENT_MODEL_LOADING=a,d.FRAGMENT_MODEL_EXECUTED=s,d.FRAGMENT_MODEL_CANCELED="canceled",d.FRAGMENT_MODEL_FAILED=o,n.default.updateClassFactory(l.__dashjs_factory_name,d),t.default=d}));t(E);var _=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=n||null,this.data=r||null}}));t(_);var T=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.captionData=null,this.label=null,this.lang=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1,this.isEmbedded=!1}}));t(T);var b=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var n=0;n<t.boxes.length;n++)this.boxes.push(new e(t.boxes[n]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var r=0;r<t.references.length;r++){var i={reference_type:t.references[r].reference_type,referenced_size:t.references[r].referenced_size,subsegment_duration:t.references[r].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var a=0,s=t.samples.length;a<s;a++){var o={sample_size:t.samples[a].sample_size,sample_duration:t.samples[a].sample_duration,sample_composition_time_offset:t.samples[a].sample_composition_time_offset};this.samples.push(o)}}}}return n(e,[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],n=0;n<this.boxes.length;n++)this.boxes[n].type===e&&t.push(this.boxes[n]);return t}}]),e}();t.default=r}));t(b);var S=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(b),r=i(u);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e=void 0;function t(t){var n=[];if(!t||!e||"function"!=typeof e.fetchAll)return n;for(var i=e.fetchAll(t),a=void 0,s=0,o=i.length;s<o;s++)(a=r(i[s]))&&n.push(a);return n}function r(e){if(!e)return null;var t=new n.default(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?r(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var n=t(e.boxes[e.boxes.length-1].type);return n.length>0?n[n.length-1]:null}}}a.__dashjs_factory_name="IsoFile",t.default=r.default.getClassFactory(a)}));t(S);var A=n((function(e,t){
/*! codem-isoboxer v0.3.6 https://github.com/madebyhiro/codem-isoboxer/blob/master/LICENSE.txt */
var n={parseBuffer:function(e){return new r(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(i.prototype._boxProcessors[e]=t)},createFile:function(){return new r},createBox:function(e,t,n){var r=i.create(e);return t&&t.append(r,n),r},createFullBox:function(e,t,r){var i=n.createBox(e,t,r);return i.version=0,i.flags=0,i},Utils:{}};n.Utils.dataViewToString=function(e,t){var n=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(n).decode(e);var r=[],i=0;if("utf-8"===n)for(;i<e.byteLength;){var a=e.getUint8(i++);a<128||(a<224?(a=(31&a)<<6,a|=63&e.getUint8(i++)):a<240?(a=(15&a)<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++)):(a=(7&a)<<18,a|=(63&e.getUint8(i++))<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++))),r.push(String.fromCharCode(a))}else for(;i<e.byteLength;)r.push(String.fromCharCode(e.getUint8(i++)));return r.join("")},n.Utils.utf8ToByteArray=function(e){var t,n;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},n.Utils.appendBox=function(e,t,n){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==n)if(null!=n){var r,i=-1;if("number"==typeof n)i=n;else{if("string"==typeof n)r=n;else{if("object"!=typeof n||!n.type)return void e.boxes.push(t);r=n.type}for(var a=0;a<e.boxes.length;a++)if(r===e.boxes[a].type){i=a+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=n.parseBuffer,t.addBoxProcessor=n.addBoxProcessor,t.createFile=n.createFile,t.createBox=n.createBox,t.createFullBox=n.createFullBox,t.Utils=n.Utils,n.Cursor=function(e){this.offset=void 0===e?0:e};var r=function(e){this._cursor=new n.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};r.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},r.prototype.fetchAll=function(e,t){var n=[];return r._sweep.call(this,e,n,t),n},r.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=i.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},r._sweep=function(e,t,n){for(var i in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&n)return;r._sweep.call(this.boxes[i],e,t,n)}},r.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var n=new Uint8Array(t);for(this._rawo=new DataView(n.buffer),this.bytes=n,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return n.buffer},r.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)};var i=function(){this._cursor=new n.Cursor};i.parse=function(e){var t=new i;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},i.create=function(e){var t=new i;return t.type=e,t.boxes=[],t},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(e,t,n){this._parsing?this[e]=this._readField(t,n):this._writeField(t,n,this[e])},i.prototype._procFieldArray=function(e,t,n,r){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(n,r);else for(i=0;i<this[e].length;i++)this._writeField(n,r,this[e][i])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(e,t,n){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push({}),n.call(this,this[e][r]);else for(r=0;r<t;r++)n.call(this,this[e][r])},i.prototype._procSubEntries=function(e,t,n,r){var i;if(this._parsing)for(e[t]=[],i=0;i<n;i++)e[t].push({}),r.call(this,e[t][i]);else for(i=0;i<n;i++)r.call(this,e[t][i])},i.prototype._procEntryField=function(e,t,n,r){this._parsing?e[t]=this._readField(n,r):this._writeField(n,r,e[t])},i.prototype._procSubBoxes=function(e,t){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push(i.parse(this));else for(n=0;n<t;n++)this._rawo?this[e][n].write():this.size+=this[e][n].getLength()},i.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(e){var t=null,n=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(n);break;case 16:t=this._raw.getInt16(n);break;case 32:t=this._raw.getInt32(n);break;case 64:var r=this._raw.getInt32(n),i=this._raw.getInt32(n+4);t=r*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},i.prototype._readUint=function(e){var t,n,r=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:r=this._raw.getUint8(i);break;case 16:r=this._raw.getUint16(i);break;case 24:r=((t=this._raw.getUint16(i))<<8)+(n=this._raw.getUint8(i+2));break;case 32:r=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),n=this._raw.getUint32(i+4),r=t*Math.pow(2,32)+n}return this._cursor.offset+=e>>3,r},i.prototype._readString=function(e){for(var t="",n=0;n<e;n++){var r=this._readUint(8);t+=String.fromCharCode(r)}return t},i.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},i.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},i.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var n=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,n}return null},i.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?n.Utils.dataViewToString(t):t},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(e,t){if(this._rawo){var n=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(n,t);break;case 16:this._rawo.setInt16(n,t);break;case 32:this._rawo.setInt32(n,t);break;case 64:var r=Math.floor(t/Math.pow(2,32)),i=t-r*Math.pow(2,32);this._rawo.setUint32(n,r),this._rawo.setUint32(n+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeUint=function(e,t){if(this._rawo){var n,r,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:n=(16776960&t)>>8,r=255&t,this._rawo.setUint16(i,n),this._rawo.setUint8(i+2,r);break;case 32:this._rawo.setUint32(i,t);break;case 64:r=t-(n=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,n),this._rawo.setUint32(i+4,r)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeString=function(e,t){for(var n=0;n<e;n++)this._writeUint(8,t.charCodeAt(n))},i.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},i.prototype._writeTemplate=function(e,t){var n=Math.floor(t),r=(t-n)*Math.pow(2,e/2);this._writeUint(e/2,n),this._writeUint(e/2,r)},i.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,n=0;n<e.length;n++)this._rawo.setInt8(t+n,e[n]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},i.prototype._writeUTF8String=function(e){var t=n.Utils.utf8ToByteArray(e);if(this._rawo)for(var r=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)r.setUint8(i,t[i]);else this.size+=t.length},i.prototype._writeField=function(e,t,n){switch(e){case"uint":this._writeUint(t,n);break;case"int":this._writeInt(t,n);break;case"template":this._writeTemplate(t,n);break;case"string":-1==t?this._writeTerminatedString(n):this._writeString(t,n);break;case"data":this._writeData(n);break;case"utf8":this._writeUTF8String(n)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},i.prototype._boxProcessors.vtte=function(){}}));A.parseBuffer,A.addBoxProcessor,A.createFile,A.createBox,A.createFullBox,A.Utils;var R=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=n,this.size=r}}));t(R);var I=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(p),r=o(S),i=o(u),a=o(A),s=o(R);function o(e){return e&&e.__esModule?e:{default:e}}function l(){var e=void 0,t=void 0,i=this.context;function o(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=a.default.parseBuffer(e),n=(0,r.default)(i).create();return n.setData(t),n}function l(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function u(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return t={parse:o,findLastTopIsoBoxCompleted:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new s.default(0,!1);for(var r=t instanceof ArrayBuffer?new Uint8Array(t):t,i=void 0,a=0;n<r.byteLength;){var o=l(r,n),d=u(r,n+4);if(0===o)break;n+o<=r.byteLength&&(e.indexOf(d)>=0?i=new s.default(n,!0,o):a=n+o),n+=o}return i||new s.default(a,!1)},getMediaTimescaleFromMoov:function(e){var t=o(e),n=t?t.getBox("mdhd"):void 0;return n?n.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var t,n,r=o(e),i=r.getBoxes("moof"),a=r.getBoxes("mfhd"),s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0;n=r.getBoxes("moof").length,t=a[a.length-1].sequence_number,l=0,c=[];var T=-1,b=-1;for(m=0;m<i.length;m++){var S=i[m],A=S.getChildBoxes("traf");for(g=0;g<A.length;g++){var R=A[g],I=R.getChildBox("tfhd"),w=R.getChildBox("tfdt");d=w.baseMediaDecodeTime;var C=R.getChildBoxes("trun"),D=R.getChildBoxes("subs");for(p=0;p<C.length;p++){var M=C[p];for(l=M.sample_count,E=(I.base_data_offset||0)+(M.data_offset||0),h=0;h<l;h++){s=void 0!==(f=M.samples[h]).sample_duration?f.sample_duration:I.default_sample_duration,u=void 0!==f.sample_size?f.sample_size:I.default_sample_size;var N={dts:d,cts:d+(void 0!==f.sample_composition_time_offset?f.sample_composition_time_offset:0),duration:s,offset:S.offset+E,size:u,subSizes:[u]};if(D)for(v=0;v<D.length;v++){var O=D[v];if(T<O.entry_count-1&&h>b&&(T++,b+=O.entries[T].sample_delta),h==b){N.subSizes=[];var P=O.entries[T];for(y=0;y<P.subsample_count;y++)N.subSizes.push(P.subsamples[y].subsample_size)}}c.push(N),E+=u,d+=s}}_=d-w.baseMediaDecodeTime}}return{sampleList:c,lastSequenceNumber:t,totalDuration:_,numSequences:n}},findInitRange:function(t){var n=null,r=o(t);if(!r)return n;var i=r.getBox("ftyp"),a=r.getBox("moov");return e.debug("Searching for initialization."),a&&a.isComplete&&(n=(i?i.offset:a.offset)+"-"+(a.offset+a.size-1),e.debug("Found the initialization.  Range: "+n)),n},parsePayload:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new s.default(0,!1);for(var r=t instanceof ArrayBuffer?new Uint8Array(t):t,i=void 0,a=0;n<r.byteLength;){var o=l(r,n),d=u(r,n+4);if(0===o)break;n+o<=r.byteLength&&(e.indexOf(d)>=0?i=new s.default(n,!0,o,d):a=n+o),n+=o}return i||new s.default(a,!1)}},e=(0,n.default)(i).getInstance().getLogger(t),t}l.__dashjs_factory_name="BoxParser",t.default=i.default.getSingletonFactory(l)}));t(I);var w=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.checkParameterType=function(e,t){if((void 0===e?"undefined":n(e))!==t)throw a.default.BAD_ARGUMENT_ERROR},t.checkInteger=function(e){if(null===e||isNaN(e)||e%1!=0)throw a.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"},t.checkRange=function(e,t,n){if(e<t||e>n)throw a.default.BAD_ARGUMENT_ERROR+" : argument out of range"},t.checkIsVideoOrAudioType=function(e){if("string"!=typeof e||e!==a.default.AUDIO&&e!==a.default.VIDEO)throw a.default.BAD_ARGUMENT_ERROR};var r,a=(r=i)&&r.__esModule?r:{default:r}}));t(w),w.checkParameterType,w.checkInteger,w.checkRange,w.checkIsVideoOrAudioType;var C=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(){return{customTimeRangeArray:[],length:0,add:function(e,t){var n=0;for(n=0;n<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:e,end:t}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var n=0;n<this.customTimeRangeArray.length;n++)if(e<=this.customTimeRangeArray[n].start&&t>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(e>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:t,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=e;break}e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=e:t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var n=this.customTimeRangeArray[e],r=this.customTimeRangeArray[t];return n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(n.end=r.end,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(n.start=r.start,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end?(this.customTimeRangeArray.splice(e,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return(0,w.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return(0,w.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}i.__dashjs_factory_name="CustomTimeRanges",t.default=r.default.getClassFactory(i)}));t(C);var D=n((function(e,t){!function(e){e.ns_tt="http://www.w3.org/ns/ttml",e.ns_tts="http://www.w3.org/ns/ttml#styling",e.ns_ttp="http://www.w3.org/ns/ttml#parameter",e.ns_xml="http://www.w3.org/XML/1998/namespace",e.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",e.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",e.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",e.ns_ebutts="urn:ebu:tt:style"}(t)})),M=n((function(e,t){!function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,n=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var a,s=null,o=i[e.toLowerCase()];return void 0!==o?s=o:null!==(a=t.exec(e))?s=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),void 0!==a[4]?parseInt(a[4],16):255]:null!==(a=n.exec(e))?s=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),255]:null!==(a=r.exec(e))&&(s=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseInt(a[4])]),s};var a=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;e.parseLength=function(e){var t,n=null;return null!==(t=a.exec(e))&&(n={value:parseFloat(t[1]),unit:t[2]}),n},e.parseTextShadow=function(t){var n=t.split(","),r=[];for(var i in n){var a=n[i].split(" ");if(1===a.length&&"none"===a[0])return"none";if(a.length>1&&a.length<5){var s=[null,null,null,null],o=e.parseLength(a.shift());if(null===o)return null;if(s[0]=o,null===(o=e.parseLength(a.shift())))return null;if(s[1]=o,0===a.length){r.push(s);continue}if(null!==(o=e.parseLength(a[0]))&&(s[2]=o,a.shift()),0===a.length){r.push(s);continue}var l=e.parseColor(a[0]);if(null===l)return null;s[3]=l,r.push(s)}}return r},e.parsePosition=function(t){var n=t.split(" "),r=function(e){return"center"===e||"left"===e||"top"===e||"bottom"===e||"right"===e};if(n.length>4)return null;for(var i in n)if(!r(n[i])){var a=e.parseLength(n[i]);if(null===a)return null;n[i]=a}for(var s={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},o=0;o<n.length;){var l=n[o++];if(r(l)){var u={value:0,unit:"%"};2!==n.length&&o<n.length&&!r(n[o])&&(u=n[o++]),"right"===l?(s.h.edge=l,s.h.offset=u):"bottom"===l?(s.v.edge=l,s.v.offset=u):"left"===l?s.h.offset=u:"top"===l&&(s.v.offset=u)}else{if(1!==n.length&&2!==n.length)return null;1===o?s.h.offset=l:s.v.offset=l}}return s},e.ComputedLength=function(e,t){this.rw=e,this.rh=t},e.ComputedLength.prototype.toUsedLength=function(e,t){return e*this.rw+t*this.rh},e.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},e.toComputedLength=function(t,n,r,i,a,s){return"%"===n&&i?new e.ComputedLength(i.rw*t/100,i.rh*t/100):"em"===n&&r?new e.ComputedLength(r.rw*t,r.rh*t):"c"===n&&a?new e.ComputedLength(t*a.rw,t*a.rh):"px"===n&&s?new e.ComputedLength(t*s.rw,t*s.rh):"rh"===n?new e.ComputedLength(0,t/100):"rw"===n?new e.ComputedLength(t/100,0):null}}(t)})),N=n((function(e,t){!function(e,t,n){function r(e,t,n,r,i,a,s,o){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=i,this.animatable=a,this.initial=n,this.applies=r,this.parse=s,this.compute=o}for(var i in e.all=[new r(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,n.parseColor,null),new r(t.ns_tts,"color","white",["span"],!0,!0,n.parseColor,null),new r(t.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"displayAlign","before",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),i=n.parseLength(t[1]);return i&&r?{h:i,w:r}:null}),(function(e,t,r,i,a){var s,o;if("auto"===i)s=new n.ComputedLength(0,1);else if(null===(s=n.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)o=new n.ComputedLength(1,0);else if(null===(o=n.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:o}})),new r(t.ns_tts,"fontFamily","default",["span","p"],!0,!0,(function(e){var t=e.split(","),n=[];for(var r in t)"'"!==t[r].charAt(0)&&'"'!==t[r].charAt(0)&&"default"===t[r]?n.push("monospaceSerif"):n.push(t[r]);return n}),null),new r(t.ns_tts,"shear","0%",["p"],!0,!0,n.parseLength,(function(e,t,n,r){return"%"!==r.unit?null:Math.abs(r.value)>100?100*Math.sign(r.value):r.value})),new r(t.ns_tts,"fontSize","1c",["span","p"],!0,!0,n.parseLength,(function(t,r,i,a,s){return n.toComputedLength(a.value,a.unit,null!==r?r.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,null!==r?r.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,t.cellLength.h,t.pxLength.h)})),new r(t.ns_tts,"fontStyle","normal",["span","p"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"fontWeight","normal",["span","p"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(e){return"normal"===e?e:n.parseLength(e)}),(function(t,r,i,a,s){var o;if("normal"===a)o=a;else if(null===(o=n.toComputedLength(a.value,a.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h)))return null;return o})),new r(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new r(t.ns_tts,"origin","auto",["region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),i=n.parseLength(t[1]);return i&&r?{h:i,w:r}:null}),(function(e,t,r,i,a){var s,o;if("auto"===i)s=new n.ComputedLength(0,0);else if(null===(s=n.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)o=new n.ComputedLength(0,0);else if(null===(o=n.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:o}})),new r(t.ns_tts,"overflow","hidden",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"padding","0px",["region"],!1,!0,(function(e){var t=e.split(" ");if(t.length>4)return null;var r=[];for(var i in t){var a=n.parseLength(t[i]);if(!a)return null;r.push(a)}return r}),(function(t,r,i,a,s){var o;if(1===a.length)o=[a[0],a[0],a[0],a[0]];else if(2===a.length)o=[a[0],a[1],a[0],a[1]];else if(3===a.length)o=[a[0],a[1],a[2],a[1]];else{if(4!==a.length)return null;o=[a[0],a[1],a[2],a[3]]}var l=i.styleAttrs[e.byName.writingMode.qname];if("lrtb"===l||"lr"===l)o=[o[0],o[3],o[2],o[1]];else if("rltb"===l||"rl"===l)o=[o[0],o[1],o[2],o[3]];else if("tblr"===l)o=[o[3],o[0],o[1],o[2]];else{if("tbrl"!==l&&"tb"!==l)return null;o=[o[3],o[2],o[1],o[0]]}var u=[];for(var d in o)if(0===o[d].value)u[d]=new n.ComputedLength(0,0);else if(u[d]=n.toComputedLength(o[d].value,o[d].unit,i.styleAttrs[e.byName.fontSize.qname],"0"===d||"2"===d?i.styleAttrs[e.byName.extent.qname].h:i.styleAttrs[e.byName.extent.qname].w,"0"===d||"2"===d?t.cellLength.h:t.cellLength.w,"0"===d||"2"===d?t.pxLength.h:t.pxLength.w),null===u[d])return null;return u})),new r(t.ns_tts,"position","top left",["region"],!1,!0,(function(e){return n.parsePosition(e)}),(function(t,r,i,a){var s,o;return null===(s=n.toComputedLength(a.v.offset.value,a.v.offset.unit,null,new n.ComputedLength(-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-i.styleAttrs[e.byName.extent.qname].h.rh),null,t.pxLength.h))?null:("bottom"===a.v.edge&&(s=new n.ComputedLength(-s.rw-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-s.rh-i.styleAttrs[e.byName.extent.qname].h.rh)),o=n.toComputedLength(a.h.offset.value,a.h.offset.unit,null,new n.ComputedLength(t.dimensions.w.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-i.styleAttrs[e.byName.extent.qname].w.rh),null,t.pxLength.w),null===s?null:("right"===a.h.edge&&(o=new n.ComputedLength(t.dimensions.w.rw-o.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-o.rh-i.styleAttrs[e.byName.extent.qname].w.rh)),{h:s,w:o}))})),new r(t.ns_tts,"ruby","none",["span"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"rubyAlign","center",["span"],!0,!0,(function(e){return"center"!==e&&"spaceAround"!==e?null:e}),null),new r(t.ns_tts,"rubyPosition","outside",["span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"rubyReserve","none",["p"],!0,!0,(function(e){var t=e.split(" "),r=[null,null];if(0===t.length||t.length>2)return null;if("none"!==t[0]&&"both"!==t[0]&&"after"!==t[0]&&"before"!==t[0]&&"outside"!==t[0])return null;if(r[0]=t[0],2===t.length&&"none"!==t[0]){var i=n.parseLength(t[1]);if(!i)return null;r[1]=i}return r}),(function(t,r,i,a,s){if("none"===a[0])return a;var o=null;return null===(o=null===a[1]?new n.ComputedLength(.5*i.styleAttrs[e.byName.fontSize.qname].rw,.5*i.styleAttrs[e.byName.fontSize.qname].rh):n.toComputedLength(a[1].value,a[1].unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h))?null:[a[0],o]})),new r(t.ns_tts,"showBackground","always",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"textAlign","start",["p"],!0,!0,(function(e){return e}),(function(e,t,n,r,i){return"left"===r?"start":"right"===r?"end":r})),new r(t.ns_tts,"textCombine","none",["span"],!0,!0,(function(e){return"none"===e||"all"===e?e:null}),null),new r(t.ns_tts,"textDecoration","none",["span"],!0,!0,(function(e){return e.split(" ")}),null),new r(t.ns_tts,"textEmphasis","none",["span"],!0,!0,(function(e){var t=e.split(" "),r={style:null,symbol:null,color:null,position:null};for(var i in t)if("none"===t[i]||"auto"===t[i])r.style=t[i];else if("filled"===t[i]||"open"===t[i])r.style=t[i];else if("circle"===t[i]||"dot"===t[i]||"sesame"===t[i])r.symbol=t[i];else if("current"===t[i])r.color=t[i];else if("outside"===t[i]||"before"===t[i]||"after"===t[i])r.position=t[i];else if(r.color=n.parseColor(t[i]),null===r.color)return null;return null==r.style&&null==r.symbol?r.style="auto":(r.symbol=r.symbol||"circle",r.style=r.style||"filled"),r.position=r.position||"outside",r.color=r.color||"current",r}),null),new r(t.ns_tts,"textOutline","none",["span"],!0,!0,(function(e){if("none"===e)return e;var t={},r=e.split(" ");if(0===r.length||r.length>2)return null;var i=n.parseColor(r[0]);if(t.color=i,null!==i&&r.shift(),1!==r.length)return null;var a=n.parseLength(r[0]);return a?(t.thickness=a,t):null}),(function(t,r,i,a,s){if("none"===a)return a;var o={};return null===a.color?o.color=i.styleAttrs[e.byName.color.qname]:o.color=a.color,o.thickness=n.toComputedLength(a.thickness.value,a.thickness.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h),null===o.thickness?null:o})),new r(t.ns_tts,"textShadow","none",["span"],!0,!0,n.parseTextShadow,(function(t,r,i,a){if("none"===a)return a;var s=[];for(var o in a){var l={};if(l.x_off=n.toComputedLength(a[o][0].value,a[o][0].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.w),null===l.x_off)return null;if(l.y_off=n.toComputedLength(a[o][1].value,a[o][1].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.y_off)return null;if(null===a[o][2])l.b_radius=0;else if(l.b_radius=n.toComputedLength(a[o][2].value,a[o][2].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.b_radius)return null;null===a[o][3]?l.color=i.styleAttrs[e.byName.color.qname]:l.color=a[o][3],s.push(l)}return s})),new r(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"zIndex","auto",["region"],!1,!0,(function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t}),null),new r(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,n.parseLength,(function(e,t,r,i,a){return n.toComputedLength(i.value,i.unit,null,null,e.cellLength.w,null)})),new r(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(e){return e}),null),new r(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(e){return e}),null),new r(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(e){return"true"===e}),null),new r(t.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(e){return"true"===e}),null)],e.byQName={},e.all)e.byQName[e.all[i].qname]=e.all[i];for(var a in e.byName={},e.all)e.byName[e.all[a].name]=e.all[a]}(t,"undefined"==typeof imscNames?D:imscNames,"undefined"==typeof imscUtils?M:imscUtils)})),O=n((function(e,t){!function(e,t,n,r){e.generateISD=function(e,t,n){var r=new l(e),i={};for(var s in e.head.layout.regions){var o=a(e,t,e.head.layout.regions[s],e.body,null,"",e.head.layout.regions[s],n,i);null!==o&&r.contents.push(o.element)}return r};var i=[n.byName.color.qname,n.byName.textCombine.qname,n.byName.textDecoration.qname,n.byName.textEmphasis.qname,n.byName.textOutline.qname,n.byName.textShadow.qname];function a(e,t,l,c,f,h,g,p,m){if(t<g.begin||t>=g.end)return null;var v="regionID"in g&&""!==g.regionID?g.regionID:h;if(null!==f&&v!==l.id&&(!("contents"in g)||"contents"in g&&0===g.contents.length||""!==v))return null;var y=new u(g);for(var E in g.sets)t<g.sets[E].begin||t>=g.sets[E].end||(y.styleAttrs[g.sets[E].qname]=g.sets[E].value);var _,T={};for(var b in y.styleAttrs)if(T[b]=!0,"region"===y.kind&&b===n.byName.writingMode.qname&&!(n.byName.direction.qname in y.styleAttrs)){var S=y.styleAttrs[b];"lrtb"===S||"lr"===S?y.styleAttrs[n.byName.direction.qname]="ltr":"rltb"!==S&&"rl"!==S||(y.styleAttrs[n.byName.direction.qname]="rtl")}if(null!==f)for(var A in n.all){var R=n.all[A];if(R.qname===n.byName.textDecoration.qname){var I=f.styleAttrs[R.qname],w=y.styleAttrs[R.qname],C=[];void 0===w?C=I:-1===w.indexOf("none")?((-1===w.indexOf("noUnderline")&&-1!==I.indexOf("underline")||-1!==w.indexOf("underline"))&&C.push("underline"),(-1===w.indexOf("noLineThrough")&&-1!==I.indexOf("lineThrough")||-1!==w.indexOf("lineThrough"))&&C.push("lineThrough"),(-1===w.indexOf("noOverline")&&-1!==I.indexOf("overline")||-1!==w.indexOf("overline"))&&C.push("overline")):C.push("none"),y.styleAttrs[R.qname]=C}else if(R.qname!==n.byName.fontSize.qname||R.qname in y.styleAttrs||"span"!==y.kind||"textContainer"!==y.styleAttrs[n.byName.ruby.qname])if(R.qname!==n.byName.fontSize.qname||R.qname in y.styleAttrs||"span"!==y.kind||"text"!==y.styleAttrs[n.byName.ruby.qname])R.inherit&&R.qname in f.styleAttrs&&!(R.qname in y.styleAttrs)&&(y.styleAttrs[R.qname]=f.styleAttrs[R.qname]);else{var D=f.styleAttrs[n.byName.fontSize.qname];"textContainer"===f.styleAttrs[n.byName.ruby.qname]?y.styleAttrs[R.qname]=D:y.styleAttrs[R.qname]=new r.ComputedLength(.5*D.rw,.5*D.rh)}else{var M=f.styleAttrs[n.byName.fontSize.qname];y.styleAttrs[R.qname]=new r.ComputedLength(.5*M.rw,.5*M.rh)}}for(var N in n.all){var O=n.all[N];if(!(O.qname in y.styleAttrs)&&!(O.qname===n.byName.position.qname&&n.byName.origin.qname in y.styleAttrs||O.qname===n.byName.origin.qname&&n.byName.position.qname in y.styleAttrs)){var P=e.head.styling.initials[O.qname]||O.initial;if(null!==P&&("region"===y.kind||!1===O.inherit&&null!==P)){var L=O.parse(P);null!==L?(y.styleAttrs[O.qname]=L,T[O.qname]=!0):d(p,"Invalid initial value for '"+O.qname+"' on element '"+y.kind)}}}for(var k in n.all){var x=n.all[k];if(x.qname in T&&null!==x.compute){var F=x.compute(e,f,y,y.styleAttrs[x.qname],m);null!==F?y.styleAttrs[x.qname]=F:(y.styleAttrs[x.qname]=x.compute(e,f,y,x.parse(x.initial),m),d(p,"Style '"+x.qname+"' on element '"+y.kind+"' cannot be computed"))}}if("none"===y.styleAttrs[n.byName.display.qname])return null;for(var U in null===f?_=null===c?[]:[c]:"contents"in g&&(_=g.contents),_){var B=a(e,t,l,c,y,v,_[U],p,m);null!==B&&y.contents.push(B.element)}for(var G in y.styleAttrs){var j=!1;if("span"===y.kind){var H=y.styleAttrs[n.byName.ruby.qname];(j=("container"===H||"textContainer"===H||"baseContainer"===H)&&-1!==i.indexOf(G))||(j="container"!==H&&G===n.byName.rubyAlign.qname),j||(j=!("textContainer"===H||"text"===H)&&G===n.byName.rubyPosition.qname)}if(!j)j=-1===n.byQName[G].applies.indexOf(y.kind);j&&delete y.styleAttrs[G]}var q=y.styleAttrs[n.byName.ruby.qname];if("p"===y.kind||"span"===y.kind&&("textContainer"===q||"text"===q)){var K=[];s(y,K),function(e){function t(e){return"br"===e.kind||/[\r\n\t ]$/.test(e.text)}function n(e){return"br"===e.kind||"preserve"===e.space&&/^[\r\n]/.test(e.text)}for(var r,i=0;i<e.length;)if("br"!==(r=e[i]).kind&&"preserve"!==r.space){var a=r.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(a)&&(0===i||t(e[i-1]))&&(a=a.substring(1)),r.text=a,0===a.length?e.splice(i,1):i++}else i++;for(i=0;i<e.length;i++)"br"!==(r=e[i]).kind&&"preserve"!==r.space?/[ ]$/.test(r.text)&&(i===e.length-1||n(e[i+1]))&&(r.text=r.text.slice(0,-1)):i++}(K),o(y)}return"div"===y.kind&&n.byName.backgroundImage.qname in y.styleAttrs||"br"===y.kind||"image"===y.kind||"contents"in y&&y.contents.length>0||"span"===y.kind&&null!==y.text||"region"===y.kind&&"always"===y.styleAttrs[n.byName.showBackground.qname]?{region_id:v,element:y}:null}function s(e,t){for(var r in e.contents){var i=e.contents[r],a=i.styleAttrs[n.byName.ruby.qname];("span"!==i.kind||"textContainer"!==a&&"text"!==a)&&("contents"in i?s(i,t):("span"===i.kind&&0!==i.text.length||"br"===i.kind)&&t.push(i))}}function o(e){if("br"===e.kind)return!1;if("text"in e)return 0===e.text.length;if("contents"in e){for(var t=e.contents.length;t--;)o(e.contents[t])&&e.contents.splice(t,1);return 0===e.contents.length}}function l(e){this.contents=[],this.aspectRatio=e.aspectRatio,this.lang=e.lang}function u(e){for(var t in this.kind=e.kind||"region",this.lang=e.lang,e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)this.styleAttrs[t]=e.styleAttrs[t];"src"in e&&(this.src=e.src),"type"in e&&(this.type=e.type),"text"in e?this.text=e.text:("region"===this.kind||"contents"in e)&&(this.contents=[]),"space"in e&&(this.space=e.space)}function d(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames||imscNames,"undefined"==typeof imscStyles?N:imscStyles,"undefined"==typeof imscUtils?M:imscUtils)})),P="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},L=[],k=[],x="undefined"!=typeof Uint8Array?Uint8Array:Array,F=!1;function U(){F=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)L[t]=e[t],k[e.charCodeAt(t)]=t;k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63}function B(e,t,n){for(var r,i,a=[],s=t;s<n;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],a.push(L[(i=r)>>18&63]+L[i>>12&63]+L[i>>6&63]+L[63&i]);return a.join("")}function G(e){var t;F||U();for(var n=e.length,r=n%3,i="",a=[],s=16383,o=0,l=n-r;o<l;o+=s)a.push(B(e,o,o+s>l?l:o+s));return 1===r?(t=e[n-1],i+=L[t>>2],i+=L[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=L[t>>10],i+=L[t>>4&63],i+=L[t<<2&63],i+="="),a.push(i),a.join("")}function j(e,t,n,r,i){var a,s,o=8*i-r-1,l=(1<<o)-1,u=l>>1,d=-7,c=n?i-1:0,f=n?-1:1,h=e[t+c];for(c+=f,a=h&(1<<-d)-1,h>>=-d,d+=o;d>0;a=256*a+e[t+c],c+=f,d-=8);for(s=a&(1<<-d)-1,a>>=-d,d+=r;d>0;s=256*s+e[t+c],c+=f,d-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),a-=u}return(h?-1:1)*s*Math.pow(2,a-r)}function H(e,t,n,r,i,a){var s,o,l,u=8*a-i-1,d=(1<<u)-1,c=d>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,g=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+c>=1?f/l:f*Math.pow(2,1-c))*l>=2&&(s++,l/=2),s+c>=d?(o=0,s=d):s+c>=1?(o=(t*l-1)*Math.pow(2,i),s+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&o,h+=g,o/=256,i-=8);for(s=s<<i|o,u+=i;u>0;e[n+h]=255&s,h+=g,s/=256,u-=8);e[n+h-g]|=128*p}var q={}.toString,K=Array.isArray||function(e){return"[object Array]"==q.call(e)};function Y(){return W.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function V(e,t){if(Y()<t)throw new RangeError("Invalid typed array length");return W.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=W.prototype:(null===e&&(e=new W(t)),e.length=t),e}function W(e,t,n){if(!(W.TYPED_ARRAY_SUPPORT||this instanceof W))return new W(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Q(this,e)}return z(this,e,t,n)}function z(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);W.TYPED_ARRAY_SUPPORT?(e=t).__proto__=W.prototype:e=$(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!W.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|ee(t,n),i=(e=V(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(J(t)){var n=0|Z(t.length);return 0===(e=V(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?V(e,0):$(e,t);if("Buffer"===t.type&&K(t.data))return $(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function X(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Q(e,t){if(X(t),e=V(e,t<0?0:0|Z(t)),!W.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function $(e,t){var n=t.length<0?0:0|Z(t.length);e=V(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function Z(e){if(e>=Y())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Y().toString(16)+" bytes");return 0|e}function J(e){return!(null==e||!e._isBuffer)}function ee(e,t){if(J(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return we(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Ce(e).length;default:if(r)return we(e).length;t=(""+t).toLowerCase(),r=!0}}function te(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return me(this,t,n);case"utf8":case"utf-8":return fe(this,t,n);case"ascii":return ge(this,t,n);case"latin1":case"binary":return pe(this,t,n);case"base64":return ce(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ve(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function ne(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function re(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=W.from(t,r)),J(t))return 0===t.length?-1:ie(e,t,n,r,i);if("number"==typeof t)return t&=255,W.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):ie(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function ie(e,t,n,r,i){var a,s=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,o/=2,l/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var d=-1;for(a=n;a<o;a++)if(u(e,a)===u(t,-1===d?0:a-d)){if(-1===d&&(d=a),a-d+1===l)return d*s}else-1!==d&&(a-=a-d),d=-1}else for(n+l>o&&(n=o-l),a=n;a>=0;a--){for(var c=!0,f=0;f<l;f++)if(u(e,a+f)!==u(t,f)){c=!1;break}if(c)return a}return-1}function ae(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var s=0;s<r;++s){var o=parseInt(t.substr(2*s,2),16);if(isNaN(o))return s;e[n+s]=o}return s}function se(e,t,n,r){return De(we(t,e.length-n),e,n,r)}function oe(e,t,n,r){return De(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function le(e,t,n,r){return oe(e,t,n,r)}function ue(e,t,n,r){return De(Ce(t),e,n,r)}function de(e,t,n,r){return De(function(e,t){for(var n,r,i,a=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function ce(e,t,n){return 0===t&&n===e.length?G(e):G(e.slice(t,n))}function fe(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,s,o,l,u=e[i],d=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=n)switch(c){case 1:u<128&&(d=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(d=l);break;case 3:a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(l=(15&u)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(d=l);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&u)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(d=l)}null===d?(d=65533,c=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),i+=c}return function(e){var t=e.length;if(t<=he)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=he));return n}(r)}W.TYPED_ARRAY_SUPPORT=void 0===P.TYPED_ARRAY_SUPPORT||P.TYPED_ARRAY_SUPPORT,W.poolSize=8192,W._augment=function(e){return e.__proto__=W.prototype,e},W.from=function(e,t,n){return z(null,e,t,n)},W.TYPED_ARRAY_SUPPORT&&(W.prototype.__proto__=Uint8Array.prototype,W.__proto__=Uint8Array),W.alloc=function(e,t,n){return function(e,t,n,r){return X(t),t<=0?V(e,t):void 0!==n?"string"==typeof r?V(e,t).fill(n,r):V(e,t).fill(n):V(e,t)}(null,e,t,n)},W.allocUnsafe=function(e){return Q(null,e)},W.allocUnsafeSlow=function(e){return Q(null,e)},W.isBuffer=function(e){return null!=e&&(!!e._isBuffer||Me(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Me(e.slice(0,0))}(e))},W.compare=function(e,t){if(!J(e)||!J(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},W.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},W.concat=function(e,t){if(!K(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return W.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=W.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!J(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},W.byteLength=ee,W.prototype._isBuffer=!0,W.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)ne(this,t,t+1);return this},W.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)ne(this,t,t+3),ne(this,t+1,t+2);return this},W.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)ne(this,t,t+7),ne(this,t+1,t+6),ne(this,t+2,t+5),ne(this,t+3,t+4);return this},W.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?fe(this,0,e):te.apply(this,arguments)},W.prototype.equals=function(e){if(!J(e))throw new TypeError("Argument must be a Buffer");return this===e||0===W.compare(this,e)},W.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},W.prototype.compare=function(e,t,n,r,i){if(!J(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),o=Math.min(a,s),l=this.slice(r,i),u=e.slice(t,n),d=0;d<o;++d)if(l[d]!==u[d]){a=l[d],s=u[d];break}return a<s?-1:s<a?1:0},W.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},W.prototype.indexOf=function(e,t,n){return re(this,e,t,n,!0)},W.prototype.lastIndexOf=function(e,t,n){return re(this,e,t,n,!1)},W.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return ae(this,e,t,n);case"utf8":case"utf-8":return se(this,e,t,n);case"ascii":return oe(this,e,t,n);case"latin1":case"binary":return le(this,e,t,n);case"base64":return ue(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return de(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},W.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var he=4096;function ge(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function pe(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function me(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=Ie(e[a]);return i}function ve(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function ye(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Ee(e,t,n,r,i,a){if(!J(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function _e(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function Te(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function be(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Se(e,t,n,r,i){return i||be(e,0,n,4),H(e,t,n,r,23,4),n+4}function Ae(e,t,n,r,i){return i||be(e,0,n,8),H(e,t,n,r,52,8),n+8}W.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),W.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=W.prototype;else{var i=t-e;n=new W(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},W.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||ye(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},W.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||ye(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},W.prototype.readUInt8=function(e,t){return t||ye(e,1,this.length),this[e]},W.prototype.readUInt16LE=function(e,t){return t||ye(e,2,this.length),this[e]|this[e+1]<<8},W.prototype.readUInt16BE=function(e,t){return t||ye(e,2,this.length),this[e]<<8|this[e+1]},W.prototype.readUInt32LE=function(e,t){return t||ye(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},W.prototype.readUInt32BE=function(e,t){return t||ye(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},W.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||ye(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},W.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||ye(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},W.prototype.readInt8=function(e,t){return t||ye(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},W.prototype.readInt16LE=function(e,t){t||ye(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},W.prototype.readInt16BE=function(e,t){t||ye(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},W.prototype.readInt32LE=function(e,t){return t||ye(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},W.prototype.readInt32BE=function(e,t){return t||ye(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},W.prototype.readFloatLE=function(e,t){return t||ye(e,4,this.length),j(this,e,!0,23,4)},W.prototype.readFloatBE=function(e,t){return t||ye(e,4,this.length),j(this,e,!1,23,4)},W.prototype.readDoubleLE=function(e,t){return t||ye(e,8,this.length),j(this,e,!0,52,8)},W.prototype.readDoubleBE=function(e,t){return t||ye(e,8,this.length),j(this,e,!1,52,8)},W.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||Ee(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},W.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||Ee(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},W.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,1,255,0),W.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},W.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,2,65535,0),W.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):_e(this,e,t,!0),t+2},W.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,2,65535,0),W.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):_e(this,e,t,!1),t+2},W.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,4,4294967295,0),W.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Te(this,e,t,!0),t+4},W.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,4,4294967295,0),W.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Te(this,e,t,!1),t+4},W.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);Ee(this,e,t,n,i-1,-i)}var a=0,s=1,o=0;for(this[t]=255&e;++a<n&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+n},W.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);Ee(this,e,t,n,i-1,-i)}var a=n-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+n},W.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,1,127,-128),W.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},W.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,2,32767,-32768),W.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):_e(this,e,t,!0),t+2},W.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,2,32767,-32768),W.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):_e(this,e,t,!1),t+2},W.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,4,2147483647,-2147483648),W.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Te(this,e,t,!0),t+4},W.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Ee(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),W.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Te(this,e,t,!1),t+4},W.prototype.writeFloatLE=function(e,t,n){return Se(this,e,t,!0,n)},W.prototype.writeFloatBE=function(e,t,n){return Se(this,e,t,!1,n)},W.prototype.writeDoubleLE=function(e,t,n){return Ae(this,e,t,!0,n)},W.prototype.writeDoubleBE=function(e,t,n){return Ae(this,e,t,!1,n)},W.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!W.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},W.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!W.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var s=J(e)?e:we(new W(e,r).toString()),o=s.length;for(a=0;a<n-t;++a)this[a+t]=s[a%o]}return this};var Re=/[^+\/0-9A-Za-z-_]/g;function Ie(e){return e<16?"0"+e.toString(16):e.toString(16)}function we(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function Ce(e){return function(e){var t,n,r,i,a,s;F||U();var o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a="="===e[o-2]?2:"="===e[o-1]?1:0,s=new x(3*o/4-a),r=a>0?o-4:o;var l=0;for(t=0,n=0;t<r;t+=4,n+=3)i=k[e.charCodeAt(t)]<<18|k[e.charCodeAt(t+1)]<<12|k[e.charCodeAt(t+2)]<<6|k[e.charCodeAt(t+3)],s[l++]=i>>16&255,s[l++]=i>>8&255,s[l++]=255&i;return 2===a?(i=k[e.charCodeAt(t)]<<2|k[e.charCodeAt(t+1)]>>4,s[l++]=255&i):1===a&&(i=k[e.charCodeAt(t)]<<10|k[e.charCodeAt(t+1)]<<4|k[e.charCodeAt(t+2)]>>2,s[l++]=i>>8&255,s[l++]=255&i),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Re,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function De(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Me(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function Ne(){}function Oe(){Oe.init.call(this)}function Pe(e){return void 0===e._maxListeners?Oe.defaultMaxListeners:e._maxListeners}function Le(e,t,n){if(t)e.call(n);else for(var r=e.length,i=He(e,r),a=0;a<r;++a)i[a].call(n)}function ke(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=He(e,i),s=0;s<i;++s)a[s].call(n,r)}function xe(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,s=He(e,a),o=0;o<a;++o)s[o].call(n,r,i)}function Fe(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var s=e.length,o=He(e,s),l=0;l<s;++l)o[l].call(n,r,i,a)}function Ue(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=He(e,i),s=0;s<i;++s)a[s].apply(n,r)}function Be(e,t,n,r){var i,a,s,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),s=a[t]):(a=e._events=new Ne,e._eventsCount=0),s){if("function"==typeof s?s=a[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=Pe(e))&&i>0&&s.length>i){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,o=l,"function"==typeof console.warn?console.warn(o):console.log(o)}}else s=a[t]=n,++e._eventsCount;return e}function Ge(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function je(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function He(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function qe(){throw new Error("setTimeout has not been defined")}function Ke(){throw new Error("clearTimeout has not been defined")}Ne.prototype=Object.create(null),Oe.EventEmitter=Oe,Oe.usingDomains=!1,Oe.prototype.domain=void 0,Oe.prototype._events=void 0,Oe.prototype._maxListeners=void 0,Oe.defaultMaxListeners=10,Oe.init=function(){this.domain=null,Oe.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Ne,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Oe.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Oe.prototype.getMaxListeners=function(){return Pe(this)},Oe.prototype.emit=function(e){var t,n,r,i,a,s,o,l="error"===e;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(o=this.domain,l){if(t=arguments[1],!o){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(n=s[e]))return!1;var d="function"==typeof n;switch(r=arguments.length){case 1:Le(n,d,this);break;case 2:ke(n,d,this,arguments[1]);break;case 3:xe(n,d,this,arguments[1],arguments[2]);break;case 4:Fe(n,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];Ue(n,d,this,i)}return!0},Oe.prototype.addListener=function(e,t){return Be(this,e,t,!1)},Oe.prototype.on=Oe.prototype.addListener,Oe.prototype.prependListener=function(e,t){return Be(this,e,t,!0)},Oe.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Ge(this,e,t)),this},Oe.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Ge(this,e,t)),this},Oe.prototype.removeListener=function(e,t){var n,r,i,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Ne:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Ne,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,s||t)}return this},Oe.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Ne,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Ne:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Ne,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Oe.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},Oe.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):je.call(e,t)},Oe.prototype.listenerCount=je,Oe.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Ye=qe,Ve=Ke;function We(e){if(Ye===setTimeout)return setTimeout(e,0);if((Ye===qe||!Ye)&&setTimeout)return Ye=setTimeout,setTimeout(e,0);try{return Ye(e,0)}catch(t){try{return Ye.call(null,e,0)}catch(t){return Ye.call(this,e,0)}}}"function"==typeof P.setTimeout&&(Ye=setTimeout),"function"==typeof P.clearTimeout&&(Ve=clearTimeout);var ze,Xe=[],Qe=!1,$e=-1;function Ze(){Qe&&ze&&(Qe=!1,ze.length?Xe=ze.concat(Xe):$e=-1,Xe.length&&Je())}function Je(){if(!Qe){var e=We(Ze);Qe=!0;for(var t=Xe.length;t;){for(ze=Xe,Xe=[];++$e<t;)ze&&ze[$e].run();$e=-1,t=Xe.length}ze=null,Qe=!1,function(e){if(Ve===clearTimeout)return clearTimeout(e);if((Ve===Ke||!Ve)&&clearTimeout)return Ve=clearTimeout,clearTimeout(e);try{Ve(e)}catch(t){try{return Ve.call(null,e)}catch(t){return Ve.call(this,e)}}}(e)}}function et(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Xe.push(new tt(e,t)),1!==Xe.length||Qe||We(Je)}function tt(e,t){this.fun=e,this.array=t}tt.prototype.run=function(){this.fun.apply(null,this.array)};function nt(){}var rt=nt,it=nt,at=nt,st=nt,ot=nt,lt=nt,ut=nt;var dt=P.performance||{},ct=dt.now||dt.mozNow||dt.msNow||dt.oNow||dt.webkitNow||function(){return(new Date).getTime()};var ft=new Date;var ht={nextTick:et,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:rt,addListener:it,once:at,off:st,removeListener:ot,removeAllListeners:lt,emit:ut,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*ct.call(dt),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-ft)/1e3}},gt="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},pt=/%[sdj%]/g;function mt(e){if(!Ct(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(_t(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,a=String(e).replace(pt,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),s=r[n];n<i;s=r[++n])wt(s)||!Nt(s)?a+=" "+s:a+=" "+_t(s);return a}function vt(e,t){if(Dt(P.process))return function(){return vt(e,t).apply(this,arguments)};if(!0===ht.noDeprecation)return e;var n=!1;return function(){if(!n){if(ht.throwDeprecation)throw new Error(t);ht.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}}var yt,Et={};function _t(e,t){var n={seen:[],stylize:bt};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),It(t)?n.showHidden=t:t&&xt(n,t),Dt(n.showHidden)&&(n.showHidden=!1),Dt(n.depth)&&(n.depth=2),Dt(n.colors)&&(n.colors=!1),Dt(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=Tt),St(n,e,n.depth)}function Tt(e,t){var n=_t.styles[t];return n?"["+_t.colors[n][0]+"m"+e+"["+_t.colors[n][1]+"m":e}function bt(e,t){return e}function St(e,t,n){if(e.customInspect&&t&&Lt(t.inspect)&&t.inspect!==_t&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return Ct(r)||(r=St(e,r,n)),r}var i=function(e,t){if(Dt(t))return e.stylize("undefined","undefined");if(Ct(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(r=t,"number"==typeof r)return e.stylize(""+t,"number");var r;if(It(t))return e.stylize(""+t,"boolean");if(wt(t))return e.stylize("null","null")}(e,t);if(i)return i;var a=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),Pt(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return At(t);if(0===a.length){if(Lt(t)){var o=t.name?": "+t.name:"";return e.stylize("[Function"+o+"]","special")}if(Mt(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Ot(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Pt(t))return At(t)}var l,u,d="",c=!1,f=["{","}"];(l=t,Array.isArray(l)&&(c=!0,f=["[","]"]),Lt(t))&&(d=" [Function"+(t.name?": "+t.name:"")+"]");return Mt(t)&&(d=" "+RegExp.prototype.toString.call(t)),Ot(t)&&(d=" "+Date.prototype.toUTCString.call(t)),Pt(t)&&(d=" "+At(t)),0!==a.length||c&&0!=t.length?n<0?Mt(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=c?function(e,t,n,r,i){for(var a=[],s=0,o=t.length;s<o;++s)Ft(t,String(s))?a.push(Rt(e,t,n,r,String(s),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(Rt(e,t,n,r,i,!0))})),a}(e,t,n,s,a):a.map((function(r){return Rt(e,t,n,s,r,c)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,d,f)):f[0]+d+f[1]}function At(e){return"["+Error.prototype.toString.call(e)+"]"}function Rt(e,t,n,r,i,a){var s,o,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(o=e.stylize("[Setter]","special")),Ft(r,i)||(s="["+i+"]"),o||(e.seen.indexOf(l.value)<0?(o=wt(n)?St(e,l.value,null):St(e,l.value,n-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),Dt(s)){if(a&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function It(e){return"boolean"==typeof e}function wt(e){return null===e}function Ct(e){return"string"==typeof e}function Dt(e){return void 0===e}function Mt(e){return Nt(e)&&"[object RegExp]"===kt(e)}function Nt(e){return"object"==typeof e&&null!==e}function Ot(e){return Nt(e)&&"[object Date]"===kt(e)}function Pt(e){return Nt(e)&&("[object Error]"===kt(e)||e instanceof Error)}function Lt(e){return"function"==typeof e}function kt(e){return Object.prototype.toString.call(e)}function xt(e,t){if(!t||!Nt(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}function Ft(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ut(){this.head=null,this.tail=null,this.length=0}_t.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},_t.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},Ut.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},Ut.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},Ut.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},Ut.prototype.clear=function(){this.head=this.tail=null,this.length=0},Ut.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},Ut.prototype.concat=function(e){if(0===this.length)return W.alloc(0);if(1===this.length)return this.head.data;for(var t=W.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t};var Bt=W.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Gt(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!Bt(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=Ht;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=qt;break;default:return void(this.write=jt)}this.charBuffer=new W(6),this.charReceived=0,this.charLength=0}function jt(e){return e.toString(this.encoding)}function Ht(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function qt(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}Gt.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived);var i;r=(t+=e.toString(this.encoding,0,r)).length-1;if((i=t.charCodeAt(r))>=55296&&i<=56319){var a=this.surrogateSize;return this.charLength+=a,this.charReceived+=a,this.charBuffer.copy(this.charBuffer,a,0,a),e.copy(this.charBuffer,0,0,a),t.substring(0,r)}return t},Gt.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},Gt.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t};var Kt=Object.freeze({__proto__:null,StringDecoder:Gt});Wt.ReadableState=Vt;var Yt=function(e){if(Dt(yt)&&(yt=ht.env.NODE_DEBUG||""),e=e.toUpperCase(),!Et[e])if(new RegExp("\\b"+e+"\\b","i").test(yt)){Et[e]=function(){var t=mt.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else Et[e]=function(){};return Et[e]}("stream");function Vt(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof bn&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.buffer=new Ut,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new Gt(e.encoding),this.encoding=e.encoding)}function Wt(e){if(!(this instanceof Wt))return new Wt(e);this._readableState=new Vt(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),Oe.call(this)}function zt(e,t,n,r,i){var a=function(e,t){var n=null;W.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));return n}(t,n);if(a)e.emit("error",a);else if(null===n)t.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,$t(e)}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var o=new Error("stream.unshift() after end event");e.emit("error",o)}else{var l;!t.decoder||i||r||(n=t.decoder.write(n),l=!t.objectMode&&0===n.length),i||(t.reading=!1),l||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&$t(e))),function(e,t){t.readingMore||(t.readingMore=!0,et(Jt,e,t))}(e,t)}else i||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}gt(Wt,Oe),Wt.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=W.from(e,t),t=""),zt(this,n,e,t,!1)},Wt.prototype.unshift=function(e){return zt(this,this._readableState,e,"",!0)},Wt.prototype.isPaused=function(){return!1===this._readableState.flowing},Wt.prototype.setEncoding=function(e){return this._readableState.decoder=new Gt(e),this._readableState.encoding=e,this};var Xt=8388608;function Qt(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=Xt?e=Xt:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function $t(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(Yt("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?et(Zt,e):Zt(e))}function Zt(e){Yt("emit readable"),e.emit("readable"),nn(e)}function Jt(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(Yt("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function en(e){Yt("readable nexttick read 0"),e.read(0)}function tn(e,t){t.reading||(Yt("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),nn(e),t.flowing&&!t.reading&&e.read(0)}function nn(e){var t=e._readableState;for(Yt("flow",t.flowing);t.flowing&&null!==e.read(););}function rn(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var a=n.data,s=e>a.length?a.length:e;if(s===a.length?i+=a:i+=a.slice(0,e),0===(e-=s)){s===a.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=W.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var a=r.data,s=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,s),0===(e-=s)){s===a.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(s));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function an(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,et(sn,t,e))}function sn(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function on(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function ln(){}function un(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function dn(e,t){Object.defineProperty(this,"buffer",{get:vt((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof bn&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?et(i,r):i(r);e._writableState.errorEmitted=!0,e.emit("error",r)}(e,n,r,t,i);else{var a=pn(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||gn(e,n),r?et(hn,e,n,a,i):hn(e,n,a,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new yn(this)}function cn(e){if(!(this instanceof cn||this instanceof bn))return new cn(e);this._writableState=new dn(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),Oe.call(this)}function fn(e,t,n,r,i,a,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function hn(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),vn(e,t)}function gn(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var s=0;n;)i[s]=n,n=n.next,s+=1;fn(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new yn(t)}else{for(;n;){var o=n.chunk,l=n.encoding,u=n.callback;if(fn(e,t,!1,t.objectMode?1:o.length,o,l,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function pn(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function mn(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function vn(e,t){var n=pn(t);return n&&(0===t.pendingcb?(mn(e,t),t.finished=!0,e.emit("finish")):mn(e,t)),n}function yn(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}Wt.prototype.read=function(e){Yt("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return Yt("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?an(this):$t(this),null;if(0===(e=Qt(e,t))&&t.ended)return 0===t.length&&an(this),null;var r,i=t.needReadable;return Yt("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&Yt("length less than watermark",i=!0),t.ended||t.reading?Yt("reading or ended",i=!1):i&&(Yt("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=Qt(n,t))),null===(r=e>0?rn(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&an(this)),null!==r&&this.emit("data",r),r},Wt.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Wt.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,Yt("pipe count=%d opts=%j",r.pipesCount,t);var i=!t||!1!==t.end?s:u;function a(e){Yt("onunpipe"),e===n&&u()}function s(){Yt("onend"),e.end()}r.endEmitted?et(i):n.once("end",i),e.on("unpipe",a);var o=function(e){return function(){var t=e._readableState;Yt("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,nn(e))}}(n);e.on("drain",o);var l=!1;function u(){Yt("cleanup"),e.removeListener("close",h),e.removeListener("finish",g),e.removeListener("drain",o),e.removeListener("error",f),e.removeListener("unpipe",a),n.removeListener("end",s),n.removeListener("end",u),n.removeListener("data",c),l=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||o()}var d=!1;function c(t){Yt("ondata"),d=!1,!1!==e.write(t)||d||((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==on(r.pipes,e))&&!l&&(Yt("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function f(t){var n;Yt("onerror",t),p(),e.removeListener("error",f),0===(n="error",e.listeners(n).length)&&e.emit("error",t)}function h(){e.removeListener("finish",g),p()}function g(){Yt("onfinish"),e.removeListener("close",h),p()}function p(){Yt("unpipe"),n.unpipe(e)}return n.on("data",c),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",f),e.once("close",h),e.once("finish",g),e.emit("pipe",n),r.flowing||(Yt("pipe resume"),n.resume()),e},Wt.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var a=on(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},Wt.prototype.on=function(e,t){var n=Oe.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&$t(this):et(en,this))}return n},Wt.prototype.addListener=Wt.prototype.on,Wt.prototype.resume=function(){var e=this._readableState;return e.flowing||(Yt("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,et(tn,e,t))}(this,e)),this},Wt.prototype.pause=function(){return Yt("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(Yt("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Wt.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;for(var i in e.on("end",(function(){if(Yt("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(i){(Yt("wrapped data"),t.decoder&&(i=t.decoder.write(i)),t.objectMode&&null==i)||(t.objectMode||i&&i.length)&&(r.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(["error","close","destroy","pause","resume"],(function(t){e.on(t,r.emit.bind(r,t))})),r._read=function(t){Yt("wrapped _read",t),n&&(n=!1,e.resume())},r},Wt._fromList=rn,cn.WritableState=dn,gt(cn,Oe),dn.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},cn.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},cn.prototype.write=function(e,t,n){var r=this._writableState,i=!1;return"function"==typeof t&&(n=t,t=null),W.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=ln),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),et(t,n)}(this,n):function(e,t,n,r){var i=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):W.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),et(r,a),i=!1),i}(this,r,e,n)&&(r.pendingcb++,i=function(e,t,n,r,i){n=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=W.from(t,n));return t}(t,n,r),W.isBuffer(n)&&(r="buffer");var a=t.objectMode?1:n.length;t.length+=a;var s=t.length<t.highWaterMark;s||(t.needDrain=!0);if(t.writing||t.corked){var o=t.lastBufferedRequest;t.lastBufferedRequest=new un(n,r,i),o?o.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else fn(e,t,!1,a,n,r,i);return s}(this,r,e,t,n)),i},cn.prototype.cork=function(){this._writableState.corked++},cn.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||gn(this,e))},cn.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},cn.prototype._write=function(e,t,n){n(new Error("not implemented"))},cn.prototype._writev=null,cn.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,vn(e,t),n&&(t.finished?et(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n)},gt(bn,Wt);for(var En=Object.keys(cn.prototype),_n=0;_n<En.length;_n++){var Tn=En[_n];bn.prototype[Tn]||(bn.prototype[Tn]=cn.prototype[Tn])}function bn(e){if(!(this instanceof bn))return new bn(e);Wt.call(this,e),cn.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Sn)}function Sn(){this.allowHalfOpen||this._writableState.ended||et(An,this)}function An(e){e.end()}function Rn(e){this.afterTransform=function(t,n){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&e.push(n);i(t);var a=e._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&e._read(a.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function In(e){if(!(this instanceof In))return new In(e);bn.call(this,e),this._transformState=new Rn(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){wn(t,e)})):wn(t)}))}function wn(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function Cn(e){if(!(this instanceof Cn))return new Cn(e);In.call(this,e)}function Dn(){Oe.call(this)}gt(In,bn),In.prototype.push=function(e,t){return this._transformState.needTransform=!1,bn.prototype.push.call(this,e,t)},In.prototype._transform=function(e,t,n){throw new Error("Not implemented")},In.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},In.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},gt(Cn,In),Cn.prototype._transform=function(e,t,n){n(null,e)},gt(Dn,Oe),Dn.Readable=Wt,Dn.Writable=cn,Dn.Duplex=bn,Dn.Transform=In,Dn.PassThrough=Cn,Dn.Stream=Dn,Dn.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function i(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",i),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",o));var a=!1;function s(){a||(a=!0,e.end())}function o(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(u(),0===Oe.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",r),e.removeListener("drain",i),n.removeListener("end",s),n.removeListener("close",o),n.removeListener("error",l),e.removeListener("error",l),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",l),e.on("error",l),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};var Mn,Nn=(Mn=Object.freeze({__proto__:null,default:Dn,Readable:Wt,Writable:cn,Duplex:bn,Transform:In,PassThrough:Cn,Stream:Dn}))&&Mn.default||Mn,On=n((function(e,t){!function(e){e.parser=function(e,t){return new r(e,t)},e.SAXParser=r,e.SAXStream=a,e.createStream=function(e,t){return new a(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function r(t,i){if(!(this instanceof r))return new r(t,i);var a=this;!function(e){for(var t=0,r=n.length;t<r;t++)e[n[t]]=""}(a),a.q=a.c="",a.bufferCheckPosition=e.MAX_BUFFER_LENGTH,a.opt=i||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!t,a.noscript=!(!t&&!a.opt.noscript),a.state=A.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(h)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),I(a,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),r.prototype={end:function(){N(this)},write:function(t){var r=this;if(this.error)throw this.error;if(r.closed)return M(r,"Cannot write after close. Assign an onready handler.");if(null===t)return N(r);"object"==typeof t&&(t=t.toString());var i=0,a="";for(;a=G(t,i++),r.c=a,a;)switch(r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++),r.state){case A.BEGIN:if(r.state=A.BEGIN_WHITESPACE,"\ufeff"===a)continue;B(r,a);continue;case A.BEGIN_WHITESPACE:B(r,a);continue;case A.TEXT:if(r.sawRoot&&!r.closedRoot){for(var o=i-1;a&&"<"!==a&&"&"!==a;)(a=G(t,i++))&&r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++);r.textNode+=t.substring(o,i-1)}"<"!==a||r.sawRoot&&r.closedRoot&&!r.strict?(!_(s,a)||r.sawRoot&&!r.closedRoot||O(r,"Text data outside of root node."),"&"===a?r.state=A.TEXT_ENTITY:r.textNode+=a):(r.state=A.OPEN_WAKA,r.startTagPosition=r.position);continue;case A.SCRIPT:"<"===a?r.state=A.SCRIPT_ENDING:r.script+=a;continue;case A.SCRIPT_ENDING:"/"===a?r.state=A.CLOSE_TAG:(r.script+="<"+a,r.state=A.SCRIPT);continue;case A.OPEN_WAKA:if("!"===a)r.state=A.SGML_DECL,r.sgmlDecl="";else if(E(s,a));else if(E(g,a))r.state=A.OPEN_TAG,r.tagName=a;else if("/"===a)r.state=A.CLOSE_TAG,r.tagName="";else if("?"===a)r.state=A.PROC_INST,r.procInstName=r.procInstBody="";else{if(O(r,"Unencoded <"),r.startTagPosition+1<r.position){var l=r.position-r.startTagPosition;a=new Array(l).join(" ")+a}r.textNode+="<"+a,r.state=A.TEXT}continue;case A.SGML_DECL:"[CDATA["===(r.sgmlDecl+a).toUpperCase()?(w(r,"onopencdata"),r.state=A.CDATA,r.sgmlDecl="",r.cdata=""):r.sgmlDecl+a==="--"?(r.state=A.COMMENT,r.comment="",r.sgmlDecl=""):"DOCTYPE"===(r.sgmlDecl+a).toUpperCase()?(r.state=A.DOCTYPE,(r.doctype||r.sawRoot)&&O(r,"Inappropriately located doctype declaration"),r.doctype="",r.sgmlDecl=""):">"===a?(w(r,"onsgmldeclaration",r.sgmlDecl),r.sgmlDecl="",r.state=A.TEXT):E(u,a)?(r.state=A.SGML_DECL_QUOTED,r.sgmlDecl+=a):r.sgmlDecl+=a;continue;case A.SGML_DECL_QUOTED:a===r.q&&(r.state=A.SGML_DECL,r.q=""),r.sgmlDecl+=a;continue;case A.DOCTYPE:">"===a?(r.state=A.TEXT,w(r,"ondoctype",r.doctype),r.doctype=!0):(r.doctype+=a,"["===a?r.state=A.DOCTYPE_DTD:E(u,a)&&(r.state=A.DOCTYPE_QUOTED,r.q=a));continue;case A.DOCTYPE_QUOTED:r.doctype+=a,a===r.q&&(r.q="",r.state=A.DOCTYPE);continue;case A.DOCTYPE_DTD:r.doctype+=a,"]"===a?r.state=A.DOCTYPE:E(u,a)&&(r.state=A.DOCTYPE_DTD_QUOTED,r.q=a);continue;case A.DOCTYPE_DTD_QUOTED:r.doctype+=a,a===r.q&&(r.state=A.DOCTYPE_DTD,r.q="");continue;case A.COMMENT:"-"===a?r.state=A.COMMENT_ENDING:r.comment+=a;continue;case A.COMMENT_ENDING:"-"===a?(r.state=A.COMMENT_ENDED,r.comment=D(r.opt,r.comment),r.comment&&w(r,"oncomment",r.comment),r.comment=""):(r.comment+="-"+a,r.state=A.COMMENT);continue;case A.COMMENT_ENDED:">"!==a?(O(r,"Malformed comment"),r.comment+="--"+a,r.state=A.COMMENT):r.state=A.TEXT;continue;case A.CDATA:"]"===a?r.state=A.CDATA_ENDING:r.cdata+=a;continue;case A.CDATA_ENDING:"]"===a?r.state=A.CDATA_ENDING_2:(r.cdata+="]"+a,r.state=A.CDATA);continue;case A.CDATA_ENDING_2:">"===a?(r.cdata&&w(r,"oncdata",r.cdata),w(r,"onclosecdata"),r.cdata="",r.state=A.TEXT):"]"===a?r.cdata+="]":(r.cdata+="]]"+a,r.state=A.CDATA);continue;case A.PROC_INST:"?"===a?r.state=A.PROC_INST_ENDING:E(s,a)?r.state=A.PROC_INST_BODY:r.procInstName+=a;continue;case A.PROC_INST_BODY:if(!r.procInstBody&&E(s,a))continue;"?"===a?r.state=A.PROC_INST_ENDING:r.procInstBody+=a;continue;case A.PROC_INST_ENDING:">"===a?(w(r,"onprocessinginstruction",{name:r.procInstName,body:r.procInstBody}),r.procInstName=r.procInstBody="",r.state=A.TEXT):(r.procInstBody+="?"+a,r.state=A.PROC_INST_BODY);continue;case A.OPEN_TAG:E(p,a)?r.tagName+=a:(P(r),">"===a?x(r):"/"===a?r.state=A.OPEN_TAG_SLASH:(_(s,a)&&O(r,"Invalid character in tag name"),r.state=A.ATTRIB));continue;case A.OPEN_TAG_SLASH:">"===a?(x(r,!0),F(r)):(O(r,"Forward-slash in opening tag not followed by >"),r.state=A.ATTRIB);continue;case A.ATTRIB:if(E(s,a))continue;">"===a?x(r):"/"===a?r.state=A.OPEN_TAG_SLASH:E(g,a)?(r.attribName=a,r.attribValue="",r.state=A.ATTRIB_NAME):O(r,"Invalid attribute name");continue;case A.ATTRIB_NAME:"="===a?r.state=A.ATTRIB_VALUE:">"===a?(O(r,"Attribute without value"),r.attribValue=r.attribName,k(r),x(r)):E(s,a)?r.state=A.ATTRIB_NAME_SAW_WHITE:E(p,a)?r.attribName+=a:O(r,"Invalid attribute name");continue;case A.ATTRIB_NAME_SAW_WHITE:if("="===a)r.state=A.ATTRIB_VALUE;else{if(E(s,a))continue;O(r,"Attribute without value"),r.tag.attributes[r.attribName]="",r.attribValue="",w(r,"onattribute",{name:r.attribName,value:""}),r.attribName="",">"===a?x(r):E(g,a)?(r.attribName=a,r.state=A.ATTRIB_NAME):(O(r,"Invalid attribute name"),r.state=A.ATTRIB)}continue;case A.ATTRIB_VALUE:if(E(s,a))continue;E(u,a)?(r.q=a,r.state=A.ATTRIB_VALUE_QUOTED):(O(r,"Unquoted attribute value"),r.state=A.ATTRIB_VALUE_UNQUOTED,r.attribValue=a);continue;case A.ATTRIB_VALUE_QUOTED:if(a!==r.q){"&"===a?r.state=A.ATTRIB_VALUE_ENTITY_Q:r.attribValue+=a;continue}k(r),r.q="",r.state=A.ATTRIB_VALUE_CLOSED;continue;case A.ATTRIB_VALUE_CLOSED:E(s,a)?r.state=A.ATTRIB:">"===a?x(r):"/"===a?r.state=A.OPEN_TAG_SLASH:E(g,a)?(O(r,"No whitespace between attributes"),r.attribName=a,r.attribValue="",r.state=A.ATTRIB_NAME):O(r,"Invalid attribute name");continue;case A.ATTRIB_VALUE_UNQUOTED:if(_(d,a)){"&"===a?r.state=A.ATTRIB_VALUE_ENTITY_U:r.attribValue+=a;continue}k(r),">"===a?x(r):r.state=A.ATTRIB;continue;case A.CLOSE_TAG:if(r.tagName)">"===a?F(r):E(p,a)?r.tagName+=a:r.script?(r.script+="</"+r.tagName,r.tagName="",r.state=A.SCRIPT):(_(s,a)&&O(r,"Invalid tagname in closing tag"),r.state=A.CLOSE_TAG_SAW_WHITE);else{if(E(s,a))continue;_(g,a)?r.script?(r.script+="</"+a,r.state=A.SCRIPT):O(r,"Invalid tagname in closing tag."):r.tagName=a}continue;case A.CLOSE_TAG_SAW_WHITE:if(E(s,a))continue;">"===a?F(r):O(r,"Invalid characters in closing tag");continue;case A.TEXT_ENTITY:case A.ATTRIB_VALUE_ENTITY_Q:case A.ATTRIB_VALUE_ENTITY_U:var c,f;switch(r.state){case A.TEXT_ENTITY:c=A.TEXT,f="textNode";break;case A.ATTRIB_VALUE_ENTITY_Q:c=A.ATTRIB_VALUE_QUOTED,f="attribValue";break;case A.ATTRIB_VALUE_ENTITY_U:c=A.ATTRIB_VALUE_UNQUOTED,f="attribValue"}";"===a?(r[f]+=U(r),r.entity="",r.state=c):E(r.entity.length?v:m,a)?r.entity+=a:(O(r,"Invalid character in entity name"),r[f]+="&"+r.entity+a,r.entity="",r.state=c);continue;default:throw new Error(r,"Unknown state: "+r.state)}r.position>=r.bufferCheckPosition&&function(t){for(var r=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,a=0,s=n.length;a<s;a++){var o=t[n[a]].length;if(o>r)switch(n[a]){case"textNode":C(t);break;case"cdata":w(t,"oncdata",t.cdata),t.cdata="";break;case"script":w(t,"onscript",t.script),t.script="";break;default:M(t,"Max buffer length exceeded: "+n[a])}i=Math.max(i,o)}var l=e.MAX_BUFFER_LENGTH-i;t.bufferCheckPosition=l+t.position}(r);return r}
/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;C(e=this),""!==e.cdata&&(w(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(w(e,"onscript",e.script),e.script="")}};try{t=Nn.Stream}catch(e){t=function(){}}var i=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function a(e,n){if(!(this instanceof a))return new a(e,n);t.apply(this),this._parser=new r(e,n),this.writable=!0,this.readable=!0;var s=this;this._parser.onend=function(){s.emit("end")},this._parser.onerror=function(e){s.emit("error",e),s._parser.error=null},this._decoder=null,i.forEach((function(e){Object.defineProperty(s,"on"+e,{get:function(){return s._parser["on"+e]},set:function(t){if(!t)return s.removeAllListeners(e),s._parser["on"+e]=t,t;s.on(e,t)},enumerable:!0,configurable:!1})}))}a.prototype=Object.create(t.prototype,{constructor:{value:a}}),a.prototype.write=function(e){if("function"==typeof W.isBuffer&&W.isBuffer(e)){if(!this._decoder){var t=Kt.StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},a.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},a.prototype.on=function(e,n){var r=this;return r._parser["on"+e]||-1===i.indexOf(e)||(r._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),t.prototype.on.call(r,e,n)};var s="\r\n\t ",o="0124356789",l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",u="'\"",d=s+">",c="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",h={xml:c,xmlns:f};s=y(s),o=y(o),l=y(l);var g=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function y(e){return e.split("").reduce((function(e,t){return e[t]=!0,e}),{})}function E(e,t){return function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e)?!!t.match(e):e[t]}function _(e,t){return!E(e,t)}u=y(u),d=y(d);var T,b,S,A=0;for(var R in e.STATE={BEGIN:A++,BEGIN_WHITESPACE:A++,TEXT:A++,TEXT_ENTITY:A++,OPEN_WAKA:A++,SGML_DECL:A++,SGML_DECL_QUOTED:A++,DOCTYPE:A++,DOCTYPE_QUOTED:A++,DOCTYPE_DTD:A++,DOCTYPE_DTD_QUOTED:A++,COMMENT_STARTING:A++,COMMENT:A++,COMMENT_ENDING:A++,COMMENT_ENDED:A++,CDATA:A++,CDATA_ENDING:A++,CDATA_ENDING_2:A++,PROC_INST:A++,PROC_INST_BODY:A++,PROC_INST_ENDING:A++,OPEN_TAG:A++,OPEN_TAG_SLASH:A++,ATTRIB:A++,ATTRIB_NAME:A++,ATTRIB_NAME_SAW_WHITE:A++,ATTRIB_VALUE:A++,ATTRIB_VALUE_QUOTED:A++,ATTRIB_VALUE_CLOSED:A++,ATTRIB_VALUE_UNQUOTED:A++,ATTRIB_VALUE_ENTITY_Q:A++,ATTRIB_VALUE_ENTITY_U:A++,CLOSE_TAG:A++,CLOSE_TAG_SAW_WHITE:A++,SCRIPT:A++,SCRIPT_ENDING:A++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var n=e.ENTITIES[t],r="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=r})),e.STATE)e.STATE[e.STATE[R]]=R;function I(e,t,n){e[t]&&e[t](n)}function w(e,t,n){e.textNode&&C(e),I(e,t,n)}function C(e){e.textNode=D(e.opt,e.textNode),e.textNode&&I(e,"ontext",e.textNode),e.textNode=""}function D(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function M(e,t){return C(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,I(e,"onerror",t),e}function N(e){return e.sawRoot&&!e.closedRoot&&O(e,"Unclosed root tag"),e.state!==A.BEGIN&&e.state!==A.BEGIN_WHITESPACE&&e.state!==A.TEXT&&M(e,"Unexpected end"),C(e),e.c="",e.closed=!0,I(e,"onend"),r.call(e,e.strict,e.opt),e}function O(e,t){if("object"!=typeof e||!(e instanceof r))throw new Error("bad call to strictFail");e.strict&&M(e,t)}function P(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,w(e,"onopentagstart",n)}function L(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),r=n[0],i=n[1];return t&&"xmlns"===e&&(r="xmlns",i=""),{prefix:r,local:i}}function k(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=L(e.attribName,!0),n=t.prefix,r=t.local;if("xmlns"===n)if("xml"===r&&e.attribValue!==c)O(e,"xml: prefix must be bound to "+c+"\nActual: "+e.attribValue);else if("xmlns"===r&&e.attribValue!==f)O(e,"xmlns: prefix must be bound to "+f+"\nActual: "+e.attribValue);else{var i=e.tag,a=e.tags[e.tags.length-1]||e;i.ns===a.ns&&(i.ns=Object.create(a.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,w(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function x(e,t){if(e.opt.xmlns){var n=e.tag,r=L(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(O(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach((function(t){w(e,"onopennamespace",{prefix:t,uri:n.ns[t]})}));for(var a=0,s=e.attribList.length;a<s;a++){var o=e.attribList[a],l=o[0],u=o[1],d=L(l,!0),c=d.prefix,f=d.local,h=""===c?"":n.ns[c]||"",g={name:l,value:u,prefix:c,local:f,uri:h};c&&"xmlns"!==c&&!h&&(O(e,"Unbound namespace prefix: "+JSON.stringify(c)),g.uri=c),e.tag.attributes[l]=g,w(e,"onattribute",g)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),w(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=A.TEXT:e.state=A.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function F(e){if(!e.tagName)return O(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=A.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=A.SCRIPT);w(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var r=n;t--;){if(e.tags[t].name===r)break;O(e,"Unexpected close tag")}if(t<0)return O(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=A.TEXT);e.tagName=n;for(var i=e.tags.length;i-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,w(e,"onclosetag",e.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach((function(t){var n=a.ns[t];w(e,"onclosenamespace",{prefix:t,uri:n})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=A.TEXT}function U(e){var t,n=e.entity,r=n.toLowerCase(),i="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[r]?e.ENTITIES[r]:("#"===(n=r).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),i=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),i=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),i.toLowerCase()!==n?(O(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function B(e,t){"<"===t?(e.state=A.OPEN_WAKA,e.startTagPosition=e.position):_(s,t)&&(O(e,"Non-whitespace before first tag."),e.textNode=t,e.state=A.TEXT)}function G(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}A=e.STATE,String.fromCodePoint||(T=String.fromCharCode,b=Math.floor,S=function(){var e,t,n=16384,r=[],i=-1,a=arguments.length;if(!a)return"";for(var s="";++i<a;){var o=Number(arguments[i]);if(!isFinite(o)||o<0||o>1114111||b(o)!==o)throw RangeError("Invalid code point: "+o);o<=65535?r.push(o):(e=55296+((o-=65536)>>10),t=o%1024+56320,r.push(e,t)),(i+1===a||r.length>n)&&(s+=T.apply(null,r),r.length=0)}return s},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:S,configurable:!0,writable:!0}):String.fromCodePoint=S)}(t)})),Pn=n((function(e,t){!function(e,t,n,r,i){function a(e){if("contents"in e)for(var t=("styleAttrs"in e?e.styleAttrs[r.byName.ruby.qname]:null),n="span"===e.kind&&("container"===t||"textContainer"===t||"baseContainer"===t),i=e.contents.length-1;i>=0;i--)!n||"styleAttrs"in e.contents[i]&&r.byName.ruby.qname in e.contents[i].styleAttrs?a(e.contents[i]):delete e.contents[i]}function s(e,t,n,r){var i=r&&"seq"===r.timeContainer,a=0;r&&(a=i&&n?n.end:r.begin),t.begin=t.explicit_begin?t.explicit_begin+a:a;var o=t.begin,l=null;for(var u in t.sets)s(e,t.sets[u],l,t),o="seq"===t.timeContainer?t.sets[u].end:Math.max(o,t.sets[u].end),l=t.sets[u];if("contents"in t)for(var d in t.contents)s(e,t.contents[d],l,t),o="seq"===t.timeContainer?t.contents[d].end:Math.max(o,t.contents[d].end),l=t.contents[d];else o=i?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,a+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=a+t.explicit_end:t.end=o,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function o(e){this.node=e}function l(){this.events=[],this.head=new u,this.body=null}function u(){this.styling=new d,this.layout=new h}function d(){this.styles={},this.initials={}}function c(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function f(){this.styleAttrs=null}function h(){this.regions={}}function g(e,t){p.call(this,"image"),this.src=e,this.type=t}function p(e){this.kind=e}function m(e){this.id=e}function v(e){this.regionID=e}function y(e){this.styleAttrs=e}function E(e){this.sets=e}function _(e){this.contents=e}function T(e,t,n){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=n}function b(){p.call(this,"body")}function S(){p.call(this,"div")}function A(){p.call(this,"p")}function R(){p.call(this,"span")}function I(){p.call(this,"span")}function w(){p.call(this,"br")}function C(){}function D(){}function M(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function N(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function O(e,t){var n={};if(null!==e)for(var i in e.attributes){var a=e.attributes[i].uri+" "+e.attributes[i].local,s=r.byQName[a];if(void 0!==s){var o=s.parse(e.attributes[i].value);null!==o?(n[a]=o,s===r.byName.zIndex&&U(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):B(t,"Cannot parse styling attribute "+a+" --\x3e "+e.attributes[i].value)}}return n}function P(e,t,n){for(var r in e.attributes)if(e.attributes[r].uri===t&&e.attributes[r].local===n)return e.attributes[r].value;return null}function L(e,t,n){var r,i=null;return null!==(r=/^(\d+(?:\.\d+)?)f$/.exec(n))?null!==t&&(i=parseFloat(r[1])/t):null!==(r=/^(\d+(?:\.\d+)?)t$/.exec(n))?null!==e&&(i=parseFloat(r[1])/e):null!==(r=/^(\d+(?:\.\d+)?)ms$/.exec(n))?i=parseFloat(r[1])/1e3:null!==(r=/^(\d+(?:\.\d+)?)s$/.exec(n))?i=parseFloat(r[1]):null!==(r=/^(\d+(?:\.\d+)?)h$/.exec(n))?i=3600*parseFloat(r[1]):null!==(r=/^(\d+(?:\.\d+)?)m$/.exec(n))?i=60*parseFloat(r[1]):null!==(r=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(n))?i=3600*parseInt(r[1])+60*parseInt(r[2])+parseFloat(r[3]):null!==(r=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(n))&&null!==t&&(i=3600*parseInt(r[1])+60*parseInt(r[2])+parseInt(r[3])+(null===r[4]?0:parseInt(r[4])/t)),i}function k(e,t,n){for(;t.styleRefs.length>0;){var r=t.styleRefs.pop();r in e.styles?(k(e,e.styles[r],n),F(e.styles[r].styleAttrs,t.styleAttrs)):B(n,"Non-existant style id referenced")}}function x(e,t,n,r){for(var i=t.length-1;i>=0;i--){var a=t[i];a in e.styles?F(e.styles[a].styleAttrs,n):B(r,"Non-existant style id referenced")}}function F(e,t){for(var n in e)n in t||(t[n]=e[n])}function U(e,t){if(e&&e.warn&&e.warn(t))throw t}function B(e,t){if(e&&e.error&&e.error(t))throw t}function G(e,t){throw e&&e.fatal&&e.fatal(t),t}function j(e,t){for(var n,r=0,i=e.length-1;r<=i;){var a=e[n=Math.floor((r+i)/2)];if(a<t)r=n+1;else{if(!(a>t))return{found:!0,index:n};i=n-1}}return{found:!1,index:r}}e.fromXML=function(e,i,p){var m=t.parser(!0,{xmlns:!0}),v=[],y=[],E=[],_=0,T=null;m.onclosetag=function(e){if(v[0]instanceof C)null!==T.head&&null!==T.head.styling&&x(T.head.styling,v[0].styleRefs,v[0].styleAttrs,i),delete v[0].styleRefs;else if(v[0]instanceof d)for(var t in v[0].styles)k(v[0],v[0].styles[t],i);else if(v[0]instanceof A||v[0]instanceof R){if(v[0].contents.length>1){var r,a=[v[0].contents[0]];for(r=1;r<v[0].contents.length;r++)v[0].contents[r]instanceof I&&a[a.length-1]instanceof I?a[a.length-1].text+=v[0].contents[r].text:a.push(v[0].contents[r]);v[0].contents=a}v[0]instanceof R&&1===v[0].contents.length&&v[0].contents[0]instanceof I&&(v[0].text=v[0].contents[0].text,delete v[0].contents)}else v[0]instanceof o&&(v[0].node.uri===n.ns_tt&&"metadata"===v[0].node.local?_--:_>0&&p&&"onCloseTag"in p&&p.onCloseTag());E.shift(),y.shift(),v.shift()},m.ontext=function(e){if(void 0===v[0]);else if(v[0]instanceof R||v[0]instanceof A){if(v[0]instanceof R){var t=v[0].styleAttrs[r.byName.ruby.qname];if("container"===t||"textContainer"===t||"baseContainer"===t)return}var n=new I;n.initFromText(T,v[0],e,y[0],E[0],i),v[0].contents.push(n)}else v[0]instanceof o&&_>0&&p&&"onText"in p&&p.onText(e)},m.onopentag=function(e){var t=e.attributes["xml:space"];t?E.unshift(t.value):0===E.length?E.unshift("default"):E.unshift(E[0]);var a=e.attributes["xml:lang"];if(a?y.unshift(a.value):0===y.length?y.unshift(""):y.unshift(y[0]),e.uri===n.ns_tt)if("tt"===e.local)null!==T&&G(i,"Two <tt> elements at ("+this.line+","+this.column+")"),(T=new l).initFromNode(e,y[0],i),v.unshift(T);else if("head"===e.local)v[0]instanceof l||G(i,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),v.unshift(T.head);else if("styling"===e.local)v[0]instanceof u||G(i,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),v.unshift(T.head.styling);else if("style"===e.local){var s;v[0]instanceof d?((s=new c).initFromNode(e,i),s.id?T.head.styling.styles[s.id]=s:B(i,"<style> element missing @id attribute"),v.unshift(s)):v[0]instanceof C?((s=new c).initFromNode(e,i),F(s.styleAttrs,v[0].styleAttrs),v.unshift(s)):G(i,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===e.local){var m;if(v[0]instanceof d){for(var I in(m=new f).initFromNode(e,i),m.styleAttrs)T.head.styling.initials[I]=m.styleAttrs[I];v.unshift(m)}else G(i,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===e.local)v[0]instanceof u||G(i,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),v.unshift(T.head.layout);else if("region"===e.local){v[0]instanceof h||G(i,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var M=new C;M.initFromNode(T,e,y[0],i),!M.id||M.id in T.head.layout.regions?B(i,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):T.head.layout.regions[M.id]=M,v.unshift(M)}else if("body"===e.local){v[0]instanceof l||G(i,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==T.body&&G(i,"Second <body> element at "+this.line+","+this.column+")");var N=new b;N.initFromNode(T,e,y[0],i),T.body=N,v.unshift(N)}else if("div"===e.local){v[0]instanceof S||v[0]instanceof b||G(i,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var O=new S;O.initFromNode(T,v[0],e,y[0],i);var P=O.styleAttrs[r.byName.backgroundImage.qname];P&&(O.contents.push(new g(P)),delete O.styleAttrs[r.byName.backgroundImage.qname]),v[0].contents.push(O),v.unshift(O)}else if("image"===e.local){v[0]instanceof S||G(i,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var L=new g;L.initFromNode(T,v[0],e,y[0],i),v[0].contents.push(L),v.unshift(L)}else if("p"===e.local){v[0]instanceof S||G(i,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var k=new A;k.initFromNode(T,v[0],e,y[0],i),v[0].contents.push(k),v.unshift(k)}else if("span"===e.local){v[0]instanceof R||v[0]instanceof A||G(i,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var x=new R;x.initFromNode(T,v[0],e,y[0],E[0],i),v[0].contents.push(x),v.unshift(x)}else if("br"===e.local){v[0]instanceof R||v[0]instanceof A||G(i,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var U=new w;U.initFromNode(T,v[0],e,y[0],i),v[0].contents.push(U),v.unshift(U)}else if("set"===e.local){v[0]instanceof R||v[0]instanceof A||v[0]instanceof S||v[0]instanceof b||v[0]instanceof C||v[0]instanceof w||G(i,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var j=new D;j.initFromNode(T,v[0],e,i),v[0].sets.push(j),v.unshift(j)}else v.unshift(new o(e));else v.unshift(new o(e));if(v[0]instanceof o)if(e.uri===n.ns_tt&&"metadata"===e.local)_++;else if(_>0&&p&&"onOpenTag"in p){var H=[];for(var q in e.attributes)H[e.attributes[q].uri+" "+e.attributes[q].local]={uri:e.attributes[q].uri,local:e.attributes[q].local,value:e.attributes[q].value};p.onOpenTag(e.uri,e.local,H)}},m.write(e).close(),delete T.head.styling.styles;var M=!1;for(var N in T.head.layout.regions){M=!0;break}if(!M){var O=C.prototype.createDefaultRegion(T.lang);T.head.layout.regions[O.id]=O}for(var P in T.head.layout.regions)s(T,T.head.layout.regions[P],null,null);return T.body&&s(T,T.body,null,null),T.body&&a(T.body),T},l.prototype.initFromNode=function(e,t,r){var a=function(e,t){var r=P(e,n.ns_ttp,"cellResolution"),i=15,a=32;if(null!==r){var s=/(\d+) (\d+)/.exec(r);null!==s?(a=parseInt(s[1]),i=parseInt(s[2])):U(t,"Malformed cellResolution value (using initial value instead)")}return{w:a,h:i}}(e,r);this.cellLength={h:new i.ComputedLength(0,1/a.h),w:new i.ComputedLength(1/a.w,0)};var s=function(e,t){var r,i=P(e,n.ns_ttp,"frameRate"),a=30;if(null!==i){null!==(r=/(\d+)/.exec(i))?a=parseInt(r[1]):U(t,"Malformed frame rate attribute (using initial value instead)")}var s=P(e,n.ns_ttp,"frameRateMultiplier"),o=1;if(null!==s){null!==(r=/(\d+) (\d+)/.exec(s))?o=parseInt(r[1])/parseInt(r[2]):U(t,"Malformed frame rate multiplier attribute (using initial value instead)")}var l=o*a,u=1,d=P(e,n.ns_ttp,"tickRate");if(null===d)null!==i&&(u=l);else{null!==(r=/(\d+)/.exec(d))?u=parseInt(r[1]):U(t,"Malformed tick rate attribute (using initial value instead)")}return{effectiveFrameRate:l,tickRate:u}}(e,r);this.effectiveFrameRate=s.effectiveFrameRate,this.tickRate=s.tickRate,this.aspectRatio=function(e,t){var r=P(e,n.ns_ittp,"aspectRatio");null===r&&(r=P(e,n.ns_ttp,"displayAspectRatio"));var i=null;if(null!==r){var a=/(\d+)\s+(\d+)/.exec(r);if(null!==a){var s=parseInt(a[1]),o=parseInt(a[2]);0!==s&&0!==o?i=s/o:B(t,"Illegal aspectRatio values (ignoring)")}else B(t,"Malformed aspectRatio attribute (ignoring)")}return i}(e,r);var o=P(e,n.ns_ttp,"timeBase");null!==o&&"media"!==o&&G(r,"Unsupported time base");var l=function(e,t){var r=P(e,n.ns_tts,"extent");if(null===r)return null;var a=r.split(" ");if(2!==a.length)return U(t,"Malformed extent (ignoring)"),null;var s=i.parseLength(a[0]),o=i.parseLength(a[1]);if(!o||!s)return U(t,"Malformed extent values (ignoring)"),null;return{h:o,w:s}}(e,r);null===l?this.pxLength={h:null,w:null}:("px"===l.h.unit&&"px"===l.w.unit||G(r,"Extent on TT must be in px or absent"),this.pxLength={h:new i.ComputedLength(0,1/l.h.value),w:new i.ComputedLength(1/l.w.value,0)}),this.dimensions={h:new i.ComputedLength(0,1),w:new i.ComputedLength(1,0)},this.lang=t},l.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=j(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var n=j(this.events,e.end);n.found||this.events.splice(n.index,0,e.end)}}},l.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},l.prototype.getMediaTimeEvents=function(){return this.events},c.prototype.initFromNode=function(e,t){this.id=M(e),this.styleAttrs=O(e,t),this.styleRefs=N(e)},f.prototype.initFromNode=function(e,t){for(var r in this.styleAttrs={},e.attributes)if(e.attributes[r].uri===n.ns_itts||e.attributes[r].uri===n.ns_ebutts||e.attributes[r].uri===n.ns_tts){var i=e.attributes[r].uri+" "+e.attributes[r].local;this.styleAttrs[i]=e.attributes[r].value}},g.prototype.initFromNode=function(e,t,n,r,i){this.src="src"in n.attributes?n.attributes.src.value:null,this.src||B(i,"Invalid image@src attribute"),this.type="type"in n.attributes?n.attributes.type.value:null,this.type||B(i,"Invalid image@type attribute"),y.prototype.initFromNode.call(this,e,t,n,i),T.prototype.initFromNode.call(this,e,t,n,i),E.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},m.prototype.initFromNode=function(e,t,n,r){this.id=M(n)},v.prototype.initFromNode=function(e,t,n,r){this.regionID=function(e){return e&&"region"in e.attributes?e.attributes.region.value:""}(n)},y.prototype.initFromNode=function(e,t,n,r){this.styleAttrs=O(n,r),null!==e.head&&null!==e.head.styling&&x(e.head.styling,N(n),this.styleAttrs,r)},E.prototype.initFromNode=function(e,t,n,r){this.sets=[]},_.prototype.initFromNode=function(e,t,n,r){this.contents=[]},T.prototype.initFromNode=function(e,t,n,r){var i=function(e,t,n,r){var i=null;n&&"begin"in n.attributes&&null===(i=L(e.tickRate,e.effectiveFrameRate,n.attributes.begin.value))&&U(r,"Malformed begin value "+n.attributes.begin.value+" (using 0)");var a=null;n&&"dur"in n.attributes&&null===(a=L(e.tickRate,e.effectiveFrameRate,n.attributes.dur.value))&&U(r,"Malformed dur value "+n.attributes.dur.value+" (ignoring)");var s=null;n&&"end"in n.attributes&&null===(s=L(e.tickRate,e.effectiveFrameRate,n.attributes.end.value))&&U(r,"Malformed end value (ignoring)");return{explicit_begin:i,explicit_end:s,explicit_dur:a}}(e,0,n,r);this.explicit_begin=i.explicit_begin,this.explicit_end=i.explicit_end,this.explicit_dur=i.explicit_dur,this.timeContainer=function(e,t){var n=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null;return n&&"par"!==n?"seq"===n?"seq":(B(t,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(n,r)},b.prototype.initFromNode=function(e,t,n,r){y.prototype.initFromNode.call(this,e,null,t,r),T.prototype.initFromNode.call(this,e,null,t,r),E.prototype.initFromNode.call(this,e,null,t,r),v.prototype.initFromNode.call(this,e,null,t,r),_.prototype.initFromNode.call(this,e,null,t,r),this.lang=n},S.prototype.initFromNode=function(e,t,n,r,i){y.prototype.initFromNode.call(this,e,t,n,i),T.prototype.initFromNode.call(this,e,t,n,i),E.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),_.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},A.prototype.initFromNode=function(e,t,n,r,i){y.prototype.initFromNode.call(this,e,t,n,i),T.prototype.initFromNode.call(this,e,t,n,i),E.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),_.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},R.prototype.initFromNode=function(e,t,n,r,i,a){y.prototype.initFromNode.call(this,e,t,n,a),T.prototype.initFromNode.call(this,e,t,n,a),E.prototype.initFromNode.call(this,e,t,n,a),v.prototype.initFromNode.call(this,e,t,n,a),_.prototype.initFromNode.call(this,e,t,n,a),this.space=i,this.lang=r},I.prototype.initFromText=function(e,t,n,r,i,a){T.prototype.initFromNode.call(this,e,t,null,a),this.text=n,this.space=i,this.lang=r},w.prototype.initFromNode=function(e,t,n,r,i){v.prototype.initFromNode.call(this,e,t,n,i),T.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},C.prototype.createDefaultRegion=function(e){var t=new C;return m.call(t,""),y.call(t,{}),E.call(t,[]),T.call(t,0,Number.POSITIVE_INFINITY,null),this.lang=e,t},C.prototype.initFromNode=function(e,t,n,r){m.prototype.initFromNode.call(this,e,null,t,r),T.prototype.initFromNode.call(this,e,null,t,r),E.prototype.initFromNode.call(this,e,null,t,r),this.styleAttrs=O(t,r),this.styleRefs=N(t),this.lang=n},D.prototype.initFromNode=function(e,t,n,r){T.prototype.initFromNode.call(this,e,t,n,r);var i=O(n,r);for(var a in this.qname=null,this.value=null,i){if(this.qname){B(r,"More than one style specified on set");break}this.qname=a,this.value=i[a]}}}(t,"undefined"==typeof sax?On:sax,"undefined"==typeof imscNames?D:imscNames,"undefined"==typeof imscStyles?N:imscStyles,"undefined"==typeof imscUtils?M:imscUtils)})),Ln=n((function(e,t){!function(e,t,n){function r(e,t,l,d){var c;if("region"===l.kind)(c=document.createElement("div")).style.position="absolute";else if("body"===l.kind)c=document.createElement("div");else if("div"===l.kind)c=document.createElement("div");else if("image"===l.kind){if(c=document.createElement("img"),null!==e.imgResolver&&null!==l.src){var g=e.imgResolver(l.src,c);g&&(c.src=g),c.height=e.regionH,c.width=e.regionW}}else if("p"===l.kind)c=document.createElement("p");else if("span"===l.kind)if("container"===l.styleAttrs[n.byName.ruby.qname])c=document.createElement("ruby"),e.ruby=!0;else if("base"===l.styleAttrs[n.byName.ruby.qname])c=document.createElement("rb");else if("text"===l.styleAttrs[n.byName.ruby.qname])c=document.createElement("rt");else if("baseContainer"===l.styleAttrs[n.byName.ruby.qname])c=document.createElement("rbc");else if("textContainer"===l.styleAttrs[n.byName.ruby.qname])c=document.createElement("rtc");else{if("delimiter"===l.styleAttrs[n.byName.ruby.qname])return;c=document.createElement("span")}else"br"===l.kind&&(c=document.createElement("br"));if(c){if(l.lang&&("region"!==l.kind&&l.lang===d.lang||(c.lang=l.lang)),t.appendChild(c),c.style.margin="0","region"===l.kind){var m=l.styleAttrs[n.byName.writingMode.qname];"lrtb"===m||"lr"===m?(e.ipd="lr",e.bpd="tb"):"rltb"===m||"rl"===m?(e.ipd="rl",e.bpd="tb"):"tblr"===m?(e.ipd="tb",e.bpd="lr"):"tbrl"!==m&&"tb"!==m||(e.ipd="tb",e.bpd="rl")}else if("p"===l.kind&&"tb"===e.bpd){var v=l.styleAttrs[n.byName.direction.qname];e.ipd="ltr"===v?"lr":"rl"}for(var y in u){var E=u[y],_=l.styleAttrs[E.qname];void 0!==_&&null!==E.map&&E.map(e,c,l,_)}var T=c,b=l.styleAttrs[n.byName.linePadding.qname];if(b&&!b.isZero()){var S=b.toUsedLength(e.w,e.h);if(S>0){var A=Math.ceil(S)+"px";"tb"===e.bpd?(T.style.paddingLeft=A,T.style.paddingRight=A):(T.style.paddingTop=A,T.style.paddingBottom=A),e.lp=b}}var R=l.styleAttrs[n.byName.multiRowAlign.qname];if(R&&"auto"!==R){var I=document.createElement("span");I.style.display="inline-block",I.style.textAlign=R,c.appendChild(I),T=I,e.mra=R}var w=l.styleAttrs[n.byName.rubyReserve.qname];if(w&&"none"!==w[0]&&(e.rubyReserve=w),l.styleAttrs[n.byName.fillLineGap.qname]&&(e.flg=!0),"span"===l.kind&&l.text){var C=l.styleAttrs[n.byName.textEmphasis.qname];if(C&&"none"!==C.style&&(e.textEmphasis=!0),n.byName.textCombine.qname in l.styleAttrs&&"all"===l.styleAttrs[n.byName.textCombine.qname])c.textContent=l.text,C&&o(e,c,l,C);else for(var D="",M=0;M<l.text.length;M++){D+=l.text.charAt(M);var N=l.text.charCodeAt(M);if(N<55296||N>56319||M===l.text.length){var O=document.createElement("span");O.textContent=D,C&&o(e,O,l,C),c.appendChild(O),D=""}}}for(var P in l.contents)r(e,T,l.contents[P],l);var L=[];if((e.lp||e.mra||e.flg||e.ruby||e.textEmphasis||e.rubyReserve)&&"p"===l.kind&&(s(e,T,L,null),e.rubyReserve&&(!function(e,t){for(var n=0;n<e.length;n++){var r,i,a=document.createElement("ruby"),s=document.createElement("rb");s.textContent="​",a.appendChild(s);var o,l=t.rubyReserve[1].toUsedLength(t.w,t.h)+"px";if("both"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&1==e.length)(r=document.createElement("rtc")).style[h]=f?"after":"under",r.textContent="​",r.style.fontSize=l,(i=document.createElement("rtc")).style[h]=f?"before":"over",i.textContent="​",i.style.fontSize=l,a.appendChild(r),a.appendChild(i);else(r=document.createElement("rtc")).textContent="​",r.style.fontSize=l,o="after"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&n>0?f?"after":"tb"===t.bpd||"rl"===t.bpd?"under":"over":f?"before":"tb"===t.bpd||"rl"===t.bpd?"over":"under",r.style[h]=o,a.appendChild(r);for(var u=null,d=0;d<e[n].rbc.length;d++)if("ruby"===e[n].rbc[d].localName){u=e[n].rbc[d];for(var c=0;c<u.style.length;c++)a.style.setProperty(u.style.item(c),u.style.getPropertyValue(u.style.item(c)));break}(u=u||e[n].elements[0].node).parentElement.insertBefore(a,u)}}(L,e),e.rubyReserve=null),(e.ruby||e.rubyReserve)&&(!function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[n].rbc.length;r++){var i;if(!e[n].rbc[r].style[h])i=f?0===n?"before":"after":"tb"===t.bpd||"rl"===t.bpd?0===n?"over":"under":0===n?"under":"over",e[n].rbc[r].style[h]=i}}(L,e),e.ruby=null),e.textEmphasis&&(!function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[n].te.length;r++){var i;if(!e[n].te[r].style[p]||"none"===e[n].te[r].style[p])i="tb"===t.bpd?0===n?"left over":"left under":"rl"===t.bpd?0===n?"right under":"left under":0===n?"left under":"right under",e[n].te[r].style[p]=i}}(L,e),e.textEmphasis=null),e.mra&&(!function(e){for(var t=0;t<e.length-1;t++){var n=e[t].elements.length;if(0!==n&&!1===e[t].br){var r=document.createElement("br"),i=e[t].elements[n-1].node;i.parentElement.insertBefore(r,i.nextSibling)}}}(L),e.mra=null),e.lp&&(!function(e,t,n){for(var r in e){var i=e[r].elements.length,a=e[r].elements[e[r].start_elem],s=e[r].elements[e[r].end_elem],o=Math.ceil(t)+"px",l="-"+Math.ceil(t)+"px";0!==i&&("lr"===n.ipd?(a.node.style.borderLeftColor=a.bgcolor||"#00000000",a.node.style.borderLeftStyle="solid",a.node.style.borderLeftWidth=o,a.node.style.marginLeft=l):"rl"===n.ipd?(a.node.style.borderRightColor=a.bgcolor||"#00000000",a.node.style.borderRightStyle="solid",a.node.style.borderRightWidth=o,a.node.style.marginRight=l):"tb"===n.ipd&&(a.node.style.borderTopColor=a.bgcolor||"#00000000",a.node.style.borderTopStyle="solid",a.node.style.borderTopWidth=o,a.node.style.marginTop=l),"lr"===n.ipd?(s.node.style.borderRightColor=s.bgcolor||"#00000000",s.node.style.borderRightStyle="solid",s.node.style.borderRightWidth=o,s.node.style.marginRight=l):"rl"===n.ipd?(s.node.style.borderLeftColor=s.bgcolor||"#00000000",s.node.style.borderLeftStyle="solid",s.node.style.borderLeftWidth=o,s.node.style.marginLeft=l):"tb"===n.ipd&&(s.node.style.borderBottomColor=s.bgcolor||"#00000000",s.node.style.borderBottomStyle="solid",s.node.style.borderBottomWidth=o,s.node.style.marginBottom=l))}}(L,e.lp.toUsedLength(e.w,e.h),e),e.lp=null),e.flg)){var k=a(T.getBoundingClientRect(),e);!function(e,t,n,r){for(var i=Math.sign(n-t),a=0;a<=e.length;a++){var s,o,l;if(s=0===a?t:a===e.length?n:(e[a].before+e[a-1].after)/2,a>0)for(var u=0;u<e[a-1].elements.length;u++)null!==e[a-1].elements[u].bgcolor&&i*((l=e[a-1].elements[u]).after-s)<0&&(o=Math.ceil(Math.abs(s-l.after))+"px",l.node.style.backgroundColor=l.bgcolor,"lr"===r.bpd?l.node.style.paddingRight=o:"rl"===r.bpd?l.node.style.paddingLeft=o:"tb"===r.bpd&&(l.node.style.paddingBottom=o));if(a<e.length)for(var d=0;d<e[a].elements.length;d++)null!==(l=e[a].elements[d]).bgcolor&&i*(l.before-s)>0&&(o=Math.ceil(Math.abs(l.before-s))+"px",l.node.style.backgroundColor=l.bgcolor,"lr"===r.bpd?l.node.style.paddingLeft=o:"rl"===r.bpd?l.node.style.paddingRight=o:"tb"===r.bpd&&(l.node.style.paddingTop=o))}}(L,k.before,k.after,e),e.flg=null}if("region"===l.kind&&(s(e,T,L),"tb"===e.bpd&&e.enableRollUp&&l.contents.length>0&&"after"===l.styleAttrs[n.byName.displayAlign.qname])){var x=new i(""===l.id?"_":l.id,L);if(e.currentISDState[x.id]=x,e.previousISDState&&x.id in e.previousISDState&&e.previousISDState[x.id].plist.length>0&&x.plist.length>1&&x.plist[x.plist.length-2].text===e.previousISDState[x.id].plist[e.previousISDState[x.id].plist.length-1].text){var F=c.firstElementChild,U=x.plist[x.plist.length-1].after-x.plist[x.plist.length-1].before;F.style.bottom="-"+U+"px",F.style.transition="transform 0.4s",F.style.position="relative",F.style.transform="translateY(-"+U+"px)"}}}else!function(e,t){if(e&&e.error&&e.error(t))throw t}(e.errorHandler,"Error processing ISD element kind: "+l.kind)}function i(e,t){this.id=e,this.plist=t}function a(e,t){var n={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(n.before=e.top,n.after=e.bottom,"lr"===t.ipd?(n.start=e.left,n.end=e.right):(n.start=e.right,n.end=e.left)):"lr"===t.bpd?(n.before=e.left,n.after=e.right,n.start=e.top,n.end=e.bottom):"rl"===t.bpd&&(n.before=e.right,n.after=e.left,n.start=e.top,n.end=e.bottom),n}function s(e,t,n,r){if("rt"!==t.localName&&"rtc"!==t.localName){var i,o,l,u,d=t.style.backgroundColor||r;if(0===t.childElementCount)if("span"===t.localName||"rb"===t.localName){var c=t.getBoundingClientRect();if(0===c.height||0===c.width)return;var f=a(c,e);if(0!==n.length&&(i=f.before,o=f.after,l=n[n.length-1].before,u=n[n.length-1].after,o<u&&i>l||u<=o&&l>=i)){var h=Math.sign(f.after-f.before),p=Math.sign(f.end-f.start);h*(f.before-n[n.length-1].before)<0&&(n[n.length-1].before=f.before),h*(f.after-n[n.length-1].after)>0&&(n[n.length-1].after=f.after),p*(f.start-n[n.length-1].start)<0&&(n[n.length-1].start=f.start,n[n.length-1].start_elem=n[n.length-1].elements.length),p*(f.end-n[n.length-1].end)>0&&(n[n.length-1].end=f.end,n[n.length-1].end_elem=n[n.length-1].elements.length)}else n.push({before:f.before,after:f.after,start:f.start,end:f.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});n[n.length-1].text+=t.textContent,n[n.length-1].elements.push({node:t,bgcolor:d,before:f.before,after:f.after})}else"br"===t.localName&&0!==n.length&&(n[n.length-1].br=!0);else for(var m=t.firstChild;m;)m.nodeType===Node.ELEMENT_NODE&&(s(e,m,n,d),"ruby"===m.localName||"rtc"===m.localName?n.length>0&&n[n.length-1].rbc.push(m):"span"===m.localName&&m.style[g]&&"none"!==m.style[g]&&n.length>0&&n[n.length-1].te.push(m)),m=m.nextSibling}}function o(e,t,n,r){var i;"none"!==r.style&&("auto"===r.style?t.style[g]="filled":t.style[g]=r.style+" "+r.symbol,("before"===r.position||"after"===r.position)&&(i="tb"===e.bpd?"before"===r.position?"left over":"left under":"rl"===e.bpd?"before"===r.position?"right under":"left under":"before"===r.position?"left under":"right under",t.style[p]=i))}function l(e,t){this.qname=e,this.map=t}e.render=function(e,t,n,i,a,s,o,l,u){var d=i||t.clientHeight,c=a||t.clientWidth;if(null!==e.aspectRatio){var f=d*e.aspectRatio;f>c?d=Math.round(c/e.aspectRatio):c=f}var h=document.createElement("div");h.style.position="relative",h.style.width=c+"px",h.style.height=d+"px",h.style.margin="auto",h.style.top=0,h.style.bottom=0,h.style.left=0,h.style.right=0,h.style.zIndex=0;var g={h:d,w:c,regionH:null,regionW:null,imgResolver:n,displayForcedOnlyMode:s||!1,isd:e,errorHandler:o,previousISDState:l,enableRollUp:u||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};for(var p in t.appendChild(h),e.contents)r(g,h,e.contents[p],e);return g.currentISDState};var u=[new l("http://www.w3.org/ns/ttml#styling backgroundColor",(function(e,t,n,r){0!==r[3]&&(t.style.backgroundColor="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")")})),new l("http://www.w3.org/ns/ttml#styling color",(function(e,t,n,r){t.style.color="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")"})),new l("http://www.w3.org/ns/ttml#styling direction",(function(e,t,n,r){t.style.direction=r})),new l("http://www.w3.org/ns/ttml#styling display",(function(e,t,n,r){})),new l("http://www.w3.org/ns/ttml#styling displayAlign",(function(e,t,n,r){t.style.display="flex",t.style.flexDirection="column","before"===r?t.style.justifyContent="flex-start":"center"===r?t.style.justifyContent="center":"after"===r&&(t.style.justifyContent="flex-end")})),new l("http://www.w3.org/ns/ttml#styling extent",(function(e,t,n,r){e.regionH=r.h.toUsedLength(e.w,e.h),e.regionW=r.w.toUsedLength(e.w,e.h);var i=0,a=0,s=n.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];s&&(i=s[0].toUsedLength(e.w,e.h)+s[2].toUsedLength(e.w,e.h),a=s[1].toUsedLength(e.w,e.h)+s[3].toUsedLength(e.w,e.h)),t.style.height=e.regionH-i+"px",t.style.width=e.regionW-a+"px"})),new l("http://www.w3.org/ns/ttml#styling fontFamily",(function(e,t,n,r){var i=[];for(var a in r)"monospaceSerif"===r[a]?(i.push("Courier New"),i.push('"Liberation Mono"'),i.push("Courier"),i.push("monospace")):"proportionalSansSerif"===r[a]?(i.push("Arial"),i.push("Helvetica"),i.push('"Liberation Sans"'),i.push("sans-serif")):"monospace"===r[a]?i.push("monospace"):"sansSerif"===r[a]?i.push("sans-serif"):"serif"===r[a]?i.push("serif"):"monospaceSansSerif"===r[a]?(i.push("Consolas"),i.push("monospace")):"proportionalSerif"===r[a]?i.push("serif"):i.push(r[a]);t.style.fontFamily=i.join(",")})),new l("http://www.w3.org/ns/ttml#styling shear",(function(e,t,n,r){if(0!==r){var i=-.9*r;"tb"===e.bpd?t.style.transform="skewX("+i+"deg)":t.style.transform="skewY("+i+"deg)"}})),new l("http://www.w3.org/ns/ttml#styling fontSize",(function(e,t,n,r){t.style.fontSize=r.toUsedLength(e.w,e.h)+"px"})),new l("http://www.w3.org/ns/ttml#styling fontStyle",(function(e,t,n,r){t.style.fontStyle=r})),new l("http://www.w3.org/ns/ttml#styling fontWeight",(function(e,t,n,r){t.style.fontWeight=r})),new l("http://www.w3.org/ns/ttml#styling lineHeight",(function(e,t,n,r){t.style.lineHeight="normal"===r?"normal":r.toUsedLength(e.w,e.h)+"px"})),new l("http://www.w3.org/ns/ttml#styling opacity",(function(e,t,n,r){t.style.opacity=r})),new l("http://www.w3.org/ns/ttml#styling origin",(function(e,t,n,r){t.style.top=r.h.toUsedLength(e.w,e.h)+"px",t.style.left=r.w.toUsedLength(e.w,e.h)+"px"})),new l("http://www.w3.org/ns/ttml#styling overflow",(function(e,t,n,r){t.style.overflow=r})),new l("http://www.w3.org/ns/ttml#styling padding",(function(e,t,n,r){var i=[];i[0]=r[0].toUsedLength(e.w,e.h)+"px",i[1]=r[3].toUsedLength(e.w,e.h)+"px",i[2]=r[2].toUsedLength(e.w,e.h)+"px",i[3]=r[1].toUsedLength(e.w,e.h)+"px",t.style.padding=i.join(" ")})),new l("http://www.w3.org/ns/ttml#styling position",(function(e,t,n,r){t.style.top=r.h.toUsedLength(e.w,e.h)+"px",t.style.left=r.w.toUsedLength(e.w,e.h)+"px"})),new l("http://www.w3.org/ns/ttml#styling rubyAlign",(function(e,t,n,r){t.style.rubyAlign="spaceAround"===r?"space-around":"center"})),new l("http://www.w3.org/ns/ttml#styling rubyPosition",(function(e,t,n,r){var i;"before"!==r&&"after"!==r||(i=f?r:"tb"===e.bpd||"rl"===e.bpd?"before"===r?"over":"under":"before"===r?"under":"over",t.parentElement.style[h]=i)})),new l("http://www.w3.org/ns/ttml#styling showBackground",null),new l("http://www.w3.org/ns/ttml#styling textAlign",(function(e,t,n,r){var i;i="start"===r?"rl"===e.ipd?"right":"left":"end"===r?"rl"===e.ipd?"left":"right":r,t.style.textAlign=i})),new l("http://www.w3.org/ns/ttml#styling textDecoration",(function(e,t,n,r){t.style.textDecoration=r.join(" ").replace("lineThrough","line-through")})),new l("http://www.w3.org/ns/ttml#styling textOutline",(function(e,t,n,r){})),new l("http://www.w3.org/ns/ttml#styling textShadow",(function(e,t,r,i){var a=r.styleAttrs[n.byName.textOutline.qname];if("none"===i&&"none"===a)t.style.textShadow="";else{var s=[];if("none"!==a){var o="rgba("+a.color[0].toString()+","+a.color[1].toString()+","+a.color[2].toString()+","+(a.color[3]/255).toString()+")";s.push("1px 1px 1px "+o),s.push("-1px 1px 1px "+o),s.push("1px -1px 1px "+o),s.push("-1px -1px 1px "+o)}if("none"!==i)for(var l in i)s.push(i[l].x_off.toUsedLength(e.w,e.h)+"px "+i[l].y_off.toUsedLength(e.w,e.h)+"px "+i[l].b_radius.toUsedLength(e.w,e.h)+"px rgba("+i[l].color[0].toString()+","+i[l].color[1].toString()+","+i[l].color[2].toString()+","+(i[l].color[3]/255).toString()+")");t.style.textShadow=s.join(",")}})),new l("http://www.w3.org/ns/ttml#styling textCombine",(function(e,t,n,r){t.style.textCombineUpright=r})),new l("http://www.w3.org/ns/ttml#styling textEmphasis",(function(e,t,n,r){})),new l("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(e,t,n,r){var i;i="bidiOverride"===r?"bidi-override":r,t.style.unicodeBidi=i})),new l("http://www.w3.org/ns/ttml#styling visibility",(function(e,t,n,r){t.style.visibility=r})),new l("http://www.w3.org/ns/ttml#styling wrapOption",(function(e,t,n,r){"wrap"===r?"preserve"===n.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===n.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"})),new l("http://www.w3.org/ns/ttml#styling writingMode",(function(e,t,n,r){"lrtb"===r||"lr"===r||"rltb"===r||"rl"===r?t.style.writingMode="horizontal-tb":"tblr"===r?t.style.writingMode="vertical-lr":"tbrl"!==r&&"tb"!==r||(t.style.writingMode="vertical-rl")})),new l("http://www.w3.org/ns/ttml#styling zIndex",(function(e,t,n,r){t.style.zIndex=r})),new l("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(e,t,n,r){e.displayForcedOnlyMode&&!1===r&&(t.style.visibility="hidden")}))],d={};for(var c in u)d[u[c].qname]=u[c];var f="webkitRubyPosition"in window.getComputedStyle(document.documentElement),h=f?"webkitRubyPosition":"rubyPosition",g="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",p="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition"}(t,"undefined"==typeof imscNames||imscNames,"undefined"==typeof imscStyles?N:imscStyles,"undefined"==typeof imscUtils||imscUtils)})),kn=O.generateISD,xn=Pn.fromXML,Fn=Ln.render,Un=kn,Bn=xn,Gn=Fn,jn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(i),r=l(f),a=l(g),s=l(u),o=l(p);function l(e){return e&&e.__esModule?e:{default:e}}function d(){var e=this.context,t=(0,r.default)(e).getInstance(),i=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0,T=void 0,b=void 0,S=void 0;function A(e){var t=d[e].kind,n=void 0!==d[e].id?d[e].id:d[e].lang,r=d[e].lang,i=d[e].isTTML,a=d[e].isEmbedded;return u.addTextTrack(t,n,r,i,a)}function R(e,t,n,r,i,a){var s=0,o=0;e/t>n/r?s=(o=t)/r*n:o=(s=e)/n*r;var l,u,d=0,c=0;return s/o>i?(c=o,d=o*i):(d=s,c=s/i),l=(e-d)/2,u=(t-c)/2,a?{x:l+.1*d,y:u+.1*c,w:.8*d,h:.8*c}:{x:l,y:u,w:d,h:c}}function I(e,n){var r=u.getClientWidth(),i=u.getClientHeight(),s=u.getVideoWidth(),o=u.getVideoHeight(),l=u.getVideoRelativeOffsetTop(),d=u.getVideoRelativeOffsetLeft();if(0!==s&&0!==o){var c=s/o,f=!1;e.isFromCEA608&&(c=3.5/3,f=!0);var y=R.call(this,r,i,s,o,c,f),T=y.w,S=y.h,A=y.x,I=y.y;if(T!=p||S!=m||A!=h||I!=g||n){if(h=A+d,g=I+l,p=T,m=S,v){var w=v.style;w&&(w.left=h+"px",w.top=g+"px",w.width=p+"px",w.height=m+"px",w.zIndex=E&&document[E]||_?b:null,t.trigger(a.default.CAPTION_CONTAINER_RESIZE))}var C=e.activeCues;if(C)for(var D=C.length,M=0;M<D;++M){var N=C[M];N.scaleCue(N)}}}}function C(e){var t=p,n=m,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0;if(e.cellResolution){var l=[t/e.cellResolution[0],n/e.cellResolution[1]];if(e.linePadding)for(r in e.linePadding)if(e.linePadding.hasOwnProperty(r)){i=(e.linePadding[r]*l[0]).toString();for(var u=document.getElementsByClassName("spanPadding"),d=0;d<u.length;d++)u[d].style.cssText=u[d].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i),u[d].style.cssText=u[d].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}if(e.fontSize){for(r in e.fontSize)if(e.fontSize.hasOwnProperty(r)){"%"===e.fontSize[r][0]?a=e.fontSize[r][1]/100:"c"===e.fontSize[r][0]&&(a=e.fontSize[r][1]),i=(a*l[1]).toString(),o="defaultFontSize"!==r?document.getElementsByClassName(r):document.getElementsByClassName("paragraph");for(var c=0;c<o.length;c++)o[c].style.cssText=o[c].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}if(e.lineHeight)for(r in e.lineHeight)if(e.lineHeight.hasOwnProperty(r)){"%"===e.lineHeight[r][0]?s=e.lineHeight[r][1]/100:"c"===e.fontSize[r][0]&&(s=e.lineHeight[r][1]),i=(s*l[1]).toString(),o=document.getElementsByClassName(r);for(var f=0;f<o.length;f++)o[f].style.cssText=o[f].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}}}if(e.isd){var h=document.getElementById(e.cueID);h&&v.removeChild(h),D(e)}}function D(e){if(v){var n=document.createElement("div");v.appendChild(n),T=Gn(e.isd,n,(function(t){var n=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,r=/^#(.*)$/;if(n.test(t)){var i=n.exec(t),a=parseInt(i[4],10)-1;return"data:image/png;base64,"+btoa(e.images[a])}if(r.test(t)){var s=r.exec(t)[1];return"data:image/png;base64,"+e.embeddedImages[s]}return null}),v.clientHeight,v.clientWidth,!1,(function(e){s.info("renderCaption :",e)}),T,!0),n.id=e.cueID,t.trigger(a.default.CAPTION_RENDERED,{captionDiv:n,currentTrackIdx:f})}}function M(e){return e>=0&&d[e]?u.getTextTrack(d[e].kind,d[e].id,d[e].lang,d[e].isTTML,d[e].isEmbedded):null}function N(e){var t=this;if(e!==f){var n=M(f=e);O.call(this,n),y&&(clearInterval(y),y=null),n&&"html"===n.renderingType&&(I.call(this,n,!0),window.ResizeObserver?(S=new window.ResizeObserver((function(){I.call(t,n,!0)}))).observe(u.getElement()):y=setInterval(I.bind(this,n),500))}}function O(e){F.call(this),e&&"html"===e.renderingType?k.call(this):x.call(this)}function P(e,t,n){return(isNaN(t)||e.startTime>=t)&&(isNaN(n)||e.endTime<=n)}function L(e,t,n){if(e.cues)for(var r=e.cues,i=r.length-1;i>=0;i--)P(r[i],t,n)&&e.removeCue(r[i])}function k(){var e=document.getElementById("native-cue-style");if(!e){(e=document.createElement("style")).id="native-cue-style",document.head.appendChild(e);var t=e.sheet,n=u.getElement();try{n&&(n.id?t.insertRule("#"+n.id+"::cue {background: transparent}",0):0!==n.classList.length?t.insertRule("."+n.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){s.info(""+e.message)}}}function x(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function F(){if(v)for(;v.firstChild;)v.removeChild(v.firstChild)}return i={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(l=window.VTTCue||window.TextTrackCue,d=[],c=[],f=-1,h=0,g=0,p=0,m=0,v=null,y=null,_=!1,b=2147483647,T=null,void 0!==document.fullscreenElement?E="fullscreenElement":void 0!==document.webkitIsFullScreen?E="webkitIsFullScreen":document.msFullscreenElement?E="msFullscreenElement":document.mozFullScreen&&(E="mozFullScreen"))},setDisplayCConTop:function(e){(0,w.checkParameterType)(e,"boolean"),_=e,v&&!document[E]&&(v.style.zIndex=e?b:null)},addTextTrack:function(e,r){if(d.length!==r){if(d.push(e),d.length===r){d.sort((function(e,t){return e.index-t.index})),v=u.getTTMLRenderingDiv();for(var i=-1,o=0;o<d.length;o++){var l=A.call(this,o);c.push(l),d[o].defaultTrack&&(l.default=!0,i=o);var h=M(o);h&&(h.mode=n.default.TEXT_SHOWING,v&&(d[o].isTTML||d[o].isEmbedded)?h.renderingType="html":h.renderingType="default"),this.addCaptions(o,0,d[o].captionData),t.trigger(a.default.TEXT_TRACK_ADDED)}if(N.call(this,i),i>=0){t.on(a.default.PLAYBACK_METADATA_LOADED,(function e(){var n=M(i);n&&I.call(this,n,!0),t.off(a.default.PLAYBACK_METADATA_LOADED,e,this)}),this);for(var g=0;g<d.length;g++){var p=M(g);p&&(p.mode=g===i?n.default.TEXT_SHOWING:n.default.TEXT_HIDDEN)}}t.trigger(a.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:f,tracks:d})}}else s.error("Trying to add too many tracks.")},addCaptions:function(e,r,i){var o=M(e),u=this;if(o&&Array.isArray(i)&&0!==i.length)for(var d=0;d<i.length;d++){var c=void 0,y=i[d];o.cellResolution=y.cellResolution,o.isFromCEA608=y.isFromCEA608,"html"===y.type&&v?((c=new l(y.start-r,y.end-r,"")).cueHTMLElement=y.cueHTMLElement,c.isd=y.isd,c.images=y.images,c.embeddedImages=y.embeddedImages,c.cueID=y.cueID,c.scaleCue=C.bind(u),c.cellResolution=y.cellResolution,c.lineHeight=y.lineHeight,c.linePadding=y.linePadding,c.fontSize=y.fontSize,v.style.left=h+"px",v.style.top=g+"px",v.style.width=p+"px",v.style.height=m+"px",c.onenter=function(){o.mode===n.default.TEXT_SHOWING&&(this.isd?(D(this),s.debug("Cue enter id:"+this.cueID)):(v.appendChild(this.cueHTMLElement),C.call(u,this),t.trigger(a.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:f})))},c.onexit=function(){if(v)for(var e=v.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(s.debug("Cue exit id:"+e[t].id),v.removeChild(e[t]),--t)}):y.data&&(c=new l(y.start-r,y.end-r,y.data),y.styles&&(void 0!==y.styles.align&&"align"in c&&(c.align=y.styles.align),void 0!==y.styles.line&&"line"in c&&(c.line=y.styles.line),void 0!==y.styles.position&&"position"in c&&(c.position=y.styles.position),void 0!==y.styles.size&&"size"in c&&(c.size=y.styles.size)),c.onenter=function(){o.mode===n.default.TEXT_SHOWING&&t.trigger(a.default.CAPTION_RENDERED,{currentTrackIdx:f})});try{c?o.addCue(c):s.error("impossible to display subtitles.")}catch(e){throw L(o),o.addCue(c),e}}},getCurrentTrackIdx:function(){return f},setCurrentTrackIdx:N,getTrackIdxForId:function(e){for(var t=-1,n=0;n<d.length;n++)if(d[n].id===e){t=n;break}return t},getCurrentTrackInfo:function(){return d[f]},setModeForTrackIdx:function(e,t){var n=M(e);n&&n.mode!==t&&(n.mode=t)},deleteCuesFromTrackIdx:function(e,t,n){var r=M(e);r&&L(r,t,n)},deleteAllTextTracks:function(){for(var e=c?c.length:0,t=0;t<e;t++){var n=M(t);n&&(L.call(this,n),n.mode="disabled")}c=[],d=[],y&&(clearInterval(y),y=null),S&&u&&(S.unobserve(u.getElement()),S=null),f=-1,F.call(this)},deleteTextTrack:function(e){u.removeChild(c[e]),c.splice(e,1)},setConfig:function(e){e&&e.videoModel&&(u=e.videoModel)}},s=(0,o.default)(e).getInstance().getLogger(i),i}d.__dashjs_factory_name="TextTracks",t.default=s.default.getSingletonFactory(d)}));t(jn);var Hn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(){var e,t=0;function n(e){for(var t="",n=0;n<e.length;++n){t+=e[n].uchar}return t.length-t.replace(/^\s+/,"").length}function r(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function i(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function a(e,t){var n=e.videoHeight/15;return t?"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?i(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?i(t.background):"transparent")+";":"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function s(e){return e.replace(/^\s+/g,"")}function o(e){return e.replace(/\s+$/g,"")}return e={createHTMLCaptionsFromScreen:function(e,i,l,u){var d=null,c=!1,f=-1,h={start:i,end:l,spans:[]},g="style_cea608_white_black",p={},m={},v=[],y=void 0,E=void 0;for(y=0;y<15;++y){var _=u.rows[y],T="",b=null;if(!1===_.isEmpty()){var S=n(_.chars);null===d&&(d={x:S,y1:y,y2:y+1,p:[]}),S!==f&&c&&(d.p.push(h),h={start:i,end:l,spans:[]},d.y2=y,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===p.hasOwnProperty(d.name)?(v.push(d),p[d.name]=d):p[d.name].p.contat(d.p),d={x:S,y1:y,y2:y+1,p:[]});for(var A=0;A<_.chars.length;++A){var R=_.chars[A],I=R.penState;if(null===b||!I.equals(b)){T.trim().length>0&&(h.spans.push({name:g,line:T,row:y}),T="");var w="style_cea608_"+I.foreground+"_"+I.background;I.underline&&(w+="_underline"),I.italics&&(w+="_italics"),m.hasOwnProperty(w)||(m[w]=JSON.parse(JSON.stringify(I))),b=I,g=w}T+=R.uchar}T.trim().length>0&&h.spans.push({name:g,line:T,row:y}),c=!0,f=S}else c=!1,f=-1,d&&(d.p.push(h),h={start:i,end:l,spans:[]},d.y2=y,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===p.hasOwnProperty(d.name)?(v.push(d),p[d.name]=d):p[d.name].p.contat(d.p),d=null)}d&&(d.p.push(h),d.y2=y+1,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===p.hasOwnProperty(d.name)?(v.push(d),p[d.name]=d):p[d.name].p.contat(d.p),d=null);var C=[];for(y=0;y<v.length;++y){var D=v[y],M="sub_cea608_"+t++,N=document.createElement("div");N.id=M;var O=r(D);N.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+O;var P=document.createElement("div");P.className="paragraph bodyStyle",P.style.cssText=a(e);var L=document.createElement("div");L.className="cueUniWrapper",L.style.cssText="unicode-bidi: normal; direction: ltr;";for(var k=0;k<D.p.length;++k){var x=D.p[k],F=0;for(E=0;E<x.spans.length;++E){var U=x.spans[E];if(U.line.length>0){if(0!==E&&F!=U.row){var B=document.createElement("br");B.className="lineBreak",L.appendChild(B)}var G=!1;F===U.row&&(G=!0),F=U.row;var j=m[U.name],H=document.createElement("span");H.className="spanPadding "+U.name+" customSpanColor",H.style.cssText=a(e,j),0!==E&&G?E===x.spans.length-1?H.textContent=o(U.line):H.textContent=U.line:x.spans.length>1&&E<x.spans.length-1&&U.row===x.spans[E+1].row?H.textContent=s(U.line):H.textContent=U.line.trim(),L.appendChild(H)}}}P.appendChild(L),N.appendChild(P);var q={bodyStyle:["%",90]};for(var K in m)m.hasOwnProperty(K)&&(q[K]=["%",90]);C.push({type:"html",start:i,end:l,cueHTMLElement:N,cueID:M,cellResolution:[32,15],isFromCEA608:!0,fontSize:q,lineHeight:{},linePadding:{}})}return C}},e}i.__dashjs_factory_name="EmbeddedTextHtmlRender",t.default=r.default.getSingletonFactory(i)}));t(Hn);var qn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!n||r&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}]),e}();t.default=r}));t(qn);var Kn=n((function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,e.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,e.SEGMENTS_UPDATE_FAILED_ERROR_CODE=13,e.SEGMENTS_UNAVAILABLE_ERROR_CODE=14,e.SEGMENT_BASE_LOADER_ERROR_CODE=15,e.TIME_SYNC_FAILED_ERROR_CODE=16,e.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,e.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,e.APPEND_ERROR_CODE=20,e.REMOVE_ERROR_CODE=21,e.DATA_UPDATE_FAILED_ERROR_CODE=22,e.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,e.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,e.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,e.DOWNLOAD_ERROR_ID_SIDX_CODE=26,e.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,e.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,e.DOWNLOAD_ERROR_ID_XLINK_CODE=29,e.MANIFEST_ERROR_ID_CODEC_CODE=30,e.MANIFEST_ERROR_ID_PARSE_CODE=31,e.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,e.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,e.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,e.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",e.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",e.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",e.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",e.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segments",e.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize time",e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",e.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",e.APPEND_ERROR_MESSAGE="chunk is not defined",e.REMOVE_ERROR_MESSAGE="buffer is not defined",e.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",e.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",e.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",e.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",e.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=qn)&&n.__esModule?n:{default:n}).default));t.default=r}));t(Kn);var Yn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=w(i),a=w(T),s=w(I),o=w(C),l=w(u),d=w(p),c=w(jn),h=w(Hn),m=w(A),y=w(r),E=w(f),b=w(g),S=w(_),R=w(Kn);function w(e){return e&&e.__esModule?e:{default:e}}function D(){var e=this.context,t=(0,E.default)(e).getInstance(),r=!1,i=void 0,l=void 0,u=void 0,f=void 0,g=void 0,p=void 0,_=void 0,T=void 0,A=void 0,I=void 0,w=void 0,C=void 0,D=void 0,M=void 0,N=void 0,O=void 0,P=void 0,L=void 0,k=void 0,x=void 0,F=void 0,U=void 0,B=void 0,G=void 0,j=void 0,H=void 0;function q(){D=null,N=NaN,O=[],k=null,M=!1}function K(){q(),w=[],T=null}function Y(e){var t=e.chunk;t.mediaInfo.embeddedCaptions&&X(t.bytes,t)}function V(){F=[],(C=(0,c.default)(e).getInstance()).setConfig({videoModel:P}),C.initialize(),u=(0,s.default)(e).getInstance(),x=null,U=0,G=[],B=null,r=!0,j=(0,h.default)(e).getInstance();var n=L.getActiveStreamProcessors();for(var i in n)if("video"===n[i].getType()){H=n[i].getRepresentationInfo().MSETimeOffset;break}t.on(b.default.VIDEO_CHUNK_RECEIVED,Y,this),t.on(b.default.BUFFER_CLEARED,$,this)}function W(e){x=e}function z(e,t){var r,i,s=new a.default,o={subtitle:"subtitles",caption:"captions"};s.captionData=e,s.lang=t.lang,s.labels=t.labels,s.id=t.id?t.id:t.index,s.index=t.index,s.isTTML=(r=!1,t.codec&&t.codec.search(n.default.STPP)>=0&&(r=!0),t.mimeType&&t.mimeType.search(n.default.TTML)>=0&&(r=!0),r),s.defaultTrack=function(e){var t=!1;F.length>1&&e.isEmbedded?t=e.id&&e.id===n.default.CC1:1===F.length?e.id&&"string"==typeof e.id&&"CC"===e.id.substring(0,2)&&(t=!0):0===F.length&&(t=e.index===w[0].index);return t}(t),s.isFragmented=!g.getIsTextTrack(t.mimeType),s.isEmbedded=!!t.isEmbedded,s.kind=i=(i=t.roles.length>0?o[t.roles[0]]:o.caption)===o.caption||i===o.subtitle?i:o.caption,s.roles=t.roles,s.accessibility=t.accessibility;var l=(w?w.length:0)+F.length;C.addTextTrack(s,l)}function X(e,t){var r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,d=void 0,c=void 0,h=t.mediaInfo,g=h.type,E=h.mimeType,_=h.codec||E;if(_){if(g===n.default.FRAGMENTED_TEXT)if(M||"InitializationSegment"!==t.segmentType){if(!M)return;if(i=(d=u.getSamplesInfo(e)).sampleList,null===k&&i.length>0&&(k=i[0].cts-t.start*N),_.search(n.default.STPP)>=0)for(T=null!==T?T:Q(_),a=0;a<i.length;a++){var b=i[a],A=b.cts,I=A-k;this.buffered.add(I/N,(I+b.duration)/N);var w=new DataView(e,b.offset,b.subSizes[0]);c=m.default.Utils.dataViewToString(w,n.default.UTF8);var O=[],L=b.offset+b.subSizes[0];for(s=1;s<b.subSizes.length;s++){var q=new Uint8Array(e,L,b.subSizes[s]),K=String.fromCharCode.apply(null,q);O.push(K),L+=b.subSizes[s]}try{var Y=p.getValue().ttmlTimeIsRelative?A/N:0;r=T.parse(c,Y,A/N,(A+b.duration)/N,O),C.addCaptions(x,k/N,r)}catch(e){D.removeExecutedRequestsBeforeTime(),this.remove(),l.error("TTML parser error: "+e.message)}}else{var V=[];for(a=0;a<i.length;a++){var W=i[a];W.cts-=k,this.buffered.add(W.cts/N,(W.cts+W.duration)/N);var X=e.slice(W.offset,W.offset+W.size),$=m.default.parseBuffer(X);for(s=0;s<$.boxes.length;s++){var Z=$.boxes[s];if(l.debug("VTT box1: "+Z.type),"vtte"!==Z.type&&"vttc"===Z.type)for(l.debug("VTT vttc boxes.length = "+Z.boxes.length),o=0;o<Z.boxes.length;o++){var J=Z.boxes[o];if(l.debug("VTT box2: "+J.type),"payl"===J.type){var ee=J.cue_text;l.debug("VTT cue_text = "+ee);var te=W.cts/N,ne=(W.cts+W.duration)/N;V.push({start:te,end:ne,data:ee,styles:{}}),l.debug("VTT "+te+"-"+ne+" : "+ee)}}}}V.length>0&&C.addCaptions(x,0,V)}}else M=!0,N=u.getMediaTimescaleFromMoov(e);else if(g===n.default.TEXT){var re=new DataView(e,0,e.byteLength);c=m.default.Utils.dataViewToString(re,n.default.UTF8);try{r=Q(_).parse(c,0),C.addCaptions(C.getCurrentTrackIdx(),0,r)}catch(e){f.error(new S.default(R.default.TIMED_TEXT_ERROR_ID_PARSE_CODE,R.default.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,c))}}else if(g===n.default.VIDEO)if(t.segmentType===v.HTTPRequest.INIT_SEGMENT_TYPE){if(0===U)for(U=u.getMediaTimescaleFromMoov(e),a=0;a<F.length;a++)z(null,F[a])}else{if(0===U)return void l.warn("CEA-608: No timescale for embeddedTextTrack yet");var ie=function(e,t){return function(e,n,r){var i=null;i=P.getTTMLRenderingDiv()?j.createHTMLCaptionsFromScreen(P.getElement(),e,n,r):[{start:e,end:n,data:r.getDisplayText(),styles:{}}],i&&C.addCaptions(t,0,i)}},ae=(d=u.getSamplesInfo(e)).lastSequenceNumber;if(!G[0]&&!G[1]){var se=void 0,oe=void 0;for(a=0;a<F.length;a++){if(F[a].id===n.default.CC1?oe=C.getTrackIdxForId(n.default.CC1):F[a].id===n.default.CC3&&(oe=C.getTrackIdxForId(n.default.CC3)),-1===oe)return void l.warn("CEA-608: data before track is ready.");se=ie(0,oe),G[a]=new y.default.Cea608Parser(a+1,{newCue:se},null)}}if(U){if(null!==B&&ae!==B+d.numSequences)for(a=0;a<G.length;a++)G[a]&&G[a].reset();for(var le=function(e,t){if(0===t.length)return null;for(var n={splits:[],fields:[[],[]]},r=new DataView(e),i=0;i<t.length;i++)for(var a=t[i],s=y.default.findCea608Nalus(r,a.offset,a.size),o=null,l=0,u=0;u<s.length;u++)for(var d=y.default.extractCea608DataFromRange(r,s[u]),c=0;c<2;c++)d[c].length>0&&(a.cts!==o?l=0:l+=1,n.fields[c].push([a.cts+H*U,d[c],l]),o=a.cts);return n.fields.forEach((function(e){e.sort((function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]}))})),n}(e,d.sampleList),ue=0;ue<G.length;ue++){var de=le.fields[ue],ce=G[ue];if(ce)for(a=0;a<de.length;a++)ce.addData(de[a][0]/U,de[a][1])}B=ae}}}else l.error("No text type defined")}function Q(e){var t=void 0;return e.search(n.default.VTT)>=0?t=A:(e.search(n.default.TTML)>=0||e.search(n.default.STPP)>=0)&&(t=I),t}function $(e){F.forEach((function(t){var n=C.getTrackIdxForId(t.id);n>=0&&C.deleteCuesFromTrackIdx(n,e.from,e.to)}))}return i={initialize:function(t,a,l,d){r||V(),C.setConfig({videoModel:P}),C.initialize(),u||(u=(0,s.default)(e).getInstance()),function(t,r,a,s){var l=!g.getIsTextTrack(t);if(w=w.concat(a),l){D=s,i.buffered=(0,o.default)(e).create(),O=_.getTracksFor(n.default.FRAGMENTED_TEXT,r);for(var u=_.getCurrentTrackFor(n.default.FRAGMENTED_TEXT,r),d=0;d<O.length;d++)if(O[d]===u){W(d);break}}for(var c=0;c<w.length;c++)z(null,w[c])}(t,a,l,d)},append:X,abort:function(){C.deleteAllTextTracks(),q(),u=null,w=[]},addEmbeddedTrack:function(e){if(r||V(),e)if(e.id===n.default.CC1||e.id===n.default.CC3){for(var t=0;t<F.length;t++)if(F[t].id===e.id)return;F.push(e)}else l.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){t.off(b.default.VIDEO_CHUNK_RECEIVED,Y,this),t.off(b.default.BUFFER_CLEARED,$,this),C&&C.deleteAllTextTracks(),r=!1,F=[],G=[null,null],B=null},setConfig:function(e){e&&(e.errHandler&&(f=e.errHandler),e.adapter&&(g=e.adapter),e.manifestModel&&(p=e.manifestModel),e.mediaController&&(_=e.mediaController),e.videoModel&&(P=e.videoModel),e.streamController&&(L=e.streamController),e.textTracks&&(C=e.textTracks),e.vttParser&&(A=e.vttParser),e.ttmlParser&&(I=e.ttmlParser))},getConfig:function(){return{fragmentModel:D,fragmentedTracks:O,videoModel:P}},setCurrentFragmentedTrackIdx:W,remove:function(e,t){void 0===e&&e===t&&(e=this.buffered.start(0),t=this.buffered.end(this.buffered.length-1)),this.buffered.remove(e,t)},reset:function(){K(),L=null,P=null,C=null}},l=(0,d.default)(e).getInstance().getLogger(i),K(),i}D.__dashjs_factory_name="TextSourceBuffer",t.default=l.default.getSingletonFactory(D)}));t(Yn);var Vn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(p);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e=this.context,t=void 0,n=void 0,i=void 0,a=void 0,s=void 0,o=void 0;function l(e){var t=e.split(":"),n=t.length-1;return e=60*parseInt(t[n-1],10)+parseFloat(t[n]),2===n&&(e+=3600*parseInt(t[0],10)),e}function u(e){var t=e.split(a),n=t[1].split(o);return n.shift(),t[1]=n[0],n.shift(),{cuePoints:t,styles:d(n)}}function d(e){var t={};return e.forEach((function(e){if(e.split(/:/).length>1){var n=e.split(/:/)[1];n&&-1!=n.search(/%/)&&(n=parseInt(n.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=n),(e.match(/line/)||e.match(/L/))&&(t.line=n),(e.match(/position/)||e.match(/P/))&&(t.position=n),(e.match(/size/)||e.match(/S/))&&(t.size=n)}})),t}function c(e,t){for(var n,r=t,i="",s="";""!==e[r]&&r<e.length;)r++;if((n=r-t)>1)for(var o=0;o<n;o++){if((s=e[t+o]).match(a)){i="";break}i+=s,o!==n-1&&(i+="\n")}else(s=e[t]).match(a)||(i=s);return i}return t={parse:function(e){var t,r=[],o=void 0;if(!e)return r;t=(e=e.split(i)).length,o=-1;for(var d=0;d<t;d++){var f=e[d];if(f.length>0&&"WEBVTT"!==f&&f.match(a)){var h=u(f),g=h.cuePoints,p=h.styles,m=c(e,d+1),v=l(g[0].replace(s,"")),y=l(g[1].replace(s,""));!isNaN(v)&&!isNaN(y)&&v>=o&&y>v?""!==m?(o=v,r.push({start:v,end:y,data:m,styles:p})):n.error("Skipping cue due to empty/malformed cue text"):n.error("Skipping cue due to incorrect cue timing")}}return r}},n=(0,r.default)(e).getInstance().getLogger(t),i=/(?:\r\n|\r|\n)/gm,a=/-->/,s=/(^[\s]+|[\s]+$)/g,o=/\s\b/g,t}a.__dashjs_factory_name="VTTParser",t.default=n.default.getSingletonFactory(a)}));t(Vn);var Wn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'}}}}));t(Wn);var zn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(u),r=l(p),i=l(f),a=l(g),s=l(c),o=l(Wn);function l(e){return e&&e.__esModule?e:{default:e}}function d(){var e=this.context,t=(0,i.default)(e).getInstance(),n=void 0,l=void 0,u=0;return n={parse:function(e,n,r,i,d){var c="",f=[],h=void 0,g=void 0,p=void 0,m={},v={},y="",E="",_={onOpenTag:function(e,n,r){if(r[" imagetype"]&&!r[" imageType"]&&(t.trigger(s.default.CONFORMANCE_VIOLATION,{level:o.default.LEVELS.ERROR,event:o.default.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),r[" imageType"]=r[" imagetype"]),"image"===n&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!r[" imageType"]||"PNG"!==r[" imageType"].value)return void l.warn("smpte-tt imageType != PNG. Discarded");y=r["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){y&&(v[y]=E.trim()),E="",y=""},onText:function(e){y&&(E+=e)}};if(!e)throw c="no ttml data to parse",new Error(c);m.data=e,t.trigger(a.default.TTML_TO_PARSE,m);var T=Bn(m.data,(function(e){c=e}),_);t.trigger(a.default.TTML_PARSED,{ttmlString:m.data,ttmlDoc:T});var b,S=T.getMediaTimeEvents();for(p=0;p<S.length;p++){var A=Un(T,S[p],(function(e){c=e}));A.contents.some((function(e){return e.contents.length}))&&(h=S[p]+n<r?r:S[p]+n)<(g=S[p+1]+n>i?i:S[p+1]+n)&&f.push({start:h,end:g,type:"html",cueID:(b=void 0,b="cue_TTML_"+u,u++,b),isd:A,images:d,embeddedImages:v})}if(""!==c)throw l.error(c),new Error(c);return f}},l=(0,r.default)(e).getInstance().getLogger(n),n}d.__dashjs_factory_name="TTMLParser",t.default=n.default.getSingletonFactory(d)}));t(zn);var Xn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=h(i),r=h(u),a=h(Yn),s=h(jn),o=h(Vn),l=h(zn),d=h(f),c=h(g);function h(e){return e&&e.__esModule?e:{default:e}}function p(){var e=this.context,t=void 0,r=void 0,i=void 0,u=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0,T=void 0,b=void 0,S=void 0,A=void 0,R=void 0,I=void 0,C=void 0,D=void 0;function M(e){void 0===D&&null!==e.fromStreamInfo&&(D=this.getCurrentTrackIdx())}function N(){void 0===D&&(D=this.getCurrentTrackIdx())}function O(){void 0!==D&&(this.setTextTrack(D),D=void 0)}function P(e){var t=this,n=e.tracks,r=e.index;_&&n.some((function(e,n){if(h.matchSettings(_,e))return t.setTextTrack(n),r=n,!0})),(!1===S||void 0===S&&!_||C)&&this.setTextTrack(-1),b=r,E.trigger(c.default.TEXT_TRACKS_ADDED,{enabled:k(),index:r,tracks:n}),I=!0}function L(e){if(!T&&e&&e.newMediaInfo){var t=e.newMediaInfo;t.type===n.default.FRAGMENTED_TEXT&&(_={lang:t.lang,role:t.roles[0],accessibility:t.accessibility[0]})}}function k(){var e=!0;return A&&!R&&(e=!1),e}function x(){A=!0,I=!1,C=!1}return t={setConfig:function(e){e&&(e.errHandler&&(i=e.errHandler),e.adapter&&(u=e.adapter),e.manifestModel&&(f=e.manifestModel),e.mediaController&&(h=e.mediaController),e.videoModel&&(g=e.videoModel),e.streamController&&(p=e.streamController),e.textTracks&&(m=e.textTracks),e.vttParser&&(v=e.vttParser),e.ttmlParser&&(y=e.ttmlParser),r.setConfig({errHandler:i,adapter:u,manifestModel:f,mediaController:h,videoModel:g,streamController:p,textTracks:m,vttParser:v,ttmlParser:y}))},getTextSourceBuffer:function(){return r},getAllTracksAreDisabled:function(){return A},addEmbeddedTrack:function(e){r.addEmbeddedTrack(e)},getTextDefaultLanguage:function(){return _&&_.lang||""},setTextDefaultLanguage:function(e){(0,w.checkParameterType)(e,"string"),_||(_={}),_.lang=e,T=!0},setTextDefaultEnabled:function(e){(0,w.checkParameterType)(e,"boolean"),(S=e)?A=!1:this.setTextTrack(-1)},getTextDefaultEnabled:function(){return void 0!==S&&S},setInitialSettings:function(e){_=e,T=!0},enableText:function(e){(0,w.checkParameterType)(e,"boolean"),!S&&e&&(S=!0),k()!==e&&(e&&this.setTextTrack(b),e||(b=this.getCurrentTrackIdx(),I?this.setTextTrack(-1):C=!0))},isTextEnabled:k,setTextTrack:function(e){var t=r.getConfig(),i=t.fragmentModel,a=t.fragmentedTracks,s=t.videoModel,o=void 0,l=void 0;A=-1===e;var u=m.getCurrentTrackIdx();if(u!==e){A&&h&&h.saveTextSettingsDisabled(),m.setModeForTrackIdx(u,n.default.TEXT_HIDDEN),m.setCurrentTrackIdx(e),m.setModeForTrackIdx(e,n.default.TEXT_SHOWING);var d=m.getCurrentTrackInfo();if(d&&d.isFragmented&&!d.isEmbedded)for(var c=0;c<a.length;c++){var f=a[c];if(d.lang===f.lang&&d.index===f.index&&(f.id?d.id===f.id:d.id===f.index))if(f!==h.getCurrentTrackFor(n.default.FRAGMENTED_TEXT,p.getActiveStreamInfo()))i.abortRequests(),i.removeExecutedRequestsBeforeTime(),r.remove(),m.deleteCuesFromTrackIdx(u),h.setTrack(f),r.setCurrentFragmentedTrackIdx(c);else if(-1===u){for(var g=p.getActiveStreamProcessors(),v=0;v<g.length;v++)if(g[v].getType()===n.default.FRAGMENTED_TEXT){l=g[v];break}l.setBufferingTime(s.getTime()),l.getScheduleController().start()}}else if(d&&!d.isFragmented){for(var y=p.getActiveStreamProcessors(),E=0;E<y.length;E++)if(y[E].getType()===n.default.TEXT){o=(l=y[E]).getMediaInfoArr();break}if(l&&o)for(var _=0;_<o.length;_++)if(o[_].index===d.index&&o[_].lang===d.lang){l.selectMediaInfo(o[_]);break}}}},getCurrentTrackIdx:function(){return m.getCurrentTrackIdx()},enableForcedTextStreaming:function(e){(0,w.checkParameterType)(e,"boolean"),R=e},reset:function(){x(),r.resetEmbedded(),r.reset()}},_=null,b=-1,R=!1,I=!1,T=!1,C=!1,m=(0,s.default)(e).getInstance(),v=(0,o.default)(e).getInstance(),y=(0,l.default)(e).getInstance(),r=(0,a.default)(e).getInstance(),E=(0,d.default)(e).getInstance(),m.initialize(),E.on(c.default.TEXT_TRACKS_QUEUE_INITIALIZED,P,t),E.on(c.default.CURRENT_TRACK_CHANGED,L,t),E.on(c.default.PERIOD_SWITCH_STARTED,M,t),E.on(c.default.STREAM_COMPLETED,N,t),E.on(c.default.PERIOD_SWITCH_COMPLETED,O,t),x(),t}p.__dashjs_factory_name="TextController",t.default=r.default.getSingletonFactory(p)}));t(Xn);var Qn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=d(p),r=d(_),i=d(f),a=d(g),s=d(u),o=d(Xn),l=d(Kn);function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t,s,u){var d=this.context,c=(0,i.default)(d).getInstance(),f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=[],E=[],_=s;function T(){try{return p.buffered}catch(e){return g.error("getAllBufferRanges exception: "+e.message),null}}function b(t){p&&C((function(){try{var n=e.duration,r=0;t&&!isNaN(t.start)&&!isNaN(t.duration)&&isFinite(t.duration)&&(n=t.start+t.duration),t&&!isNaN(t.start)&&(r=t.start),p.appendWindowStart=0,p.appendWindowEnd=n,p.appendWindowStart=r,g.debug("Updated append window. Set start to "+p.appendWindowStart+" and end to "+p.appendWindowEnd)}catch(e){g.warn("Failed to set append window")}}))}function S(){var e=this;if(E.length>0){m=!0;var t=E[0];E.splice(0,1);var n=[],i=function(){var r=T();!function(e,t,n,r){t&&t.length>0&&t.length<n.length&&function(e,t){for(var n=0;n<e.length;n++){var r=Math.round(e.start(n)),i=Math.round(e.end(n));if(i===t.start||r===t.end||t.start>=r&&t.end<=i)return!0}return!1}(t,r)&&c.trigger(a.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:e,from:n.end(n.length-2),to:n.start(n.length-1),unintended:!0})}(e,n,r,t),E.length>0?S.call(this):(m=!1,_&&_({chunk:t}))};try{0===t.bytes.length?i.call(this):(n=T(),p.appendBuffer?p.appendBuffer(t.bytes):p.append(t.bytes,t),C(i.bind(this)))}catch(e){g.fatal('SourceBuffer append failed "'+e+'"'),E.length>0?S():m=!1,_&&_({chunk:t,error:new r.default(e.code,e.message)})}}}function A(){if(y.length>0){var e=y.shift();p.updating?C(e):(e(),A())}}function R(){p.updating||A()}function I(){p.updating||A()}function w(){g.error("SourceBufferSink error")}function C(e){y.push(e),p.updating||A()}return f={getType:function(){return h},getAllBufferRanges:T,getBuffer:function(){return p},append:function(e){e?(E.push(e),m||C(S.bind(this))):_({chunk:e,error:new r.default(l.default.APPEND_ERROR_CODE,l.default.APPEND_ERROR_MESSAGE)})},remove:function(t,n,i){var s=this;C((function(){try{t>=0&&n>t&&(i||"ended"!==e.readyState)&&p.remove(t,n),C((function(){c.trigger(a.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:s,from:t,to:n,unintended:!1})}))}catch(e){c.trigger(a.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:s,from:t,to:n,unintended:!1,error:new r.default(e.code,e.message)})}}))},abort:function(){try{("open"===e.readyState||p.setTextTrack&&"ended"===e.readyState)&&p.abort()}catch(e){g.error('SourceBuffer append abort failed: "'+e+'"')}E=[]},reset:function(t){if(p){if("function"==typeof p.removeEventListener&&(p.removeEventListener("updateend",I,!1),p.removeEventListener("error",w,!1),p.removeEventListener("abort",w,!1)),clearInterval(v),y=[],!t){try{p.getClassName&&"TextSourceBuffer"===p.getClassName()||(g.debug("Removing sourcebuffer from media source"),e.removeSourceBuffer(p))}catch(e){g.error("Failed to remove source buffer from media source.")}p=null}m=!1}E=[],_=null},updateTimestampOffset:function(e){p.timestampOffset===e||isNaN(e)||C((function(){e<0&&(e+=.001),p.timestampOffset=e}))},hasDiscontinuitiesAfter:function(e){try{var t=T();if(t&&t.length>1)for(var n=0,r=t.length;n<r;n++)if(n>0&&e<t.start(n)&&t.start(n)>t.end(n-1)+.1)return!0}catch(e){g.error("hasDiscontinuities exception: "+e.message)}return!1},waitForUpdateEnd:C,updateAppendWindow:b},function(){g=(0,n.default)(d).getInstance().getLogger(f),m=!1,h=t.type;var r=t.codec;try{if(r.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))throw new Error("not really supported");(p=u||e.addSourceBuffer(r)).changeType&&u&&(g.debug("Doing period transition with changeType"),p.changeType(r)),b();if("function"==typeof p.addEventListener)try{p.addEventListener("updateend",I,!1),p.addEventListener("error",w,!1),p.addEventListener("abort",w,!1)}catch(e){v=setInterval(R,50)}else v=setInterval(R,50)}catch(e){if(!t.isText&&-1===r.indexOf('codecs="stpp')&&-1===r.indexOf('codecs="wvtt'))throw e;var i=(0,o.default)(d).getInstance();p=i.getTextSourceBuffer()}}(),f}c.__dashjs_factory_name="SourceBufferSink";var h=s.default.getClassFactory(c);t.default=h}));t(Qn);var $n=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(p),r=i(u);function i(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=this.context,r=void 0,i=void 0,a=void 0,s=[],o=e;function l(e,t){s=s.filter((function(n){return!((isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e))}))}return r={getAllBufferRanges:function(){for(var e=[],t=0;t<s.length;t++){var n=s[t];0===e.length||n.start>e[e.length-1].end?e.push({start:n.start,end:n.end}):e[e.length-1].end=n.end}var r={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(r,"length",{get:function(){return e.length}}),r},append:function(e){"InitializationSegment"!==e.segmentType?(s.push(e),s.sort((function(e,t){return e.start-t.start})),a=null):a=e,i.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),o&&o({chunk:e})},remove:l,abort:function(){},discharge:function(e,t){var n=function(e,t){return s.filter((function(n){return(isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e)}))}(e,t);return a&&(n.push(a),a=null),l(e,t),n},reset:function(){s=[],a=null,o=null},updateTimestampOffset:function(){},hasDiscontinuitiesAfter:function(){return!1},waitForUpdateEnd:function(e){e()},getBuffer:function(){return this}},i=(0,n.default)(t).getInstance().getLogger(r),r}a.__dashjs_factory_name="PreBufferSink";var s=r.default.getClassFactory(a);t.default=s}));t($n);var Zn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};var i={DEFAULT:.5,STRONG:1,WEAK:0};function a(e,t,n){var r,a;return r=void 0===e?-1:e,a=function(e){var t=i.DEFAULT;return e!==i.DEFAULT&&e!==i.STRONG&&e!==i.WEAK||(t=e),t}(n),{quality:r,reason:void 0===t?null:t,priority:a}}a.__dashjs_factory_name="SwitchRequest";var s=r.default.getClassFactory(a);s.NO_CHANGE=-1,s.PRIORITY=i,r.default.updateClassFactory(a.__dashjs_factory_name,s),t.default=s}));t(Zn);var Jn=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=d(u),r=d(p),a=d(Zn),s=d(i),o=d(l);function d(e){return e&&e.__esModule?e:{default:e}}function c(e){e=e||{};var t=this.context,n=e.dashMetrics,i=void 0,l=void 0;return i={getMaxIndex:function(e){var r=(0,a.default)(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return r;!function(){if(!n||!n.hasOwnProperty("getCurrentBufferState"))throw new Error(s.default.MISSING_CONFIG_ERROR)}();var i=e.getMediaInfo(),u=e.getMediaType(),d=n.getCurrentBufferState(u),c=e.getScheduleController(),f=e.getAbrController(),h=e.getStreamInfo(),g=h&&h.manifestInfo?h.manifestInfo.isDynamic:null,p=f.getThroughputHistory(),m=p.getSafeAverageThroughput(u,g),v=p.getAverageLatency(u),y=e.useBufferOccupancyABR();return isNaN(m)||!d||y||f.getAbandonmentStateFor(u)!==o.default.ABANDON_LOAD&&(d.state===o.default.BUFFER_LOADED||g)&&(r.quality=f.getQualityForBitrate(i,m,v),c.setTimeToLoadDelay(0),l.debug("["+u+"] requesting switch to index: ",r.quality,"Average throughput",Math.round(m),"kbps"),r.reason={throughput:m,latency:v}),r},reset:function(){}},l=(0,r.default)(t).getInstance().getLogger(i),i}c.__dashjs_factory_name="ThroughputRule",t.default=n.default.getClassFactory(c)}));t(Jn);var er=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=h(f),r=h(g),a=h(u),s=h(p),o=h(Zn),d=h(i),c=h(l);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){e=e||{};var t=this.context,i=(0,n.default)(t).getInstance(),a=e.dashMetrics,l=void 0,u=void 0,f=void 0;function h(){(f={})[d.default.VIDEO]={ignoreCount:2},f[d.default.AUDIO]={ignoreCount:2}}function g(){h()}function p(e){isNaN(e.startTime)||e.mediaType!==d.default.AUDIO&&e.mediaType!==d.default.VIDEO||f[e.mediaType].ignoreCount>0&&f[e.mediaType].ignoreCount--}return l={getMaxIndex:function(e){var n=(0,o.default)(t).create();if(!e||!e.hasOwnProperty("getMediaType"))return n;!function(){if(!a||!a.hasOwnProperty("getCurrentBufferLevel")||!a.hasOwnProperty("getCurrentBufferState"))throw new Error(d.default.MISSING_CONFIG_ERROR)}();var r=e.getMediaType(),i=a.getCurrentBufferState(r),s=e.getRepresentationInfo().fragmentDuration;if(function(e){return f[e].ignoreCount>0}(r)||!s)return n;if(i&&i.state===c.default.BUFFER_EMPTY)u.debug("["+r+"] Switch to index 0; buffer is empty."),n.quality=0,n.reason="InsufficientBufferRule: Buffer is empty";else{var l=e.getMediaInfo(),h=e.getAbrController(),g=h.getThroughputHistory(),p=a.getCurrentBufferLevel(r),m=g.getAverageThroughput(r),v=g.getAverageLatency(r),y=m*(p/s)*.5;n.quality=h.getQualityForBitrate(l,y,v),n.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return n},reset:function(){h(),i.off(r.default.PLAYBACK_SEEKING,g,l),i.off(r.default.BYTES_APPENDED_END_FRAGMENT,p,l)}},u=(0,s.default)(t).getInstance().getLogger(l),h(),i.on(r.default.PLAYBACK_SEEKING,g,l),i.on(r.default.BYTES_APPENDED_END_FRAGMENT,p,l),l}m.__dashjs_factory_name="InsufficientBufferRule",t.default=a.default.getClassFactory(m)}));t(er);var tr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(Zn),r=a(u),i=a(p);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){e=e||{};var t=this.context,r=e.mediaPlayerModel,a=e.dashMetrics,o=e.settings,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0;function h(){d={},c={},f=[]}return l={shouldAbandon:function(e){var i=(0,n.default)(t).create(n.default.NO_CHANGE,{name:s.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return i;var l,h,g=e.getMediaInfo(),p=e.getMediaType(),m=e.getCurrentRequest();if(!isNaN(m.index)){l=p,h=m.index,d[l]=d[l]||{},d[l][h]=d[l][h]||{};var v=r.getStableBufferTime();if(a.getCurrentBufferLevel(p)>v)return i;var y=d[p][m.index];if(null===y||null===m.firstByteDate||c.hasOwnProperty(y.id))return i;if(void 0===y.firstByteTime&&(f[p]=[],y.firstByteTime=m.firstByteDate.getTime(),y.segmentDuration=m.duration,y.bytesTotal=m.bytesTotal,y.id=m.index),y.bytesLoaded=m.bytesLoaded,y.elapsedTime=(new Date).getTime()-y.firstByteTime,y.bytesLoaded>0&&y.elapsedTime>0&&function(e,t){f[e]=f[e]||[],f[e].push(t)}(p,Math.round(8*y.bytesLoaded/y.elapsedTime)),f[p].length>=5&&y.elapsedTime>500&&y.bytesLoaded<y.bytesTotal){var E=f[p].reduce((function(e,t){return e+t}),0);if(y.measuredBandwidthInKbps=Math.round(E/f[p].length),y.estimatedTimeOfDownload=+(8*y.bytesTotal/y.measuredBandwidthInKbps/1e3).toFixed(2),y.estimatedTimeOfDownload<1.8*y.segmentDuration||0===e.getRepresentationInfo().quality)return i;if(!c.hasOwnProperty(y.id)){var _=e.getAbrController(),T=y.bytesTotal-y.bytesLoaded,b=_.getBitrateList(g),S=_.getQualityForBitrate(g,y.measuredBandwidthInKbps*o.get().streaming.abr.bandwidthSafetyFactor),A=_.getMinAllowedIndexFor(p),R=void 0!==A?Math.max(A,S):S;T>y.bytesTotal*b[R].bitrate/b[_.getQualityFor(p)].bitrate&&(i.quality=R,i.reason.throughput=y.measuredBandwidthInKbps,i.reason.fragmentID=y.id,c[y.id]=y,u.debug("["+p+"] frag id",y.id," is asking to abandon and switch to quality to ",R," measured bandwidth was",y.measuredBandwidthInKbps),delete d[p][y.id])}}else y.bytesLoaded===y.bytesTotal&&delete d[p][y.id]}return i},reset:h},u=(0,i.default)(t).getInstance().getLogger(l),h(),l}s.__dashjs_factory_name="AbandonRequestsRule",t.default=r.default.getClassFactory(s)}));t(tr);var nr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(Zn),i=a(p);function a(e){return e&&e.__esModule?e:{default:e}}function s(){var e=this.context,t=void 0,n=void 0;return t={getMaxIndex:function(t){var i=(0,r.default)(e).create();if(!t||!t.hasOwnProperty("getDroppedFramesHistory"))return i;var a=t.getDroppedFramesHistory();if(a){for(var s=a.getFrameHistory(),o=0,l=0,u=r.default.NO_CHANGE,d=1;d<s.length;d++)if(s[d]&&(o=s[d].droppedVideoFrames,(l=s[d].totalVideoFrames)>375&&o/l>.15)){u=d-1,n.debug("index: "+u+" Dropped Frames: "+o+" Total Frames: "+l);break}return(0,r.default)(e).create(u,{droppedFrames:o})}return i}},n=(0,i.default)(e).getInstance().getLogger(t),t}s.__dashjs_factory_name="DroppedFramesRule",t.default=n.default.getClassFactory(s)}));t(nr);var rr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(p),i=a(Zn);function a(e){return e&&e.__esModule?e:{default:e}}function s(){var e=this.context,t=void 0,n=void 0;return t={getMaxIndex:function(t){for(var r=t?t.getSwitchHistory():null,a=r?r.getSwitchRequests():[],s=0,o=0,l=0,u=(0,i.default)(e).create(),d=0;d<a.length;d++)if(void 0!==a[d]&&(s+=a[d].drops,o+=a[d].noDrops,l+=a[d].dropSize,s+o>=6&&s/o>.075)){u.quality=d>0&&a[d].drops>0?d-1:d,u.reason={index:u.quality,drops:s,noDrops:o,dropSize:l},n.debug("Switch history rule index: "+u.quality+" samples: "+(s+o)+" drops: "+s);break}return u}},n=(0,r.default)(e).getInstance().getLogger(t),t}s.__dashjs_factory_name="SwitchHistoryRule",t.default=n.default.getClassFactory(s)}));t(rr);var ir=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=d(l),r=d(Zn),i=d(u),a=d(f),s=d(g),o=d(p);function d(e){return e&&e.__esModule?e:{default:e}}var c=10;function h(e){e=e||{};var t=this.context,i=e.dashMetrics,l=e.mediaPlayerModel,u=(0,a.default)(t).getInstance(),d=void 0,f=void 0,h=void 0;function g(e,t,n){var r=n.reduce((function(e,t,r){return t>n[e]?r:e}),0);if(0===r)return null;var i=Math.max(e,c+2*t.length),a=(n[r]-1)/(i/c-1);return{gp:a,Vp:c/a}}function p(e){var t={},n=e.getMediaInfo().bitrateList.map((function(e){return e.bandwidth})),r=function(e){return e.map((function(e){return Math.log(e)}))}(n);r=r.map((function(e){return e-r[0]+1}));var i=l.getStableBufferTime(),a=g(i,n,r);return a?(t.state=1,t.bitrates=n,t.utilities=r,t.stableBufferTime=i,t.Vp=a.Vp,t.gp=a.gp,t.lastQuality=0,m(t)):t.state=0,t}function m(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function y(e,t){var n=l.getStableBufferTime();if(e.stableBufferTime!==n){var r=g(n,e.bitrates,e.utilities);if(r.Vp!==e.Vp||r.gp!==e.gp){var a=i.getCurrentBufferLevel(t),s=a+e.placeholderBuffer;s-=c,s*=r.Vp/e.Vp,s+=c,e.stableBufferTime=n,e.Vp=r.Vp,e.gp=r.gp,e.placeholderBuffer=Math.max(0,s-a)}}}function E(e,t){return e.Vp*(e.utilities[t]+e.gp)}function _(e,t){for(var n=e.bitrates[t],r=e.utilities[t],i=0,a=t-1;a>=0;--a)if(e.utilities[a]<e.utilities[t]){var s=e.bitrates[a],o=e.utilities[a],l=e.Vp*(e.gp+(n*o-s*r)/(n-s));i=Math.max(i,l)}return i}function T(){for(var e in h)h.hasOwnProperty(e)&&2===h[e].state&&(h[e].placeholderBuffer=0)}function b(){for(var e in h)if(h.hasOwnProperty(e)){var t=h[e];0!==t.state&&(t.state=1,m(t))}}function S(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=h[e.chunk.mediaInfo.type];if(t&&0!==t.state){var n=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||n>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=n,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=n,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,R(t,e.chunk.mediaInfo.type)}}}function A(e){if(e&&e.metric===n.default.HTTP_REQUEST&&e.value&&e.value.type===v.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=h[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),R(t,e.mediaType))}}function R(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var n=i.getCurrentBufferLevel(t)+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),r=E(e,e.lastQuality),a=Math.max(0,r-n);e.placeholderBuffer=Math.min(a,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function I(e){if(e){var t=h[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function w(e){if(e){var t=h[e.mediaType];if(t&&0!==t.state){var n=i.getCurrentBufferLevel(e.mediaType),r=void 0;r=t.abrQuality>0?_(t,t.abrQuality):c;var a=Math.max(0,r-n);t.placeholderBuffer=Math.min(t.placeholderBuffer,a)}}}function C(){h={}}return d={getMaxIndex:function(e){var n=(0,r.default)(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return n;var a=e.getMediaInfo(),s=e.getMediaType(),o=e.getScheduleController(),l=e.getStreamInfo(),u=e.getAbrController(),d=u.getThroughputHistory(),c=l?l.id:null,g=l&&l.manifestInfo&&l.manifestInfo.isDynamic,v=e.useBufferOccupancyABR();if(n.reason=n.reason||{},!v)return n;o.setTimeToLoadDelay(0);var T=function(e){var t=e.getMediaType(),n=h[t];return n?0!==n.state&&y(n,t):(n=p(e),h[t]=n),n}(e);if(0===T.state)return n;var b=i.getCurrentBufferLevel(s),S=d.getAverageThroughput(s,g),A=d.getSafeAverageThroughput(s,g),R=d.getAverageLatency(s),I=void 0;if(n.reason.state=T.state,n.reason.throughput=S,n.reason.latency=R,isNaN(S))return n;switch(T.state){case 1:I=u.getQualityForBitrate(a,A,R),n.quality=I,n.reason.throughput=A,T.placeholderBuffer=Math.max(0,_(T,I)-b),T.lastQuality=I,!isNaN(T.lastSegmentDurationS)&&b>=T.lastSegmentDurationS&&(T.state=2);break;case 2:!function(e,t){var n=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var r=.001*(n-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,r)}}else{var i=.001*(n-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,i)}e.lastCallTimeMs=n,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,y(e,t)}(T,s),I=function(e,t){for(var n=e.bitrates.length,r=NaN,i=NaN,a=0;a<n;++a){var s=(e.Vp*(e.utilities[a]+e.gp)-t)/e.bitrates[a];(isNaN(i)||s>=i)&&(i=s,r=a)}return r}(T,b+T.placeholderBuffer);var w=u.getQualityForBitrate(a,A,R);I>T.lastQuality&&I>w&&(I=Math.max(w,T.lastQuality));var C=Math.max(0,b+T.placeholderBuffer-E(T,I));C<=T.placeholderBuffer?(T.placeholderBuffer-=C,C=0):(C-=T.placeholderBuffer,T.placeholderBuffer=0,I<u.getTopQualityIndexFor(s,c)?o.setTimeToLoadDelay(1e3*C):C=0),n.quality=I,n.reason.throughput=S,n.reason.latency=R,n.reason.bufferLevel=b,n.reason.placeholderBuffer=T.placeholderBuffer,n.reason.delay=C,T.lastQuality=I;break;default:f.debug("BOLA ABR rule invoked in bad state."),n.quality=u.getQualityForBitrate(a,A,R),n.reason.state=T.state,n.reason.throughput=A,n.reason.latency=R,T.state=1,m(T)}return n},reset:function(){C(),u.off(s.default.BUFFER_EMPTY,T,d),u.off(s.default.PLAYBACK_SEEKING,b,d),u.off(s.default.MEDIA_FRAGMENT_LOADED,S,d),u.off(s.default.METRIC_ADDED,A,d),u.off(s.default.QUALITY_CHANGE_REQUESTED,I,d),u.off(s.default.FRAGMENT_LOADING_ABANDONED,w,d)}},f=(0,o.default)(t).getInstance().getLogger(d),C(),u.on(s.default.BUFFER_EMPTY,T,d),u.on(s.default.PLAYBACK_SEEKING,b,d),u.on(s.default.MEDIA_FRAGMENT_LOADED,S,d),u.on(s.default.METRIC_ADDED,A,d),u.on(s.default.QUALITY_CHANGE_REQUESTED,I,d),u.on(s.default.FRAGMENT_LOADING_ABANDONED,w,d),d}h.__dashjs_factory_name="BolaRule",t.default=i.default.getClassFactory(h)}));t(ir);var ar=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=h(l),r=h(Zn),a=h(u),s=h(f),o=h(g),d=h(p),c=h(i);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){e=e||{};var t=this.context,i=e.dashMetrics,a=(0,s.default)(t).getInstance(),l=void 0,u=void 0,f=void 0,h=void 0;function g(e){var t={},n=e.getMediaInfo(),r=n.bitrateList.map((function(e){return e.bandwidth/1e3}));return t.state=1,t.bitrates=r,t.lastQuality=0,function(e){if(!e||!e.type)return;f[e.type]={},f[e.type].w=[],f[e.type].prev_w=[],f[e.type].Q=0,f[e.type].segment_request_start_s=0,f[e.type].segment_download_finish_s=0,f[e.type].B_target=1.5}(n),p(t),t}function p(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function m(){for(var e in u)if(u.hasOwnProperty(e)){var t=u[e];0!==t.state&&(t.state=1,p(t))}}function y(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=u[e.chunk.mediaInfo.type],n=f[e.chunk.mediaInfo.type];if(t&&0!==t.state){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,_(t,n)}}}function E(e){if(e&&e.metric===n.default.HTTP_REQUEST&&e.value&&e.value.type===v.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=u[e.mediaType],r=f[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),_(t,r))}}function _(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function T(e){if(e&&e.mediaType){var t=u[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function b(e,t){if(e.length!==t.length)return-1;for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function S(){u={},f={}}return l={getMaxIndex:function(e){var n=(0,r.default)(t).create(),a=Math.pow(4,.99),s=Math.max(Math.pow(4,1),a*Math.sqrt(4)),o=e.getMediaInfo(),l=e.getMediaType(),d=o.bitrateList.map((function(e){return e.bandwidth})),m=d.length,v=e.getScheduleController(),y=e.getStreamInfo(),E=e.getAbrController(),_=E.getThroughputHistory(),T=y&&y.manifestInfo&&y.manifestInfo.isDynamic,S=e.useL2AABR(),A=i.getCurrentBufferLevel(l,!0),R=_.getSafeAverageThroughput(l,T),I=_.getAverageThroughput(l,T),w=_.getAverageLatency(l),C=void 0,D=e.getVideoModel().getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")))return n;if(n.reason=n.reason||{},!S||l===c.default.AUDIO)return n;v.setTimeToLoadDelay(0);var M=function(e){var t=e.getMediaType(),n=u[t];return n||(n=g(e),u[t]=n),n}(e);if(0===M.state)return n;var N=f[l];if(!N)return n;if(n.reason.state=M.state,n.reason.throughput=I,n.reason.latency=w,isNaN(I))return n;switch(M.state){case 1:if(C=E.getQualityForBitrate(o,R,w),n.quality=C,n.reason.throughput=R,M.lastQuality=C,!isNaN(M.lastSegmentDurationS)&&A>=N.B_target){M.state=2,N.Q=a;for(var O=0;O<m;++O)O===M.lastQuality?N.prev_w[O]=1:N.prev_w[O]=0}break;case 2:var P=[],L=i.getCurrentHttpRequest(l).trace.reduce((function(e,t){return e+t.d}),0),k=i.getCurrentHttpRequest(l).trace.reduce((function(e,t){return e+t.b[0]}),0),x=Math.round(8*k/L);x<1&&(x=1);for(var F=M.lastSegmentDurationS,U=1,B=0;B<m;++B)d[B]=d[B]/1e3,D*d[B]>x&&(U=-1),N.w[B]=N.prev_w[B]+U*(F/(2*s))*((N.Q+a)*(D*d[B]/x));N.w=function(e){for(var t=e.length,n=!1,r=[],i=0;i<t;++i)r[i]=e[i];for(var a=e.sort((function(e,t){return t-e})),s=0,o=0,l=[],u=0;u<t-1;++u)if((o=((s+=a[u])-1)/(u+1))>=a[u+1]){n=!0;break}n||(o=(s+a[t-1]-1)/t);for(var d=0;d<t;++d)l[d]=Math.max(r[d]-o,0);return l}(N.w);for(var G=0;G<m;++G)P[G]=N.w[G]-N.prev_w[G],N.prev_w[G]=N.w[G];N.Q=Math.max(0,N.Q-F+F*D*((b(d,N.prev_w)+b(d,P))/x));for(var j=[],H=0;H<m;++H)j[H]=Math.abs(d[H]-b(N.w,d));(C=j.indexOf(Math.min.apply(Math,j)))>M.lastQuality&&d[M.lastQuality+1]<=x&&(C=M.lastQuality+1),d[C]>=x&&(N.Q=2*Math.max(a,N.Q)),n.quality=C,n.reason.throughput=I,n.reason.latency=w,n.reason.bufferLevel=A,M.lastQuality=n.quality;break;default:h.debug("L2A ABR rule invoked in bad state."),n.quality=E.getQualityForBitrate(o,R,w),n.reason.state=M.state,n.reason.throughput=R,n.reason.latency=w,M.state=1,p(M)}return n},reset:function(){S(),a.off(o.default.PLAYBACK_SEEKING,m,l),a.off(o.default.MEDIA_FRAGMENT_LOADED,y,l),a.off(o.default.METRIC_ADDED,E,l),a.off(o.default.QUALITY_CHANGE_REQUESTED,T,l)}},h=(0,d.default)(t).getInstance().getLogger(l),S(),a.on(o.default.PLAYBACK_SEEKING,m,l),a.on(o.default.MEDIA_FRAGMENT_LOADED,y,l),a.on(o.default.METRIC_ADDED,E,l),a.on(o.default.QUALITY_CHANGE_REQUESTED,T,l),l}m.__dashjs_factory_name="L2ARule",t.default=a.default.getClassFactory(m)}));t(ar);var sr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(p);function i(e){return e&&e.__esModule?e:{default:e}}var a="manual_weight_selection",s="random_weight_selection",o="dynamic_weight_selection";function l(){var e=this.context,t=void 0,n=void 0,i=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0,h=void 0;function g(){i=null,l=1,u=100,d=0,c=null,f=null,h=o}function p(){var e=0;if(i)for(var t=0;t<i.length;t++){var n=i[t];n.state.throughput>e&&(e=n.state.throughput)}return e}function m(e,t,n){var r=e.map((function(e,r){return n[r]*Math.pow(e-t[r],2)})).reduce((function(e,t){return e+t}));return(r<0?-1:1)*Math.sqrt(Math.abs(r))}function v(e,t){return m([e.state.throughput,e.state.latency,e.state.rebuffer,e.state.switch],[t.state.throughput,t.state.latency,t.state.rebuffer,t.state.switch],[1,1,1,1])}function y(e,t,n){for(var r=0;r<t.length;r++){var i=t[r],a=v(i,e);E(i,n,Math.exp(-1*Math.pow(a,2)/(2*Math.pow(.1,2))))}}function E(e,t,n){var r=e.state,i=[.01,.01,.01,.01];r.throughput=r.throughput+(t[0]-r.throughput)*i[0]*n,r.latency=r.latency+(t[1]-r.latency)*i[1]*n,r.rebuffer=r.rebuffer+(t[2]-r.rebuffer)*i[2]*n,r.switch=r.switch+(t[3]-r.switch)*i[3]*n}function _(e,t,n,r,i,a,s){c||(c=f[f.length-1]);var o=e.findWeightVector(t,n,r,i,a,s);null!==o&&-1!==o&&(c=o)}return t={getNextQuality:function(e,t,r,o,g,v,E){var T=r,b=o,S=t,A=function(e){if(!i){i=[];var t=e.bitrateList,n=[];d=t[0].bandwidth,t.forEach((function(e){n.push(e.bandwidth),e.bandwidth<d&&(d=e.bandwidth)})),s=n.map((function(e){return Math.pow(e,2)})).reduce((function(e,t){return e+t})),l=Math.sqrt(s);for(var r=0;r<t.length;r++){var a={qualityIndex:r,bitrate:t[r].bandwidth,state:{throughput:t[r].bandwidth/l,latency:0,rebuffer:0,switch:0}};i.push(a),a.bitrate}f=function(e){var t=[],n=function(e){for(var t=[],n=0;n<e;n++){var r=[Math.random()*p(),Math.random(),Math.random(),Math.random()];t.push(r)}return t}(Math.pow(e.length,2));t.push(n[0]);for(var r=[1,1,1,1],i=1;i<e.length;i++){for(var a=null,s=null,o=0;o<n.length;o++){for(var l=n[o],u=null,d=0;d<t.length;d++){var c=m(l,t[d],r);(null===u||c<u)&&(u=c)}(null===s||u>s)&&(a=l,s=u)}t.push(a)}for(var f=null,h=null,g=0;g<t.length;g++){for(var v=0,y=0;y<t.length;y++)g!==y&&(v+=m(t[g],t[y],r));(null===f||v>f)&&(f=v,h=g)}var E=[];E.push(t[h]),t.splice(h,1);for(;t.length>0;){for(var _=null,T=null,b=0;b<t.length;b++){var S=m(E[0],t[b],r);(null===_||S<_)&&(_=S,T=b)}E.push(t[T]),t.splice(T,1)}return E}(i)}var s;return i}(e),R=t/l;R>1&&(R=p()),r/=u,n.debug("getNextQuality called throughput:"+R+" latency:"+r+" bufferSize:"+o+" currentQualityIndex:"+v+" playbackRate:"+g);var I=A[v],w=I.bitrate*E.getSegmentDuration()/S,C=Math.max(0,w-b);if(b-w<E.getMinBuffer())return n.debug("Buffer is low for bitrate= "+I.bitrate+" downloadTime="+w+" currentBuffer="+b+" rebuffer="+C),function(e,t){var n=0,r=e;if(i)for(var a=0;a<i.length;a++){var s=i[a];s.bitrate<e.bitrate&&s.bitrate>n&&t>s.bitrate&&(n=s.bitrate,r=s)}return r}(I,S).qualityIndex;switch(h){case a:c=[.4,.4,.4,.4];break;case s:!function(e){c=function(e,t){for(var n=[],r=Math.sqrt(2/e),i=0;i<t;i++)n.push(Math.random()*r);return c=n}(e.length,4)}(A);break;default:_(E,A,T,b,C,S,g)}for(var D=null,M=null,N=null,O=0;O<A.length;O++){var P=A[O],L=P.state,k=[L.throughput,L.latency,L.rebuffer,L.switch],x=c.slice(),F=E.getNextBufferWithBitrate(P.bitrate,b,S),U=F<E.getMinBuffer();U&&n.debug("Buffer is low for bitrate="+P.bitrate+" downloadTime="+w+" currentBuffer="+b+" nextBuffer="+F),(P.bitrate>t-1e4||U)&&P.bitrate!==d&&(x[0]=100);var B=m(k,[R,0,0,0],x);(null===D||B<D)&&(D=B,M=P.qualityIndex,N=P)}var G=Math.abs(I.bitrate-N.bitrate)/l;return y(I,A,[R,r,C,G]),y(N,A,[R,0,0,G]),M},reset:function(){g()}},n=(0,r.default)(e).getInstance().getLogger(t),g(),t}l.__dashjs_factory_name="LearningAbrController",t.default=n.default.getClassFactory(l)}));t(sr);var or=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}}));t(or);var lr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(or);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e,t=void 0,n=void 0,i=void 0,a=void 0;function s(){t=null,n=null,i=null,a=null}function o(e,t,n,i){var a=new r.default;return a.type=e,a.weights.bitrateReward=t||1,a.weights.bitrateSwitchPenalty=1,a.weights.rebufferPenalty=n||1e3,a.weights.latencyPenalty=[],a.weights.latencyPenalty.push({threshold:1.1,penalty:.05*i}),a.weights.latencyPenalty.push({threshold:1e8,penalty:.1*n}),a.weights.playbackSpeedPenalty=i||200,a}function l(e,t,n,r,i){i.bitrateWSum+=i.weights.bitrateReward*e,i.lastBitrate&&(i.bitrateSwitchWSum+=i.weights.bitrateSwitchPenalty*Math.abs(e-i.lastBitrate)),i.lastBitrate=e,i.rebufferWSum+=i.weights.rebufferPenalty*t;for(var a=0;a<i.weights.latencyPenalty.length;a++){var s=i.weights.latencyPenalty[a];if(n<=s.threshold){i.latencyWSum+=s.penalty*n;break}}i.playbackSpeedWSum+=i.weights.playbackSpeedPenalty*Math.abs(1-r),i.totalQoe=i.bitrateWSum-i.bitrateSwitchWSum-i.rebufferWSum-i.latencyWSum-i.playbackSpeedWSum}return e={setupPerSegmentQoe:function(e,r,s){t=o("segment",e,r,s),n=e,i=r,a=s},logSegmentMetrics:function(e,n,r,i){t&&l(e,n,r,i,t)},getPerSegmentQoe:function(){return t},calculateSingleUseQoe:function(e,t,r,s){var u=null;return n&&i&&a&&(u=o("segment",n,i,a)),u?(l(e,t,r,s,u),u.totalQoe):0},reset:function(){s()}},s(),e}a.__dashjs_factory_name="LoLpQoeEvaluator",t.default=n.default.getClassFactory(a)}));t(lr);var ur=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(e){var t,n,r,i,a,s=e.targetLatency,o=e.bufferMin,l=e.segmentDuration,u=e.qoeEvaluator,d=void 0,c=void 0;function f(){return l}function h(e,t){var n=f();return t>n?e-n:e+n-t}return t={getMinBuffer:function(){return o},getSegmentDuration:f,getNextBufferWithBitrate:function(e,t,n){return h(t,e*l/n)},getNextBuffer:h,findWeightVector:function(e,t,n,r,i,a){var f=null,g=null,p=null,m=Math.abs(t-c);return e.forEach((function(e){d.forEach((function(r){r[0];var d=r[1],c=r[2],v=(r[3],e.bitrate*l/i),y=h(n,v),E=(0===c?10:1/c)*Math.max(1e-5,v-y),_=(0===d?10:1/d)*e.state.latency,T=u.calculateSingleUseQoe(e.bitrate,E,_,a);(null===f||T>f)&&function(e,t,n){if(e>s+n)return!1;return t>=o}(t,y,m)&&(f=T,g=r,p=e.bitrate)}))})),null===g&&null===p&&(g=-1),c=t,g}},n=[.2,.4,.6,.8,1],r=4,i=n.map((function(e){return[e]})),a=function e(t,r,i){if(i===r)return t;for(var a=t.length,s=0;s<a;s++)for(var o=t.shift(),l=0;l<n.length;l++)t.push(o.concat(n[l]));return e(t,r,i+1)},d=a(i,r,1),c=0,t}i.__dashjs_factory_name="LoLpWeightSelector",t.default=r.default.getClassFactory(i)}));t(ur);var dr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=h(p),r=h(u),a=h(sr),s=h(lr),o=h(Zn),d=h(l),c=h(ur),f=h(i);function h(e){return e&&e.__esModule?e:{default:e}}function g(e){var t=(e=e||{}).dashMetrics,r=this.context,i=void 0,l=void 0,u=void 0,h=void 0;return l={getMaxIndex:function(e){try{var n=(0,o.default)(r).create(),a=e.getMediaInfo().type,s=e.getAbrController(),l=e.getStreamInfo(),g=s.getQualityFor(a,l),p=e.getMediaInfo(),m=t.getCurrentBufferState(a),v=e.getScheduleController(),y=t.getCurrentBufferLevel(a,!0),E=l&&l.manifestInfo?l.manifestInfo.isDynamic:null,_=v.getPlaybackController(),T=_.getCurrentLiveLatency();if(!e.useLoLPABR()||a===f.default.AUDIO)return n;T||(T=0);var b=_.getPlaybackRate(),S=s.getThroughputHistory().getSafeAverageThroughput(a,E);if(i.debug("Throughput "+Math.round(S)+" kbps"),isNaN(S)||!m)return n;if(s.getAbandonmentStateFor(a)===d.default.ABANDON_LOAD)return n;for(var A=p.bitrateList,R=e.getRepresentationInfo().fragmentDuration,I=A[0].bandwidth/1e3,w=A[A.length-1].bandwidth/1e3,C=0;C<A.length;C++){var D=A[C].bandwidth/1e3;D>w?w=D:D<I&&(I=D)}var M=A[g].bandwidth/1e3,N=t.getCurrentHttpRequest(a,!0),O=(N.tresponse.getTime()-N.trequest.getTime())/1e3,P=O>R?O-R:0;h.setupPerSegmentQoe(R,w,I),h.logSegmentMetrics(M,P,T,b);var L=(0,c.default)(r).create({targetLatency:1.5,bufferMin:.3,segmentDuration:R,qoeEvaluator:h});return n.quality=u.getNextQuality(p,1e3*S,T,y,b,g,L),n.reason={throughput:S,latency:T},n.priority=o.default.PRIORITY.STRONG,v.setTimeToLoadDelay(0),n.quality!==g&&console.log("[TgcLearningRule]["+a+"] requesting switch to index: ",n.quality,"Average throughput",Math.round(S),"kbps"),n}catch(e){throw e}},reset:function(){u.reset(),h.reset()}},i=(0,n.default)(r).getInstance().getLogger(l),u=(0,a.default)(r).create(),h=(0,s.default)(r).create(),l}g.__dashjs_factory_name="LoLPRule",t.default=r.default.getClassFactory(g)}));t(dr);var cr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=p(Jn),r=p(er),a=p(tr),s=p(nr),o=p(rr),l=p(ir),d=p(ar),c=p(dr),f=p(u),h=p(Zn),g=p(i);function p(e){return e&&e.__esModule?e:{default:e}}var m="qualitySwitchRules",v="abandonFragmentRules";function y(e){e=e||{};var t=this.context,i=e.mediaPlayerModel,u=e.dashMetrics,f=e.settings,p=void 0,y=void 0;function E(e){return e.filter((function(e){return e.quality>h.default.NO_CHANGE}))}function _(e){var n,r={},i=null,a=void 0,s=void 0,o=void 0,l=void 0;if(0!==e.length){for(r[h.default.PRIORITY.STRONG]={quality:h.default.NO_CHANGE,reason:null},r[h.default.PRIORITY.WEAK]={quality:h.default.NO_CHANGE,reason:null},r[h.default.PRIORITY.DEFAULT]={quality:h.default.NO_CHANGE,reason:null},a=0,n=e.length;a<n;a+=1)(s=e[a]).quality!==h.default.NO_CHANGE&&(r[s.priority].quality===h.default.NO_CHANGE||r[s.priority].quality>s.quality)&&(r[s.priority].quality=s.quality,r[s.priority].reason=s.reason||null);return r[h.default.PRIORITY.WEAK].quality!==h.default.NO_CHANGE&&(i=r[h.default.PRIORITY.WEAK]),r[h.default.PRIORITY.DEFAULT].quality!==h.default.NO_CHANGE&&(i=r[h.default.PRIORITY.DEFAULT]),r[h.default.PRIORITY.STRONG].quality!==h.default.NO_CHANGE&&(i=r[h.default.PRIORITY.STRONG]),i&&(o=i.quality,l=i.reason),(0,h.default)(t).create(o,l)}}return{initialize:function(){p=[],y=[],f.get().streaming.abr.useDefaultABRRules&&(f.get().streaming.abr.ABRStrategy===g.default.ABR_STRATEGY_L2A?p.push((0,d.default)(t).create({dashMetrics:u,mediaPlayerModel:i,settings:f})):f.get().streaming.abr.ABRStrategy===g.default.ABR_STRATEGY_LoLP?p.push((0,c.default)(t).create({dashMetrics:u})):(p.push((0,l.default)(t).create({dashMetrics:u,mediaPlayerModel:i,settings:f})),p.push((0,n.default)(t).create({dashMetrics:u})),p.push((0,r.default)(t).create({dashMetrics:u})),p.push((0,o.default)(t).create()),p.push((0,s.default)(t).create()),y.push((0,a.default)(t).create({dashMetrics:u,mediaPlayerModel:i,settings:f})))),i.getABRCustomRules().forEach((function(e){e.type===m&&p.push(e.rule(t).create()),e.type===v&&y.push(e.rule(t).create())}))},reset:function(){[p,y].forEach((function(e){e&&e.length&&e.forEach((function(e){return e.reset&&e.reset()}))})),p=[],y=[]},getMaxQuality:function(e){return _(E(p.map((function(t){return t.getMaxIndex(e)}))))||(0,h.default)(t).create()},getMinSwitchRequest:_,shouldAbandonFragment:function(e){return _(E(y.map((function(t){return t.shouldAbandon(e)}))))||(0,h.default)(t).create()},getQualitySwitchRules:function(){return p}}}y.__dashjs_factory_name="ABRRulesCollection";var E=f.default.getClassFactory(y);E.QUALITY_SWITCH_RULES=m,E.ABANDON_FRAGMENT_RULES=v,f.default.updateSingletonFactory(y.__dashjs_factory_name,E),t.default=E}));t(cr);var fr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN}}));t(fr);var hr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(e){var t=(e=e||{}).abrController,n=e.switchHistory,r=e.droppedFramesHistory,i=e.currentRequest,a=e.useBufferOccupancyABR,s=e.useL2AABR,o=e.useLoLPABR,l=e.streamProcessor?e.streamProcessor.getScheduleController():null,u=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,d=e.videoModel?e.videoModel:null;function c(){return u?u.mediaInfo:null}return{getMediaType:function(){var e=c();return e?e.type:null},getMediaInfo:c,getDroppedFramesHistory:function(){return r},getCurrentRequest:function(){return i},getSwitchHistory:function(){return n},getStreamInfo:function(){var e=c();return e?e.streamInfo:null},getScheduleController:function(){return l},getAbrController:function(){return t},getRepresentationInfo:function(){return u},useBufferOccupancyABR:function(){return a},useL2AABR:function(){return s},useLoLPABR:function(){return o},getVideoModel:function(){return d}}}i.__dashjs_factory_name="RulesContext",t.default=r.default.getClassFactory(i)}));t(hr);var gr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(Zn);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e=[],t=[];return{push:function(n){n.newValue===r.default.NO_CHANGE&&(n.newValue=n.oldValue),e[n.oldValue]||(e[n.oldValue]={noDrops:0,drops:0,dropSize:0});var i=n.newValue-n.oldValue,a=i<0?1:0,s=a?-i:0,o=a?0:1;if(e[n.oldValue].drops+=a,e[n.oldValue].dropSize+=s,e[n.oldValue].noDrops+=o,t.push({idx:n.oldValue,noDrop:o,drop:a,dropSize:s}),t.length>8){var l=t.shift();e[l.idx].drops-=l.drop,e[l.idx].dropSize-=l.dropSize,e[l.idx].noDrops-=l.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}a.__dashjs_factory_name="SwitchRequestHistory";var s=n.default.getClassFactory(a);t.default=s}));t(gr);var pr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(){var e=[],t=0,n=0;return{push:function(r,i){var a=i&&i.droppedVideoFrames?i.droppedVideoFrames:0,s=i&&i.totalVideoFrames?i.totalVideoFrames:0,o=a-t;t=a;var l=s-n;n=s,isNaN(r)||(e[r]?(e[r].droppedVideoFrames+=o,e[r].totalVideoFrames+=l):e[r]={droppedVideoFrames:o,totalVideoFrames:l})},getFrameHistory:function(){return e},reset:function(r){e=[],t=r.droppedVideoFrames,n=r.totalVideoFrames}}}i.__dashjs_factory_name="DroppedFramesHistory";var a=r.default.getClassFactory(i);t.default=a}));t(pr);var mr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(i),r=a(u);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=(e=e||{}).settings,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0;function l(e,t,n,r){var i=Math.pow(.5,n/r.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;var a=Math.pow(.5,n/r.slow);e.slowEstimate=(1-a)*t+a*e.slowEstimate,e.totalWeight+=n}function u(e,l,u){return t.get().streaming.abr.movingAverageMethod!==n.default.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var n=e?o.throughputHalfLife:o.latencyHalfLife,r=e?a[t]:s[t];if(!r||r.totalWeight<=0)return NaN;var i=r.fastEstimate/(1-Math.pow(.5,r.totalWeight/n.fast)),l=r.slowEstimate/(1-Math.pow(.5,r.totalWeight/n.slow));return e?Math.min(i,l):Math.max(i,l)}(e,l):function(e,t,n){var a=function(e,t,n){var a=void 0,s=void 0;if(e?(a=r[t],s=n?3:4):(a=i[t],s=4),a){if(s>=a.length)s=a.length;else if(e)for(var o=1;o<s;++o){var l=a[a.length-o]/a[a.length-o-1];if((l>=1.3||l<=1/1.3)&&(s+=1)===a.length)break}}else s=0;return s}(e,t,n),s=(e?r:i)[t];if(0===a||!s||0===s.length)return NaN;return(s=s.slice(-a)).reduce((function(e,t){return e+t}))/s.length}(e,l,u)}function d(e,t){return u(!0,e,t)}function c(e){r[e]=r[e]||[],i[e]=i[e]||[],a[e]=a[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},s[e]=s[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function f(){r={},i={},a={},s={}}var h={push:function(e,u,d){if(u.trace&&u.trace.length){var f=u.tresponse.getTime()-u.trequest.getTime()||1,h=u._tfinish.getTime()-u.tresponse.getTime()||1,g=u.trace.reduce((function(e,t){return e+t.b[0]}),0),p=void 0;p=t.get().streaming.lowLatencyEnabled?u.trace.reduce((function(e,t){return e+t.d}),0):d?h:f+h;var m=Math.round(8*g/p);if(c(e),function(e,r,i){return e===n.default.VIDEO?i<t.get().streaming.cacheLoadThresholds[n.default.VIDEO]:e===n.default.AUDIO?i<t.get().streaming.cacheLoadThresholds[n.default.AUDIO]:void 0}(e,0,h)){if(r[e].length>0&&!r[e].hasCachedEntries)return;r[e].hasCachedEntries=!0}else r[e]&&r[e].hasCachedEntries&&function(e){delete r[e],delete i[e],delete a[e],delete s[e],c(e)}(e);r[e].push(m),r[e].length>20&&r[e].shift(),i[e].push(f),i[e].length>20&&i[e].shift(),l(a[e],m,.001*h,o.throughputHalfLife),l(s[e],f,1,o.latencyHalfLife)}},getAverageThroughput:d,getSafeAverageThroughput:function(e,n){var r=d(e,n);return isNaN(r)||(r*=t.get().streaming.abr.bandwidthSafetyFactor),r},getAverageLatency:function(e){return u(!1,e)},reset:f};return o={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},f(),h}s.__dashjs_factory_name="ThroughputHistory",t.default=r.default.getClassFactory(s)}));t(mr);var vr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=A(cr),r=A(i),a=A(l),s=A(fr),o=A(E),d=A(f),c=A(g),h=A(u),m=A(hr),y=A(Zn),_=A(gr),T=A(pr),b=A(mr),S=A(p);function A(e){return e&&e.__esModule?e:{default:e}}function R(){var e=this.context,t=(0,S.default)(e).getInstance(),i=(0,d.default)(e).getInstance(),l=void 0,u=void 0,f=void 0,h=void 0,g=void 0,p=void 0,E=void 0,A=void 0,R=void 0,I=void 0,C=void 0,D=void 0,M=void 0,N=void 0,O=void 0,P=void 0,L=void 0,k=void 0,x=void 0,F=void 0,U=void 0,B=void 0,G=void 0,j=void 0,H=void 0;function q(){(f=(0,n.default)(e).create({dashMetrics:j,mediaPlayerModel:O,settings:H})).initialize()}function K(){g={},p={},A={},E={},k={},U={},B={},G={},void 0===I&&(I=!1),L=void 0,x=void 0,F=void 0,clearTimeout(R),R=null}function Y(e){e.mediaType===r.default.VIDEO&&(void 0!==L&&x.push(L,N.getPlaybackQuality()),L=e.newQuality)}function V(e){e.metric!==a.default.HTTP_REQUEST||!e.value||e.value.type!==v.HTTPRequest.MEDIA_SEGMENT_TYPE||e.mediaType!==r.default.AUDIO&&e.mediaType!==r.default.VIDEO||F.push(e.mediaType,e.value,H.get().streaming.abr.useDeadTimeLatency),e.metric!==a.default.BUFFER_LEVEL||e.mediaType!==r.default.AUDIO&&e.mediaType!==r.default.VIDEO||function(e,t){var n=H.get().streaming.abr.ABRStrategy;if(n===r.default.ABR_STRATEGY_L2A)return U[e]=!1,G[e]=!1,void(B[e]=!0);if(n===r.default.ABR_STRATEGY_LoLP)return U[e]=!1,G[e]=!0,void(B[e]=!1);if(n===r.default.ABR_STRATEGY_BOLA)return U[e]=!0,G[e]=!1,void(B[e]=!1);if(n===r.default.ABR_STRATEGY_THROUGHPUT)return U[e]=!1,G[e]=!1,void(B[e]=!1);!function(e,t){var n=O.getStableBufferTime(),r=n,i=.5*n,a=U[e],s=t>(a?i:r);U[e]=s,s!==a&&(s?u.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+t.toFixed(3)+")."):u.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+t.toFixed(3)+")."))}(e,t)}(e.mediaType,.001*e.value.level)}function W(e,t){var n=void 0;return g[t]=g[t]||{},g[t].hasOwnProperty(e)||(g[t][e]=0),n=function(e,t){var n=e;if(!E[t])return n;var r=X(t);void 0!==r&&(n=Math.max(e,r));var i=z(t);void 0!==i&&(n=Math.min(n,i));return n}(g[t][e],e),n=function(e,t,n){var r=H.get().streaming.abr.maxRepresentationRatio[t];if(isNaN(r)||r>=1||r<0)return e;return Math.min(e,Math.round(n*r))}(n,e,g[t][e]),n=function(e,t){if(t!==r.default.VIDEO||!H.get().streaming.abr.limitBitrateByPortal||!E[t])return e;I||ae();var n=M.getAdaptationForType(0,t).Representation,i=e;if(C>0&&D>0){for(;i>0&&n[i]&&C<n[i].width&&C-n[i-1].width<n[i].width-C;)i-=1;for(;i<n.length-1&&n[i].width===n[i+1].width;)i+=1}return i}(n,e),n}function z(e){var t=function(e){return H.get().streaming.abr.maxBitrate[e]}(e);return t>-1?J(E[e].getMediaInfo(),t):void 0}function X(e){var t=function(e){return H.get().streaming.abr.minBitrate[e]}(e);if(t>-1){var n=E[e].getMediaInfo(),r=ee(n),i=J(n,t);return r[i]&&i<r.length-1&&r[i].bitrate<1e3*t&&i++,i}}function Q(e,t,n,r){var i=t.id,a=ie(e);(0,w.checkInteger)(n);var s=W(e,i);n!==a&&n>=0&&n<=s&&$(e,a,n,s,r)}function $(e,t,n,r,a){if(e&&E[e]){var s=E[e].getStreamInfo(),o=s?s.id:null;if(H.get().debug.logLevel===S.default.LOG_LEVEL_DEBUG){var l=j.getCurrentBufferLevel(e);u.info("["+e+"] switch from "+t+" to "+n+"/"+r+" (buffer: "+l+") "+(a?JSON.stringify(a):"."))}!function(e,t,n){p[t]=p[t]||{},p[t][e]=n}(e,o,n),i.trigger(c.default.QUALITY_CHANGE_REQUESTED,{oldQuality:t,newQuality:n,reason:a},{streamId:s.id,mediaType:e});var d=F.getAverageThroughput(e);isNaN(d)||P.setSavedBitrateSettings(e,d)}}function Z(e,t){A[e].state=t}function J(e,t,n){var r=e&&e.type?E[e.type].getRepresentationInfo():null;if(H.get().streaming.abr.useDeadTimeLatency&&n&&r&&r.fragmentDuration){n/=1e3;var i=r.fragmentDuration;if(n>i)return 0;t*=1-n/i}for(var a=ee(e),s=a.length-1;s>=0;s--){if(1e3*t>=a[s].bitrate)return s}return 0}function ee(e){var t=[];if(!e||!e.bitrateList)return t;for(var n=e.bitrateList,r=e.type,i=void 0,a=0,o=n.length;a<o;a++)(i=new s.default).mediaType=r,i.qualityIndex=a,i.bitrate=n[a].bandwidth,i.width=n[a].width,i.height=n[a].height,i.scanType=n[a].scanType,t.push(i);return t}function te(e){return U[e]}function ne(e){return B[e]}function re(e){return G[e]}function ie(e){if(e&&E[e]){var t=E[e].getStreamInfo(),n=t?t.id:null;if(n)return p[n]=p[n]||{},p[n].hasOwnProperty(e)||(p[n][e]=0),p[n][e]}return 0}function ae(){if(N){var e=H.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;C=N.getClientWidth()*e,D=N.getClientHeight()*e}}function se(t){var n=t.request.mediaType;if(H.get().streaming.abr.autoSwitchBitrate[n]){var r=E[n];if(!r)return;var i=(0,m.default)(e).create({abrController:l,streamProcessor:r,currentRequest:t.request,useBufferOccupancyABR:te(n),useL2AABR:ne(n),useLoLPABR:re(n),videoModel:N}),s=f.shouldAbandonFragment(i);if(s.quality>y.default.NO_CHANGE){var u=r.getFragmentModel();u.getRequests({state:o.default.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(u.abortRequests(),Z(n,a.default.ABANDON_LOAD),k[n].reset(),k[n].push({oldValue:ie(n),newValue:s.quality,confidence:1,reason:s.reason}),Q(n,h.getActiveStreamInfo(),s.quality,s.reason),clearTimeout(R),R=setTimeout((function(){Z(n,a.default.ALLOW_LOAD),R=null}),H.get().streaming.abandonLoadTimeout))}}}return l={isPlayingAtTopQuality:function(e){var t=e?e.id:null,n=ie(r.default.AUDIO),i=ie(r.default.VIDEO);return n===W(r.default.AUDIO,t)&&i===W(r.default.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,n=e.streamInfo.id,r=e.representationCount-1;return function(e,t,n){g[t]=g[t]||{},g[t][e]=n}(t,n,r),r},getThroughputHistory:function(){return F},getBitrateList:ee,getQualityForBitrate:J,getTopBitrateInfoFor:function(e){if(e&&E&&E[e]){var t=E[e].getStreamInfo();if(t&&t.id){var n=W(e,t.id),r=ee(E[e].getMediaInfo());return r[n]?r[n]:null}}return null},getMaxAllowedIndexFor:z,getMinAllowedIndexFor:X,getInitialBitrateFor:function(e){if(function(){if(!P||!P.hasOwnProperty("getSavedBitrateSettings"))throw new Error(r.default.MISSING_CONFIG_ERROR)}(),e===r.default.TEXT||e===r.default.FRAGMENTED_TEXT)return NaN;var t=P.getSavedBitrateSettings(e),n=H.get().streaming.abr.initialBitrate[e],i=H.get().streaming.abr.initialRepresentationRatio[e];if(-1===n)if(i>-1){var a=M.getAdaptationForType(0,e).Representation;if(Array.isArray(a))n=a[Math.max(Math.round(a.length*i)-1,0)].bandwidth;else n=0}else n=isNaN(t)?e===r.default.VIDEO?1e3:100:t;return n},getQualityFor:ie,getAbandonmentStateFor:function(e){return A[e]?A[e].state:null},setPlaybackQuality:Q,checkPlaybackQuality:function(t){if(t&&E&&E[t]){var n=E[t].getStreamInfo(),r=n?n.id:null,i=ie(t),s=(0,m.default)(e).create({abrController:l,streamProcessor:E[t],currentValue:i,switchHistory:k[t],droppedFramesHistory:x,useBufferOccupancyABR:te(t),useL2AABR:ne(t),useLoLPABR:re(t),videoModel:N});if(x){var o=N.getPlaybackQuality();o&&x.push(L,o)}if(H.get().streaming.abr.autoSwitchBitrate[t]){var d=X(t),c=W(t,r),h=f.getMaxQuality(s),g=h.quality;if(void 0!==d&&(g>y.default.NO_CHANGE?g:i)<d&&(g=d),g>c&&(g=c),k[t].push({oldValue:i,newValue:g}),g>y.default.NO_CHANGE&&g!=i)(A[t].state===a.default.ALLOW_LOAD||g>i)&&$(t,i,g,c,h.reason);else if(H.get().debug.logLevel===S.default.LOG_LEVEL_DEBUG){var p=j.getCurrentBufferLevel(t,!0);u.debug("["+t+"] stay on "+i+"/"+c+" (buffer: "+p+")")}}}},getTopQualityIndexFor:W,setElementSize:ae,setWindowResizeEventCalled:function(e){I=e},createAbrRulesCollection:q,registerStreamType:function(t,n){k[t]=k[t]||(0,_.default)(e).create(),E[t]=n,A[t]=A[t]||{},A[t].state=a.default.ALLOW_LOAD,U[t]=!1,B[t]=!1,G[t]=!1,i.on(c.default.LOADING_PROGRESS,se,l),t===r.default.VIDEO&&(i.on(c.default.QUALITY_CHANGE_RENDERED,Y,l),x=x||(0,T.default)(e).create(),ae()),i.on(c.default.METRIC_ADDED,V,l),i.on(c.default.PERIOD_SWITCH_COMPLETED,q,l),F=F||(0,b.default)(e).create({settings:H})},unRegisterStreamType:function(e){delete E[e]},setConfig:function(e){e&&(e.streamController&&(h=e.streamController),e.domStorage&&(P=e.domStorage),e.mediaPlayerModel&&(O=e.mediaPlayerModel),e.dashMetrics&&(j=e.dashMetrics),e.adapter&&(M=e.adapter),e.videoModel&&(N=e.videoModel),e.settings&&(H=e.settings))},reset:function(){K(),i.off(c.default.LOADING_PROGRESS,se,l),i.off(c.default.QUALITY_CHANGE_RENDERED,Y,l),i.off(c.default.METRIC_ADDED,V,l),i.off(c.default.PERIOD_SWITCH_COMPLETED,q,l),f&&f.reset()}},u=t.getLogger(l),K(),l}R.__dashjs_factory_name="AbrController";var I=h.default.getSingletonFactory(R);I.QUALITY_DEFAULT=0,h.default.updateSingletonFactory(R.__dashjs_factory_name,I),t.default=I}));t(vr);var yr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(){var e={};return{save:function(t){var n=t.streamId,r=t.representationId;e[n]=e[n]||{},e[n][r]=t},extract:function(t,n){return e&&e[t]&&e[t][n]?e[t][n]:null},reset:function(){e={}}}}i.__dashjs_factory_name="InitCache",t.default=r.default.getSingletonFactory(i)}));t(yr);var Er=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=A(i),r=A(l),a=A(E),s=A(Qn),o=A($n),d=A(vr),c=A(f),h=A(g),m=A(u),y=A(p),T=A(yr),b=A(_),S=A(Kn);function A(e){return e&&e.__esModule?e:{default:e}}var R=.5,I=.01,w="BufferController";function C(e){e=e||{};var t=this.context,i=(0,c.default)(t).getInstance(),l=e.errHandler,u=e.fragmentModel,f=e.representationController,g=e.mediaController,p=e.adapter,m=e.textController,E=e.abrController,_=e.playbackController,A=e.streamInfo,C=e.type,D=e.settings,M=void 0,N=void 0,O=void 0,P=void 0,L=void 0,k=void 0,x=void 0,F=void 0,U=void 0,B=void 0,G=void 0,j=void 0,H=void 0,q=void 0,K=void 0,Y=void 0,V=void 0,W=void 0,z=void 0,X=void 0,Q=void 0,$=void 0,Z=void 0;function J(e){return p.convertDataToRepresentationInfo(f.getRepresentationForQuality(e))}function ee(e,n){if(!W||!e)return null;var r=e[0];if(x)try{B=n&&n[C]?(0,s.default)(t).create(x,r,ae.bind(this),n[C]):(0,s.default)(t).create(x,r,ae.bind(this),null),D.get().streaming.useAppendWindow&&B.updateAppendWindow(A),"function"==typeof B.getBuffer().initialize&&B.getBuffer().initialize(C,A,e,u)}catch(e){N.fatal("Caught error on create SourceBuffer: "+e),l.error(new b.default(S.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,S.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+C))}else B=(0,o.default)(t).create(ae.bind(this));return Te(J(O)),B}function te(e){N.info("Init fragment finished loading saving to",C+"'s init cache"),W.save(e.chunk),N.debug("Append Init fragment",C," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),re(e.chunk)}function ne(e){var t=e.chunk;if($){Z=t;var n=B&&B.getAllBufferRanges();n&&n.length>0&&_.getTimeToStreamEnd()>D.get().streaming.stallThreshold&&(N.debug("Clearing buffer because track changed - "+(n.end(n.length-1)+.5)),ye([{start:0,end:n.end(n.length-1)+.5,force:!0}]))}else re(t)}function re(e){B.append(e),e.mediaInfo.type===n.default.VIDEO&&Me(h.default.VIDEO_CHUNK_RECEIVED,{chunk:e})}function ie(e){if(e&&e.length>0)for(var t=0,n=e.length;t<n;t++)N.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",_.getTime())}function ae(e){if(e.error){if(22===e.error.code&&(V=!0,k=.8*Ce(),N.warn("Quota exceeded, Critical Buffer: "+k),k>0)){var t=Math.max(.2*k,1),r=k-t,i=Math.min(D.get().streaming.bufferTimeAtTopQuality,.9*r),a=Math.min(D.get().streaming.bufferTimeAtTopQualityLongForm,.9*r),s={streaming:{bufferToKeep:parseFloat(t.toFixed(5)),bufferTimeAtTopQuality:parseFloat(i.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(a.toFixed(5))}};D.update(s)}22!==e.error.code&&De()||(N.warn("Clearing playback buffer to overcome quota exceed situation"),Me(h.default.QUOTA_EXCEEDED,{criticalBufferLevel:k,quotaExceededTime:e.chunk.start}),ye(ve()))}else{V=!1,(q=e.chunk)&&!isNaN(q.index)&&(F=Math.max(q.index,F),ge());var o=B.getAllBufferRanges();if(q.segmentType===v.HTTPRequest.MEDIA_SEGMENT_TYPE)ie(o),ue(),function(){if(C!==n.default.AUDIO&&C!==n.default.VIDEO)return;if(isNaN(z))return;var e=_.getTime(),t=fe(z,0);if(e===z&&t)return;var r=f.getCurrentRepresentation().segmentDuration;if(!(t=fe(z,r)))return;Math.abs(e-z)>r?z<=t.end&&(_.seek(Math.max(z,t.start),!1,!0),z=NaN):e<t.start&&(_.seek(t.start,!1,!0),z=NaN)}();else if($){var l=_.getTime();N.debug("AppendToBuffer seek target should be "+l),Me(h.default.SEEK_TARGET,{time:l})}var u=!1;j&&(j.indexOf(q)>0&&(u=!0),j=null),q&&!u&&Me(q.endFragment?h.default.BYTES_APPENDED_END_FRAGMENT:h.default.BYTES_APPENDED,{quality:q.quality,startTime:q.start,index:q.index,bufferedRanges:o,mediaType:C})}}function se(e){O!==e.newQuality&&(Te(this.getRepresentationInfo(e.newQuality)),O=e.newQuality)}function oe(e){B&&(z=e.seekTime,P&&(X=!0,P=!1,U=Number.POSITIVE_INFINITY),C!==n.default.FRAGMENTED_TEXT?function(){if(!B)return;B.waitForUpdateEnd((function(){var e=function(){if(!B)return;var e=[],t=B.getAllBufferRanges();if(!t||0===t.length)return e;var n=_.getTime(),r=t.end(t.length-1)+R,i=u.getRequests({state:a.default.FRAGMENT_MODEL_EXECUTED,time:n,threshold:I})[0];if(i){var s={start:0,end:i.startTime-D.get().streaming.stallThreshold},o=u.getRequests({state:a.default.FRAGMENT_MODEL_EXECUTED,time:i.startTime-i.duration/2,threshold:I})[0];o&&o.startTime!=i.startTime&&(s.end=o.startTime),s.start<s.end&&s.end>t.start(0)&&e.push(s);var l={start:i.startTime+i.duration+D.get().streaming.stallThreshold,end:r},d=u.getRequests({state:a.default.FRAGMENT_MODEL_EXECUTED,time:i.startTime+i.duration+D.get().streaming.stallThreshold,threshold:I})[0];d&&d.startTime!==i.startTime&&(l.start=d.startTime+d.duration+D.get().streaming.stallThreshold),l.start<l.end&&l.start<r&&e.push(l)}else N.debug("getAllRangesWithSafetyFactor - No request found in current time position, removing full buffer 0 -",r),e.push({start:0,end:r});return e}();e&&0!==e.length||ue(),ye(e)}))}():ue())}function le(){z=NaN}function ue(){(!$||C===n.default.FRAGMENTED_TEXT&&m.isTextEnabled())&&he()}function de(){pe()}function ce(){z=NaN,pe()}function fe(e,t){var n=B.getAllBufferRanges(),r=0,i=0,a=null,s=null,o=0,l=void 0,u=void 0,d=isNaN(t)?.15:t;if(null!=n){for(u=0,l=n.length;u<l;u++)if(r=n.start(u),i=n.end(u),null===a)o=Math.abs(r-e),(e>=r&&e<i||o<=d)&&(a=r,s=i);else{if(!((o=r-s)<=d))break;s=i}if(null!==a)return{start:a,end:s}}return null}function he(){var e,t,n;_&&(e=(isNaN(z)?_.getTime():z)||0,D.get().streaming.jumpGaps&&(t=D.get().streaming.smallGapLimit),L=null===(n=fe(e,t))?0:n.end-e,Me(h.default.BUFFER_LEVEL_UPDATED,{bufferLevel:L}),pe())}function ge(){F>=U-1&&!P&&void 0===B.discharge&&(P=!0,N.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for "+C),Me(h.default.BUFFERING_COMPLETED))}function pe(){C!==n.default.AUDIO&&C!==n.default.VIDEO||(X&&!P&&L>0&&_&&_.getTimeToStreamEnd()-L<.1&&(X=!1,P=!0,N.debug("checkIfSufficientBuffer trigger BUFFERING_COMPLETED for type "+C),Me(h.default.BUFFERING_COMPLETED)),(!D.get().streaming.lowLatencyEnabled&&L<D.get().streaming.stallThreshold||0===L)&&!P?me(r.default.BUFFER_EMPTY):(P||L>=A.manifestInfo.minBufferTime)&&me(r.default.BUFFER_LOADED))}function me(e){H===e||e===r.default.BUFFER_EMPTY&&0===_.getTime()||C===n.default.FRAGMENTED_TEXT&&!m.isTextEnabled()||(H=e,Me(h.default.BUFFER_LEVEL_STATE_CHANGED,{state:e}),Me(e===r.default.BUFFER_LOADED?h.default.BUFFER_LOADED:h.default.BUFFER_EMPTY),N.debug(e===r.default.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function ve(){var e=[],t=B.getAllBufferRanges();if(!t||0===t.length)return e;var n=_.getTime(),r=Math.max(0,n-D.get().streaming.bufferToKeep),i=u.getRequests({state:a.default.FRAGMENT_MODEL_EXECUTED,time:n,threshold:I})[0];if(i)r=Math.min(i.startTime,r);else if(0===n&&_.getIsDynamic())return[];if(t.start(0)<=r){for(var s={start:0,end:r},o=0;o<t.length&&t.end(o)<=r;o++)s.end=t.end(o);s.start<s.end&&e.push(s)}return e}function ye(e){e&&B&&0!==e.length&&(Q.push.apply(Q,e),Y||Ee())}function Ee(){if(0===Q.length||!B)return N.debug("Nothing to prune, halt pruning"),Q=[],void(Y=!1);var e=B.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return N.debug("SourceBuffer is empty (or does not exist), halt pruning"),Q=[],void(Y=!1);var t=Q.shift();N.debug("Removing buffer from:",t.start,"to",t.end),Y=!0,_.getTime()<t.end&&(P=!1,F=0),B.remove(t.start,t.end,t.force)}function _e(e){B===e.buffer&&(N.debug("onRemoved buffer from:",e.from,"to",e.to),ie(B.getAllBufferRanges()),0===Q.length&&(Y=!1),e.unintended&&(N.warn("Detected unintended removal from:",e.from,"to",e.to,"setting index handler time to",e.from),Me(h.default.SEEK_TARGET,{time:e.from,mediaType:C,streamId:A.id})),Y?Ee():($?($=!1,Z&&re(Z)):he(),Me(h.default.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:De(),quotaExceeded:V})))}function Te(e){e&&void 0!==e.MSETimeOffset&&B&&B.updateTimestampOffset&&B.updateTimestampOffset(e.MSETimeOffset)}function be(e){e.error||P||Te(e.currentRepresentation)}function Se(e){U=e.request.index,ge()}function Ae(e){if(e.newMediaInfo.streamInfo.id===A.id&&e.newMediaInfo.type===C){var t=B&&B.getAllBufferRanges();t&&(N.info("Track change asked"),g.getSwitchMode(C)===n.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&t&&t.length>0&&_.getTimeToStreamEnd()>D.get().streaming.stallThreshold&&(P=!1,U=Number.POSITIVE_INFINITY))}}function Re(){++K*(D.get().streaming.wallclockTimeUpdateInterval/1e3)>=D.get().streaming.bufferPruningInterval&&(K=0,B&&C!==n.default.FRAGMENTED_TEXT&&(P||ye(ve())))}function Ie(){pe()}function we(e,t){x=e,B&&t&&"function"==typeof B.discharge&&(G=B,ee(t))}function Ce(){var e,t=B.getAllBufferRanges(),n=0,r=void 0;if(!t)return n;for(r=0,e=t.length;r<e;r++)n+=t.end(r)-t.start(r);return n}function De(){return Ce()<k}function Me(e,t){var n=t||{};i.trigger(e,n,{streamId:A.id,mediaType:C})}function Ne(e,t){k=Number.POSITIVE_INFINITY,H=void 0,O=d.default.QUALITY_DEFAULT,U=Number.POSITIVE_INFINITY,F=0,q=null,P=!1,Y=!1,V=!1,X=!1,L=0,K=0,Q=[],z=NaN,B&&(e||B.abort(),B.reset(t),B=null),$=!1}return M={initialize:function(e){we(e),O=E.getQualityFor(C),i.on(h.default.DATA_UPDATE_COMPLETED,be,this),i.on(h.default.INIT_FRAGMENT_LOADED,te,this),i.on(h.default.MEDIA_FRAGMENT_LOADED,ne,this),i.on(h.default.QUALITY_CHANGE_REQUESTED,se,this),i.on(h.default.STREAM_COMPLETED,Se,this),i.on(h.default.PLAYBACK_PLAYING,ce,this),i.on(h.default.PLAYBACK_PROGRESS,ue,this),i.on(h.default.PLAYBACK_TIME_UPDATED,ue,this),i.on(h.default.PLAYBACK_RATE_CHANGED,Ie,this),i.on(h.default.PLAYBACK_SEEKING,oe,this),i.on(h.default.PLAYBACK_SEEKED,le,this),i.on(h.default.PLAYBACK_STALLED,de,this),i.on(h.default.WALLCLOCK_TIME_UPDATED,Re,this),i.on(h.default.CURRENT_TRACK_CHANGED,Ae,this,{priority:c.default.EVENT_PRIORITY_HIGH}),i.on(h.default.SOURCEBUFFER_REMOVE_COMPLETED,_e,this)},getStreamId:function(){return A.id},getType:function(){return C},getBufferControllerType:function(){return w},getRepresentationInfo:J,createBuffer:ee,dischargePreBuffer:function(){if(B&&G&&"function"==typeof G.discharge){var e=G.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+C+"PreBuffer discharge, adding buffer for:",n=0;n<e.length;n++)t+=" start: "+e.start(n)+", end: "+e.end(n)+";";N.debug(t)}else N.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");j=[];for(var r=G.discharge(),i=null,a=0;a<r.length;a++){var s=r[a];if("InitializationSegment"!==s.segmentType){var o=W.extract(s.streamId,s.representationId);o&&i!==o&&(j.push(o),B.append(o),i=o)}j.push(s),B.append(s)}G.reset(),G=null}},getBuffer:function(){return B},setBuffer:function(e){B=e},getBufferLevel:function(){return L},getRangeAt:fe,setMediaSource:we,getMediaSource:function(){return x},appendInitSegment:function(e){var t=W.extract(A.id,e);return!!t&&(N.info("Append Init fragment",C," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),re(t),!0)},replaceBuffer:function(){$=!0},getIsBufferingCompleted:function(){return P},getIsPruningInProgress:function(){return Y},reset:function(e,t){i.off(h.default.DATA_UPDATE_COMPLETED,be,this),i.off(h.default.INIT_FRAGMENT_LOADED,te,this),i.off(h.default.MEDIA_FRAGMENT_LOADED,ne,this),i.off(h.default.QUALITY_CHANGE_REQUESTED,se,this),i.off(h.default.STREAM_COMPLETED,Se,this),i.off(h.default.PLAYBACK_PLAYING,ce,this),i.off(h.default.PLAYBACK_PROGRESS,ue,this),i.off(h.default.PLAYBACK_TIME_UPDATED,ue,this),i.off(h.default.PLAYBACK_RATE_CHANGED,Ie,this),i.off(h.default.PLAYBACK_SEEKING,oe,this),i.off(h.default.PLAYBACK_SEEKED,le,this),i.off(h.default.PLAYBACK_STALLED,de,this),i.off(h.default.WALLCLOCK_TIME_UPDATED,Re,this),i.off(h.default.CURRENT_TRACK_CHANGED,Ae,this),i.off(h.default.SOURCEBUFFER_REMOVE_COMPLETED,_e,this),Ne(e,t)},updateAppendWindow:function(){B&&!P&&B.updateAppendWindow(A)}},N=(0,y.default)(t).getInstance().getLogger(M),W=(0,T.default)(t).getInstance(),Ne(),M}C.__dashjs_factory_name=w,t.default=m.default.getClassFactory(C)}));t(Er);var _r=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=p(i),r=p(f),a=p(g),s=p(u),o=p(yr),l=p(Qn),d=p(Xn),c=p(_),h=p(Kn);function p(e){return e&&e.__esModule?e:{default:e}}var m="NotFragmentedTextBufferController";function v(e){e=e||{};var t=this.context,i=(0,r.default)(t).getInstance(),s=(0,d.default)(t).getInstance(),u=e.errHandler,f=e.streamInfo,g=e.type,p=e.mimeType,v=e.fragmentModel,y=void 0,E=void 0,_=void 0,T=void 0,b=void 0,S=void 0;function A(e){T=e}function R(e){null===S.extract(f.id,e.currentRepresentation.id)&&(E=!1,i.trigger(a.default.INIT_FRAGMENT_NEEDED,{representationId:e.currentRepresentation.id,sender:y},{streamId:f.id,mediaType:g}))}function I(e){e.chunk.bytes&&(S.save(e.chunk),b.append(e.chunk),E=!0,i.trigger(a.default.STREAM_COMPLETED,{request:e.request},{streamId:f.id,mediaType:g}))}return y={getBufferControllerType:function(){return m},initialize:function(e){A(e),S=(0,o.default)(t).getInstance()},createBuffer:function(e){var r=e[0];try{if(b=(0,l.default)(t).create(T,r),!_){var i=b.getBuffer();i.hasOwnProperty(n.default.INITIALIZE)&&i.initialize(p,f,e,v),_=!0}return b}catch(e){if(r&&(r.isText||-1!==r.codec.indexOf('codecs="stpp')||-1!==r.codec.indexOf('codecs="wvtt')))try{b=s.getTextSourceBuffer()}catch(e){u.error(new c.default(h.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,h.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+g+" : "+e.message))}else u.error(new c.default(h.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,h.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+g))}},getStreamId:function(){return f.id},getType:function(){return g},getBuffer:function(){return b},getBufferLevel:function(){return 0},setMediaSource:A,getMediaSource:function(){return T},getIsBufferingCompleted:function(){return E},getIsPruningInProgress:function(){return!1},dischargePreBuffer:function(){},appendInitSegment:function(e){return null!==S.extract(f.id,e)},getRangeAt:function(){return null},reset:function(e){i.off(a.default.DATA_UPDATE_COMPLETED,R,y),i.off(a.default.INIT_FRAGMENT_LOADED,I,y),!e&&b&&(b.abort(),b.reset(),b=null)},updateTimestampOffset:function(e){b.timestampOffset===e||isNaN(e)||(b.timestampOffset=e)}},_=!1,T=null,E=!1,i.on(a.default.DATA_UPDATE_COMPLETED,R,y),i.on(a.default.INIT_FRAGMENT_LOADED,I,y),y}v.__dashjs_factory_name=m,t.default=s.default.getClassFactory(v)}));t(_r);var Tr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(i),r=o(u),a=o(Er),s=o(_r);function o(e){return e&&e.__esModule?e:{default:e}}function l(e){e=e||{};var t,r=this.context,i=void 0;function o(){return i.getBuffer()}return t={getBufferControllerType:function(){return i.getBufferControllerType()},initialize:function(e,t){return i.initialize(e,t)},createBuffer:function(e,t){return i.createBuffer(e,t)},getType:function(){return i.getType()},getBuffer:o,setBuffer:function(e){i.setBuffer(e)},getBufferLevel:function(){return i.getBufferLevel()},setMediaSource:function(e){i.setMediaSource(e)},getMediaSource:function(){return i.getMediaSource()},getIsBufferingCompleted:function(){return i.getIsBufferingCompleted()},getIsPruningInProgress:function(){return i.getIsPruningInProgress()},dischargePreBuffer:function(){return i.dischargePreBuffer()},appendInitSegment:function(e){i.appendInitSegment(e)},getRangeAt:function(e){return i.getRangeAt(e)},reset:function(e){i.reset(e)},updateTimestampOffset:function(e){var t=o();t.timestampOffset===e||isNaN(e)||(t.timestampOffset=e)},updateAppendWindow:function(){i.updateAppendWindow()},getRepresentationInfo:function(e){return i.getRepresentationInfo(e)}},i=e.type===n.default.FRAGMENTED_TEXT?(0,a.default)(r).create({streamInfo:e.streamInfo,type:e.type,mediaPlayerModel:e.mediaPlayerModel,manifestModel:e.manifestModel,fragmentModel:e.fragmentModel,errHandler:e.errHandler,mediaController:e.mediaController,representationController:e.representationController,adapter:e.adapter,textController:e.textController,abrController:e.abrController,playbackController:e.playbackController,settings:e.settings}):(0,s.default)(r).create({streamInfo:e.streamInfo,type:e.type,mimeType:e.mimeType,fragmentModel:e.fragmentModel,errHandler:e.errHandler}),t}l.__dashjs_factory_name="TextBufferController",t.default=r.default.getClassFactory(l)}));t(Tr);var br=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(i),r=s(u),a=s(l);function s(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=(e=e||{}).dashMetrics,r=e.mediaPlayerModel,i=e.textController,s=e.abrController,o=e.settings;function l(e,l,u){var d=NaN;if(!e||!l)return d;if(e===n.default.FRAGMENTED_TEXT)if(i.isTextEnabled())if(isNaN(l.fragmentDuration)){var c=t.getCurrentSchedulingInfo(a.default.SCHEDULING_INFO);d=c?c.duration:0}else d=l.fragmentDuration;else d=0;else if(e===n.default.AUDIO&&u){var f=t.getCurrentBufferLevel(n.default.VIDEO);d=isNaN(l.fragmentDuration)?f:Math.max(f,l.fragmentDuration)}else{var h=l.mediaInfo.streamInfo;if(s.isPlayingAtTopQuality(h))d=h.manifestInfo.duration>=o.get().streaming.longFormContentDurationThreshold?o.get().streaming.bufferTimeAtTopQualityLongForm:o.get().streaming.bufferTimeAtTopQuality;else d=r.getStableBufferTime()}return d}return{execute:function(e,n,r){return!e||!n||t.getCurrentBufferLevel(e)<l(e,n,r)},getBufferTarget:l}}o.__dashjs_factory_name="BufferLevelRule",t.default=r.default.getClassFactory(o)}));t(br);var Sr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=m(i),r=m(l),a=m(br),s=m(E),o=m(f),d=m(g),c=m(u),h=m(p);function m(e){return e&&e.__esModule?e:{default:e}}function v(e){e=e||{};var t=this.context,i=(0,o.default)(t).getInstance(),l=e.adapter,u=e.dashMetrics,c=e.mediaPlayerModel,f=e.fragmentModel,g=e.abrController,p=e.playbackController,m=e.textController,v=e.type,y=e.mimeType,E=e.mediaController,_=e.bufferController,T=e.settings,b=void 0,S=void 0,A=void 0,R=void 0,I=void 0,w=void 0,C=void 0,D=void 0,M=void 0,N=void 0,O=void 0,P=void 0,L=void 0,k=void 0,x=void 0,F=void 0,U=void 0,B=void 0,G=void 0,j=void 0;function H(){return!1===I}function q(){S&&(H()||R&&!_.getIsBufferingCompleted()&&(A.debug("Schedule Controller starts"),I=!1,u.createPlaylistTraceMetrics(R.id,1e3*p.getTime(),p.getPlaybackRate()),V(0)))}function K(){I||(A.debug("Schedule Controller stops"),A.debug(v+" Schedule Controller stops"),I=!0,clearTimeout(D))}function Y(){if(S)if(I||w||p.isPaused()&&!T.get().streaming.scheduleWhilePaused||(v===n.default.FRAGMENTED_TEXT||v===n.default.TEXT)&&!m.isTextEnabled()||_.getIsBufferingCompleted())K();else{!function(){if(!isNaN(M))return;if(!k)return;var e=p.getTime(),t=1.5;if(isNaN(k.fragmentDuration)){var i=u.getCurrentSchedulingInfo(R.mediaInfo.type);t=i?1.5*i.duration:1.5}var a=f.getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,time:e+t,threshold:0})[0];if(a&&-1===x.indexOf(a)&&!l.getIsTextTrack(y)){var o=T.get().streaming.fastSwitchEnabled,d=_.getBufferLevel(),c=g.getAbandonmentStateFor(v),h=!E.isCurrentTrack(a.mediaInfo)&&E.getSwitchMode(a.mediaInfo.type)===n.default.TRACK_SWITCH_MODE_NEVER_REPLACE,m=a.quality<k.quality;o&&(h||m)&&d>=t&&c!==r.default.ABANDON_LOAD?(z(a),j=!0,A.debug("Reloading outdated fragment at index: ",a.index)):a.quality>k.quality&&!U&&ue(p.getTime()+d)}}();var e=x.length>0,t=k?k.quality:NaN;if(U||isNaN(t)||F||e||function(e,t){L[t]=L[t]||{};var n=g.getTopQualityIndexFor(e,t);return L[t][e]!=n&&(A.info("Top quality "+e+" index has changed from "+L[t][e]+" to "+n),L[t][e]=n,!0)}(v,S.id)||O.execute(v,R,N)){W(!0),!e&&G&&g.checkPlaybackQuality(v),function(){if(R.quality===t&&!F||U){var e=x.shift();e&&e.isInitializationRequest()?(i.trigger(d.default.INIT_FRAGMENT_NEEDED,{representationId:e.representationId,sender:b},{streamId:S.id,mediaType:v}),G=!1):(i.trigger(d.default.MEDIA_FRAGMENT_NEEDED,{seekTarget:M,replacement:e},{streamId:S.id,mediaType:v}),G=!0)}else F?(A.debug("Switch track for "+v+", representation id = "+R.id),(U=E.getSwitchMode(v)===n.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE)&&_.replaceBuffer&&_.replaceBuffer(),F=!1):A.debug("Quality has changed, get init request for representationid = "+R.id),i.trigger(d.default.INIT_FRAGMENT_NEEDED,{representationId:R.id,sender:b},{streamId:S.id,mediaType:v}),G=!1}()}else V(500)}}function V(e){clearTimeout(D),D=setTimeout(Y,e)}function W(e){w!==e?w=e:A.debug("isFragmentProcessingInProgress is already equal to",e)}function z(e){x.push(e)}function X(e){if(p&&f){var t=f.getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,time:p.getTime(),threshold:0})[0];t&&p.getTime()>=t.startTime&&((!P.mediaInfo||t.mediaInfo.type===P.mediaInfo.type&&t.mediaInfo.id!==P.mediaInfo.id)&&e&&i.trigger(d.default.TRACK_CHANGE_RENDERED,{mediaType:v,oldMediaInfo:P.mediaInfo,newMediaInfo:t.mediaInfo}),t.quality===P.quality&&t.adaptationIndex===P.adaptationIndex||!e||i.trigger(d.default.QUALITY_CHANGE_RENDERED,{mediaType:v,oldQuality:P.quality,newQuality:t.quality}),P={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function Q(){K(),W(!1),A.info("Stream "+S.id+" is complete")}function $(e){e.request.mediaInfo.streamInfo.id===S.id&&e.request.mediaType===v&&(A.info("OnFragmentLoadingCompleted - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),l.getIsTextTrack(y)&&W(!1),e.error&&e.request.serviceLocation&&!I&&(z(e.request),W(!1),V(0)),U&&(B=e.request))}function Z(){X(!0)}function J(e){if(U&&!isNaN(e.startTime)&&(U=!1,f.addExecutedRequest(B)),W(!1),isNaN(e.index)&&(k=_.getRepresentationInfo(e.quality),A.info("["+v+"] lastInitializedRepresentationInfo changed to "+e.quality)),j&&!isNaN(e.startTime)){var t=p.getTime(),n=e.startTime+R.fragmentDuration,r=1.5*R.fragmentDuration;V(t+r>=n?0:1e3*(n-(t+r))),j=!1}else V(0)}function ee(e){A.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),p.isSeeking()||F||(A.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),z(e.request)),W(!1),V(0)}function te(){}function ne(){K()}function re(e){U&&T.get().streaming.flushBufferAtTrackSwitch&&p.seek(p.getTime()+.001,!1,!0),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&q()}function ie(){K(),W(!1)}function ae(){f.abortRequests(),K()}function se(){!I&&T.get().streaming.scheduleWhilePaused||q()}function oe(e){if(S){ue(e.seekTime),de(0),I&&q();var t=R&&R.DVRWindow&&p?R.DVRWindow.end-p.getTime():NaN;u.updateManifestUpdateInfo({latency:t}),w?f.abortRequests():V(0)}}function le(e){u.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function ue(e){M=e}function de(e){C=e}function ce(){G=!0,w=!1,C=0,M=NaN,k=void 0,P={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},L={},x=[],I=!0,F=!1,U=!1,B=null,j=!1}return b={initialize:function(e){N=e,O=(0,a.default)(t).create({abrController:g,dashMetrics:u,mediaPlayerModel:c,textController:m,settings:T}),i.on(d.default.DATA_UPDATE_STARTED,te,this),i.on(d.default.FRAGMENT_LOADING_COMPLETED,$,this),i.on(d.default.STREAM_COMPLETED,Q,this),i.on(d.default.BUFFER_CLEARED,re,this),i.on(d.default.BYTES_APPENDED_END_FRAGMENT,J,this),i.on(d.default.QUOTA_EXCEEDED,ie,this),i.on(d.default.PLAYBACK_SEEKING,oe,this),i.on(d.default.PLAYBACK_STARTED,se,this),i.on(d.default.PLAYBACK_RATE_CHANGED,le,this),i.on(d.default.PLAYBACK_TIME_UPDATED,Z,this),i.on(d.default.URL_RESOLUTION_FAILED,ae,this),i.on(d.default.FRAGMENT_LOADING_ABANDONED,ee,this),i.on(d.default.BUFFERING_COMPLETED,ne,this)},getType:function(){return v},getStreamId:function(){return S.id},setCurrentRepresentation:function(e){R=e},setSeekTarget:ue,setTimeToLoadDelay:de,getTimeToLoadDelay:function(){return C},switchTrackAsked:function(){F=!0},isStarted:H,start:q,stop:K,reset:function(){i.off(d.default.DATA_UPDATE_STARTED,te,this),i.off(d.default.FRAGMENT_LOADING_COMPLETED,$,this),i.off(d.default.STREAM_COMPLETED,Q,this),i.off(d.default.BUFFER_CLEARED,re,this),i.off(d.default.BYTES_APPENDED_END_FRAGMENT,J,this),i.off(d.default.QUOTA_EXCEEDED,ie,this),i.off(d.default.PLAYBACK_SEEKING,oe,this),i.off(d.default.PLAYBACK_STARTED,se,this),i.off(d.default.PLAYBACK_RATE_CHANGED,le,this),i.off(d.default.PLAYBACK_TIME_UPDATED,Z,this),i.off(d.default.URL_RESOLUTION_FAILED,ae,this),i.off(d.default.FRAGMENT_LOADING_ABANDONED,ee,this),i.off(d.default.BUFFERING_COMPLETED,ne,this),K(),X(!1),ce(),S=null},getBufferTarget:function(){return O.getBufferTarget(v,R,N)},processInitRequest:function(e){e&&(W(!0),f.executeRequest(e))},processMediaRequest:function(e){e?(A.debug("Next fragment request url is "+e.url),f.executeRequest(e)):(p.getIsDynamic()&&A.debug("Next fragment seems to be at the bleeding live edge and is not available yet. Rescheduling."),W(!1),V(T.get().streaming.lowLatencyEnabled?100:500))},getPlaybackController:function(){return p}},A=(0,h.default)(t).getInstance().getLogger(b),ce(),S=e.streamInfo,b}v.__dashjs_factory_name="ScheduleController",t.default=c.default.getClassFactory(v)}));t(Sr);var Ar=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(i),r=s(_),a=s(u);function s(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=(e=e||{}).eventBus,i=e.events,a=e.errors,s=e.abrController,o=e.dashMetrics,l=e.playbackController,u=e.timelineConverter,d=e.type,c=e.streamInfo,f=e.dashConstants,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0;function y(){return d}function E(){if(!(s&&o&&l&&u))throw new Error(n.default.MISSING_CONFIG_ERROR)}function _(){return p}function T(){return v}function b(){g=null,p=!0,m=[]}function S(){E();var e=new Date,t=T(),n=1e3*l.getTime();t&&o.addRepresentationSwitch(t.adaptation.type,e,n,t.id)}function A(e){return null==e||e>=m.length?null:m[e]}function R(e,t){var n;(e.segmentAvailabilityRange=u.calcSegmentAvailabilityRange(e,t),e.segmentAvailabilityRange.end<e.segmentAvailabilityRange.start)?C(new r.default(a.SEGMENTS_UNAVAILABLE_ERROR_CODE,a.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE,{availabilityDelay:e.segmentAvailabilityRange.start-e.segmentAvailabilityRange.end})):t&&(n=e.segmentAvailabilityRange.end,u.setExpectedLiveEdge(n),o.updateManifestUpdateInfo({presentationStartTime:n}))}function I(e,n){E();for(var r=0,a=m.length;r<a;r++)R(m[r],e),n&&t.trigger(i.REPRESENTATION_UPDATE_STARTED,{representation:m[r]},{streamId:c.id,mediaType:d})}function w(){p=!0,t.trigger(i.DATA_UPDATE_STARTED,{},{streamId:c.id,mediaType:d})}function C(e){p=!1,t.trigger(i.DATA_UPDATE_COMPLETED,{data:g,currentRepresentation:v,error:e},{streamId:c.id,mediaType:d})}function D(e){var n=e;t.trigger(i.AST_IN_FUTURE,{delay:n}),setTimeout((function(){_()||(w(),m.forEach((function(e){e.segmentAvailabilityRange=null})),I(l.getIsDynamic(),!0))}),n)}function M(e){if(_())if(e.error)C(e.error);else{var t,n=e.representation,i=o.getCurrentManifestUpdate(),u=!1,d=0,h=void 0;if(n.adaptation.period.mpd.manifest.type===f.DYNAMIC&&!n.adaptation.period.mpd.manifest.ignorePostponeTimePeriod&&l.getStreamController().getStreams().length<=1&&(d=function(e){try{var t=l.getStreamController().getActiveStreamInfo(),n=e.segmentAvailabilityRange.start;t&&t.id&&t.id!==c.id&&(n=Math.min(l.getTime(),n));var r=e.segmentAvailabilityRange.end-n;return 1e3*(l.getLiveDelay()-r)}catch(e){return 0}}(n)),d>0)return D(d),void C(new r.default(a.SEGMENTS_UPDATE_FAILED_ERROR_CODE,a.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE));if(i){for(var g=0;g<i.representationInfo.length;g++)if((h=i.representationInfo[g]).index===n.index&&h.mediaType===y()){u=!0;break}u||o.addManifestUpdateRepresentationInfo(n,y())}(function(){for(var e=0,t=m.length;e<t;e++){var n=m[e].segmentInfoType;if(null===m[e].segmentAvailabilityRange||!m[e].hasInitialization()||(n===f.SEGMENT_BASE||n===f.BASE_URL)&&!m[e].segments)return!1}return!0})()&&(s.setPlaybackQuality(y(),c,(t=v,m.indexOf(t))),o.updateManifestUpdateInfo({latency:v.segmentAvailabilityRange.end-l.getTime()}),o.getCurrentRepresentationSwitch(T().adaptation.type)||S(),C())}}function N(e){e.isDynamic&&I(e.isDynamic)}function O(e){v=A(e.newQuality),S()}function P(e){if(e.newDuration){var t=T();if(t&&t.adaptation.period)t.adaptation.period.duration=e.newDuration}}return h={getStreamId:function(){return c.id},getType:y,getData:function(){return g},isUpdating:_,updateData:function(e,t,r,i){E(),w(),m=t,v=A(i),g=e,r===n.default.VIDEO||r===n.default.AUDIO||r===n.default.FRAGMENTED_TEXT?I(l.getIsDynamic(),!0):C()},updateRepresentation:R,getCurrentRepresentation:T,getRepresentationForQuality:A,reset:function(){t.off(i.QUALITY_CHANGE_REQUESTED,O,h),t.off(i.REPRESENTATION_UPDATE_COMPLETED,M,h),t.off(i.WALLCLOCK_TIME_UPDATED,N,h),t.off(i.MANIFEST_VALIDITY_CHANGED,P,h),b()}},b(),t.on(i.QUALITY_CHANGE_REQUESTED,O,h),t.on(i.REPRESENTATION_UPDATE_COMPLETED,M,h),t.on(i.WALLCLOCK_TIME_UPDATED,N,h),t.on(i.MANIFEST_VALIDITY_CHANGED,P,h),h}o.__dashjs_factory_name="RepresentationController",t.default=a.default.getClassFactory(o)}));t(Ar);var Rr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=(e=e||{}).timelineConverter;return{getLiveEdge:function(e){return function(){if(!t||!t.hasOwnProperty("getExpectedLiveEdge"))throw new Error(r.default.MISSING_CONFIG_ERROR)}(),e.DVRWindow?e.DVRWindow.end:0},reset:function(){t=null}}}s.__dashjs_factory_name="LiveEdgeFinder",t.default=n.default.getClassFactory(s)}));t(Rr);var Ir=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null}}));t(Ir);var wr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unescapeDollarsInTemplate=function(e){return e?e.split("$$").join("$"):e},t.replaceIDForTemplate=function(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var n=t.toString();return e.split("$RepresentationID$").join(n)},t.replaceTokenForTemplate=a,t.getIndexBasedSegment=function(e,t,n,r){var i,a,l=void 0;l=n.segmentDuration,isNaN(l)&&(l=n.adaptation.period.duration);i=parseFloat((n.adaptation.period.start+r*l).toFixed(5)),a=parseFloat((i+l).toFixed(5));var u=s(n,l,i,e.calcMediaTimeFromPresentationTime(i,n),e.calcAvailabilityStartTimeFromPresentationTime(i,n.adaptation.period.mpd,t),e,a,t,r);if(!o(e,n,u,t))return null;return u},t.getTimeBasedSegment=function(e,t,n,r,i,l,u,d,c,f){var h,g,p=r/l,m=Math.min(i/l,n.adaptation.period.mpd.maxSegmentDuration),v=void 0;if(h=e.calcPresentationTimeFromMediaTime(p,n),g=h+m,v=s(n,m,h,p,n.adaptation.period.mpd.manifest.loadedTime,e,g,t,c),!o(e,n,v,t))return null;return v.replacementTime=f||r,u=a(u,"Number",v.replacementNumber),u=a(u,"Time",v.replacementTime),v.media=u,v.mediaRange=d,v};var n,r=(n=Ir)&&n.__esModule?n:{default:n};function i(e,t){for(;e.length<t;)e="0"+e;return e}function a(e,t,n){var r=void 0,a=void 0,s=void 0,o=void 0,l=void 0,u=void 0,d=t.length,c="%0".length;if(!e)return e;for(;;){if((r=e.indexOf("$"+t))<0)return e;if((a=e.indexOf("$",r+d))<0)return e;if((s=e.indexOf("%0",r+d))>r&&s<a)switch(o=e.charAt(a-1),l=parseInt(e.substring(s+c,a-1),10),o){case"d":case"i":case"u":u=i(n.toString(),l);break;case"x":u=i(n.toString(16),l);break;case"X":u=i(n.toString(16),l).toUpperCase();break;case"o":u=i(n.toString(8),l);break;default:return e}else u=n;e=e.substring(0,r)+u+e.substring(a+1)}}function s(e,t,n,i,a,s,o,l,u){var d,c=new r.default;return c.representation=e,c.duration=t,c.presentationStartTime=n,c.mediaStartTime=i,c.availabilityStartTime=a,c.availabilityEndTime=s.calcAvailabilityEndTimeFromPresentationTime(o,e.adaptation.period.mpd,l),c.wallStartTime=s.calcWallTimeForSegment(c,l),c.replacementNumber=(d=u,c.representation.startNumber+d),c.availabilityIdx=u,c}function o(e,t,n,r){var i=e.getPeriodEnd(t,r),a=e.calcPeriodRelativeTimeFromMpdRelativeTime(t,i);if(e.calcPeriodRelativeTimeFromMpdRelativeTime(t,n.presentationStartTime)>=a){if(!r)return!1;if(t.segmentAvailabilityRange&&n.presentationStartTime>=t.segmentAvailabilityRange.end)return!1}return!0}}));t(wr),wr.unescapeDollarsInTemplate,wr.replaceIDForTemplate,wr.replaceTokenForTemplate,wr.getIndexBasedSegment,wr.getTimeBasedSegment;var Cr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n,i=(e=e||{}).timelineConverter;function a(){if(!i||!i.hasOwnProperty("calcMediaTimeFromPresentationTime")||!i.hasOwnProperty("calcSegmentAvailabilityRange"))throw new Error(r.default.MISSING_CONFIG_ERROR)}function s(e,n){var r,a,s,o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,l=o.SegmentTimeline,u=o.SegmentURL_asArray,d=0,c=0,f=-1,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0;s=e.timescale;var E=!1;for(g=0,a=(r=l.S_asArray).length;g<a&&!E;g++){if(m=0,(h=r[g]).hasOwnProperty("r")&&(m=h.r),h.hasOwnProperty("t")&&(c=(d=h.t)/s),m<0){if((y=r[g+1])&&y.hasOwnProperty("t"))v=y.t/s;else{var _=e.segmentAvailabilityRange?e.segmentAvailabilityRange.end:i.calcSegmentAvailabilityRange(e,t).end;v=i.calcMediaTimeFromPresentationTime(_,e),e.segmentDuration=h.d/s}m=Math.ceil((v-c)/(h.d/s))-1}for(p=0;p<=m&&!E;p++)(E=n(d,c,o,u,h,s,++f,g))&&(e.segmentDuration=h.d/s,(p<m-1||g<a-1)&&f++),c=(d+=h.d)/s}e.availableSegmentsNumber=f}return n={getSegmentByIndex:function(e,n,r){if(a(),!e)return null;var o=null,l=!1;return s(e,(function(n,a,s,u,d,c,f,h){if(l||r<0){var g=s.media,p=d.mediaRange;return u&&(g=u[h].media||"",p=u[h].mediaRange),o=(0,wr.getTimeBasedSegment)(i,t,e,n,d.d,c,g,p,f,d.tManifest),!0}return a>=r-.5*d.d/c&&(l=!0),!1})),o},getSegmentByTime:function(e,n){if(a(),!e)return null;void 0===n&&(n=null);var r=null,o=i.calcMediaTimeFromPresentationTime(n,e);return s(e,(function(n,a,s,l,u,d,c,f){if(o<a+u.d/d){var h=s.media,g=u.mediaRange;return l&&(h=l[f].media||"",g=l[f].mediaRange),r=(0,wr.getTimeBasedSegment)(i,t,e,n,u.d,d,h,g,c,u.tManifest),!0}return!1})),r}},n}s.__dashjs_factory_name="TimelineSegmentsGetter";var o=n.default.getClassFactory(s);t.default=o}));t(Cr);var Dr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=(e=e||{}).timelineConverter;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.default.MISSING_CONFIG_ERROR)}function a(e,r){if(i(),!e)return null;var a=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;r=Math.max(r,0);var s=(0,wr.getIndexBasedSegment)(n,t,e,r);if(s){s.replacementTime=Math.round((r-1)*e.segmentDuration*e.timescale,10);var o=a.media;o=(0,wr.replaceTokenForTemplate)(o,"Number",s.replacementNumber),o=(0,wr.replaceTokenForTemplate)(o,"Time",s.replacementTime),s.media=o}var l=e.segmentDuration,u=e.segmentAvailabilityRange;return isNaN(l)?e.availableSegmentsNumber=1:e.availableSegmentsNumber=Math.ceil((u.end-u.start)/l),s}return{getSegmentByIndex:a,getSegmentByTime:function(e,t){if(i(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var s=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return a(e,Math.floor(s/r))}}}s.__dashjs_factory_name="TemplateSegmentsGetter";var o=n.default.getClassFactory(s);t.default=o}));t(Dr);var Mr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=(e=e||{}).timelineConverter;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.default.MISSING_CONFIG_ERROR)}function a(e,r){if(i(),!e)return null;var a=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,s=a.SegmentURL_asArray.length,o=e&&!isNaN(e.startNumber)?e.startNumber:1,l=Math.max(o-1,0),u=Math.max(r-l,0),d=null;if(u<s){var c=a.SegmentURL_asArray[u];(d=(0,wr.getIndexBasedSegment)(n,t,e,r))&&(d.replacementTime=(o+r-1)*e.segmentDuration,d.media=c.media?c.media:"",d.mediaRange=c.mediaRange,d.index=r,d.indexRange=c.indexRange)}return e.availableSegmentsNumber=s,d}return{getSegmentByIndex:a,getSegmentByTime:function(e,t){if(i(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var s=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return a(e,Math.floor(s/r))}}}s.__dashjs_factory_name="ListSegmentsGetter";var o=n.default.getClassFactory(s);t.default=o}));t(Mr);var Nr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=(e=e||{}).timelineConverter;function n(){if(!t||!t.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.default.MISSING_CONFIG_ERROR)}function i(e,t){if(n(),!e)return null;var r=e.segments?e.segments.length:-1,i=void 0;if(t<r&&(i=e.segments[t])&&i.availabilityIdx===t)return i;for(var a=0;a<r;a++)if((i=e.segments[a])&&i.availabilityIdx===t)return i;return null}return{getSegmentByIndex:i,getSegmentByTime:function(e,t){n();var r=function(e,t){if(!e)return-1;var n=e.segments,r=n?n.length:null,i=-1,a=void 0,s=void 0,o=void 0,l=void 0,u=void 0;if(n&&r>0)for(u=0;u<r;u++)if(o=(s=n[u]).presentationStartTime,t+(a=(l=s.duration)/2)>=o&&t-a<o+l){i=s.availabilityIdx;break}return i}(e,t);return i(e,r)}}}s.__dashjs_factory_name="SegmentBaseGetter";var o=n.default.getClassFactory(s);t.default=o}));t(Nr);var Or=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(u),r=o(Cr),i=o(Dr),a=o(Mr),s=o(Nr);function o(e){return e&&e.__esModule?e:{default:e}}function l(e){e=e||{};var t,n=this.context,o=e.events,l=e.eventBus,u=e.dashConstants,d=e.streamInfo,c=e.type,f=void 0;function h(e){return e?e.segments?f[u.SEGMENT_BASE]:f[e.segmentInfoType]:null}return t={initialize:function(t){f[u.SEGMENT_TIMELINE]=(0,r.default)(n).create(e,t),f[u.SEGMENT_TEMPLATE]=(0,i.default)(n).create(e,t),f[u.SEGMENT_LIST]=(0,a.default)(n).create(e,t),f[u.SEGMENT_BASE]=(0,s.default)(n).create(e,t)},update:function(e,t,n,r){n||l.trigger(o.SEGMENTBASE_INIT_REQUEST_NEEDED,{streamId:d.id,mediaType:c,mimeType:t,representation:e}),r||l.trigger(o.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,{streamId:d.id,mediaType:c,mimeType:t,representation:e})},getSegmentByIndex:function(e,t,n){var r=h(e);return r?r.getSegmentByIndex(e,t,n):null},getSegmentByTime:function(e,t){var n=h(e);return n?n.getSegmentByTime(e,t):null}},f={},t}l.__dashjs_factory_name="SegmentsController";var d=n.default.getClassFactory(l);t.default=d}));t(Or);var Pr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(y),r=a(u),i=a(Or);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){e=e||{};var t=this.context,r=e.eventBus,a=e.events,s=e.debug,o=e.dashConstants,l=e.urlUtils,u=e.type,d=e.streamInfo,c=e.timelineConverter,f=e.dashMetrics,h=e.baseURLController,g=void 0,p=void 0,m=void 0,y=void 0,E=void 0,_=void 0,T=void 0,b=void 0,S=void 0;function A(){return u}function R(){m=-1,y=null}function I(){R(),E=null,S=null,b=null}function w(e,t,n){var r=h.resolve(n.path),i=void 0,a=void 0;return r&&t!==r.url&&l.isRelative(t)?(i=r.url,a=r.serviceLocation,t&&(i=l.resolve(t,i))):i=t,!l.isRelative(i)&&(e.url=i,e.serviceLocation=a,!0)}function C(e){var t,n,i;t=e.representation,n=t.hasInitialization(),i=t.hasSegments(),n&&i?r.trigger(a.REPRESENTATION_UPDATE_COMPLETED,{representation:t},{streamId:d.id,mediaType:u}):S.update(t,b,n,i)}function D(e,t){if(null==t)return null;var r=new n.default,i=t.representation,a=i.adaptation.period.mpd.manifest.Period_asArray[i.adaptation.period.index].AdaptationSet_asArray[i.adaptation.index].Representation_asArray[i.index].bandwidth,s=t.media;return s=(0,wr.replaceTokenForTemplate)(s,"Number",t.replacementNumber),s=(0,wr.replaceTokenForTemplate)(s,"Time",t.replacementTime),s=(0,wr.replaceTokenForTemplate)(s,"Bandwidth",a),s=(0,wr.replaceIDForTemplate)(s,i.id),s=(0,wr.unescapeDollarsInTemplate)(s),r.mediaType=A(),r.type=v.HTTPRequest.MEDIA_SEGMENT_TYPE,r.range=t.mediaRange,r.startTime=t.presentationStartTime,r.mediaStartTime=t.mediaStartTime,r.duration=t.duration,r.timescale=i.timescale,r.availabilityStartTime=t.availabilityStartTime,r.availabilityEndTime=t.availabilityEndTime,r.wallStartTime=t.wallStartTime,r.quality=i.index,r.index=t.availabilityIdx,r.mediaInfo=e,r.adaptationIndex=i.adaptation.index,r.representationId=i.id,w(r,s,i)?r:void 0}function M(e){var t=!1;if(!e)return t;if(_){if(T)t=!0;else if(y){var n=parseFloat((y.presentationStartTime-e.adaptation.period.start).toFixed(5));t=(y.duration>0?n+1.5*y.duration:n)>=e.adaptation.period.duration}}else m>=e.availableSegmentsNumber&&(t=!0);return t}function N(e){var t=e.representation;t.segments&&r.trigger(a.REPRESENTATION_UPDATE_COMPLETED,{representation:t},{streamId:d.id,mediaType:u})}function O(e){if(!e.error){var t,n=e.segments,i=e.representation,s=[],o=0,l=void 0,h=void 0,g=void 0;for(l=0,t=n?n.length:0;l<t;l++)h=n[l],(g=(0,wr.getTimeBasedSegment)(c,_,i,h.startTime,h.duration,h.timescale,h.media,h.mediaRange,o))&&(s.push(g),g=null,o++);if(s.length>0)if(i.segmentAvailabilityRange={start:s[0].presentationStartTime,end:s[s.length-1].presentationStartTime},i.availableSegmentsNumber=s.length,i.segments=s,_)!function(e){c.setExpectedLiveEdge(e),f.updateManifestUpdateInfo({presentationStartTime:e})}(s[s.length-1].presentationStartTime-8);i.hasInitialization()&&r.trigger(a.REPRESENTATION_UPDATE_COMPLETED,{representation:i},{streamId:d.id,mediaType:u})}}function P(){p.debug("Dynamic stream complete"),T=!0}return g={initialize:function(e){_=e,T=!1,S.initialize(e)},getStreamId:function(){return d.id},getType:A,getStreamInfo:function(){return d},getInitRequest:function(e,t){if(!t)return null;var r=function(e,t,r){var i=new n.default,a=t.adaptation.period,s=a.start;if(i.mediaType=r,i.type=v.HTTPRequest.INIT_SEGMENT_TYPE,i.range=t.range,i.availabilityStartTime=c.calcAvailabilityStartTimeFromPresentationTime(s,a.mpd,_),i.availabilityEndTime=c.calcAvailabilityEndTimeFromPresentationTime(s+a.duration,a.mpd,_),i.quality=t.index,i.mediaInfo=e,i.representationId=t.id,w(i,t.initialization,t))return i.url=(0,wr.replaceTokenForTemplate)(i.url,"Bandwidth",t.bandwidth),i}(e,t,A());return r},getRequestForSegment:D,getSegmentRequestForTime:function(e,t,r,i){var a=null;if(!t||!t.segmentInfoType)return a;var s=m,l=!!i&&i.keepIdx,d=!(!i||!i.ignoreIsFinished);E!==r&&(E=r,p.debug("Getting the request for time : "+r));var c=S.getSegmentByTime(t,r);return c?(m=c.availabilityIdx,y=c,p.debug("Index for time "+r+" is "+m),a=D(e,c)):!d&&M(t)&&((a=new n.default).action=n.default.ACTION_COMPLETE,a.index=m-1,a.mediaType=u,a.mediaInfo=e,p.debug("Signal complete in getSegmentRequestForTime")),l&&s>=0&&(m=t.segmentInfoType===o.SEGMENT_TIMELINE&&_?m:s),a},getNextSegmentRequest:function(e,t){var r=null;if(!t||!t.segmentInfoType)return null;E=null;var i=m+1;p.debug("Getting the next request at index: "+i);var a=S.getSegmentByIndex(t,i,y?y.mediaStartTime:-1);return a||!function(e){return!isFinite(e.adaptation.period.duration)}(t)||T?(a?(r=D(e,a),m=a.availabilityIdx):m=_?i-1:i,a?y=a:M(t)&&((r=new n.default).action=n.default.ACTION_COMPLETE,r.index=m-1,r.mediaType=A(),r.mediaInfo=e,p.debug("Signal complete")),r):(p.debug(A()+" No segment found at index: "+i+". Wait for next loop"),null)},setCurrentIndex:function(e){m=e},getCurrentIndex:function(){return m},isMediaFinished:M,reset:function(){I(),r.off(a.INITIALIZATION_LOADED,N,g),r.off(a.SEGMENTS_LOADED,O,g),r.off(a.REPRESENTATION_UPDATE_STARTED,C,g),r.off(a.DYNAMIC_TO_STATIC,P,g)},resetIndex:R,setMimeType:function(e){b=e},getNextSegmentRequestIdempotent:function(e,t){var n=m+1,r=S.getSegmentByIndex(t,n,y?y.mediaStartTime:-1);return r?D(e,r):null}},p=s.getLogger(g),I(),S=(0,i.default)(t).create(e),r.on(a.INITIALIZATION_LOADED,N,g),r.on(a.SEGMENTS_LOADED,O,g),r.on(a.REPRESENTATION_UPDATE_STARTED,C,g),r.on(a.DYNAMIC_TO_STATIC,P,g),g}s.__dashjs_factory_name="DashHandler",t.default=r.default.getClassFactory(s)}));t(Pr);var Lr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(){return{modifyRequestURL:function(e){return e},modifyRequestHeader:function(e){return e}}}i.__dashjs_factory_name="RequestModifier",t.default=r.default.getSingletonFactory(i)}));t(Lr);var kr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(){var e=void 0,t=/^[a-z][a-z0-9+\-_.]*:/i,n=/^https?:\/\//i,r=/^https:\/\//i,i=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,a=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},s=function(e,t){var n=o;if(!t)return e;if(!d(e))return e;c(e)&&(n=l),f(e)&&(n=u);var r=n(t),i="/"!==r.charAt(r.length-1)&&"/"!==e.charAt(0)?"/":"";return[r,e].join(i)};function o(e){var t=e.indexOf("/"),n=e.lastIndexOf("/");return-1!==t?n===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,n+1)):""}function l(e){var t=e.match(i);return t?t[1]:""}function u(e){var n=e.match(t);return n?n[0]:""}function d(e){return!t.test(e)}function c(e){return d(e)&&"/"===e.charAt(0)}function f(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y");e=a}catch(e){}finally{e=e||s}}(),{parseBaseUrl:o,parseOrigin:l,parseScheme:u,isRelative:d,isPathAbsolute:c,isSchemeRelative:f,isHTTPURL:function(e){return n.test(e)},isHTTPS:function(e){return r.test(e)},removeHostname:function(e){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e)[2].substring(1)},resolve:function(t,n){return e(t,n)}}}i.__dashjs_factory_name="DefaultURLUtils",t.default=r.default.getSingletonFactory(i)}));t(kr);var xr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(kr);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e,t=void 0,n=[],i=this.context;function a(e,r,i){var a=function(e){var r=void 0;for(r=0;r<n.length;r++)if(n[r].regex.test(e))return n[r].utils;return t}(i||r);return a&&"function"==typeof a[e]?a[e](r,i):t[e](r,i)}return t=(0,r.default)(i).getInstance(),e={registerUrlRegex:function(e,t){n.push({regex:e,utils:t})},parseBaseUrl:function(e){return a("parseBaseUrl",e)},parseOrigin:function(e){return a("parseOrigin",e)},parseScheme:function(e){return a("parseScheme",e)},isRelative:function(e){return a("isRelative",e)},isPathAbsolute:function(e){return a("isPathAbsolute",e)},isSchemeRelative:function(e){return a("isSchemeRelative",e)},isHTTPURL:function(e){return a("isHTTPURL",e)},isHTTPS:function(e){return a("isHTTPS",e)},removeHostname:function(e){return a("removeHostname",e)},resolve:function(e,t){return a("resolve",e,t)}},e}a.__dashjs_factory_name="URLUtils";var s=n.default.getSingletonFactory(a);t.default=s}));t(xr);var Fr=n((function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function e(){n(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};r.INITIAL_PLAYOUT_START_REASON="initial_playout",r.SEEK_START_REASON="seek",r.RESUME_FROM_PAUSE_START_REASON="resume",r.METRICS_COLLECTION_START_REASON="metrics_collection_start";var i=function e(){n(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};i.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",i.REBUFFERING_REASON="rebuffering",i.USER_REQUEST_STOP_REASON="user_request",i.END_OF_PERIOD_STOP_REASON="end_of_period",i.END_OF_CONTENT_STOP_REASON="end_of_content",i.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",i.FAILURE_STOP_REASON="failure",t.PlayList=r,t.PlayListTrace=i}));t(Fr),Fr.PlayList,Fr.PlayListTrace;var Ur=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=L(i),r=L(o),a=L(l),s=L(E),d=L(Er),c=L(Tr),h=L(Sr),m=L(Ar),v=L(Rr),T=L(u),b=L(f),S=L(g),A=L(Pr),R=L(Kn),C=L(_),D=L(p),M=L(Lr),N=L(xr),O=L(I),P=L(y);function L(e){return e&&e.__esModule?e:{default:e}}function k(e){e=e||{};var t=this.context,i=(0,b.default)(t).getInstance(),o=e.streamInfo,l=e.type,u=e.errHandler,f=e.mimeType,g=e.timelineConverter,p=e.adapter,y=e.manifestModel,E=e.mediaPlayerModel,_=e.fragmentModel,T=e.abrController,I=e.playbackController,L=e.mediaController,k=e.textController,x=e.dashMetrics,F=e.settings,U=e.boxParser,B=void 0,G=void 0,j=void 0,H=void 0,q=void 0,K=void 0,Y=void 0,V=void 0,W=void 0,z=void 0,X=void 0,Q=void 0;function $(){return l}function Z(){q=[],H=null,X=0}function J(e){(e.error||Y.setCurrentRepresentation(p.convertDataToRepresentationInfo(e.currentRepresentation)),e.error&&e.error.code!==R.default.SEGMENTS_UPDATE_FAILED_ERROR_CODE)||I.getStreamController().getActiveStreamInfo().id===o.id&&ae()}function ee(e){var t=ue(e.newQuality);Y.setCurrentRepresentation(t),x.pushPlayListTraceMetrics(new Date,Fr.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),x.createPlaylistTraceMetrics(t.id,1e3*I.getTime(),I.getPlaybackRate())}function te(e){x.addBufferLevel(l,new Date,1e3*e.bufferLevel);var t=I.getStreamController().getActiveStreamInfo().id;y.getValue().doNotUpdateDVRWindowOnBufferUpdated||o.id!==t||ae()}function ne(e){x.addBufferState(l,e.state,Y.getBufferTarget()),e.state!==a.default.BUFFER_EMPTY||I.isSeeking()||x.pushPlayListTraceMetrics(new Date,Fr.PlayListTrace.REBUFFERING_REASON)}function re(e){_.syncExecutedRequestsWithBufferedRange(K.getBuffer().getAllBufferRanges(),o.duration),e.from>I.getTime()&&(X=e.from,Q=!0)}function ie(e){X=e.quotaExceededTime,Q=!0}function ae(){var e=o.manifestInfo,t=e.isDynamic,n=g.calcSegmentAvailabilityRange(V.getCurrentRepresentation(),t);x.addDVRInfo($(),I.getTime(),e,n)}function se(){return K?K.getBuffer():null}function oe(){return q}function le(){return H}function ue(e){var t=void 0;return void 0!==e?((0,w.checkInteger)(e),t=V?V.getRepresentationForQuality(e):null):t=V?V.getCurrentRepresentation():null,p.convertDataToRepresentationInfo(t)}function de(e){if(e.sender&&(!p.getIsTextTrack(f)||k.isTextEnabled())&&K&&e.representationId&&!K.appendInitSegment(e.representationId)){var t=z?z.getInitRequest(le(),V.getCurrentRepresentation()):null;Y.processInitRequest(t)}}function ce(e){var t=void 0;K.getIsPruningInProgress()||(t=function(e,t){var r=ue(),i=!isNaN(e),a=I.getNormalizedTime(),s=i?e:X,o=!1,l=void 0;if(isNaN(s)||$()===n.default.FRAGMENTED_TEXT&&!k.isTextEnabled())return null;if(K){var u=K.getRangeAt(s),d=K.getRangeAt(a);if((null!==u||null!==d)&&!i)if(!u||d&&d.start!=u.start&&d.end!=u.end)K.getBuffer().hasDiscontinuitiesAfter(a)&&$()!==n.default.FRAGMENTED_TEXT&&(_.removeExecutedRequestsAfterTime(d.end),o=!0)}if(t)l=ge(r,s=t.startTime+t.duration/2,{timeThreshold:0,ignoreIsFinished:!0});else{var c=i||Q||o;for(l=ge(r,c?s:void 0,{keepIdx:!c}),Q=!1;l&&l.action!==P.default.ACTION_COMPLETE&&_.isFragmentLoaded(l);)l=ge(r)}return l}(e.seekTarget,e.replacement))&&(Y.setSeekTarget(NaN),e.replacement||(isNaN(t.startTime+t.duration)||(X=t.startTime+t.duration),t.delayLoadingTime=(new Date).getTime()+Y.getTimeToLoadDelay(),Y.setTimeToLoadDelay(0))),Y.processMediaRequest(t)}function fe(e){var n=e.chunk,r=n.bytes,a=n.quality,l=ue(a),u=V&&l?V.getRepresentationForQuality(l.quality):null,d=p.getEventsFor(l.mediaInfo),c=p.getEventsFor(l,u);if(d&&d.length>0||c&&c.length>0){var f=function(e,n,r,i){try{for(var a={},s=[],o=r.concat(i),l=0,u=o.length;l<u;l++)a[o[l].schemeIdUri+"/"+o[l].value]=o[l];var d=(0,O.default)(t).getInstance().parse(e),c=d.getBoxes("emsg");if(!c||0===c.length)return s;for(var f=d.getBox("sidx"),h=!f||isNaN(f.earliest_presentation_time)||isNaN(f.timescale)?n&&!isNaN(n.mediaStartTime)?n.mediaStartTime:0:f.earliest_presentation_time/f.timescale,g=Math.max(h,0),m=V.getCurrentRepresentation(),v=0,y=c.length;v<y;v++){var E=p.getEvent(c[v],a,g,m);E&&s.push(E)}return s}catch(e){return[]}}(r,_.getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,quality:a,index:n.index})[0],d,c);i.trigger(S.default.INBAND_EVENTS,{events:f},{streamId:o.id})}}function he(e){X=e.time,Y.setSeekTarget(e.time)}function ge(e,t,n){var r=null;if(z){var i=V&&e?V.getRepresentationForQuality(e.quality):null;r=void 0!==t&&void 0!==n?z.getSegmentRequestForTime(le(),i,t,n):z.getNextSegmentRequest(le(),i)}return r}return B={initialize:function(a,s){z=(0,A.default)(t).create({streamInfo:o,type:l,timelineConverter:g,dashMetrics:x,mediaPlayerModel:E,baseURLController:e.baseURLController,errHandler:u,settings:F,boxParser:U,events:S.default,eventBus:i,errors:R.default,debug:(0,D.default)(t).getInstance(),requestModifier:(0,M.default)(t).getInstance(),dashConstants:r.default,constants:n.default,urlUtils:(0,N.default)(t).getInstance()}),(j=o.manifestInfo.isDynamic)&&(W=(0,v.default)(t).create({timelineConverter:g})),z.initialize(j),T.registerStreamType(l,B),V=(0,m.default)(t).create({streamInfo:o,type:l,abrController:T,dashMetrics:x,playbackController:I,timelineConverter:g,dashConstants:r.default,events:S.default,eventBus:i,errors:R.default}),K=function(e){var r=null;if(!e)return u.error(new C.default(R.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,R.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null;r=e===n.default.VIDEO||e===n.default.AUDIO?(0,d.default)(t).create({streamInfo:o,type:e,mediaPlayerModel:E,manifestModel:y,fragmentModel:_,errHandler:u,mediaController:L,representationController:V,adapter:p,textController:k,abrController:T,playbackController:I,settings:F}):(0,c.default)(t).create({streamInfo:o,type:e,mimeType:f,mediaPlayerModel:E,manifestModel:y,fragmentModel:_,errHandler:u,mediaController:L,representationController:V,adapter:p,textController:k,abrController:T,playbackController:I,settings:F});return r}(l),K&&K.initialize(a),(Y=(0,h.default)(t).create({streamInfo:o,type:l,mimeType:f,adapter:p,dashMetrics:x,mediaPlayerModel:E,fragmentModel:_,abrController:T,playbackController:I,textController:k,mediaController:L,bufferController:K,settings:F})).initialize(s),X=0,Q=!1},getStreamId:function(){return o.id},getType:$,isUpdating:function(){return!!V&&V.isUpdating()},getBufferController:function(){return K},getFragmentModel:function(){return _},getScheduleController:function(){return Y},getRepresentationController:function(){return V},getRepresentationInfo:ue,getBufferLevel:function(){return K?K.getBufferLevel():0},isBufferingCompleted:function(){return!!K&&K.getIsBufferingCompleted()},createBuffer:function(e){return se()||K?K.createBuffer(q,e):null},updateStreamInfo:function(e){o=e,F.get().streaming.useAppendWindow&&K.updateAppendWindow()},getStreamInfo:function(){return o},selectMediaInfo:function(e){e===H||e&&H&&e.type!==H.type||(H=e);var t=p.getRealAdaptation(o,H),r=p.getVoRepresentations(H);if(V){var i=V.getData(),a=T.getTopQualityIndexFor(l,o.id),s=T.getMinAllowedIndexFor(l),u=void 0,d=null;null!==i&&i.id==t.id||l===n.default.FRAGMENTED_TEXT?u=T.getQualityFor(l):(d=T.getThroughputHistory().getAverageThroughput(l)||T.getInitialBitrateFor(l),u=T.getQualityForBitrate(H,d)),void 0!==s&&u<s&&(u=s),u>a&&(u=a),z.setMimeType(H?H.mimeType:null),V.updateData(t,r,l,u)}},addMediaInfo:function(e,t){-1===q.indexOf(e)&&q.push(e),t&&this.selectMediaInfo(e)},getLiveStartTime:function(){if(!j)return NaN;if(!W)return NaN;var e=NaN,t=ue(),n=W.getLiveEdge(t);if(isNaN(n))return NaN;var r=function(e,t){try{var n=null,r=I.getLiveDelay(),i=isNaN(o.manifestInfo.DVRWindowSize)?r:o.manifestInfo.DVRWindowSize,a=.1*i,s=void 0;if(!isFinite(i)||ge(t,e-i+a,{ignoreIsFinished:!0}))for(;!n&&r<=i;)(n=ge(t,s=e-r,{ignoreIsFinished:!0}))||(r+=1);return n&&I.setLiveDelay(r,!0),G.debug("live edge: "+e+", live delay: "+r+", live target: "+s),n}catch(e){return null}}(n,t);return r&&(e=F.get().streaming.lowLatencyEnabled?r.duration<E.getLiveDelay()?r.startTime:r.startTime+r.duration-E.getLiveDelay():r.startTime),e},switchTrackAsked:function(){Y.switchTrackAsked()},getMediaInfoArr:oe,getMediaInfo:le,getMediaSource:function(){return K.getMediaSource()},setMediaSource:function(e){K.setMediaSource(e,oe())},dischargePreBuffer:function(){K.dischargePreBuffer()},getBuffer:se,setBuffer:function(e){K.setBuffer(e)},setBufferingTime:function(e){X=e},resetIndexHandler:function(){z&&z.resetIndex()},getInitRequest:function(e){(0,w.checkInteger)(e);var t=V?V.getRepresentationForQuality(e):null;return z?z.getInitRequest(le(),t):null},getFragmentRequest:ge,finalisePlayList:function(e,t){x.pushPlayListTraceMetrics(e,t)},probeNextRequest:function(){var e=ue(),t=V&&e?V.getRepresentationForQuality(e.quality):null;return z.getNextSegmentRequestIdempotent(le(),t)},reset:function(e,t){z&&z.reset(),K&&(K.reset(e,t),K=null),Y&&(Y.reset(),Y=null),V&&(V.reset(),V=null),W&&(W.reset(),W=null),T&&!t&&T.unRegisterStreamType(l),i.off(S.default.DATA_UPDATE_COMPLETED,J,B),i.off(S.default.QUALITY_CHANGE_REQUESTED,ee,B),i.off(S.default.INIT_FRAGMENT_NEEDED,de,B),i.off(S.default.MEDIA_FRAGMENT_NEEDED,ce,B),i.off(S.default.MEDIA_FRAGMENT_LOADED,fe,B),i.off(S.default.BUFFER_LEVEL_UPDATED,te,B),i.off(S.default.BUFFER_LEVEL_STATE_CHANGED,ne,B),i.off(S.default.BUFFER_CLEARED,re,B),i.off(S.default.SEEK_TARGET,he,B),Z(),l=null,o=null}},G=(0,D.default)(t).getInstance().getLogger(B),Z(),i.on(S.default.DATA_UPDATE_COMPLETED,J,B,{priority:b.default.EVENT_PRIORITY_HIGH}),i.on(S.default.QUALITY_CHANGE_REQUESTED,ee,B),i.on(S.default.INIT_FRAGMENT_NEEDED,de,B),i.on(S.default.MEDIA_FRAGMENT_NEEDED,ce,B),i.on(S.default.MEDIA_FRAGMENT_LOADED,fe,B),i.on(S.default.BUFFER_LEVEL_UPDATED,te,B),i.on(S.default.BUFFER_LEVEL_STATE_CHANGED,ne,B),i.on(S.default.BUFFER_CLEARED,re,B),i.on(S.default.QUOTA_EXCEEDED,ie,B),i.on(S.default.SEEK_TARGET,he,B),B}k.__dashjs_factory_name="StreamProcessor",t.default=T.default.getClassFactory(k)}));t(Ur);var Br=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null}}));t(Br);var Gr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(e){var t=(e=e||{}).requestModifier;return{load:function(e){var n=new Date,r=e.request,i=new XMLHttpRequest;if(i.open(e.method,e.url,!0),r.responseType&&(i.responseType=r.responseType),r.range&&i.setRequestHeader("Range","bytes="+r.range),r.requestStartDate||(r.requestStartDate=n),t&&(i=t.modifyRequestHeader(i)),e.headers)for(var a in e.headers){var s=e.headers[a];s&&i.setRequestHeader(a,s)}i.withCredentials=e.withCredentials,i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.onprogress=e.progress,i.onabort=e.onabort,i.ontimeout=e.ontimeout,i.timeout=e.timeout,i.send(),e.response=i},abort:function(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}}}i.__dashjs_factory_name="XHRLoader";var a=r.default.getClassFactory(i);t.default=a}));t(Gr);var jr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"mixin",value:function(t,r,i){var a=void 0,s={};if(t)for(var o in r)r.hasOwnProperty(o)&&(a=r[o],o in t&&(t[o]===a||o in s&&s[o]===a)||("object"===n(t[o])&&null!==t[o]?t[o]=e.mixin(t[o],a,i):t[o]=i(a)));return t}},{key:"clone",value:function(t){if(!t||"object"!==(void 0===t?"undefined":n(t)))return t;var r=void 0;if(t instanceof Array){r=[];for(var i=0,a=t.length;i<a;++i)i in t&&r.push(e.clone(t[i]))}else r={};return e.mixin(r,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var n=new URL(e);return t.forEach((function(e){e.key&&e.value&&n.searchParams.set(e.key,e.value)})),n.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),r=0,i=n.length;r<i;r++){var a=n[r],s=a.indexOf(": ");s>0&&(t[a.substring(0,s)]=a.substring(s+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t}}]),e}();t.default=i}));t(jr);var Hr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=l(u),a=l(jr),s=l(p),o=l(i);function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(){var e,t,r={debug:{logLevel:s.default.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{metricsMaxListDepth:1e3,abandonLoadTimeout:1e4,liveDelayFragmentCount:NaN,liveDelay:null,scheduleWhilePaused:!0,fastSwitchEnabled:!1,flushBufferAtTrackSwitch:!1,calcSegmentAvailabilityRangeFromTimeline:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,stableBufferTime:12,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,longFormContentDurationThreshold:600,wallclockTimeUpdateInterval:50,lowLatencyEnabled:!1,keepProtectionMediaKeys:!1,useManifestDateHeaderTimeSource:!0,useSuggestedPresentationDelay:!0,useAppendWindow:!0,manifestUpdateRetryInterval:100,stallThreshold:.5,filterUnsupportedEssentialProperties:!0,eventControllerRefreshDelay:100,utcSynchronization:{backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso&ms"}},liveCatchup:{minDrift:.02,maxDrift:0,playbackRate:.5,latencyThreshold:60,playbackBufferMin:.5,enabled:!1,mode:o.default.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:o.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:o.default.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:o.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE,fragmentRequestTimeout:0,retryIntervals:(e={},d(e,v.HTTPRequest.MPD_TYPE,500),d(e,v.HTTPRequest.XLINK_EXPANSION_TYPE,500),d(e,v.HTTPRequest.MEDIA_SEGMENT_TYPE,1e3),d(e,v.HTTPRequest.INIT_SEGMENT_TYPE,1e3),d(e,v.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),d(e,v.HTTPRequest.INDEX_SEGMENT_TYPE,1e3),d(e,v.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),d(e,v.HTTPRequest.OTHER_TYPE,1e3),d(e,"lowLatencyReductionFactor",10),e),retryAttempts:(t={},d(t,v.HTTPRequest.MPD_TYPE,3),d(t,v.HTTPRequest.XLINK_EXPANSION_TYPE,1),d(t,v.HTTPRequest.MEDIA_SEGMENT_TYPE,3),d(t,v.HTTPRequest.INIT_SEGMENT_TYPE,3),d(t,v.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),d(t,v.HTTPRequest.INDEX_SEGMENT_TYPE,3),d(t,v.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),d(t,v.HTTPRequest.OTHER_TYPE,3),d(t,"lowLatencyMultiplyFactor",5),t),abr:{movingAverageMethod:o.default.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:o.default.ABR_STRATEGY_DYNAMIC,bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:o.default.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:o.default.CMCD_MODE_QUERY}}},i=a.default.clone(r);function l(e,t,r){for(var i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&("object"===n(e[i])&&null!==e[i]?l(e[i],t[i],r.slice()+i+"."):t[i]=a.default.clone(e[i]))}return{get:function(){return i},update:function(e){"object"===(void 0===e?"undefined":n(e))&&l(e,i,"")},reset:function(){i=a.default.clone(r)}}}c.__dashjs_factory_name="Settings";var f=r.default.getSingletonFactory(c);t.default=f}));t(Hr);var qr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(u),r=s(Hr),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}function o(e){e=e||{};var t=this.context,n=e.requestModifier,i=e.boxParser,s=(0,r.default)(t).getInstance();function o(e,t){e.reader.read().then(t).catch((function(t){e.onerror&&200===e.response.status&&e.onerror(t)}))}function l(e,t,n,r,i){switch(e){case a.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING:return function(e,t){try{var n=void 0,r=void 0;n=e.filter((function(t,n){return n>0&&n<e.length-1})),r=t.filter((function(e,n){return n>0&&n<t.length-1}));var i=0;if(n.length>1){for(var a=0;a<n.length;a++){if(n[a]&&r[a])i+=r[a].ts-n[a].ts}return i}return null}catch(e){return null}}(t,n);case a.default.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA:default:return u(r,i)}}function u(e,t){try{if((e=e.filter((function(n){return n.bytes>t/4/e.length}))).length>1){var n=0,r=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach((function(t,i){var a=e[i+1];if(a){var s=a.ts-t.ts;n+=s<r?s:0}})),n}return null}catch(e){return null}}return{load:function(e){var t=new Date,r=e.request,u=new Headers;if(r.range&&u.append("Range","bytes="+r.range),e.headers)for(var d in e.headers){var c=e.headers[d];c&&u.append(d,c)}r.requestStartDate||(r.requestStartDate=t),n&&n.modifyRequestHeader({setRequestHeader:function(e,t){u.append(e,t)}});var f=void 0;"function"==typeof window.AbortController&&(f=new AbortController,e.abortController=f,f.signal.onabort=e.onabort);var h={method:e.method,headers:u,credentials:e.withCredentials?"include":void 0,signal:f?f.signal:void 0};fetch(e.url,h).then((function(t){e.response||(e.response={}),e.response.status=t.status,e.response.statusText=t.statusText,e.response.responseURL=t.url,t.ok||e.onerror();var n="",r=!0,u=!1,d=void 0;try{for(var c,f=t.headers.keys()[Symbol.iterator]();!(r=(c=f.next()).done);r=!0){var h=c.value;n+=h+": "+t.headers.get(h)+"\r\n"}}catch(e){u=!0,d=e}finally{try{!r&&f.return&&f.return()}finally{if(u)throw d}}if(e.response.responseHeaders=n,!t.body)return t.arrayBuffer().then((function(t){e.response.response=t;var n={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(n),e.onload(),e.onend()}));var g=parseInt(t.headers.get("Content-Length"),10),p=0,m=!1,v=new Uint8Array,y=0;e.reader=t.body.getReader();var E=[],_=[],T=[],b=!0,S=s.get().streaming.abr.fetchThroughputCalculationMode;o(e,(function t(n){var r=n.value;if(n.done)return v&&(e.progress({loaded:p,total:isNaN(g)?p:g,lengthComputable:!0,time:l(S,_,T,E,p),stream:!0}),e.response.response=v.buffer),e.onload(),void e.onend();if(r&&r.length>0){if(v=function(e,t){if(0===e.length)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(v,r),p+=r.length,E.push({ts:Date.now(),bytes:r.length}),S===a.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&b)i.findLastTopIsoBoxCompleted(["moof"],v,y).found&&(b=!1,_.push({ts:performance.now(),bytes:r.length}));var s=i.findLastTopIsoBoxCompleted(["moov","mdat"],v,y);if(s.found){var u=s.lastCompletedOffset+s.size;S===a.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&(b=!0,T.push({ts:performance.now(),bytes:v.length}));var d=void 0;u===v.length?(d=v,v=new Uint8Array):(d=new Uint8Array(v.subarray(0,u)),v=v.subarray(u)),e.progress({data:d.buffer,lengthComputable:!1,noTrace:!0}),y=0}else y=s.lastCompletedOffset,m||(e.progress({lengthComputable:!1,noTrace:!0}),m=!0)}o(e,t)}))})).catch((function(t){e.onerror&&e.onerror(t)}))},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(e){}},calculateDownloadedTime:l}}o.__dashjs_factory_name="FetchLoader";var l=n.default.getClassFactory(o);t.default=l}));t(qr);var Kr=n((function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",e.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",e.CMCD_DATA_GENERATED="cmcdDataGenerated",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=d)&&n.__esModule?n:{default:n}).default));t.default=r}));t(Kr);var Yr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n=o)&&n.__esModule?n:{default:n};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}return r(e,[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==i.default.BASE_URL&&this.segmentInfoType!==i.default.SEGMENT_BASE&&!this.indexRange}}]),e}();t.default=a}));t(Yr);var Vr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null}}));t(Vr);var Wr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null};n.DEFAULT_ID="defaultId",t.default=n}));t(Wr);var zr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN}}));t(zr);var Xr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""}}));t(Xr);var Qr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN}}));t(Qr);var $r=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=n||t||"",this.dvb_priority=r||1,this.dvb_weight=i||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};n.DEFAULT_DVB_PRIORITY=1,n.DEFAULT_DVB_WEIGHT=1,t.default=n}));t($r);var Zr=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0}}));t(Zr);var Jr=Array.isArray,ei=Object.keys,ti=Object.prototype.hasOwnProperty,ni=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){var r,i,a,s=Jr(t),o=Jr(n);if(s&&o){if((i=t.length)!=n.length)return!1;for(r=i;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(s!=o)return!1;var l=t instanceof Date,u=n instanceof Date;if(l!=u)return!1;if(l&&u)return t.getTime()==n.getTime();var d=t instanceof RegExp,c=n instanceof RegExp;if(d!=c)return!1;if(d&&c)return t.toString()==n.toString();var f=ei(t);if((i=f.length)!==ei(n).length)return!1;for(r=i;0!=r--;)if(!ti.call(n,f[r]))return!1;for(r=i;0!=r--;)if(!e(t[a=f[r]],n[a]))return!1;return!0}return t!=t&&n!=n},ri=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(ni);function i(e){return e&&e.__esModule?e:{default:e}}function a(){return{areEqual:function(e,t){return(0,r.default)(e,t)}}}a.__dashjs_factory_name="ObjectUtils",t.default=n.default.getSingletonFactory(a)}));t(ri);var ii=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}}));t(ii);var ai=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.THUMBNAILS_SCHEME_ID_URIS=void 0;var n=p(i),r=p(o),a=p(u),s=p(ii),l=p(xr),d=p(g),c=p(I),f=p(Gr),h=p(Pr);function p(e){return e&&e.__esModule?e:{default:e}}var m=t.THUMBNAILS_SCHEME_ID_URIS=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function v(e){var t,i=this.context,a=e.adapter,o=e.baseURLController,u=e.streamInfo,g=e.timelineConverter,p=e.debug,v=e.eventBus,y=e.events,E=e.dashConstants,_=(0,l.default)(i).getInstance(),T=void 0,b=void 0,S=void 0,A=void 0,R=void 0,I=void 0;function w(){D(),R=(0,f.default)(i).create({}),I=(0,c.default)(i).getInstance(),(b=(0,h.default)(i).create({streamInfo:u,timelineConverter:g,baseURLController:o,debug:p,eventBus:v,events:y,dashConstants:E,urlUtils:_})).initialize(!!a&&a.getIsDynamic()),function(){if(!u||!a)return;if(!(A=a.getMediaInfoForType(u,n.default.IMAGE)))return;var e=a.getVoRepresentations(A);e&&e.length>0&&e.forEach((function(e){(e.segmentInfoType===r.default.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===r.default.SEGMENT_TIMELINE)&&C(e),e.segmentInfoType===r.default.SEGMENT_BASE&&C(e,!0)}));T.length>0&&(T.sort((function(e,t){return e.bitrate-t.bitrate})),S=T.length-1)}()}function C(e,t){var r=new s.default;r.id=e.id,r.bitrate=e.bandwidth,r.width=e.width,r.height=e.height,r.tilesHor=1,r.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach((function(e){if(m.indexOf(e.schemeIdUri)>=0&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(r.tilesHor=parseInt(t[0],10),r.tilesVert=parseInt(t[1],10))}})),t?v.trigger(d.default.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,{streamId:u.id,mediaType:n.default.IMAGE,mimeType:A.mimeType,representation:e,callback:function(e,t,n,i){var s=[];n=function(e,t){var n,r=[],i=0,s=void 0,o=void 0,l=void 0;for(s=0,n=e.length;s<n;s++)o=e[s],(l=(0,wr.getTimeBasedSegment)(g,a.getIsDynamic(),t,o.startTime,o.duration,o.timescale,o.media,o.mediaRange,i))&&(r.push(l),l=null,i++);return r}(n,i),r.segmentDuration=n[0].duration,r.readThumbnail=function(e,t){var r=null;s.some((function(t){if(t.start<=e&&t.end>e)return r=t.url,!0})),r?t(r):n.some((function(n){if(n.mediaStartTime<=e&&n.mediaStartTime+n.duration>e){var r=o.resolve(i.path);return R.load({method:"get",url:r.url,request:{range:n.mediaRange,responseType:"arraybuffer"},onload:function(e){var r=I.getSamplesInfo(e.target.response),i=new Blob([e.target.response.slice(r.sampleList[0].offset,r.sampleList[0].offset+r.sampleList[0].size)],{type:"image/jpeg"}),a=window.URL.createObjectURL(i);s.push({start:n.mediaStartTime,end:n.mediaStartTime+n.duration,url:a}),t&&t(a)}}),!0}}))}}}):(r.startNumber=e.startNumber,r.segmentDuration=e.segmentDuration,r.timescale=e.timescale,r.templateUrl=function(e){var t=_.isRelative(e.media)?_.resolve(e.media,o.resolve(e.path).url):e.media;if(!t)return"";return(0,wr.replaceIDForTemplate)(t,e.id)}(e)),r.tilesHor>0&&r.tilesVert>0&&(r.widthPerTile=r.width/r.tilesHor,r.heightPerTile=r.height/r.tilesVert,T.push(r))}function D(){T=[],S=-1,A=null}return t={initialize:w,getTracks:function(){return T},reset:D,setTrackByIndex:function(e){T&&0!==T.length&&(e>=T.length&&(e=T.length-1),S=e)},getCurrentTrack:function(){return S<0?null:T[S]},getCurrentTrackIndex:function(){return S},getThumbnailRequestForTime:function(e){for(var t=void 0,n=a.getVoRepresentations(A),r=0;r<n.length;r++)if(T[S].id===n[r].id){t=n[r];break}return b.getSegmentRequestForTime(A,t,e)}},w(),t}v.__dashjs_factory_name="ThumbnailTracks",t.default=a.default.getClassFactory(v)}));t(ai),ai.THUMBNAILS_SCHEME_ID_URIS;var si=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=S(i),r=S(o),a=S(Yr),s=S(Vr),l=S(Wr),d=S(zr),c=S(Xr),f=S(Qr),h=S($r),g=S(Zr),m=S(ri),v=S(xr),y=S(u),E=S(p),T=S(_),b=S(Kn);function S(e){return e&&e.__esModule?e:{default:e}}function A(){var e=void 0,t=void 0,i=void 0,o=void 0,u=this.context,p=(0,v.default)(u).getInstance(),y=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function _(e,t){var i=void 0,a=void 0,s=void 0,o=void 0,l=void 0,u=void 0,d=!1,c=!1;if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.hasOwnProperty("ContentComponent_asArray")&&(o=e.ContentComponent_asArray),l=t!==n.default.TEXT?new RegExp(t):new RegExp("(vtt|ttml)"),e.Representation_asArray&&e.Representation_asArray.length&&e.Representation_asArray.length>0){var f=P(e.Representation_asArray[0]);if(f&&f.length>0&&ai.THUMBNAILS_SCHEME_ID_URIS.indexOf(f[0].schemeIdUri)>=0)return t===n.default.IMAGE;if(e.Representation_asArray[0].hasOwnProperty(r.default.CODECS)&&(0===(u=e.Representation_asArray[0].codecs).search(n.default.STPP)||0===u.search(n.default.WVTT)))return t===n.default.FRAGMENTED_TEXT}if(o){if(o.length>1)return t===n.default.MUXED;o[0]&&o[0].contentType===t&&(d=!0,c=!0)}if(e.hasOwnProperty(r.default.MIME_TYPE)&&(d=l.test(e.mimeType),c=!0),!c)for(i=0,a=e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0;!c&&i<a;)(s=e.Representation_asArray[i]).hasOwnProperty(r.default.MIME_TYPE)&&(d=l.test(s.mimeType),c=!0),i++;return d}function S(e){return _(e,n.default.AUDIO)}function A(e){return _(e,n.default.VIDEO)}function R(e){return _(e,n.default.FRAGMENTED_TEXT)}function I(e){return _(e,n.default.IMAGE)}function w(e){return"text/vtt"===e||"application/ttml+xml"===e}function C(){return function(e,t){return e.bandwidth-t.bandwidth}}function D(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort((function(e,t){return e.bandwidth-t.bandwidth})),e}function M(e,t){return e&&e.Period_asArray&&y(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function N(e){return e&&e.Period_asArray?e.Period_asArray:[]}function O(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===r.default.DYNAMIC),t}function P(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}})):null}function L(e,t){if(!e)throw new Error("Period cannot be null or undefined");var n=l.default.DEFAULT_ID+"_"+t;return e.hasOwnProperty(r.default.ID)&&e.id.length>0&&"__proto__"!==e.id&&(n=e.id),n}function k(e,t){var i=[],a=void 0;if(!e)return i;for(a=0;a<e.length;a++){var s=new g.default;if(s.timescale=1,s.representation=t,!e[a].hasOwnProperty(n.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");s.schemeIdUri=e[a].schemeIdUri,e[a].hasOwnProperty(r.default.TIMESCALE)&&(s.timescale=e[a].timescale),e[a].hasOwnProperty(r.default.VALUE)&&(s.value=e[a].value),i.push(s)}return i}function x(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],i=!1;return n.some((function(n){if(n){var a=new h.default,s=n.__text||n;return p.isRelative(s)&&(i=!0,e.baseUri&&(s=p.resolve(s,e.baseUri))),a.url=s,n.hasOwnProperty(r.default.SERVICE_LOCATION)&&n.serviceLocation.length?a.serviceLocation=n.serviceLocation:a.serviceLocation=s,n.hasOwnProperty(r.default.DVB_PRIORITY)&&(a.dvb_priority=n[r.default.DVB_PRIORITY]),n.hasOwnProperty(r.default.DVB_WEIGHT)&&(a.dvb_weight=n[r.default.DVB_WEIGHT]),n.hasOwnProperty(r.default.AVAILABILITY_TIME_OFFSET)&&(a.availabilityTimeOffset=n[r.default.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(r.default.AVAILABILITY_TIME_COMPLETE)&&(a.availabilityTimeComplete="false"!==n[r.default.AVAILABILITY_TIME_COMPLETE]),t.push(a),i}})),t}return e={getIsTypeOf:_,getIsTextTrack:w,getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(r.default.LANG)&&(t=e.lang.replace(/[^A-Za-z0-9-]/g,"")),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(r.default.VIEWPOINT)?e.Viewpoint:null},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(r.default.ROLE_ASARRAY)?e.Role_asArray:[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(r.default.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(r.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAudioChannelConfigurationForRepresentation:function(e){return e&&e.hasOwnProperty(r.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function(e,t,n){var r=M(t,n);return r.length>0&&y(e)?r[e]:null},getIndexForAdaptation:function(e,t,n){if(!e)return-1;for(var r=M(t,n),i=0;i<r.length;i++){if((0,m.default)(u).getInstance().areEqual(r[i],e))return i}return-1},getAdaptationForId:function(e,t,n){var i,a=M(t,n),s=void 0;for(s=0,i=a.length;s<i;s++)if(a[s].hasOwnProperty(r.default.ID)&&a[s].id===e)return a[s];return null},getAdaptationsForType:function(e,t,n){var r,i=M(e,t),a=void 0,s=[];for(a=0,r=i.length;a<r;a++)_(i[a],n)&&s.push(D(i[a]));return s},getRealPeriods:N,getRealPeriodForIndex:function(e,t){var n=N(t);return n.length>0&&y(e)?n[e]:null},getCodec:function(e,t,n){var r=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var i=y(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];i&&(r=i.mimeType+';codecs="'+i.codecs+'"',n&&void 0!==i.width&&(r+=';width="'+i.width+'";height="'+i.height+'"'))}return r&&(r=r.replace(/\sprofiles=[^;]*/g,"")),r},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(r.default.CENC_DEFAULT_KID)?e[r.default.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e||!Array.isArray(e.Label_asArray))return[];for(var t=[],n=0;n<e.Label_asArray.length;n++)t.push({lang:e.Label_asArray[n].lang,text:e.Label_asArray[n].__text||e.Label_asArray[n]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(r.default.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:O,getId:function(e){return e&&e[r.default.ID]||null},hasProfile:function(e,t){var n=!1;return e&&e.profiles&&e.profiles.length>0&&(n=-1!==e.profiles.indexOf(t)),n},getDuration:function(e){return e&&e.hasOwnProperty(r.default.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=NaN;return e&&e.hasOwnProperty(r.default.MINIMUM_UPDATE_PERIOD)&&(n=e.minimumUpdatePeriod),isNaN(n)?n:Math.max(n-t,1)},getPublishTime:function(e){return e&&e.hasOwnProperty(r.default.PUBLISH_TIME)?new Date(e[r.default.PUBLISH_TIME]):null},getRepresentationCount:function(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){var t=D(e);return(t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[]).map((function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null}}))},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&y(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t,n,i,s,o,l=[],u=function(e){if(e&&e.period&&y(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&y(e.index))return D(t.AdaptationSet_asArray[e.index])}}(e),d=void 0,c=void 0;if(u&&u.Representation_asArray){if(e&&e.period&&y(e.period.index)){var f=x(e.period.mpd.manifest);f&&(c=f[0])}for(var h=0,g=u.Representation_asArray.length;h<g;++h){var p=u.Representation_asArray[h],m=new a.default;if(m.index=h,m.adaptation=e,p.hasOwnProperty(r.default.ID)&&(m.id=p.id),p.hasOwnProperty(r.default.CODECS)&&(m.codecs=p.codecs),p.hasOwnProperty(r.default.CODEC_PRIVATE_DATA)&&(m.codecPrivateData=p.codecPrivateData),p.hasOwnProperty(r.default.BANDWITH)&&(m.bandwidth=p.bandwidth),p.hasOwnProperty(r.default.WIDTH)&&(m.width=p.width),p.hasOwnProperty(r.default.HEIGHT)&&(m.height=p.height),p.hasOwnProperty(r.default.SCAN_TYPE)&&(m.scanType=p.scanType),p.hasOwnProperty(r.default.MAX_PLAYOUT_RATE)&&(m.maxPlayoutRate=p.maxPlayoutRate),p.hasOwnProperty(r.default.SEGMENT_BASE)?(d=p.SegmentBase,m.segmentInfoType=r.default.SEGMENT_BASE):p.hasOwnProperty(r.default.SEGMENT_LIST)?(d=p.SegmentList).hasOwnProperty(r.default.SEGMENT_TIMELINE)?m.segmentInfoType=r.default.SEGMENT_TIMELINE:m.segmentInfoType=r.default.SEGMENT_LIST:p.hasOwnProperty(r.default.SEGMENT_TEMPLATE)?((d=p.SegmentTemplate).hasOwnProperty(r.default.SEGMENT_TIMELINE)?m.segmentInfoType=r.default.SEGMENT_TIMELINE:m.segmentInfoType=r.default.SEGMENT_TEMPLATE,d.hasOwnProperty(r.default.INITIALIZATION_MINUS)&&(m.initialization=d.initialization.split("$Bandwidth$").join(p.bandwidth).split("$RepresentationID$").join(p.id))):m.segmentInfoType=r.default.BASE_URL,m.essentialProperties=P(p),d){if(d.hasOwnProperty(r.default.INITIALIZATION)){var v=d.Initialization;v.hasOwnProperty(r.default.SOURCE_URL)&&(m.initialization=v.sourceURL),v.hasOwnProperty(r.default.RANGE)&&(m.range=v.range)}else p.hasOwnProperty(r.default.MIME_TYPE)&&w(p.mimeType)&&(m.range=0);d.hasOwnProperty(r.default.TIMESCALE)&&(m.timescale=d.timescale),d.hasOwnProperty(r.default.DURATION)?m.segmentDuration=d.duration/m.timescale:p.hasOwnProperty(r.default.SEGMENT_TEMPLATE)&&(d=p.SegmentTemplate).hasOwnProperty(r.default.SEGMENT_TIMELINE)&&(m.segmentDuration=(i=d.SegmentTimeline,s=void 0,o=void 0,s=i.S_asArray[0],o=i.S_asArray[1],(s.hasOwnProperty("d")?s.d:o.t-s.t)/m.timescale)),d.hasOwnProperty(r.default.MEDIA)&&(m.media=d.media),d.hasOwnProperty(r.default.START_NUMBER)&&(m.startNumber=d.startNumber),d.hasOwnProperty(r.default.INDEX_RANGE)&&(m.indexRange=d.indexRange),d.hasOwnProperty(r.default.PRESENTATION_TIME_OFFSET)&&(m.presentationTimeOffset=d.presentationTimeOffset/m.timescale),d.hasOwnProperty(r.default.AVAILABILITY_TIME_OFFSET)?m.availabilityTimeOffset=d.availabilityTimeOffset:c&&void 0!==c.availabilityTimeOffset&&(m.availabilityTimeOffset=c.availabilityTimeOffset),d.hasOwnProperty(r.default.AVAILABILITY_TIME_COMPLETE)?m.availabilityTimeComplete="false"!==d.availabilityTimeComplete:c&&void 0!==c.availabilityTimeComplete&&(m.availabilityTimeComplete=c.availabilityTimeComplete)}m.MSETimeOffset=(n=void 0,void 0,n=(t=m).presentationTimeOffset,t.adaptation.period.start-n),m.path=[e.period.index,e.index,h],l.push(m)}}return l},getAdaptationsForPeriod:function(e){var t=e&&y(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,i=[],a=void 0,o=void 0,l=void 0;if(t&&t.AdaptationSet_asArray)for(l=0;l<t.AdaptationSet_asArray.length;l++)o=t.AdaptationSet_asArray[l],a=new s.default,o.hasOwnProperty(r.default.ID)&&(a.id=o.id),a.index=l,a.period=e,_(o,n.default.MUXED)?a.type=n.default.MUXED:S(o)?a.type=n.default.AUDIO:A(o)?a.type=n.default.VIDEO:R(o)?a.type=n.default.FRAGMENTED_TEXT:I(o)?a.type=n.default.IMAGE:a.type=n.default.TEXT,i.push(a);return i},getRegularPeriods:function(e){var a,s=!!e&&O(e.manifest),o=[],u=null,d=null,c=null,f=null,h=void 0;for(h=0,a=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;h<a;h++)(d=e.manifest.Period_asArray[h]).hasOwnProperty(r.default.START)?(f=new l.default).start=d.start:null!==u&&u.hasOwnProperty(r.default.DURATION)&&null!==c?(f=new l.default).start=parseFloat((c.start+c.duration).toFixed(5)):0!==h||s||((f=new l.default).start=0),null!==c&&isNaN(c.duration)&&(null!==f?c.duration=parseFloat((f.start-c.start).toFixed(5)):t.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==f&&(f.id=L(d,h),f.index=h,f.mpd=e,d.hasOwnProperty(r.default.DURATION)&&(f.duration=d.duration),o.push(f),u=d,c=f),d=null,f=null;return 0===o.length||null!==c&&isNaN(c.duration)&&(c.duration=parseFloat((function(e){!function(){if(!i||!i.hasOwnProperty("error"))throw new Error(n.default.MISSING_CONFIG_ERROR)}();var t=O(e.mpd.manifest),r=void 0;e.mpd.manifest.mediaPresentationDuration?r=e.mpd.manifest.mediaPresentationDuration:e.duration?r=e.duration:t?r=Number.POSITIVE_INFINITY:i.error(new T.default(b.default.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e));return r}(c)-c.start).toFixed(5))),o},getMpd:function(e){var t=new d.default;return e&&(t.manifest=e,e.hasOwnProperty(r.default.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(r.default.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(r.default.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(r.default.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(r.default.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(r.default.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(r.default.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(r.default.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t},getEventsForPeriod:function(e){var t=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,i=t?t.Period_asArray:null,a=i&&e&&y(e.index)?i[e.index].EventStream_asArray:null,s=[],l=void 0,u=void 0;if(a)for(l=0;l<a.length;l++){var d=new g.default;if(d.period=e,d.timescale=1,!a[l].hasOwnProperty(n.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(d.schemeIdUri=a[l][n.default.SCHEME_ID_URI],a[l].hasOwnProperty(r.default.TIMESCALE)&&(d.timescale=a[l][r.default.TIMESCALE]),a[l].hasOwnProperty(r.default.VALUE)&&(d.value=a[l][r.default.VALUE]),a[l].hasOwnProperty(r.default.PRESENTATION_TIME_OFFSET)&&(d.presentationTimeOffset=a[l][r.default.PRESENTATION_TIME_OFFSET]),u=0;a[l].Event_asArray&&u<a[l].Event_asArray.length;u++){var c=a[l].Event_asArray[u],h=new f.default;if(h.presentationTime=0,h.eventStream=d,c.hasOwnProperty(r.default.PRESENTATION_TIME)){h.presentationTime=c.presentationTime;var p=d.presentationTimeOffset?d.presentationTimeOffset/d.timescale:0;h.calculatedPresentationTime=h.presentationTime/d.timescale+e.start-p}c.hasOwnProperty(r.default.DURATION)&&(h.duration=c.duration/d.timescale),c.hasOwnProperty(r.default.ID)&&(h.id=c.id),c.Signal&&c.Signal.Binary?h.messageData=o.decodeArray(c.Signal.Binary.toString()):h.messageData=c.messageData||c.__text,s.push(h)}}return s},getEssentialPropertiesForRepresentation:P,getEventStreamForAdaptationSet:function(e,t){var n=void 0,r=void 0,i=void 0;return e&&e.Period_asArray&&t&&t.period&&y(t.period.index)&&(r=e.Period_asArray[t.period.index])&&r.AdaptationSet_asArray&&y(t.index)&&(i=r.AdaptationSet_asArray[t.index])&&(n=i.InbandEventStream_asArray),k(n,null)},getEventStreamForRepresentation:function(e,t){var n=void 0,r=void 0,i=void 0,a=void 0;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&y(t.adaptation.period.index)&&(r=e.Period_asArray[t.adaptation.period.index])&&r.AdaptationSet_asArray&&y(t.adaptation.index)&&(i=r.AdaptationSet_asArray[t.adaptation.index])&&i.Representation_asArray&&y(t.index)&&(a=i.Representation_asArray[t.index])&&(n=a.InbandEventStream_asArray),k(n,t)},getUTCTimingSources:function(e){var t=O(e),i=!!e&&e.hasOwnProperty(r.default.AVAILABILITY_START_TIME),a=e?e.UTCTiming_asArray:null,s=[];return(t||i)&&a&&a.forEach((function(e){var t=new c.default;e.hasOwnProperty(n.default.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(r.default.VALUE)&&(t.value=e.value.toString(),s.push(t)))})),s},getBaseURLsFromElement:x,getRepresentationSortFunction:C,getLocation:function(e){if(e&&e.hasOwnProperty(n.default.LOCATION))return e.Location=e.Location_asArray[0],e.Location},getPatchLocation:function(e){if(e&&e.hasOwnProperty(r.default.PATCH_LOCATION))return e.PatchLocation=e.PatchLocation_asArray[0],e.PatchLocation},getSuggestedPresentationDelay:function(e){return e&&e.hasOwnProperty(r.default.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null},getAvailabilityStartTime:function(e){return e&&e.hasOwnProperty(r.default.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null},getServiceDescriptions:function(e){var t=[];if(e&&e.hasOwnProperty(r.default.SERVICE_DESCRIPTION)){var i=!0,a=!1,s=void 0;try{for(var o,l=e.ServiceDescription_asArray[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var u=o.value,d=void 0,c=void 0,f=void 0,h=void 0;for(var g in u)u.hasOwnProperty(g)&&(g===r.default.ID?d=u[g]:g===r.default.SERVICE_DESCRIPTION_SCOPE?c=u[g].schemeIdUri:g===r.default.SERVICE_DESCRIPTION_LATENCY?f={target:u[g].target,max:u[g].max,min:u[g].min}:g===r.default.SERVICE_DESCRIPTION_PLAYBACK_RATE&&(h={max:u[g].max,min:u[g].min}));c===n.default.SERVICE_DESCRIPTION_LL_SCHEME&&(f||h)&&t.push({id:d,schemeIdUri:c,latency:f,playbackRate:h})}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}}return t},getSupplementalPropperties:function(e){var t={};if(e&&e.hasOwnProperty(r.default.SUPPLEMENTAL_PROPERTY)){var i=!0,a=!1,s=void 0;try{for(var o,l=e.SupplementalProperty_asArray[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var u=o.value;u.hasOwnProperty(n.default.SCHEME_ID_URI)&&u.hasOwnProperty(r.default.VALUE)&&(t[u[n.default.SCHEME_ID_URI]]=u[r.default.VALUE])}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}}return t},setConfig:function(e){e&&(e.errHandler&&(i=e.errHandler),e.BASE64&&(o=e.BASE64))}},t=(0,E.default)(u).getInstance().getLogger(e),e}A.__dashjs_factory_name="DashManifestModel",t.default=y.default.getSingletonFactory(A)}));t(si);var oi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=m(f),r=m(c),a=m(Kr),s=m(u),o=m(p),l=m(Hr),d=m(i),h=m(si),g=m(jr);function m(e){return e&&e.__esModule?e:{default:e}}var y="m",E="a",_="v",T="i",b="c",S="tt",A="k",R="o",I="d",w="s",C="v",D="l";function M(){var e=void 0,t=void 0,i=void 0,s=void 0,u=void 0,c=void 0,f=void 0,p=void 0,m=void 0,M=void 0,N=this.context,O=(0,n.default)(N).getInstance(),P=(0,l.default)(N).getInstance();function L(){i={pr:1,nor:null,st:null,sf:null,sid:""+g.default.generateUuid(),cid:null},m={},p={},M={},x()}function k(){x()}function x(){if(c){var e=c.getStreamController();if(e&&"function"==typeof e.getActiveStream){var t=e.getActiveStream();t&&(f=t.getProcessors())}}}function F(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var l=s.value;e[l]&&(n[l]=e[l])}}catch(e){i=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw a}}return n}function U(e){try{return e.type===v.HTTPRequest.MPD_TYPE?((t=B()).ot=""+y,t):e.type===v.HTTPRequest.MEDIA_SEGMENT_TYPE?(function(e){M.hasOwnProperty(e)||(M[e]=!1);p.hasOwnProperty(e)||(p[e]=!1);m.hasOwnProperty(e)||(m[e]=!1)}(e.mediaType),function(e){var t=B(),n=function(e){try{var t=e.quality,n=e.mediaInfo.bitrateList;return parseInt(n[t].bandwidth/1e3)}catch(e){return null}}(e),r=function(e){try{return isNaN(e.duration)?null:Math.round(1e3*e.duration)}catch(e){return null}}(e),a=function(e){try{return 100*parseInt(s.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(e){return null}}(e.mediaType),o=function(e){try{var t=i.pr,n=u.getCurrentBufferLevel(e);return isNaN(t)||isNaN(n)?null:100*parseInt(n/t*10)}catch(e){return null}}(e.mediaType),l=G(e.mediaType),h=function(e){try{var t=s.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(e){return null}}(e.mediaType),g=i.pr,v=function(e){if(!f||0===f.length)return;var t=!0,n=!1,r=void 0;try{for(var i,a=f[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;if(s.getType()===e)return s.probeNextRequest()}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}(e.mediaType),y=void 0;e.mediaType===d.default.VIDEO&&(y=_);e.mediaType===d.default.AUDIO&&(y=E);e.mediaType===d.default.FRAGMENTED_TEXT&&(y="application/mp4"===e.mediaInfo.mimeType?S:b);var T=P.get().streaming.cmcd.rtp;T||(T=function(e){var t=c.getPlaybackRate();t||(t=1);var n=e.quality,r=e.mediaType,i=e.mediaInfo,a=e.duration,s=G(r);0===s&&(s=500);var o=i.bitrateList[n].bandwidth*a/1e3/(s/t/1e3),l=P.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(P.get().streaming.cmcd.rtpSafetyFactor)?P.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(o*l/100)+1)}(e));if(t.rtp=T,v)if(e.url!==v.url){var A=new URL(v.url);t.nor=A.pathname}else v.range&&(t.nrr=v.range);n&&(t.br=n);y&&(t.ot=y);isNaN(r)||(t.d=r);isNaN(a)||(t.mtp=a);isNaN(o)||(t.dl=o);isNaN(l)||(t.bl=l);isNaN(h)||(t.tb=h);isNaN(g)||1===g||(t.pr=g);m[e.mediaType]&&(t.bs=!0,m[e.mediaType]=!1);!p[e.mediaType]&&M[e.mediaType]||(t.su=!0,p[e.mediaType]=!1,M[e.mediaType]=!0);return t}(e)):e.type===v.HTTPRequest.INIT_SEGMENT_TYPE?function(){var e=B();return e.ot=""+T,e.su=!0,e}():e.type===v.HTTPRequest.OTHER_TYPE||e.type===v.HTTPRequest.XLINK_EXPANSION_TYPE?function(){var e=B();return e.ot=""+R,e}():e.type===v.HTTPRequest.LICENSE?function(e){var t=B();return t.ot=A,t}():null}catch(e){return null}var t}function B(){var e={},t=P.get().streaming.cmcd.cid?P.get().streaming.cmcd.cid:i.cid;return e.v=1,e.sid=P.get().streaming.cmcd.sid?P.get().streaming.cmcd.sid:i.sid,e.sid=""+e.sid,t&&(e.cid=""+t),isNaN(i.pr)||1===i.pr||null===i.pr||(e.pr=i.pr),i.st&&(e.st=i.st),i.sf&&(e.sf=i.sf),e}function G(e){try{var t=u.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(e){return null}}function j(e){try{i.pr=e.playbackRate}catch(e){}}function H(t){try{var n=e.getIsDynamic(t.data)?""+D:""+C,r=t.protocol&&"MSS"===t.protocol?""+w:""+I;i.st=""+n,i.sf=""+r}catch(e){}}function q(e){try{e.state&&e.mediaType&&e.state===r.default.BUFFER_EMPTY&&(m[e.mediaType]||(m[e.mediaType]=!0),p[e.mediaType]||(p[e.mediaType]=!0))}catch(e){}}function K(){for(var e in m)m.hasOwnProperty(e)&&(m[e]=!0);for(var t in p)p.hasOwnProperty(t)&&(p[t]=!0)}function Y(e){try{if(!e)return null;var t=Object.keys(e).sort((function(e,t){return e.localeCompare(t)})),n=t.length,r=t.reduce((function(t,r,i){if("v"===r&&1===e[r])return t;"string"!=typeof e[r]||"ot"===r&&"sf"===r&&"st"===r?t+=r+"="+e[r]:t+=r+'="'+e[r].replace(/"/g,'"')+'"';return i<n-1&&(t+=","),t}),"");return r=r.replace(/=true/g,"")}catch(e){return null}}return t={getQueryParameter:function(e){try{if(P.get().streaming.cmcd&&P.get().streaming.cmcd.enabled){var t=U(e),n=Y(t);return O.trigger(a.default.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:n}),{key:"CMCD",value:n}}return null}catch(e){return null}},getHeaderParameters:function(e){try{if(P.get().streaming.cmcd&&P.get().streaming.cmcd.enabled){var t=U(e),n=F(t,["br","d","ot","tb"]),r=F(t,["bl","dl","mtp","nor","nrr","su"]),i=F(t,["bs","rtp"]),s=F(t,["cid","pr","sf","sid","st","v"]),o={"CMCD-Object":Y(n),"CMCD-Request":Y(r),"CMCD-Status":Y(i),"CMCD-Session":Y(s)};return O.trigger(a.default.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t}),o}return null}catch(e){return null}},setConfig:function(e){e&&(e.abrController&&(s=e.abrController),e.dashMetrics&&(u=e.dashMetrics),e.playbackController&&(c=e.playbackController))},reset:function(){O.off(r.default.PLAYBACK_RATE_CHANGED,j,this),O.off(r.default.MANIFEST_LOADED,H,this),O.off(r.default.BUFFER_LEVEL_STATE_CHANGED,q,t),O.off(r.default.PLAYBACK_SEEKED,K,t),L()},initialize:function(){O.on(r.default.PLAYBACK_RATE_CHANGED,j,t),O.on(r.default.MANIFEST_LOADED,H,t),O.on(r.default.BUFFER_LEVEL_STATE_CHANGED,q,t),O.on(r.default.PLAYBACK_SEEKED,K,t),O.on(r.default.PERIOD_SWITCH_COMPLETED,k,t)}},(0,o.default)(N).getInstance().getLogger(t),e=(0,h.default)(N).getInstance(),L(),t}M.__dashjs_factory_name="CmcdModel",t.default=s.default.getSingletonFactory(M)}));t(oi);var li=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=E(Gr),r=E(qr),a=E(u),s=E(_),o=E(oi),l=E(jr),d=E(p),c=E(f),h=E(g),m=E(Hr),y=E(i);function E(e){return e&&e.__esModule?e:{default:e}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){e=e||{};var t,i=this.context,a=e.errHandler,u=e.dashMetrics,f=e.mediaPlayerModel,g=e.requestModifier,p=e.boxParser,E=e.useFetch||!1,_=e.errors,b=e.requestTimeout||0,S=(0,c.default)(i).getInstance(),A=(0,m.default)(i).getInstance(),R=void 0,I=void 0,w=void 0,C=void 0,D=void 0,M=void 0,N=void 0;function O(e,t){var o=e.request,d=[],c=!0,m=!0,_=new Date,T=_,R=0,P=void 0;if(!g||!u||!a)throw new Error("config object is not correct or missing");var L=function(e){m=!1,o.requestStartDate=_,o.requestEndDate=new Date,o.firstByteDate=o.firstByteDate||_,o.checkExistenceOnly||(u.addHttpRequest(o,P.response?P.response.responseURL:null,P.response?P.response.status:null,P.response&&P.response.getAllResponseHeaders?P.response.getAllResponseHeaders():P.response?P.response.responseHeaders:[],e?d:null),o.type===v.HTTPRequest.MPD_TYPE&&u.addManifestUpdate(o))},k=function(){if(-1!==I.indexOf(P)&&(I.splice(I.indexOf(P),1),m))if(L(!1),t>0){try{if(A.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&o.type===v.HTTPRequest.MEDIA_SEGMENT_TYPE)f.getRetryAttemptsForType(v.HTTPRequest.MEDIA_SEGMENT_TYPE)===t&&S.trigger(h.default.ATTEMPT_BACKGROUND_SYNC)}catch(e){}t--;var n={config:e};C.push(n),n.timeout=setTimeout((function(){-1!==C.indexOf(n)&&(C.splice(C.indexOf(n),1),O(e,t))}),f.getRetryIntervalsForType(o.type))}else{if(o.type===v.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;a.error(new s.default(D[o.type],o.url+" is not available",{request:o,response:P.response})),e.error&&e.error(o,"error",P.response.statusText),e.complete&&e.complete(o,P.response.statusText)}},x=void 0;x=E&&window.fetch&&"arraybuffer"===o.responseType&&o.type===v.HTTPRequest.MEDIA_SEGMENT_TYPE?(0,r.default)(i).create({requestModifier:g,boxParser:p}):(0,n.default)(i).create({requestModifier:g});var F=null,U=g.modifyRequestURL(o.url);if(A.get().streaming.cmcd&&A.get().streaming.cmcd.enabled){var B=A.get().streaming.cmcd.mode;if(B===y.default.CMCD_MODE_QUERY){var G=function(e){try{var t=[],n=M.getQueryParameter(e);return n&&t.push(n),t}catch(e){return[]}}(o);U=l.default.addAditionalQueryParameterToUrl(U,G)}else B===y.default.CMCD_MODE_HEADER&&(F=M.getHeaderParameters(o))}var j=o.checkExistenceOnly?v.HTTPRequest.HEAD:v.HTTPRequest.GET,H=f.getXHRWithCredentialsForType(o.type);P={url:U,method:j,withCredentials:H,request:o,onload:function(){P.response.status>=200&&P.response.status<=299&&(L(!0),e.success&&e.success(P.response.response,P.response.statusText,P.response.responseURL),e.complete&&e.complete(o,P.response.statusText))},onend:k,onerror:k,progress:function(t){var n=new Date;c&&(c=!1,(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(o.firstByteDate=n)),t.lengthComputable&&(o.bytesLoaded=t.loaded,o.bytesTotal=t.total),t.noTrace||(d.push({s:T,d:t.time?t.time:n.getTime()-T.getTime(),b:[t.loaded?t.loaded-R:0]}),T=n,R=t.loaded),e.progress&&t&&e.progress(t)},onabort:function(){e.abort&&e.abort(o)},ontimeout:function(e){var t=void 0;if(e.lengthComputable){var n=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+n.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";N.warn(t)},loader:x,timeout:b,headers:F};var q=(new Date).getTime();if(isNaN(o.delayLoadingTime)||q>=o.delayLoadingTime)I.push(P),x.load(P);else{var K={httpRequest:P};w.push(K),K.delayTimeout=setTimeout((function(){if(-1!==w.indexOf(K)){w.splice(w.indexOf(K),1);try{_=new Date,T=_,I.push(K.httpRequest),x.load(K.httpRequest)}catch(e){K.httpRequest.onerror()}}}),o.delayLoadingTime-q)}}return R={load:function(e){e.request?O(e,f.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")},abort:function(){C.forEach((function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)})),C=[],w.forEach((function(e){return clearTimeout(e.delayTimeout)})),w=[],I.forEach((function(e){e.request.type!==v.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))})),I=[]}},N=(0,d.default)(i).getInstance().getLogger(R),I=[],w=[],C=[],M=(0,o.default)(i).getInstance(),T(t={},v.HTTPRequest.MPD_TYPE,_.DOWNLOAD_ERROR_ID_MANIFEST_CODE),T(t,v.HTTPRequest.XLINK_EXPANSION_TYPE,_.DOWNLOAD_ERROR_ID_XLINK_CODE),T(t,v.HTTPRequest.INIT_SEGMENT_TYPE,_.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),T(t,v.HTTPRequest.MEDIA_SEGMENT_TYPE,_.DOWNLOAD_ERROR_ID_CONTENT_CODE),T(t,v.HTTPRequest.INDEX_SEGMENT_TYPE,_.DOWNLOAD_ERROR_ID_CONTENT_CODE),T(t,v.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,_.DOWNLOAD_ERROR_ID_CONTENT_CODE),T(t,v.HTTPRequest.OTHER_TYPE,_.DOWNLOAD_ERROR_ID_CONTENT_CODE),D=t,R}b.__dashjs_factory_name="HTTPLoader";var S=a.default.getClassFactory(b);t.default=S}));t(li);var ui=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(li);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e=void 0;function t(){e={}}function n(){t()}return n(),{getLoader:function(t){for(var n in e)if(e.hasOwnProperty(n)&&t.startsWith(n))return e[n];return r.default},registerLoader:function(t,n){e[t]=n},unregisterLoader:function(t){e[t]&&delete e[t]},unregisterAllLoader:t,reset:n}}a.__dashjs_factory_name="SchemeLoaderFactory";var s=n.default.getSingletonFactory(a);t.default=s}));t(ui);var di=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(ui);function i(e){return e&&e.__esModule?e:{default:e}}function a(e){e=e||{};var t,n=this.context,i=void 0,a=void 0;return i=(0,r.default)(n).getInstance(),t={load:function(t){var r=i.getLoader(t&&t.request?t.request.url:null);(a=r(n).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.useFetch||null,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors})).load(t)},abort:function(){a&&a.abort()}},t}a.__dashjs_factory_name="URLLoader";var s=n.default.getClassFactory(a);t.default=s}));t(di);var ci=n((function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.checkForExistenceOnly=!0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=y)&&n.__esModule?n:{default:n}).default);t.default=r}));t(ci);var fi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(i),r=l(di),a=l(ci),s=l(_),o=l(u);function l(e){return e&&e.__esModule?e:{default:e}}function d(e){e=e||{};var t=this.context,i=e.eventBus,o=e.events,l=e.urlUtils,u=e.errors,d=void 0,c=void 0;return d={checkForExistence:function(e){var t=function(t){i.trigger(o.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var n=new a.default(e.url);c.load({request:n,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(e){var t=function(t,n){i.trigger(o.LOADING_COMPLETED,{request:e,response:t||null,error:n||null,sender:d})};e?c.load({request:e,progress:function(t){i.trigger(o.LOADING_PROGRESS,{request:e,stream:t.stream}),t.data&&i.trigger(o.LOADING_DATA_PROGRESS,{request:e,response:t.data||null,error:null,sender:d})},success:function(e){t(e)},error:function(e,n,r){t(void 0,new s.default(u.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,r,n))},abort:function(e){e&&i.trigger(o.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:d})}}):t(void 0,new s.default(u.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,u.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){c&&c.abort()},reset:function(){c&&(c.abort(),c=null)}},c=(0,r.default)(t).create({errHandler:e.errHandler,errors:u,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.settings.get().streaming.lowLatencyEnabled,urlUtils:l,constants:n.default,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout}),d}d.__dashjs_factory_name="FragmentLoader",t.default=o.default.getClassFactory(d)}));t(fi);var hi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=v(i),r=v(Br),a=v(E),s=v(fi),o=v(Lr),l=v(f),d=v(g),c=v(Kn),h=v(u),m=v(p);function v(e){return e&&e.__esModule?e:{default:e}}function y(e){e=e||{};var t=this.context,i=(0,l.default)(t).getInstance(),u=e.errHandler,f=e.mediaPlayerModel,h=e.dashMetrics,g=(0,m.default)(t).getInstance(),p=e.streamInfo,v=void 0,y=void 0,E=void 0;function _(){for(var e in E)E[e].reset();E={}}function T(e){if(e.sender){var t=e.request,a=e.response,s=t.isInitializationRequest(),o=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType!==n.default.AUDIO&&t.mediaType!==n.default.VIDEO&&t.mediaType!==n.default.FRAGMENTED_TEXT||i.trigger(d.default.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation})),a&&o){var l=function(e,t,n,i){var a=new r.default;return a.streamId=n,a.mediaInfo=t.mediaInfo,a.segmentType=t.type,a.start=t.startTime,a.duration=t.duration,a.end=a.start+a.duration,a.bytes=e,a.index=t.index,a.quality=t.quality,a.representationId=t.representationId,a.endFragment=i,a}(a,t,p.id,e.type!==d.default.FRAGMENT_LOADING_PROGRESS);i.trigger(s?d.default.INIT_FRAGMENT_LOADED:d.default.MEDIA_FRAGMENT_LOADED,{chunk:l,request:t},{streamId:o.id,mediaType:t.mediaType})}else y.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}}return v={getStreamId:function(){return p.id},getModel:function(n){var r=E[n];return r||(r=(0,a.default)(t).create({streamInfo:p,type:n,dashMetrics:h,fragmentLoader:(0,s.default)(t).create({dashMetrics:h,mediaPlayerModel:f,errHandler:u,requestModifier:(0,o.default)(t).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:i,events:d.default,errors:c.default,dashConstants:e.dashConstants,urlUtils:e.urlUtils}),debug:g,eventBus:i,events:d.default}),E[n]=r),r},reset:function(){i.off(d.default.FRAGMENT_LOADING_COMPLETED,T,this),i.off(d.default.FRAGMENT_LOADING_PROGRESS,T,this),_()}},y=g.getLogger(v),_(),i.on(d.default.FRAGMENT_LOADING_COMPLETED,T,v),i.on(d.default.FRAGMENT_LOADING_PROGRESS,T,v),v}y.__dashjs_factory_name="FragmentController",t.default=h.default.getClassFactory(y)}));t(hi);var gi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null}}));t(gi);var pi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(u),r=l(i),a=l(gi),s=l(ai),o=l(fr);function l(e){return e&&e.__esModule?e:{default:e}}function d(e){var t,n=this.context,i=e.streamInfo,l=void 0;function u(){l&&l.reset()}return t={getStreamId:function(){return i.id},provide:function(e,t){if("function"==typeof t){var n,r=l.getCurrentTrack(),i=void 0;if(!r||r.segmentDuration<=0||null==e)t(null);else{isNaN(r.segmentDuration)&&(i=l.getThumbnailRequestForTime(e))&&(r.segmentDuration=i.duration),n=e%r.segmentDuration;var s=Math.floor(n*r.tilesHor*r.tilesVert/r.segmentDuration),o=new a.default;if(o.width=Math.floor(r.widthPerTile),o.height=Math.floor(r.heightPerTile),o.x=Math.floor(s%r.tilesHor)*r.widthPerTile,o.y=Math.floor(s/r.tilesHor)*r.heightPerTile,"readThumbnail"in r)return r.readThumbnail(e,(function(e){o.url=e,t(o)}));if(i)o.url=i.url,r.segmentDuration=NaN;else{var u=Math.floor(e/r.segmentDuration);o.url=function(e,t){var n=t+e.startNumber,r=(0,wr.replaceTokenForTemplate)(e.templateUrl,"Number",n);return r=(0,wr.replaceTokenForTemplate)(r,"Time",(n-1)*e.segmentDuration*e.timescale),r=(0,wr.replaceTokenForTemplate)(r,"Bandwidth",e.bandwidth),(0,wr.unescapeDollarsInTemplate)(r)}(r,u)}t(o)}}},setTrackByIndex:function(e){l.setTrackByIndex(e)},getCurrentTrackIndex:function(){return l.getCurrentTrackIndex()},getBitrateList:function(){var e=l.getTracks(),t=0;return e.map((function(e){var n=new o.default;return n.mediaType=r.default.IMAGE,n.qualityIndex=t++,n.bitrate=e.bitrate,n.width=e.width,n.height=e.height,n}))},reset:u},u(),l=(0,s.default)(n).create({streamInfo:i,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants}),t}d.__dashjs_factory_name="ThumbnailController",t.default=n.default.getClassFactory(d)}));t(pi);var mi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=b(i),r=b(o),a=b(Ur),s=b(hi),l=b(pi),d=b(f),c=b(g),h=b(p),m=b(Kn),v=b(u),y=b(_),E=b(I),T=b(xr);function b(e){return e&&e.__esModule?e:{default:e}}function S(e){e=e||{};var t=this.context,i=(0,d.default)(t).getInstance(),o=(0,T.default)(t).getInstance(),u=e.manifestModel,f=e.mediaPlayerModel,g=e.manifestUpdater,p=e.adapter,v=e.capabilities,_=e.capabilitiesFilter,b=e.errHandler,S=e.timelineConverter,A=e.dashMetrics,R=e.abrController,I=e.playbackController,w=e.eventController,C=e.mediaController,D=e.textController,M=e.protectionController,N=e.videoModel,O=e.settings,P=e.streamInfo,L=void 0,k=void 0,x=void 0,F=void 0,U=void 0,B=void 0,G=void 0,j=void 0,H=void 0,q=void 0,K=void 0,Y=void 0,V=void 0,W=void 0,z=void 0,X=void 0,Q=void 0,$=void 0;function Z(e){for(var t=x?x.length:0,n=0;n<t;n++){x[n].getFragmentModel().removeExecutedRequestsBeforeTime(ne()+te()),x[n].reset(false,e)}x=[],U=!1,B=!1,be(!1),i.off(c.default.CURRENT_TRACK_CHANGED,ue,L)}function J(){Z(),F=!1,G=!1,j=!1,H={},q=!1,z=!1,Q=!1}function ee(){I&&I.pause(),K&&(K.reset(),K=null),P=null,J(),i.off(c.default.DATA_UPDATE_COMPLETED,pe,L),i.off(c.default.BUFFERING_COMPLETED,ge,L),i.off(c.default.INBAND_EVENTS,me,L),M&&(i.off(c.default.KEY_ERROR,oe,L),i.off(c.default.SERVER_CERTIFICATE_UPDATED,oe,L),i.off(c.default.LICENSE_REQUEST_COMPLETE,oe,L),i.off(c.default.KEY_SYSTEM_SELECTED,oe,L),i.off(c.default.KEY_SESSION_CREATED,oe,L),i.off(c.default.KEY_STATUSES_CHANGED,oe,L)),be(!1)}function te(){return P?P.duration:NaN}function ne(){return P?P.start:NaN}function re(){if(!P.manifestInfo.isDynamic)return NaN;for(var e=0;e<x.length;e++)if(x[e].getType()===n.default.AUDIO||x[e].getType()===n.default.VIDEO)return x[e].getLiveStartTime();return NaN}function ie(){return P?P.id:null}function ae(){return P}function se(){if(!(N&&R&&R.hasOwnProperty("getBitrateList")&&p&&p.hasOwnProperty("getAllMediaInfoForType")&&p.hasOwnProperty("getEventsFor")))throw new Error(n.default.MISSING_CONFIG_ERROR)}function oe(e){e.error&&(b.error(e.error),k.fatal(e.error.message),ee())}function le(e){var t,r=e?e.type:null,i=void 0;if(r===n.default.MUXED)return i="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",k.fatal(i),b.error(new y.default(m.default.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,i,u.getValue())),!1;if(r===n.default.TEXT||r===n.default.FRAGMENTED_TEXT||r===n.default.EMBEDDED_TEXT||r===n.default.IMAGE)return!0;if(t=e.codec,k.debug(r+" codec: "+t),e.contentProtection&&!v.supportsEncryptedMedia())b.error(new y.default(m.default.CAPABILITY_MEDIAKEYS_ERROR_CODE,m.default.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE));else if(!v.supportsCodec(t))return i=r+"Codec ("+t+") is not supported.",k.error(i),!1;return!0}function ue(e){if(P&&e.newMediaInfo.streamInfo.id===P.id){var t=e.newMediaInfo,r=u.getValue();p.setCurrentMediaInfo(P.id,t.type,t);var i=ve(t);if(i){var a=I.getTime();k.info("Stream -  Process track changed at current time "+a),k.debug("Stream -  Update stream controller"),r.refreshManifestOnSwitchTrack?(k.debug("Stream -  Refreshing manifest for switch track"),$=e,g.refreshManifest()):(i.selectMediaInfo(t),t.type!==n.default.FRAGMENTED_TEXT?(R.updateTopQualityIndex(t),i.switchTrackAsked(),i.getFragmentModel().abortRequests()):(i.getScheduleController().setSeekTarget(a),i.setBufferingTime(a),i.resetIndexHandler()))}}}function de(s,o){var d,h=p.getAllMediaInfoForType(P,s),g=null;if(h&&0!==h.length){s===n.default.VIDEO&&(G=!0),s===n.default.AUDIO&&(j=!0);for(var m=0,v=h.length;m<v;m++)if(g=h[m],s===n.default.EMBEDDED_TEXT)D.addEmbeddedTrack(g);else{if(!le(g))continue;C.addTrack(g)}s!==n.default.EMBEDDED_TEXT&&0!==C.getTracksFor(s,P).length&&(s!==n.default.IMAGE?(C.checkInitialMediaSettingsForType(s,P),d=C.getCurrentTrackFor(s,P),i.trigger(c.default.STREAM_INITIALIZING,{streamInfo:P,mediaInfo:g}),function(r,i,s,o){var l=K.getModel(r?r.type:null),d=(0,a.default)(t).create({streamInfo:P,type:r?r.type:null,mimeType:r?r.mimeType:null,timelineConverter:S,adapter:p,manifestModel:u,mediaPlayerModel:f,fragmentModel:l,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,abrController:R,playbackController:I,mediaController:C,textController:D,errHandler:b,settings:O,boxParser:W});if(d.initialize(s,G),R.updateTopQualityIndex(r),o?(d.setBuffer(o.buffer),d.setBufferingTime(o.currentTime),x[o.replaceIdx]=d):x.push(d),!o||!o.ignoreMediaInfo)if(!r||r.type!==n.default.TEXT&&r.type!==n.default.FRAGMENTED_TEXT)d.addMediaInfo(r,!0);else{for(var c=void 0,h=0;h<i.length;h++)i[h].index===r.index&&(c=h),d.addMediaInfo(i[h]);d.selectMediaInfo(i[c])}}(d,h,o)):Y=(0,l.default)(t).create({streamInfo:P,adapter:p,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:X,eventBus:i,events:c.default,dashConstants:r.default}))}else k.info("No "+s+" data.")}function ce(){if(w){var e=p.getEventsFor(P);w.addInlineEvents(e)}}function fe(){for(var e=x.length,t=!!H.audio||!!H.video?new y.default(m.default.DATA_UPDATE_FAILED_ERROR_CODE,m.default.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,r=0;r<e;r++)if(x[r].isUpdating()||q)return;if(B){if(M){M.clearMediaInfoArrayByStreamId(ie());for(var a=0;a<e&&x[a];a++){var s=x[a].getType();if(s===n.default.AUDIO||s===n.default.VIDEO||s===n.default.FRAGMENTED_TEXT){var o=x[a].getMediaInfo();o&&M.initializeForMedia(o)}}}t?b.error(t):F||(F=!0,i.trigger(c.default.STREAM_INITIALIZED,{streamInfo:P,liveStartTime:V?NaN:re()}));for(var l=0;l<e&&x[l];l++)x[l].getScheduleController().start()}}function he(e){for(var t={},n=0,r=x.length;n<r;n++){var i=x[n].createBuffer(e);i&&(t[x[n].getType()]=i.getBuffer())}return t}function ge(){var e=ye(),t=e.length;if(0!==t){for(var r=0;r<t;r++)if(!e[r].isBufferingCompleted()&&(e[r].getType()===n.default.AUDIO||e[r].getType()===n.default.VIDEO))return void k.warn("onBufferingCompleted - One streamProcessor has finished but",e[r].getType(),"one is not buffering completed");k.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),i.trigger(c.default.STREAM_BUFFERING_COMPLETED,{streamInfo:P})}else k.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function pe(e){H[e.mediaType]=e.error,fe()}function me(e){var t;t=e.events,w&&w.addInbandEvents(t)}function ve(e){return e?ye().filter((function(t){return t.getType()===e.type}))[0]:null}function ye(){for(var e=[],t=void 0,r=void 0,i=0;i<x.length;i++)(t=(r=x[i]).getType())!==n.default.AUDIO&&t!==n.default.VIDEO&&t!==n.default.FRAGMENTED_TEXT&&t!==n.default.TEXT||e.push(r);return e}function Ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return!1;var r=e.getStreamInfo(),i=n?n.getStreamInfo():ae();if(!r||!i)return!1;var a=p.getAdaptationForType(r.index,t,r),s=p.getAdaptationForType(i.index,t,i);return a&&s?!(!_e(s)&&_e(a)):!a&&!s}function _e(e){return!!e&&!!(e.ContentProtection||e.Representation&&e.Representation.length>0&&e.Representation[0].ContentProtection)}function Te(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;var r=e.getStreamInfo(),i=n?n.getStreamInfo():ae();if(!r||!i)return!1;var a=p.getAdaptationForType(r.index,t,r),s=p.getAdaptationForType(i.index,t,i);if(!a||!s)return!a&&!s;var o=a&&s&&a.mimeType===s.mimeType,l=s.Representation_asArray.map((function(e){return e.codecs})),u=a.Representation_asArray.map((function(e){return e.codecs})),d=u.some((function(e){return l.indexOf(e)>-1})),c=u.some((function(e){return l.some((function(t){return v.codecRootCompatibleWithCodec(t,e)}))}));return d||c&&o}function be(e){V=e}function Se(){return V}return L={initialize:function(){i.on(c.default.BUFFERING_COMPLETED,ge,L),i.on(c.default.DATA_UPDATE_COMPLETED,pe,L),i.on(c.default.INBAND_EVENTS,me,L),M&&(i.on(c.default.KEY_ERROR,oe,L),i.on(c.default.SERVER_CERTIFICATE_UPDATED,oe,L),i.on(c.default.LICENSE_REQUEST_COMPLETE,oe,L),i.on(c.default.KEY_SYSTEM_SELECTED,oe,L),i.on(c.default.KEY_SESSION_CREATED,oe,L),i.on(c.default.KEY_STATUSES_CHANGED,oe,L)),i.trigger(c.default.STREAM_UPDATED,{streamInfo:P})},getStreamId:function(){return P?P.id:null},activate:function(e,t){if(!U){var r=void 0;return i.on(c.default.CURRENT_TRACK_CHANGED,ue,L),Se()?(!function(){if(q=!0,se(),_.filterUnsupportedFeaturesOfPeriod(P),B=!0,q=!1,0===x.length){var e="No streams to play.";b.error(new y.default(m.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e,u.getValue())),k.debug(e)}else fe()}(),r=t):r=function(e,t){se();var r=N.getElement();ce(),q=!0,_.filterUnsupportedFeaturesOfPeriod(P),(!r||r&&/^VIDEO$/i.test(r.nodeName))&&de(n.default.VIDEO,e);de(n.default.AUDIO,e),de(n.default.TEXT,e),de(n.default.FRAGMENTED_TEXT,e),de(n.default.EMBEDDED_TEXT,e),de(n.default.MUXED,e),de(n.default.IMAGE,e);var i=he(t);if(B=!0,q=!1,0===x.length){var a="No streams to play.";b.error(new y.default(m.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,a,u.getValue())),k.fatal(a)}else fe();return i}(e,t),U=!0,r}return t},deactivate:Z,isActive:function(){return U},getDuration:te,getStartTime:ne,getId:ie,getStreamInfo:ae,getHasAudioTrack:function(){return j},getHasVideoTrack:function(){return G},preload:function(e,t){if(!Se()){ce(),de(n.default.VIDEO,e),de(n.default.AUDIO,e),de(n.default.TEXT,e),de(n.default.FRAGMENTED_TEXT,e),de(n.default.EMBEDDED_TEXT,e),de(n.default.MUXED,e),de(n.default.IMAGE,e),he(t),i.on(c.default.CURRENT_TRACK_CHANGED,ue,L);for(var r=0;r<x.length&&x[r];r++)x[r].getScheduleController().start();be(!0)}},getThumbnailController:function(){return Y},getBitrateListFor:function(e){if(se(),e===n.default.IMAGE)return Y?Y.getBitrateList():[];var t=function(e){for(var t=null,n=0;n<x.length;n++)if((t=x[n]).getType()===e)return t.getMediaInfo();return null}(e);return R.getBitrateList(t)},updateData:function(e){k.info("Manifest updated... updating data system wide."),U=!1,q=!0,P=e,i.trigger(c.default.STREAM_UPDATED,{streamInfo:P}),w&&ce(),_.filterUnsupportedFeaturesOfPeriod(P);for(var t=0,r=x.length;t<r;t++){var a=x[t];a.updateStreamInfo(P);var s=p.getMediaInfoForType(P,a.getType());s&&(R.updateTopQualityIndex(s),a.addMediaInfo(s,!0))}if($&&$.newMediaInfo.type!==n.default.FRAGMENTED_TEXT){var o=ve($.oldMediaInfo);if(!o)return;o.switchTrackAsked(),$=void 0}q=!1,fe()},reset:ee,getProcessors:ye,setMediaSource:function(e){for(var t=0;t<x.length;)le(x[t].getMediaInfo())?(x[t].setMediaSource(e),t++):(x[t].reset(),x.splice(t,1));for(var n=0;n<x.length;n++)x[n].dischargePreBuffer();if(0===x.length){var r="No streams to play.";b.error(new y.default(m.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,r+"nostreams",u.getValue())),k.fatal(r)}},isMediaCodecCompatible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Te(e,n.default.VIDEO,t)&&Te(e,n.default.AUDIO,t)},isProtectionCompatible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Ee(e,n.default.VIDEO,t)&&Ee(e,n.default.AUDIO,t)},getPreloaded:Se,getPreloadingScheduled:function(){return z},setPreloadingScheduled:function(e){z=e},getIsEndedEventSignaled:function(){return Q},setIsEndedEventSignaled:function(e){Q=e}},X=(0,h.default)(t).getInstance(),k=X.getLogger(L),J(),W=(0,E.default)(t).getInstance(),K=(0,s.default)(t).create({streamInfo:P,mediaPlayerModel:f,dashMetrics:A,errHandler:b,settings:O,boxParser:W,dashConstants:r.default,urlUtils:o}),L}S.__dashjs_factory_name="Stream",t.default=v.default.getClassFactory(S)}));t(mi);var vi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(f),r=c(g),i=c(u),a=c(p),s=c(Kn),l=c(o),d=c(xr);function c(e){return e&&e.__esModule?e:{default:e}}function h(){var e=this.context,t=(0,n.default)(e).getInstance(),i=(0,d.default)(e).getInstance(),o=void 0,u=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0;function T(){c=NaN,p=!1,h=!0,g=!1,b()}function b(){null!==f&&(clearTimeout(f),f=null)}function S(e){b(),g||(isNaN(e)&&!isNaN(c)&&(e=1e3*c),isNaN(e)||(u.debug("Refresh manifest in "+e+" milliseconds."),f=setTimeout(I,e)))}function A(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];p=!0;var t=v.getValue(),n=t.url,r=y.getPatchLocation(t),a=y.getLocation(t);r&&!e?n=r:a&&(n=a),i.isRelative(n)&&(n=i.resolve(n,t.url)),m.load(n)}function R(e){if(e){if(y.getIsPatch(e)){var n=e;e=v.getValue();var i=y.isPatchValid(e,n),a=i;if(i){var s=y.getPublishTime(e);a=y.applyPatchToManifest(e,n);var o=y.getPublishTime(e);a=s.getTime()!=o.getTime()}if(!a)return u.debug("Patch provided is invalid, performing full manifest refresh"),void A(!0);e.loadedTime=new Date}}else(e=v.getValue()).loadedTime=new Date;if(v.getValue()&&v.getValue().type===l.default.DYNAMIC&&e.type===l.default.STATIC)return t.trigger(r.default.DYNAMIC_TO_STATIC),p=!1,void(g=!0);v.setValue(e);var d=new Date,f=(d.getTime()-e.loadedTime.getTime())/1e3;1e3*(c=y.getManifestUpdatePeriod(e,f))>2147483647&&(c=2147483.647),t.trigger(r.default.MANIFEST_UPDATED,{manifest:e}),u.info("Manifest has been refreshed at "+d+"["+d.getTime()/1e3+"] "),h||S()}function I(){h||(p?S(_.get().streaming.manifestUpdateRetryInterval):A())}function w(e){e.error?e.error.code===s.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&E.error(e.error):R(e.manifest)}function C(){h=!1,S()}function D(){(h=!_.get().streaming.scheduleWhilePaused)&&b()}function M(){p=!1}return o={initialize:function(){T(),t.on(r.default.STREAMS_COMPOSED,M,this),t.on(r.default.PLAYBACK_STARTED,C,this),t.on(r.default.PLAYBACK_PAUSED,D,this),t.on(r.default.INTERNAL_MANIFEST_LOADED,w,this)},setManifest:function(e){R(e)},refreshManifest:A,setConfig:function(e){e&&(e.manifestModel&&(v=e.manifestModel),e.adapter&&(y=e.adapter),e.manifestLoader&&(m=e.manifestLoader),e.errHandler&&(E=e.errHandler),e.settings&&(_=e.settings))},reset:function(){t.off(r.default.PLAYBACK_STARTED,C,this),t.off(r.default.PLAYBACK_PAUSED,D,this),t.off(r.default.STREAMS_COMPOSED,M,this),t.off(r.default.INTERNAL_MANIFEST_LOADED,w,this),T()}},u=(0,a.default)(e).getInstance().getLogger(o),o}h.__dashjs_factory_name="ManifestUpdater",t.default=i.default.getClassFactory(h)}));t(vi);var yi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=d(_),r=d(f),i=d(g),a=d(Kn),s=d(u),o=d(p),l=d(xr);function d(e){return e&&e.__esModule?e:{default:e}}function c(){var e=this.context,t=(0,r.default)(e).getInstance(),s=(0,l.default)(e).getInstance(),u=void 0,d=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,y=void 0,E=void 0,_=void 0,T=void 0,b=void 0,S=void 0,A=void 0;function R(){m=[],y=[],E=null,_=null,b=null,T=NaN,c=!1,f=!1,S=h.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function I(){c||f||!b||!b.value||!b.schemeIdUri||isNaN(T)||isNaN(h.get().streaming.utcSynchronization.backgroundAttempts)||(_&&(Date.now()-_)/1e3<30||(m=[],f=!0,w(isNaN(h.get().streaming.utcSynchronization.backgroundAttempts)?2:h.get().streaming.utcSynchronization.backgroundAttempts)))}function w(e){try{if(e<=0)return void G();var t=Date.now();g[b.schemeIdUri](b.value,(function(n){var r=Date.now(),i=D(t,r,n);m.push(i),w(e-1)}),(function(){G()}))}catch(e){G()}}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||0;if(!y||0===y.length||t>=y.length)M();else{var n=y[t];if(n)if(g.hasOwnProperty(n.schemeIdUri)){var r=(new Date).getTime();g[n.schemeIdUri](n.value,(function(e){var t=(new Date).getTime(),i=D(r,t,e);b=n,M(i)}),(function(){C(t+1)}))}else C(t+1);else M()}}function D(e,t,n){return n-(t-(t-e)/2)}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=isNaN(e);t&&h.get().streaming.useManifestDateHeaderTimeSource?U():B(t,e)}function N(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t=void 0,n=void 0,r=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[4],10),parseInt(r[5],10),r[6]&&(parseInt(r[6],10)||0),r[7]&&1e3*parseFloat(r[7])||0),r[9]&&r[10]&&(n=60*parseInt(r[9],10)+parseInt(r[10],10),t+=("+"===r[8]?-1:1)*n*60*1e3),new Date(t).getTime()}(e)),t}function O(e){return Date.parse(e)}function P(e){return Date.parse(e)}function L(e,t,n){n()}function k(e,t,n){var r=N(e);isNaN(r)?n():t(r)}function x(e,t,n,r,i){var a,o,l=!1,u=new XMLHttpRequest,d=i?v.HTTPRequest.HEAD:v.HTTPRequest.GET,c=t.match(/\S+/g);if(t=c.shift(),a=function(){l||(l=!0,c.length?x(e,c.join(" "),n,r,i):r())},o=function(){var t=void 0,r=void 0;200===u.status&&(t=i?u.getResponseHeader("Date"):u.response,r=e(t),isNaN(r)||(n(r),l=!0))},s.isRelative(t)){var f=A.resolve();f&&(t=s.resolve(t,f.url))}u.open(d,t),u.timeout=5e3,u.onload=o,u.onloadend=a,u.send()}function F(e,t,n){x(P,e,t,n,!0)}function U(){var e=p.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;isNaN(t)?B(!0):B(!1,t-Date.now())}function B(e,r){if(isNaN(T)||isNaN(r)||e||function(e){try{var t=j(e),n=isNaN(S)?30:S,r=isNaN(h.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:h.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,i=isNaN(h.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:h.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,a=isNaN(h.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:h.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts,s=void 0;t?(s=Math.min(n*r,i),d.debug("Increasing timeBetweenSyncAttempts to "+s)):(s=Math.max(n/r,a),d.debug("Decreasing timeBetweenSyncAttempts to "+s)),S=s}catch(e){}}(r),!e&&!isNaN(r)){E=Date.now(),c=!1;var s=isNaN(T);T=r,s&&I(),d.debug("Completed UTC sync. Setting client - server offset to "+r)}e&&(b=null),t.trigger(i.default.UPDATE_TIME_SYNC_OFFSET,{offset:r,error:e?new n.default(a.default.TIME_SYNC_FAILED_ERROR_CODE,a.default.TIME_SYNC_FAILED_ERROR_MESSAGE):null}),t.trigger(i.default.TIME_SYNCHRONIZATION_COMPLETED)}function G(){if(m&&0!==m.length){var e=m.reduce((function(e,t){return e+t}),0)/m.length;j(e)?d.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(d.debug("Completed background UTC sync. Setting client - server offset to "+e),T=e,t.trigger(i.default.UPDATE_TIME_SYNC_OFFSET,{offset:T})),f=!1,_=Date.now()}}function j(e){try{if(isNaN(T))return!0;var t=h.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(h.get().streaming.utcSynchronization.maximumAllowedDrift)?h.get().streaming.utcSynchronization.maximumAllowedDrift:100;return e>=T-t&&e<=T+t}catch(e){return!0}}return u={initialize:function(){R(),g={"urn:mpeg:dash:utc:http-head:2014":F,"urn:mpeg:dash:utc:http-xsdate:2014":x.bind(null,N),"urn:mpeg:dash:utc:http-iso:2014":x.bind(null,O),"urn:mpeg:dash:utc:direct:2014":k,"urn:mpeg:dash:utc:http-head:2012":F,"urn:mpeg:dash:utc:http-xsdate:2012":x.bind(null,N),"urn:mpeg:dash:utc:http-iso:2012":x.bind(null,O),"urn:mpeg:dash:utc:direct:2012":k,"urn:mpeg:dash:utc:http-ntp:2014":L,"urn:mpeg:dash:utc:ntp:2014":L,"urn:mpeg:dash:utc:sntp:2014":L}},attemptSync:function(e){y=e,c||(!function(){try{var e=isNaN(S)?30:S;return!(E&&e&&!isNaN(e))||(Date.now()-E)/1e3>=e}catch(e){return!0}}()?t.trigger(i.default.TIME_SYNCHRONIZATION_COMPLETED):(c=!0,C()))},setConfig:function(e){e&&(e.dashMetrics&&(p=e.dashMetrics),e.baseURLController&&(A=e.baseURLController),e.settings&&(h=e.settings))},reset:function(){R(),t.off(i.default.ATTEMPT_BACKGROUND_SYNC,I,u)}},d=(0,o.default)(e).getInstance().getLogger(u),t.on(i.default.ATTEMPT_BACKGROUND_SYNC,I,u),u}c.__dashjs_factory_name="TimeSyncController";var h=s.default.getSingletonFactory(c);h.HTTP_TIMEOUT_MS=5e3,s.default.updateSingletonFactory(c.__dashjs_factory_name,h),t.default=h}));t(yi);var Ei=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(p);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e=void 0,t=void 0,n=this.context;return e={createMediaSource:function(){var e="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:e?new WebKitMediaSource:null},attachMediaSource:function(e,t){var n=window.URL.createObjectURL(e);return t.setSource(n),n},detachMediaSource:function(e){e.setSource(null)},setDuration:function e(n,r){n&&"open"===n.readyState&&(null===r&&isNaN(r)||n.duration!==r&&(!function(e){for(var t=e.sourceBuffers,n=0;n<t.length;n++)if(t[n].updating)return!0;return!1}(n)?(t.info("Set MediaSource duration:"+r),n.duration=r):setTimeout(e.bind(null,n,r),50)))},setSeekable:function(e,t,n){e&&"function"==typeof e.setLiveSeekableRange&&"function"==typeof e.clearLiveSeekableRange&&"open"===e.readyState&&t>=0&&t<n&&(e.clearLiveSeekableRange(),e.setLiveSeekableRange(t,n))},signalEndOfStream:function(e){if(e&&"open"===e.readyState){for(var n=e.sourceBuffers,r=0;r<n.length;r++){if(n[r].updating)return;if(0===n[r].buffered.length)return}t.info("call to mediaSource endOfStream"),e.endOfStream()}}},t=(0,r.default)(n).getInstance().getLogger(e),e}a.__dashjs_factory_name="MediaSourceController",t.default=n.default.getSingletonFactory(a)}));t(Ei);var _i=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(u),r=o(p),i=o(f),a=o(c),s=o(Gr);function o(e){return e&&e.__esModule?e:{default:e}}function l(){var e="urn:mpeg:dash:event:2012",t="discarded",n="updated",o="added",l=this.context,u=(0,i.default)(l).getInstance(),d=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0;function T(){if(!m||!v)throw new Error("setConfig function has to be called previously")}function b(){_=!1,f={},h={},g=null,E=!1,p=Date.now()/1e3}function S(){try{null!==g&&_&&(clearInterval(g),g=null,_=!1,function(){try{C(h),C(f)}catch(e){}}())}catch(e){throw e}}function A(e,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.eventStream.schemeIdUri,s=e.eventStream.value,l=e.id,u=t;r[a]||(r[a]=[]);var d=r[a].findIndex((function(e){return(!s||e.eventStream.value&&e.eventStream.value===s)&&e.id===l}));return-1===d?(r[a].push(e),u=o):i&&(r[a][d]=e,u=n),u}function R(e){try{if(1==e.eventStream.value){var t=e.calculatedPresentationTime,n=void 0;n=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,u.trigger(a.default.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:t,newDuration:n,newManifestValidAfter:NaN},{mode:a.default.EVENT_MODE_ON_START})}}catch(e){}}function I(){try{if(!E){E=!0;var e=v.getTime(),t=e-p;t=p>0?Math.max(0,t):0,w(h,t,e),w(f,t,e),p=e,E=!1}}catch(e){E=!1}}function w(e,t,n){try{D(e,(function(r){if(void 0!==r){var i=isNaN(r.duration)?0:r.duration;r.calculatedPresentationTime<=n&&r.calculatedPresentationTime+t+i>=n?M(r,e,a.default.EVENT_MODE_ON_START):(function(e,t,n){try{return e-t>n}catch(e){return!1}}(n,i+t,r.calculatedPresentationTime)||function(e){try{var t=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>t}catch(e){return!1}}(r))&&(c.debug("Deleting event "+r.id+" as it is expired or invalid"),N(e,r))}}))}catch(e){}}function C(e){try{var t=v.getTime();D(e,function(n){var r=n.eventStream&&n.eventStream.period&&!isNaN(n.eventStream.period.duration)?n.eventStream.period.duration:NaN,i=n.eventStream&&n.eventStream.period&&!isNaN(n.eventStream.period.start)?n.eventStream.period.start:NaN;if(!isNaN(r)&&!isNaN(i)){var s=n.calculatedPresentationTime;Math.abs(s-t)<300&&M(n,e,a.default.EVENT_MODE_ON_START)}}())}catch(e){}}function D(e,t){try{if(e)for(var n=Object.keys(e),r=0;r<n.length;r++){e[n[r]].forEach((function(e){void 0!==e&&t(e)}))}}catch(e){}}function M(t,n,r){try{var i=v.getTime(),o=t.id;if(r===a.default.EVENT_MODE_ON_RECEIVE)return c.debug("Received event "+o),void u.trigger(t.eventStream.schemeIdUri,{event:t},{mode:r});t.eventStream.schemeIdUri===e&&1===t.eventStream.value?0===t.duration&&0===t.presentationTimeDelta||(c.debug("Starting manifest refresh event "+o+" at "+i),N(n,t),function(){try{T(),m.refreshManifest()}catch(e){}}()):"urn:mpeg:dash:event:callback:2015"===t.eventStream.schemeIdUri&&1===t.eventStream.value?(c.debug("Starting callback event "+o+" at "+i),N(n,t),function(e){try{(0,s.default)(l).create({}).load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(e){throw e}}(t.messageData)):(c.debug("Starting event "+o+" at "+i),N(n,t),u.trigger(t.eventStream.schemeIdUri,{event:t},{mode:r}))}catch(e){}}function N(e,t){var n=t.eventStream.schemeIdUri,r=t.eventStream.value,i=t.id;e[n]=e[n].filter((function(e){return r&&e.eventStream.value&&e.eventStream.value!==r||e.id!==i})),0===e[n].length&&delete e[n]}return d={addInlineEvents:function(e){try{if(T(),e)for(var t=0;t<e.length;t++){var r=e[t],i=A(r,f,!0);i===o?(c.debug("Added inline event with id "+r.id),M(r,e,a.default.EVENT_MODE_ON_RECEIVE)):i===n&&c.debug("Updated inline event with id "+r.id)}c.debug("Added "+e.length+" inline events")}catch(e){throw e}},addInbandEvents:function(t){try{T();for(var n=0;n<t.length;n++){var r=t[n];A(r,h,!1)===o?(r.eventStream.schemeIdUri===e&&void 0===h[r.id]&&R(r),c.debug("Added inband event with id "+r.id),M(r,t,a.default.EVENT_MODE_ON_RECEIVE)):c.debug("Inband event with scheme_id_uri "+r.eventStream.schemeIdUri+", value "+r.eventStream.value+" and id "+r.id+" was ignored because it has been added before.")}I()}catch(e){throw e}},getInbandEvents:function(){return h},getInlineEvents:function(){return f},start:function(){try{T(),c.debug("Start Event Controller");var e=y.get().streaming.eventControllerRefreshDelay;_||isNaN(e)||(_=!0,g=setInterval(I,e))}catch(e){throw e}},setConfig:function(e){try{if(!e)return;e.manifestUpdater&&(m=e.manifestUpdater),e.playbackController&&(v=e.playbackController),e.settings&&(y=e.settings)}catch(e){throw e}},reset:function(){S(),b()}},c=(0,r.default)(l).getInstance().getLogger(d),b(),d}l.__dashjs_factory_name="EventController",t.default=n.default.getSingletonFactory(l)}));t(_i);var Ti=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=w(i),r=w(l),a=w(mi),s=w(vi),o=w(f),d=w(g),h=w(u),m=w(p),v=w(yr),y=w(xr),E=w(c),T=w(yi),b=w(Ei),S=w(_),A=w(Kn),R=w(_i),I=w(Wn);function w(e){return e&&e.__esModule?e:{default:e}}function C(){var e=this.context,t=(0,o.default)(e).getInstance(),i=void 0,l=void 0,u=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,_=void 0,w=void 0,C=void 0,D=void 0,M=void 0,N=void 0,O=void 0,P=void 0,L=void 0,k=void 0,x=void 0,F=void 0,U=void 0,B=void 0,G=void 0,j=void 0,H=void 0,q=void 0,K=void 0,Y=void 0,V=void 0,W=void 0,z=void 0,X=void 0,Q=void 0,$=void 0,Z=void 0,J=void 0,ee=void 0,te=void 0,ne=void 0,re=void 0;function ie(){if(Ie()){var e=W.getPlaybackQuality();e&&_.addDroppedFrames(e)}}function ae(e){var t=ge(e.seekTime);t===B&&te&&te.length>0&&te.forEach((function(e){e.deactivate(!0)})),t&&t!==B?(Ce(Fr.PlayListTrace.END_OF_PERIOD_STOP_REASON),ye(t,B,e.seekTime)):Ce(Fr.PlayListTrace.USER_REQUEST_STOP_REASON),De(Fr.PlayList.SEEK_START_REASON)}function se(e){var t=ve();Ce(Fr.PlayListTrace.END_OF_PERIOD_STOP_REASON),ye(t,B,e.seekTime),De(Fr.PlayList.SEEK_START_REASON)}function oe(){l.debug("[onPlaybackStarted]"),$?($=!1,De(Fr.PlayList.INITIAL_PLAYOUT_START_REASON)):Q&&(Q=!1,De(Fr.PlayList.RESUME_FROM_PAUSE_START_REASON))}function le(e){l.debug("[onPlaybackPaused]"),e.ended||(Q=!0,Ce(Fr.PlayListTrace.USER_REQUEST_STOP_REASON))}function ue(){Z&&(clearInterval(Z),Z=null)}function de(){J||(J=setInterval((function(){!function(){if(!B||!ce(B))return;var e=function(e){try{var t=e||(B||null);if(t){var n=t.getStreamInfo().start;return U.filter((function(e){return e.getStreamInfo().start>n}))}}catch(e){return[]}}(B),t=0,r=function(){var r=e[t],i=0===t?B:e[t-1];if(!r.getPreloadingScheduled()&&ce(i)&&V){var a=[n.default.VIDEO,n.default.AUDIO],s=!0;a.forEach((function(e){var t=p.getMediaInfoForType(r.getStreamInfo(),e);p.getVoRepresentations(t).forEach((function(e){var t=p.getIsDynamic(),n=F.calcSegmentAvailabilityRange(e,t);n.end<n.start&&(s=!1)}))})),s&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(V&&!e.getPreloaded()){he(e,t)&&(e.setPreloadingScheduled(!0),l.info("[onStreamCanLoadNext] Preloading next stream with id "+e.getId()),e.preload(V,ee),te.push(e),e.getProcessors().forEach((function(t){t.setBufferingTime(e.getStartTime())})))}}(r,i)}t+=1};for(;t<e.length;)r()}()}),500))}function ce(e){try{if(!e)return!1;var t=e.getProcessors().filter((function(e){return e.getType()===n.default.AUDIO||e.getType()===n.default.VIDEO}));if(!t||0===t.length)return!1;var r=t.filter((function(e){return!e.isBufferingCompleted()}));return r&&0===r.length}catch(e){return!1}}function fe(){var e=Ne().isLast;V&&e&&(l.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),w.signalEndOfStream(V))}function he(e,t){try{return re.get().streaming.reuseExistingSourceBuffers&&t.isProtectionCompatible(e,t)&&(ne||t.isMediaCodecCompatible(e,t))&&!function(e){try{var t=e.getStreamInfo(),r=p.getAdaptationForType(t.index,n.default.FRAGMENTED_TEXT,t);return!!r&&(-1!==r.codecs.indexOf("stpp")||-1!==r.codecs.indexOf("wvtt"))}catch(e){return!1}}(e)}catch(e){return!1}}function ge(e){if(isNaN(e))return null;var t=0,n=null,r=U.length;r>0&&(t+=U[0].getStartTime());for(var i=0;i<r;i++)if(n=U[i],e<(t=parseFloat((t+n.getDuration()).toFixed(5))))return n;return null}function pe(){return B?B.getProcessors():[]}function me(e){if(!B.getIsEndedEventSignaled()){B.setIsEndedEventSignaled(!0);var t=ve();t?(l.debug("StreamController onEnded, found next stream with id "+t.getStreamInfo().id),ye(t,B,NaN)):(l.debug("StreamController no next stream found"),B.setIsEndedEventSignaled(!1)),Ce(t?Fr.PlayListTrace.END_OF_PERIOD_STOP_REASON:Fr.PlayListTrace.END_OF_CONTENT_STOP_REASON)}e&&e.isLast&&ue()}function ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||(B||null);if(t){for(var n=t.getStreamInfo().start,r=t.getStreamInfo().duration,i=parseFloat((n+r).toFixed(5)),a=0,s=-1,o=NaN;a<U.length;){var l=U[a],u=l.getStreamInfo().start-i;u>=0&&(isNaN(o)||u<o)&&(o=u,s=a),a+=1}return s>=0?U[s]:null}return null}function ye(e,n,r){if(!(q||!e||n===e&&e.isActive())){q=!0,t.trigger(d.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:n?n.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});var i=!1;n&&(i=he(e,n),n.deactivate(i)),r=isNaN(r)?!i&&n?e.getStreamInfo().start:NaN:r,l.info("Switch to stream "+e.getId()+". Seektime is "+r+", current playback time is "+z.getTime()),l.info("Seamless period switch is set to "+i),B=e,te=te.filter((function(e){return e.getId()!==B.getId()})),z.initialize(Ne(),!!n,r),W.getElement()?Ee(r,null===n,!1,i):_e(r,i)}}function Ee(e,n,r,i){var a=void 0;function s(){V&&"open"===V.readyState&&(l.debug("MediaSource is open!"),window.URL.revokeObjectURL(a),V.removeEventListener("sourceopen",s),V.removeEventListener("webkitsourceopen",s),Te(),n||t.trigger(d.default.SOURCE_INITIALIZED),r?B.setMediaSource(V):_e(e,i))}V?i?(_e(e,i),n||t.trigger(d.default.SOURCE_INITIALIZED)):(w.detachMediaSource(W),V.addEventListener("sourceopen",s,!1),V.addEventListener("webkitsourceopen",s,!1),a=w.attachMediaSource(V,W),l.debug("MediaSource attached to element.  Waiting on open...")):((V=w.createMediaSource()).addEventListener("sourceopen",s,!1),V.addEventListener("webkitsourceopen",s,!1),a=w.attachMediaSource(V,W),l.debug("MediaSource attached to element.  Waiting on open..."))}function _e(e,n){if(ee=B.activate(V,n?ee:void 0)){var r=Object.keys(ee);r.length>0&&ee[r[0]].changeType&&(ne=!0)}$||isNaN(e)||(e===z.getTime()?t.trigger(d.default.SEEK_TARGET,{time:e},{streamId:B.getId()}):z.seek(e)),!H&&$||z.play(),q=!1,t.trigger(d.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Ne()})}function Te(e){var t=e||Ne().manifestInfo.duration;w.setDuration(V,t)}function be(e){for(var t=0,n=U.length;t<n;t++)if(U[t].getId()===e.id)return U[t];return null}function Se(){try{var r=p.getStreamsInfo();if(0===r.length)throw new Error("There are no streams");_.updateManifestUpdateInfo({currentTime:z.getTime(),buffered:W.getBufferRange(),presentationStartTime:r[0].start,clientTimeOffset:F.getClientTimeOffset()}),U.length>0&&(U=U.filter((function(e){var t=r.filter((function(t){return t.id===e.getId()})).length>0||e.getId()===B.getId();return t||l.debug("Removing stream "+e.getId()),t})));for(var i=0,s=r.length;i<s;i++){var o=r[i],h=be(o);h?h.updateData(o):(h=(0,a.default)(e).create({manifestModel:g,mediaPlayerModel:X,dashMetrics:_,manifestUpdater:f,adapter:p,timelineConverter:F,capabilities:u,capabilitiesFilter:c,errHandler:x,baseURLController:D,abrController:M,playbackController:z,eventController:O,mediaController:N,textController:P,protectionController:G,videoModel:W,streamInfo:o,settings:re}),U.push(h),h.initialize()),_.addManifestUpdateStreamInfo(o)}if(!B){if(p.getIsDynamic()&&U.length){var m=r[0].manifestInfo,v=function(e,t){try{var r=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){var i=e[0],a=[n.default.VIDEO,n.default.AUDIO,n.default.FRAGMENTED_TEXT].reduce((function(e,t){var n=p.getMediaInfoForType(i,t);return n&&e.push(n),e}),[]).reduce((function(e,t){var n=p.getVoRepresentations(t);return n&&n.length>0&&n.forEach((function(t){t&&e.push(t)})),e}),[]).reduce((function(e,t){var n=p.convertDataToRepresentationInfo(t);return n&&n.fragmentDuration&&!isNaN(n.fragmentDuration)&&e.push(n.fragmentDuration),e}),[]);r=Math.max.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(a))}return isFinite(r)?r:NaN}catch(e){return NaN}}(r,m);z.computeAndSetLiveDelay(v,m.DVRWindowSize,m.minBufferTime)}var y=null;!(y=ge(z.getStartTimeFromUriParameters(p.getIsDynamic())))&&p.getIsDynamic()&&U.length&&(l.debug("Dynamic stream: Trying to find the correct starting period"),y=function(){try{return ge(F.calcPresentationTimeFromWallTime(new Date,p.getRegularPeriods()[0])-z.getLiveDelay())}catch(e){return null}}()),ye(null!==y?y:U[0],null,NaN),Z||(Z=setInterval((function(){!q&&z.getTimeToStreamEnd()<=0&&t.trigger(d.default.PLAYBACK_ENDED,{isLast:Ne().isLast})}),200)),de()}t.trigger(d.default.STREAMS_COMPOSED)}catch(e){x.error(new S.default(A.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+"nostreamscomposed",g.getValue())),Y=!0,ke()}}function Ae(){var e=g.getValue();G&&(t.trigger(d.default.PROTECTION_CREATED,{controller:G,manifest:e}),G.setMediaElement(W.getElement()),j&&G.setProtectionData(j)),Se()}function Re(e){if(e.error)Y=!0,ke();else{var n=e.manifest;p.updatePeriods(n);var r=p.getUTCTimingSources();!p.getIsDynamic()||r&&0!==r.length||t.trigger(E.default.CONFORMANCE_VIOLATION,{level:I.default.LEVELS.WARNING,event:I.default.EVENTS.NO_UTC_TIMING_ELEMENT});var i=p.getIsDynamic()?r.concat(X.getUTCTimingSources()):r,a=k.isHTTPS(e.manifest.url);i.forEach((function(e){e.value.replace(/.*?:\/\//g,"")===X.getDefaultUtcTimingSource().value.replace(/.*?:\/\//g,"")&&(e.value=e.value.replace(a?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),a?"https://":"http://"),l.debug("Matching default timing source protocol to manifest protocol: ",e.value))})),D.initialize(n),C.attemptSync(i)}}function Ie(){return!!B&&B.getHasVideoTrack()}function we(){return!!B&&B.getHasAudioTrack()}function Ce(e,t){t=t||new Date,pe().forEach((function(n){n.finalisePlayList(t,e)})),_.addPlayList()}function De(e){_.createPlaylistMetrics(1e3*z.getTime(),e)}function Me(e){if(e.error){var t="";switch(e.error.code){case 1:t="MEDIA_ERR_ABORTED";break;case 2:t="MEDIA_ERR_NETWORK";break;case 3:t="MEDIA_ERR_DECODE";break;case 4:t="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:t="MEDIA_ERR_ENCRYPTED";break;default:t="UNKNOWN"}K=!0,e.error.message&&(t+=" ("+e.error.message+")"),e.error.msExtendedCode&&(t+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),l.fatal("Video Element Error: "+t),e.error&&l.fatal(e.error),x.error(new S.default(e.error.code,t)),ke()}}function Ne(){return B?B.getStreamInfo():null}function Oe(){if(!(h&&h.hasOwnProperty("load")&&F&&F.hasOwnProperty("initialize")&&F.hasOwnProperty("reset")&&F.hasOwnProperty("getClientTimeOffset")&&g&&x&&_&&z))throw new Error(n.default.MISSING_CONFIG_ERROR)}function Pe(e){isNaN(e.newDuration)||Te(e.newDuration)}function Le(){U=[],G=null,q=!1,B=null,K=!1,Y=!1,$=!0,Q=!1,H=!0,Z=null,J=null,te=[]}function ke(){Oe(),C.reset(),Ce(K||Y?Fr.PlayListTrace.FAILURE_STOP_REASON:Fr.PlayListTrace.USER_REQUEST_STOP_REASON);for(var e=0,n=U?U.length:0;e<n;e++){U[e].reset(K)}t.off(d.default.PLAYBACK_TIME_UPDATED,ie,i),t.off(d.default.PLAYBACK_SEEKING,ae,i),t.off(d.default.GAP_CAUSED_SEEK_TO_PERIOD_END,se,i),t.off(d.default.PLAYBACK_ERROR,Me,i),t.off(d.default.PLAYBACK_STARTED,oe,i),t.off(d.default.PLAYBACK_PAUSED,le,i),t.off(d.default.PLAYBACK_ENDED,me,i),t.off(d.default.MANIFEST_UPDATED,Re,i),t.off(d.default.STREAM_BUFFERING_COMPLETED,fe,i),t.off(d.default.MANIFEST_VALIDITY_CHANGED,Pe,i),t.off(d.default.TIME_SYNCHRONIZATION_COMPLETED,Ae,i),t.off(E.default.METRIC_ADDED,xe,i),D.reset(),f.reset(),O.reset(),_.clearAllCurrentMetrics(),g.setValue(null),h.reset(),F.reset(),L.reset(),V&&(w.detachMediaSource(W),V=null),W=null,G&&(G.setMediaElement(null),G=null,j=null,g.getValue()&&t.trigger(d.default.PROTECTION_DESTROYED,{data:g.getValue().url})),ue(),clearInterval(J),J=null,t.trigger(d.default.STREAM_TEARDOWN_COMPLETE),Le()}function xe(e){if(e.metric===r.default.DVR_INFO){var t=we()?n.default.AUDIO:n.default.VIDEO;e.mediaType===t&&w.setSeekable(V,e.value.range.start,e.value.range.end)}}return i={initialize:function(n,r){Oe(),H=n,j=r,F.initialize(),(f=(0,s.default)(e).create()).setConfig({manifestModel:g,adapter:p,manifestLoader:h,errHandler:x,settings:re}),f.initialize(),(O=(0,R.default)(e).getInstance()).setConfig({manifestUpdater:f,playbackController:z,settings:re}),O.start(),C.setConfig({dashMetrics:_,baseURLController:D,settings:re}),C.initialize(),t.on(d.default.PLAYBACK_TIME_UPDATED,ie,i),t.on(d.default.PLAYBACK_SEEKING,ae,i),t.on(d.default.GAP_CAUSED_SEEK_TO_PERIOD_END,se,i),t.on(d.default.PLAYBACK_ERROR,Me,i),t.on(d.default.PLAYBACK_STARTED,oe,i),t.on(d.default.PLAYBACK_PAUSED,le,i),t.on(d.default.PLAYBACK_ENDED,me,i,{priority:o.default.EVENT_PRIORITY_HIGH}),t.on(d.default.MANIFEST_UPDATED,Re,i),t.on(d.default.STREAM_BUFFERING_COMPLETED,fe,i),t.on(d.default.MANIFEST_VALIDITY_CHANGED,Pe,i),t.on(d.default.TIME_SYNCHRONIZATION_COMPLETED,Ae,i),t.on(E.default.METRIC_ADDED,xe,i)},getActiveStreamInfo:Ne,hasVideoTrack:Ie,hasAudioTrack:we,switchToVideoElement:function(e){B&&(z.initialize(Ne()),Ee(e,!1,!0,!1))},getStreamById:function(e){return U.filter((function(t){return t.getId()===e}))[0]},getStreamForTime:ge,getTimeRelativeToStreamId:function(e,t){for(var n=null,r=0,i=0,a=null,s=0;s<U.length;s++){if(i=(n=U[s]).getStartTime(),a=n.getDuration(),Number.isFinite(i)&&(r=i),n.getId()===t)return e-r;Number.isFinite(a)&&(r+=a)}return null},load:function(e){Oe(),h.load(e)},loadWithManifest:function(e){!function(){if(!f||!f.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}(),f.setManifest(e)},getActiveStreamProcessors:pe,setConfig:function(e){e&&(e.capabilities&&(u=e.capabilities),e.capabilitiesFilter&&(c=e.capabilitiesFilter),e.manifestLoader&&(h=e.manifestLoader),e.manifestModel&&(g=e.manifestModel),e.mediaPlayerModel&&(X=e.mediaPlayerModel),e.protectionController&&(G=e.protectionController),e.adapter&&(p=e.adapter),e.dashMetrics&&(_=e.dashMetrics),e.errHandler&&(x=e.errHandler),e.timelineConverter&&(F=e.timelineConverter),e.videoModel&&(W=e.videoModel),e.playbackController&&(z=e.playbackController),e.abrController&&(M=e.abrController),e.mediaController&&(N=e.mediaController),e.textController&&(P=e.textController),e.settings&&(re=e.settings),e.baseURLController&&(D=e.baseURLController))},setProtectionData:function(e){j=e},getIsStreamSwitchInProgress:function(){return q},getHasMediaOrIntialisationError:function(){return K||Y},hasStreamFinishedBuffering:ce,getStreams:function(){return U},getActiveStream:function(){return B},reset:ke},l=(0,m.default)(e).getInstance().getLogger(i),C=(0,T.default)(e).getInstance(),w=(0,b.default)(e).getInstance(),L=(0,v.default)(e).getInstance(),k=(0,y.default)(e).getInstance(),Le(),i}C.__dashjs_factory_name="StreamController",t.default=h.default.getSingletonFactory(C)}));t(Ti);var bi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(u),r=s(p),i=s(g),a=s(f);function s(e){return e&&e.__esModule?e:{default:e}}function o(){var e=this.context,t=(0,a.default)(e).getInstance(),n=void 0,s=void 0,o=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0;function m(){p.debug("Stopping the gap controller"),u&&(clearInterval(u),u=null),function(){t.off(i.default.WALLCLOCK_TIME_UPDATED,E,this),t.off(i.default.PLAYBACK_SEEKING,y,this),t.off(i.default.BYTES_APPENDED_END_FRAGMENT,v,n)}(),u=null,d=NaN,l=0,g=null}function v(){u||function(){try{u||(p.debug("Starting the gap controller"),u=setInterval((function(){_()&&b(c.getTime())}),100))}catch(e){}}()}function y(){g&&(clearTimeout(g),g=null)}function E(){if(_()&&++l>=30){var e=c.getTime();s===e?b(e,!0):(s=e,d=NaN),l=0}}function _(){return o.get().streaming.jumpGaps&&f.getActiveStreamProcessors().length>0&&(!c.isSeeking()||f.hasStreamFinishedBuffering(f.getActiveStream()))&&!c.isPaused()&&!f.getIsStreamSwitchInProgress()&&!f.getHasMediaOrIntialisationError()}function T(e,t){try{if(!e||e.length<=1&&t>0)return NaN;for(var n=NaN,r=0;isNaN(n)&&r<e.length;){var i=r>0?e.end(r-1):0;t<e.start(r)&&i-t<.1&&(n=r),r+=1}return n}catch(e){return null}}function b(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=o.get().streaming.smallGapLimit,a=o.get().streaming.jumpLargeGaps,s=h.getBufferRange(),l=void 0,u=NaN,f=!1;if(l=T(s,e),!isNaN(l)){var m=s.start(l),v=m-e;v>0&&(v<=r||a)&&(u=m)}var y=c.getTimeToStreamEnd();if(isNaN(u)&&n&&isFinite(y)&&!isNaN(y)&&y<r&&(u=parseFloat(c.getStreamEndTime().toFixed(5)),f=!0),u>0&&d!==u&&u>e&&!g){var E=u-e;if(f)p.warn("Jumping to end of stream because of gap from "+e+" to "+u+". Gap duration: "+E),t.trigger(i.default.GAP_CAUSED_SEEK_TO_PERIOD_END,{seekTime:u,duration:E});else{var _=c.getIsDynamic(),b=l>0?s.end(l-1):e,S=_?1e3*E:0;g=window.setTimeout((function(){c.seek(u,!0,!0),p.warn("Jumping gap starting at "+b+" and ending at "+u+". Jumping by: "+E),t.trigger(i.default.GAP_CAUSED_INTERNAL_SEEK,{seekTime:u,duration:E}),g=null}),S)}d=u}}return n={reset:m,setConfig:function(e){e&&(e.settings&&(o=e.settings),e.playbackController&&(c=e.playbackController),e.streamController&&(f=e.streamController),e.videoModel&&(h=e.videoModel),e.timelineConverter,e.adapter)},initialize:function(){!function(){t.on(i.default.WALLCLOCK_TIME_UPDATED,E,this),t.on(i.default.PLAYBACK_SEEKING,y,this),t.on(i.default.BYTES_APPENDED_END_FRAGMENT,v,n)}()}},p=(0,r.default)(e).getInstance().getLogger(n),m(),n}o.__dashjs_factory_name="GapController",t.default=n.default.getSingletonFactory(o)}));t(bi);var Si=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(i),r=l(g),a=l(f),s=l(u),o=l(p);function l(e){return e&&e.__esModule?e:{default:e}}function d(){var e=this.context,t=(0,a.default)(e).getInstance(),i=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=[n.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,n.default.TRACK_SWITCH_MODE_NEVER_REPLACE],h=[n.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE,n.default.TRACK_SELECTION_MODE_FIRST_TRACK,n.default.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY,n.default.TRACK_SELECTION_MODE_WIDEST_RANGE];function g(e,t){if(!e||!t)return[];var n=t.id;return l[n]&&l[n][e]?l[n][e].list:[]}function p(e,t){return!e||!t||t&&!l[t.id]?null:l[t.id][e].current}function m(e,i){if(e&&e.streamInfo){var a=e.type,s=e.streamInfo,o=s.id,u=p(a,s);if(l[o]&&l[o][a]&&!b(e,u)&&(l[o][a].current=e,!l[o][a].current||i&&a===n.default.FRAGMENTED_TEXT||t.trigger(r.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:u,newMediaInfo:e,switchMode:E(a)}),!i)){var d=function(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}(e);if(!d||!l[o][a].storeLastSettings)return;d.roles&&(d.role=d.roles[0],delete d.roles),d.accessibility&&(d.accessibility=d.accessibility[0]),d.audioChannelConfiguration&&(d.audioChannelConfiguration=d.audioChannelConfiguration[0]),c.setSavedMediaSettings(a,d)}}}function v(e,t){e&&t&&(d[e]=t)}function y(e){return e?d[e]:null}function E(e){return u.get().streaming.trackSwitchMode[e]}function _(){return u.get().streaming.selectionModeForInitialTrack}function T(e){return e===n.default.AUDIO||e===n.default.VIDEO||e===n.default.TEXT||e===n.default.FRAGMENTED_TEXT||e===n.default.IMAGE}function b(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var n=e.id===t.id,r=e.viewpoint===t.viewpoint,i=e.lang===t.lang,a=e.roles.toString()===t.roles.toString(),s=e.accessibility.toString()===t.accessibility.toString(),o=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&r&&i&&a&&s&&o}function S(){l={},d={audio:null,video:null,fragmentedText:null}}function A(e,t){var n=!e.lang||t.lang.match(e.lang),r=void 0===e.index||null===e.index||t.index===e.index,i=!e.viewpoint||e.viewpoint===t.viewpoint,a=!e.role||!!t.roles.filter((function(t){return t===e.role}))[0],s=!e.accessibility||!!t.accessibility.filter((function(t){return t===e.accessibility}))[0],o=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0];return n&&r&&i&&a&&s&&o}function R(e){var t=0,n=[],r=void 0;return e.forEach((function(e){(r=Math.max.apply(Math,e.bitrateList.map((function(e){return e.bandwidth}))))>t?(t=r,n=[e]):r===t&&n.push(e)})),n}function I(e){var t=1/0,n=[],r=void 0;return e.forEach((function(e){var i=e.bitrateList.reduce((function(e,t){var n=Math.max(1,t.width*t.height);return e+t.bandwidth/n}),0);(r=i/e.bitrateList.length)<t?(t=r,n=[e]):r===t&&n.push(e)})),n}function w(e){var t=0,n=[],r=void 0;return e.forEach((function(e){(r=e.representationCount)>t?(t=r,n=[e]):r===t&&n.push(e)})),n}return i={checkInitialMediaSettingsForType:function(e,t){var n=y(e),r=g(e,t),i=[];n||v(e,n=c.getSavedMediaSettings(e)),r&&0!==r.length&&(n&&r.forEach((function(e){A(n,e)&&i.push(e)})),0===i.length?m(this.selectInitialTrack(e,r),!0):i.length>1?m(this.selectInitialTrack(e,i)):m(i[0]))},addTrack:function(e){if(e){var t=e.type;if(T(t)){var n=e.streamInfo.id;l[n]||(l[n]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});for(var r=l[n][t].list,i=0,a=r.length;i<a;++i)if(b(r[i],e))return;r.push(e);var s=y(t);s&&A(s,e)&&!p(t,e.streamInfo)&&m(e)}}},getTracksFor:g,getCurrentTrackFor:p,isCurrentTrack:function(e){if(!e)return!1;var t=e.type,n=e.streamInfo.id;return l[n]&&l[n][t]&&b(l[n][t].current,e)},setTrack:m,setInitialSettings:v,getInitialSettings:y,setSwitchMode:function(e,t){if(s.warn("deprecated: Please use updateSettings({streaming: { trackSwitchMode: mode } }) instead"),-1!==f.indexOf(t)){var n={};n[e]=t,u.update({streaming:{trackSwitchMode:n}})}else s.warn("Track switch mode is not supported: "+t)},getSwitchMode:E,selectInitialTrack:function(e,t){if(e===n.default.FRAGMENTED_TEXT)return t[0];var r=_(),i=[];switch(r){case n.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE:(i=R(t)).length>1&&(i=w(i));break;case n.default.TRACK_SELECTION_MODE_FIRST_TRACK:i.push(t[0]);break;case n.default.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:(i=I(t)).length>1&&(i=R(i));break;case n.default.TRACK_SELECTION_MODE_WIDEST_RANGE:(i=w(t)).length>1&&(i=R(t));break;default:s.warn("Track selection mode is not supported: "+r)}return i[0]},getTracksWithHighestBitrate:R,getTracksWithHighestEfficiency:I,getTracksWithWidestRange:w,setSelectionModeForInitialTrack:function(e){s.warn("deprecated: Please use updateSettings({streaming: { selectionModeForInitialTrack: mode } }) instead"),-1!==h.indexOf(e)?u.update({streaming:{selectionModeForInitialTrack:e}}):s.warn("Track selection mode is not supported: "+e)},getSelectionModeForInitialTrack:_,isMultiTrackSupportedByType:T,isTracksEqual:b,matchSettings:A,saveTextSettingsDisabled:function(){c.setSavedMediaSettings(n.default.FRAGMENTED_TEXT,null)},setConfig:function(e){e&&(e.domStorage&&(c=e.domStorage),e.settings&&(u=e.settings))},reset:S},s=(0,o.default)(e).getInstance().getLogger(i),S(),i}d.__dashjs_factory_name="MediaController";var c=s.default.getSingletonFactory(d);s.default.updateSingletonFactory(d.__dashjs_factory_name,c),t.default=c}));t(Si);var Ai=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(ri),r=i(u);function i(e){return e&&e.__esModule?e:{default:e}}var a=NaN,s=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:t||null,selectedIdx:n||a},this.children=[]};function o(){var e,t=void 0,r=void 0,i=this.context,o=(0,n.default)(i).getInstance();function l(e,t,n){var i=r.getBaseURLsFromElement(n);e[t]?o.areEqual(i,e[t].data.baseUrls)||(e[t].data.baseUrls=i,e[t].data.selectedIdx=a):e[t]=new s(i)}function u(e){!function(){if(!r||!r.hasOwnProperty("getBaseURLsFromElement")||!r.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var n=r.getBaseURLsFromElement(e);o.areEqual(n,t.data.baseUrls)||(t.data.baseUrls=n,t.data.selectedIdx=a),e&&e.Period_asArray&&e.Period_asArray.forEach((function(e,n){l(t.children,n,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach((function(e,i){l(t.children[n].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(r.getRepresentationSortFunction()).forEach((function(e,r){l(t.children[n].children[i].children,r,e)}))}))}))}function d(e,n){var r=n||t;e(r.data),r.children&&r.children.forEach((function(t){return d(e,t)}))}function c(){t=new s}return e={reset:c,update:function(e){u(e)},getForPath:function(e){var n=t,r=[n.data];return e&&e.forEach((function(e){(n=n.children[e])&&r.push(n.data)})),r.filter((function(e){return e.baseUrls.length}))},invalidateSelectedIndexes:function(e){d((function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=a)}))},setConfig:function(e){e.adapter&&(r=e.adapter)}},c(),e}o.__dashjs_factory_name="BaseURLTreeModel",t.default=r.default.getClassFactory(o)}));t(Ai);var Ri=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(u),r=i(f);function i(e){return e&&e.__esModule?e:{default:e}}function a(e){e=e||{};var t=void 0,n=[],i=(0,r.default)(this.context).getInstance(),a=e.updateEventName,s=e.addBlacklistEventName;function o(e){-1===n.indexOf(e)&&(n.push(e),i.trigger(a,{entry:e}))}function l(e){o(e.entry)}return t={add:o,contains:function(e){return!!(n.length&&e&&e.length)&&-1!==n.indexOf(e)},reset:function(){n=[]}},s&&i.on(s,l,t),t}a.__dashjs_factory_name="BlackListController",t.default=n.default.getClassFactory(a)}));t(Ri);var Ii=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(e){var t=(e=e||{}).blacklistController;return{select:function(e){return e&&function(e){var t=0,n=[],r=0,i=void 0,a=void 0;if(a=e.sort((function(e,t){var n=e.dvb_priority-t.dvb_priority;return isNaN(n)?0:n})).filter((function(e,t,n){return!t||n[0].dvb_priority&&e.dvb_priority&&n[0].dvb_priority===e.dvb_priority})),a.length)return a.length>1&&(a.forEach((function(e){t+=e.dvb_weight,n.push(t)})),i=Math.floor(Math.random()*(t-1)),n.every((function(e,t){return r=t,!(i<e)}))),a[r]}((n=[],e.filter((function(e){return!t.contains(e.serviceLocation)||(e.dvb_priority&&n.push(e.dvb_priority),!1)})).filter((function(e){return!n.length||!e.dvb_priority||-1===n.indexOf(e.dvb_priority)}))));var n}}}i.__dashjs_factory_name="DVBSelector",t.default=r.default.getClassFactory(i)}));t(Ii);var wi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(e){var t=(e=e||{}).blacklistController;return{select:function(e){var n=0,r=void 0;return e&&e.some((function(e,r){return n=r,!t.contains(e.serviceLocation)}))&&(r=e[n]),r}}}i.__dashjs_factory_name="BasicSelector",t.default=r.default.getClassFactory(i)}));t(wi);var Ci=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(Kn),r=c(f),i=c(g),a=c(Ri),s=c(Ii),o=c(wi),l=c(u),d=c(_);function c(e){return e&&e.__esModule?e:{default:e}}function h(){var e,t=this.context,l=(0,r.default)(t).getInstance(),u=void 0,c=void 0,f=void 0,h=void 0;function g(){u.reset()}return e={chooseSelector:function(e){(0,w.checkParameterType)(e,"boolean"),h=e?f:c},select:function(e){if(e){var t=e.baseUrls,r=e.selectedIdx;if(!isNaN(r))return t[r];var a=h.select(t);return a?(e.selectedIdx=t.indexOf(a),a):(l.trigger(i.default.URL_RESOLUTION_FAILED,{error:new d.default(n.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,n.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(h===c&&g()))}},reset:g,setConfig:function(e){e.selector&&(h=e.selector)}},u=(0,a.default)(t).create({updateEventName:i.default.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:i.default.SERVICE_LOCATION_BLACKLIST_ADD}),c=(0,o.default)(t).create({blacklistController:u}),f=(0,s.default)(t).create({blacklistController:u}),h=c,e}h.__dashjs_factory_name="BaseURLSelector",t.default=l.default.getClassFactory(h)}));t(Ci);var Di=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=d(Ai),r=d(Ci),i=d(xr),a=d($r),s=d(u),o=d(f),l=d(g);function d(e){return e&&e.__esModule?e:{default:e}}function c(){var e=void 0,t=void 0,s=this.context,u=(0,o.default)(s).getInstance(),d=(0,i.default)(s).getInstance(),c=void 0,f=void 0;function h(e){c.invalidateSelectedIndexes(e.entry)}return e={reset:function(){c.reset(),f.reset()},initialize:function(e){var n;c.setConfig({adapter:t}),n=e,c.update(n),f.chooseSelector(t.getIsDVB(n))},resolve:function(e){var t=c.getForPath(e).reduce((function(e,t){var n=f.select(t);return n?(d.isRelative(n.url)?e.url=d.resolve(n.url,e.url):(e.url=n.url,e.serviceLocation=n.serviceLocation),e.availabilityTimeOffset=n.availabilityTimeOffset,e.availabilityTimeComplete=n.availabilityTimeComplete,e):new a.default}),new a.default);if(!d.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(c=e.baseURLTreeModel),e.baseURLSelector&&(f=e.baseURLSelector),e.adapter&&(t=e.adapter)}},c=(0,n.default)(s).create(),f=(0,r.default)(s).create(),u.on(l.default.SERVICE_LOCATION_BLACKLIST_CHANGED,h,e),e}c.__dashjs_factory_name="BaseURLController",t.default=s.default.getClassFactory(c)}));t(Di);var Mi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=r(i);function r(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.url=e||null,i.type=r||null,i.mediaType=n.default.STREAM,i.responseType="",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(r(y).default);t.default=a}));t(Mi);var Ni=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=d(_),r=d(di),i=d(Mi),a=d(f),s=d(g),o=d(u),l=d(Kn);function d(e){return e&&e.__esModule?e:{default:e}}function c(e){e=e||{};var t=this.context,o=(0,a.default)(t).getInstance(),u=(0,r.default)(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.settings?e.settings.get().streaming.lowLatencyEnabled:null,errors:l.default});return{load:function(e,t,r){var a=function(i,a){t.resolved=!0,t.resolvedContent=i||null,o.trigger(s.default.XLINK_ELEMENT_LOADED,{element:t,resolveObject:r,error:i||a?null:new n.default(l.default.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,l.default.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)a(null,!0);else{var d=new i.default(e,v.HTTPRequest.XLINK_EXPANSION_TYPE);u.load({request:d,success:function(e){a(e)},error:function(){a(null)}})}},reset:function(){u&&(u.abort(),u=null)}}}c.__dashjs_factory_name="XlinkLoader",t.default=o.default.getClassFactory(c)}));t(Ni);var Oi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e=e||{},function(){void 0===e.escapeMode&&(e.escapeMode=!0);void 0===e.attributePrefix&&(e.attributePrefix="_");e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0);e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0);void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0);e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1);e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1);void 0===e.ignoreRoot&&(e.ignoreRoot=!1)}();var t=1,n=3,r=4,i=8,a=9;function s(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function o(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function l(e,t,n,r){for(var i=0;i<e.length;i++){var a=e[i];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(t,n,r))break}return i!=e.length}function u(t,n,r){if("property"===e.arrayAccessForm)t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]];!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&l(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function d(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function c(n,r,i,a){return!(r==t&&e.xmlElementsFilter.length>0)||l(e.xmlElementsFilter,n,i,a)}function f(o,h){if(o.nodeType==a){for(var g=new Object,p=o.childNodes,m=0;m<p.length;m++){if((y=p[m]).nodeType==t)if(e.ignoreRoot)g=f(y);else(g={})[E=s(y)]=f(y)}return g}if(o.nodeType==t){(g=new Object).__cnt=0;var v=[];for(p=o.childNodes,m=0;m<p.length;m++){var y,E=s(y=p[m]);if(y.nodeType!=i){var _=h+"."+E;if(c(g,y.nodeType,E,_))if(g.__cnt++,null==g[E]){var T=f(y,_);if("#text"!=E||/[^\s]/.test(T))(b={})[E]=T,v.push(b);g[E]=T,u(g,E,_)}else{null!=g[E]&&(g[E]instanceof Array||(g[E]=[g[E]],u(g,E,_)));var b;T=f(y,_);if("#text"!=E||/[^\s]/.test(T))(b={})[E]=T,v.push(b);g[E][g[E].length]=T}}}g.__children=v;for(var S=s(o),A=0;A<o.attributes.length;A++){var R=o.attributes[A];g.__cnt++;for(var I=R.value,w=0,C=e.matchers.length;w<C;w++){var D=e.matchers[w];D.test(R,S)&&(I=D.converter(R.value))}g[e.attributePrefix+R.name]=I}var M=function(e){return e.prefix}(o);return null!=M&&""!=M&&(g.__cnt++,g.__prefix=M),null!=g["#text"]&&(g.__text=g["#text"],g.__text instanceof Array&&(g.__text=g.__text.join("\n")),e.stripWhitespaces&&(g.__text=g.__text.trim()),delete g["#text"],"property"==e.arrayAccessForm&&delete g["#text_asArray"],g.__text=function(t,n,r){if(e.datetimeAccessFormPaths.length>0){var i=r.split(".#")[0];return l(e.datetimeAccessFormPaths,t,n,i)?d(t):t}return t}(g.__text,E,h+"."+E)),null!=g["#cdata-section"]&&(g.__cdata=g["#cdata-section"],delete g["#cdata-section"],"property"==e.arrayAccessForm&&delete g["#cdata-section_asArray"]),0==g.__cnt&&"text"==e.emptyNodeForm?g="":1==g.__cnt&&null!=g.__text?g=g.__text:1!=g.__cnt||null==g.__cdata||e.keepCData?g.__cnt>1&&null!=g.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==g.__text||""==g.__text.trim())&&delete g.__text:g=g.__cdata,delete g.__cnt,!e.enableToStringFunc||null==g.__text&&null==g.__cdata||(g.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),g}if(o.nodeType==n||o.nodeType==r)return o.nodeValue}function h(t,n,r,i){var a="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+n;if(null!=r)for(var s=0;s<r.length;s++){var l=r[s],u=t[l];e.escapeMode&&(u=o(u)),a+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?a+='"'+u+'"':a+="'"+u+"'"}return a+=i?"/>":">"}function g(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function p(t,n){return"property"==e.arrayAccessForm&&(r=n.toString(),i="_asArray",-1!==r.indexOf(i,r.length-i.length))||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function;var r,i}function m(e){var t=0;if(e instanceof Object)for(var n in e)p(e,n)||t++;return t}function v(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||l(e.jsonPropertiesFilter,t,n,r)}function y(t){var n=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&n.push(r);return n}function E(t){var n="";return t instanceof Object?n+=function(t){var n="";return null!=t.__cdata&&(n+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?n+=o(t.__text):n+=t.__text),n}(t):null!=t&&(e.escapeMode?n+=o(t):n+=t),n}function _(e,t){return""===e?t:e+"."+t}function T(e,t,n,r){var i="";if(0==e.length)i+=h(e,t,n,!0);else for(var a=0;a<e.length;a++)i+=h(e[a],t,y(e[a]),!1),i+=b(e[a],_(r,t)),i+=g(e[a],t);return i}function b(e,t){var n="";if(m(e)>0)for(var r in e)if(!p(e,r)&&(""==t||v(e,r,_(t,r)))){var i=e[r],a=y(i);if(null==i||null==i)n+=h(i,r,a,!0);else if(i instanceof Object)if(i instanceof Array)n+=T(i,r,a,t);else if(i instanceof Date)n+=h(i,r,a,!1),n+=i.toISOString(),n+=g(i,r);else{m(i)>0||null!=i.__text||null!=i.__cdata?(n+=h(i,r,a,!1),n+=b(i,_(t,r)),n+=g(i,r)):n+=h(i,r,a,!0)}else n+=h(i,r,a,!1),n+=E(i),n+=g(i,r)}return n+=E(e)}this.parseXmlString=function(e){if(void 0===e)return null;var t;if(window.DOMParser){var n=new window.DOMParser;try{(t=n.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?d(e):e},this.xml2json=function(e){return f(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return b(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}}}));t(Oi);var Pi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(Ni),r=c(f),i=c(g),a=c(u),s=c(Oi),l=c(xr),d=c(o);function c(e){return e&&e.__esModule?e:{default:e}}var h="onLoad";function p(e){e=e||{};var t=this.context,a=(0,r.default)(t).getInstance(),o=(0,l.default)(t).getInstance(),u=void 0,c=void 0,f=void 0,g=void 0,p=void 0,m=void 0;function v(e,t,n){var r={},i=void 0,a=void 0;r.elements=e,r.type=t,r.resolveType=n,0===r.elements.length&&E(r);for(var s=0;s<r.elements.length;s++)i=r.elements[s],a=o.isHTTPURL(i.url)?i.url:i.originalContent.BaseURL+i.url,m.load(a,i,r)}function y(e){var t,n=void 0,r="";if(n=e.element,t=e.resolveObject,n.resolvedContent){var i=0;0===n.resolvedContent.indexOf("<?xml")&&(i=n.resolvedContent.indexOf("?>")+2),r=n.resolvedContent.substr(0,i)+"<response>"+n.resolvedContent.substr(i)+"</response>",n.resolvedContent=p.xml_str2json(r)}(function(e){var t=void 0;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(t)&&E(t)}function E(e){var t=[],n=void 0,r=void 0;if(function(e){var t=[],n=void 0,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0;for(a=e.elements.length-1;a>=0;a--){if(r=(n=e.elements[a]).type+"_asArray",n.resolvedContent){if(n.resolvedContent)for(s=0;s<n.resolvedContent[r].length;s++)i=n.resolvedContent[r][s],t.push(i)}else delete n.originalContent["xlink:actuate"],delete n.originalContent["xlink:href"],t.push(n.originalContent);for(n.parentElement[r].splice(n.index,1),o=0;o<t.length;o++)n.parentElement[r].splice(n.index+o,0,t[o]);t=[]}e.elements.length>0&&f.run(g)}(e),"onActuate"===e.resolveType&&a.trigger(i.default.XLINK_READY,{manifest:g}),e.resolveType===h)switch(e.type){case d.default.PERIOD:for(n=0;n<g[d.default.PERIOD+"_asArray"].length;n++)(r=g[d.default.PERIOD+"_asArray"][n]).hasOwnProperty(d.default.ADAPTATION_SET+"_asArray")&&(t=t.concat(_(r[d.default.ADAPTATION_SET+"_asArray"],r,d.default.ADAPTATION_SET,h))),r.hasOwnProperty(d.default.EVENT_STREAM+"_asArray")&&(t=t.concat(_(r[d.default.EVENT_STREAM+"_asArray"],r,d.default.EVENT_STREAM,h)));v(t,d.default.ADAPTATION_SET,h);break;case d.default.ADAPTATION_SET:a.trigger(i.default.XLINK_READY,{manifest:g})}}function _(e,t,n,r){var i=[],a=void 0,s=void 0,o=void 0;for(s=e.length-1;s>=0;s--)(a=e[s]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===a["xlink:href"]&&e.splice(s,1);for(s=0;s<e.length;s++)(a=e[s]).hasOwnProperty("xlink:href")&&a.hasOwnProperty("xlink:actuate")&&a["xlink:actuate"]===r&&(o=T(a["xlink:href"],t,n,s,r,a),i.push(o));return i}function T(e,t,n,r,i,a){return{url:e,parentElement:t,type:n,index:r,resolveType:i,originalContent:a,resolvedContent:null,resolved:!1}}return u={resolveManifestOnLoad:function(e){p=new s.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:c}),(g=e).Period_asArray?v(_(g.Period_asArray,g,d.default.PERIOD,h),d.default.PERIOD,h):a.trigger(i.default.XLINK_READY,{manifest:g})},setMatchers:function(e){e&&(c=e)},setIron:function(e){e&&(f=e)},reset:function(){a.off(i.default.XLINK_ELEMENT_LOADED,y,u),m&&(m.reset(),m=null)}},a.on(i.default.XLINK_ELEMENT_LOADED,y,u),m=(0,n.default)(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),u}p.__dashjs_factory_name="XlinkController",t.default=a.default.getClassFactory(p)}));t(Pi);var Li=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(n=u)&&n.__esModule?n:{default:n};function a(e){function t(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function n(e,n,i){for(var a=0,s=e.length;a<s;++a){var o=e[a];if(n[o.name])if(i[o.name]){if(o.merge){var l=n[o.name],u=i[o.name];"object"===(void 0===l?"undefined":r(l))&&"object"===(void 0===u?"undefined":r(u))?t(l,u):i[o.name]=l+u}}else i[o.name]=n[o.name]}}function i(e,t){for(var r=0,a=e.children.length;r<a;++r){var s=e.children[r],o=t[s.name+"_asArray"];if(o)for(var l=0,u=o.length;l<u;++l){var d=o[l];n(e.properties,t,d),i(s,d)}}}return{run:function(t){if(null===t||"object"!==(void 0===t?"undefined":r(t)))return t;if(t.Period_asArray&&"period"in e)for(var n=e.period,a=t.Period_asArray,s=0,o=a.length;s<o;++s){var l=a[s];if(i(n,l),"adaptationset"in e){var u=l.AdaptationSet_asArray;if(u)for(var d=e.adaptationset,c=0,f=u.length;c<f;++c)i(d,u[c])}}return t}}}a.__dashjs_factory_name="ObjectIron";var s=i.default.getClassFactory(a);t.default=s}));t(Li);var ki=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=t,this._converter=n}return n(e,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),e}();t.default=r}));t(ki);var xi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(ki),r=i(o);function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(function(e,t){var n,i=(a(n={},r.default.MPD,[r.default.ID,r.default.PROFILES]),a(n,r.default.PERIOD,[r.default.ID]),a(n,r.default.BASE_URL,[r.default.SERVICE_LOCATION,r.default.BYTE_RANGE]),a(n,r.default.SEGMENT_BASE,[r.default.INDEX_RANGE]),a(n,r.default.INITIALIZATION,[r.default.RANGE]),a(n,r.default.REPRESENTATION_INDEX,[r.default.RANGE]),a(n,r.default.SEGMENT_LIST,[r.default.INDEX_RANGE]),a(n,r.default.BITSTREAM_SWITCHING,[r.default.RANGE]),a(n,r.default.SEGMENT_URL,[r.default.MEDIA_RANGE,r.default.INDEX_RANGE]),a(n,r.default.SEGMENT_TEMPLATE,[r.default.INDEX_RANGE,r.default.MEDIA,r.default.INDEX,r.default.INITIALIZATION_MINUS,r.default.BITSTREAM_SWITCHING_MINUS]),a(n,r.default.ASSET_IDENTIFIER,[r.default.VALUE,r.default.ID]),a(n,r.default.EVENT_STREAM,[r.default.VALUE]),a(n,r.default.ADAPTATION_SET,[r.default.PROFILES,r.default.MIME_TYPE,r.default.SEGMENT_PROFILES,r.default.CODECS,r.default.CONTENT_TYPE]),a(n,r.default.FRAME_PACKING,[r.default.VALUE,r.default.ID]),a(n,r.default.AUDIO_CHANNEL_CONFIGURATION,[r.default.VALUE,r.default.ID]),a(n,r.default.CONTENT_PROTECTION,[r.default.VALUE,r.default.ID]),a(n,r.default.ESSENTIAL_PROPERTY,[r.default.VALUE,r.default.ID]),a(n,r.default.SUPPLEMENTAL_PROPERTY,[r.default.VALUE,r.default.ID]),a(n,r.default.INBAND_EVENT_STREAM,[r.default.VALUE,r.default.ID]),a(n,r.default.ACCESSIBILITY,[r.default.VALUE,r.default.ID]),a(n,r.default.ROLE,[r.default.VALUE,r.default.ID]),a(n,r.default.RATING,[r.default.VALUE,r.default.ID]),a(n,r.default.VIEWPOINT,[r.default.VALUE,r.default.ID]),a(n,r.default.CONTENT_COMPONENT,[r.default.CONTENT_TYPE]),a(n,r.default.REPRESENTATION,[r.default.ID,r.default.DEPENDENCY_ID,r.default.MEDIA_STREAM_STRUCTURE_ID]),a(n,r.default.SUBSET,[r.default.ID]),a(n,r.default.METRICS,[r.default.METRICS_MINUS]),a(n,r.default.REPORTING,[r.default.VALUE,r.default.ID]),n);if(i.hasOwnProperty(t)){var s=i[t];return void 0!==s&&s.indexOf(e.name)>=0}return!1}),(function(e){return String(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.default);t.default=s}));t(xi);var Fi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(ki),r=s(i),a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}var l=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(function(e){for(var t=[a.default.MIN_BUFFER_TIME,a.default.MEDIA_PRESENTATION_DURATION,a.default.MINIMUM_UPDATE_PERIOD,a.default.TIMESHIFT_BUFFER_DEPTH,a.default.MAX_SEGMENT_DURATION,a.default.MAX_SUBSEGMENT_DURATION,a.default.SUGGESTED_PRESENTATION_DELAY,a.default.START,r.default.START_TIME,a.default.DURATION],n=t.length,i=0;i<n;i++)if(e.nodeName===t[i])return l.test(e.value);return!1}),(function(e){var t=l.exec(e),n=31536e3*parseFloat(t[3]||0)+2592e3*parseFloat(t[5]||0)+86400*parseFloat(t[7]||0)+3600*parseFloat(t[9]||0)+60*parseFloat(t[11]||0)+parseFloat(t[13]||0);return void 0!==t[1]&&(n=-n),n})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.default);t.default=u}));t(Fi);var Ui=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=ki)&&n.__esModule?n:{default:n};var i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(function(e){return i.test(e.value)}),(function(e){var t=i.exec(e),n=void 0;if(n=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),t[6]&&parseInt(t[6],10)||0,t[7]&&1e3*parseFloat(t[7])||0),t[9]&&t[10]){var r=60*parseInt(t[9],10)+parseInt(t[10],10);n+=("+"===t[8]?-1:1)*r*60*1e3}return new Date(n)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(r.default);t.default=a}));t(Ui);var Bi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=ki)&&n.__esModule?n:{default:n};var i=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(function(e){return i.test(e.value)}),(function(e){return parseFloat(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(r.default);t.default=a}));t(Bi);var Gi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this._name=t,this._merge=function(e){return e&&e.length&&e.charAt(0)===e.charAt(0).toUpperCase()}(t)}return n(e,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),e}();t.default=r}));t(Gi);var ji=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n=Gi)&&n.__esModule?n:{default:n};var a=function(){function e(t,n,r){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t||"",this._properties=[],this._children=r||[],Array.isArray(n)&&n.forEach((function(e){a._properties.push(new i.default(e))}))}return r(e,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),e}();t.default=a}));t(ji);var Hi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(ji),r=i(o);function i(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=[r.default.PROFILES,r.default.WIDTH,r.default.HEIGHT,r.default.SAR,r.default.FRAMERATE,r.default.AUDIO_SAMPLING_RATE,r.default.MIME_TYPE,r.default.SEGMENT_PROFILES,r.default.CODECS,r.default.MAXIMUM_SAP_PERIOD,r.default.START_WITH_SAP,r.default.MAX_PLAYOUT_RATE,r.default.CODING_DEPENDENCY,r.default.SCAN_TYPE,r.default.FRAME_PACKING,r.default.AUDIO_CHANNEL_CONFIGURATION,r.default.CONTENT_PROTECTION,r.default.ESSENTIAL_PROPERTY,r.default.SUPPLEMENTAL_PROPERTY,r.default.INBAND_EVENT_STREAM];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r.default.ADAPTATION_SET,e,[new n.default(r.default.REPRESENTATION,e,[new n.default(r.default.SUB_REPRESENTATION,e)])]))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.default);t.default=a}));t(Hi);var qi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(ji),r=i(o);function i(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=[r.default.SEGMENT_BASE,r.default.SEGMENT_TEMPLATE,r.default.SEGMENT_LIST];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r.default.PERIOD,e,[new n.default(r.default.ADAPTATION_SET,e,[new n.default(r.default.REPRESENTATION,e)])]))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.default);t.default=a}));t(qi);var Ki=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f(u),r=f(Li),i=f(Oi),a=f(xi),s=f(Fi),o=f(Ui),l=f(Bi),d=f(Hi),c=f(qi);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){e=e||{};var t=this.context,n=e.debug,u=void 0,f=void 0,h=void 0,g=void 0,p=void 0;return u={parse:function(e){var t=void 0,n=window.performance.now();if(!(t=g.xml_str2json(e)))throw new Error("parsing the manifest failed");var r=window.performance.now();t.Patch?((t=t.Patch).add_asArray&&t.add_asArray.forEach((function(e){return p.run(e)})),t.replace_asArray&&t.replace_asArray.forEach((function(e){return p.run(e)}))):(t=t.MPD,p.run(t));var i=window.performance.now();return f.info("Parsing complete: ( xml2json: "+(r-n).toPrecision(3)+"ms, objectiron: "+(i-r).toPrecision(3)+"ms, total: "+((i-n)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t},getMatchers:function(){return h},getIron:function(){return p}},f=n.getLogger(u),h=[new s.default,new o.default,new l.default,new a.default],g=new i.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:h}),p=(0,r.default)(t).create({adaptationset:new d.default,period:new c.default}),u}h.__dashjs_factory_name="DashParser",t.default=n.default.getClassFactory(h)}));t(Ki);var Yi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=T(i),r=T(o),a=T(Pi),s=T(di),l=T(xr),d=T(Mi),c=T(_),h=T(f),p=T(g),m=T(Kn),y=T(u),E=T(Ki);function T(e){return e&&e.__esModule?e:{default:e}}function b(e){e=e||{};var t=this.context,i=e.debug,o=(0,h.default)(t).getInstance(),u=(0,l.default)(t).getInstance(),f=void 0,g=void 0,y=void 0,_=void 0,T=void 0,b=e.mssHandler,S=e.errHandler;function A(e){o.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}return f={load:function(e){var r=new d.default(e,v.HTTPRequest.MPD_TYPE);y.load({request:r,success:function(r,a,s){if(_){var l=void 0,d=void 0,f=void 0;if(s&&s!==e?(d=u.parseBaseUrl(s),l=s):(u.isRelative(e)&&(e=u.resolve(e,window.location.href)),d=u.parseBaseUrl(e)),"No Content"!=a)if(null===T&&(T=function(e){var n=null;return e.indexOf("SmoothStreamingMedia")>-1?(b&&(n=b.createMssParser(),b.registerEvents()),n):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?(0,E.default)(t).create({debug:i}):n}(r)),null!==T){_.setMatchers(T.getMatchers()),_.setIron(T.getIron());try{f=T.parse(r)}catch(t){return void o.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(m.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,m.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+e)})}f?(f.url=l||e,f.originalUrl||(f.originalUrl=f.url),f.hasOwnProperty(n.default.LOCATION)&&(d=u.parseBaseUrl(f.Location_asArray[0]),g.debug("BaseURI set by Location to: "+d)),f.baseUri=d,f.loadedTime=new Date,_.resolveManifestOnLoad(f),o.trigger(p.default.ORIGINAL_MANIFEST_LOADED,{originalManifest:r})):o.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(m.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,m.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+e)})}else o.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(m.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,m.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+e)});else o.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null})}},error:function(t,n,r){o.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(m.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,m.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+(e+", ")+r)})}})},reset:function(){o.off(p.default.XLINK_READY,A,f),b&&b.reset(),_&&(_.reset(),_=null),y&&(y.abort(),y=null)}},g=i.getLogger(f),o.on(p.default.XLINK_READY,A,f),y=(0,s.default)(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.settings.get().streaming.lowLatencyEnabled,urlUtils:u,constants:n.default,dashConstants:r.default,errors:m.default}),_=(0,a.default)(t).create({errHandler:S,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),T=null,f}b.__dashjs_factory_name="ManifestLoader";var S=y.default.getClassFactory(b);t.default=S}));t(Yi);var Vi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(f),r=a(g),i=a(u);function a(e){return e&&e.__esModule?e:{default:e}}function s(){var e=this.context,t=(0,n.default)(e).getInstance();return{error:function(e){t.trigger(r.default.ERROR,{error:e})}}}s.__dashjs_factory_name="ErrorHandler",t.default=i.default.getSingletonFactory(s)}));t(Vi);var Wi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.supportsMediaSource=a;var n,r=(n=u)&&n.__esModule?n:{default:n};var i=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function a(){var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t}function s(){var e,t=void 0;return e={supportsMediaSource:a,supportsEncryptedMedia:function(){return t},supportsCodec:function(e){return!(!("MediaSource"in window)||!MediaSource.isTypeSupported(e))||!(!("WebKitMediaSource"in window)||!WebKitMediaSource.isTypeSupported(e))},setEncryptedMediaSupported:function(e){t=e},supportsEssentialProperty:function(e){try{return-1!==ai.THUMBNAILS_SCHEME_ID_URIS.indexOf(e.schemeIdUri)}catch(e){return!0}},codecRootCompatibleWithCodec:function(e,t){for(var n=e.split(".")[0],r=0===t.indexOf(n),a=void 0,s=0;s<i.length;s++)if(i[s].codec===n){a=i[s];break}return a?r||a.compatibleCodecs.some((function(e){return 0===t.indexOf(e)})):r}},t=!1,e}s.__dashjs_factory_name="Capabilities",t.default=r.default.getSingletonFactory(s)}));t(Wi),Wi.supportsMediaSource;var zi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(u),r=s(p),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}function o(){var e=this.context,t=void 0,n=void 0,i=void 0,s=void 0,o=void 0,l=void 0;function u(e,t){var r=n.getRealPeriodByIndex(t?t.index:null);r&&r.AdaptationSet_asArray&&0!==r.AdaptationSet_asArray.length&&(r.AdaptationSet_asArray=r.AdaptationSet_asArray.filter((function(t){return!t.Representation_asArray||0===t.Representation_asArray.length||!n.getIsTypeOf(t,e)||(t.Representation_asArray=t.Representation_asArray.filter((function(e,r){var a=n.getCodec(t,r,!0);return!!i.supportsCodec(a)||(o.error("[Stream] codec not supported: "+a),!1)})),t.Representation_asArray&&t.Representation_asArray.length>0)})))}return t={setConfig:function(e){e&&(e.adapter&&(n=e.adapter),e.capabilities&&(i=e.capabilities),e.settings&&(s=e.settings))},filterUnsupportedFeaturesOfPeriod:function(e){u(a.default.VIDEO,e),u(a.default.AUDIO,e),s.get().streaming.filterUnsupportedEssentialProperties&&function(e){var t=n.getRealPeriodByIndex(e?e.index:null);if(!t||!t.AdaptationSet_asArray||0===t.AdaptationSet_asArray.length)return;t.AdaptationSet_asArray=t.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){var t=n.getEssentialPropertiesForRepresentation(e);if(t&&t.length>0)for(var r=0;r<t.length;){if(!i.supportsEssentialProperty(t[r]))return o.debug("[Stream] EssentialProperty not supported: "+t[r].schemeIdUri),!1;r+=1}return!0})),e.Representation_asArray&&e.Representation_asArray.length>0)}))}(e),function(e){if(!l||0===l.length)return;var t=n.getRealPeriodByIndex(e?e.index:null);if(!t||!t.AdaptationSet_asArray||0===t.AdaptationSet_asArray.length)return;t.AdaptationSet_asArray=t.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){return!l.some((function(t){return!t(e)}))})),e.Representation_asArray&&e.Representation_asArray.length>0)}))}(e)},setCustomCapabilitiesFilters:function(e){l=e}},o=(0,r.default)(e).getInstance().getLogger(t),t}o.__dashjs_factory_name="CapabilitiesFilter",t.default=n.default.getSingletonFactory(o)}));t(zi);var Xi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null}}));t(Xi);var Qi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(Xi),r=i(u);function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e=void 0;return{initialize:function(t){if(e=new n.default,!t)return null;var r=t.indexOf("#");if(-1!==r)for(var i=t.substr(r+1).split("&"),a=0,s=i.length;a<s;++a){var o=i[a],l=o.indexOf("=");if(-1!==l){var u=o.substring(0,l);e.hasOwnProperty(u)&&(e[u]=o.substr(l+1))}}},getURIFragmentData:function(){return e}}}a.__dashjs_factory_name="URIFragmentModel",t.default=r.default.getSingletonFactory(a)}));t(Qi);var $i=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(f),r=a(g),i=a(u);function a(e){return e&&e.__esModule?e:{default:e}}function s(){var e=this.context,t=(0,n.default)(e).getInstance(),i=void 0;return{getValue:function(){return i},setValue:function(e){i=e,e&&t.trigger(r.default.MANIFEST_LOADED,{data:e})}}}s.__dashjs_factory_name="ManifestModel",t.default=i.default.getSingletonFactory(s)}));t($i);var Zi=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(Xr),r=l(u),a=l(i),s=l(cr),o=l(Hr);function l(e){return e&&e.__esModule?e:{default:e}}function d(){var e,t=void 0,r=void 0,i=void 0,l=this.context,u=(0,o.default)(l).getInstance();function d(e){var t=void 0;for(t=0;t<i.length;t++)if(i[t].rulename===e)return t;return-1}function c(){return u.get().streaming.lowLatencyEnabled?u.get().streaming.liveDelay||3:u.get().streaming.liveDelay}function f(e,r){h(e,r);var i=new n.default;i.schemeIdUri=e,i.value=r,t.push(i)}function h(e,n){(0,w.checkParameterType)(e,"string"),(0,w.checkParameterType)(n,"string"),t.forEach((function(r,i){r.schemeIdUri===e&&r.value===n&&t.splice(i,1)}))}return e={getABRCustomRules:function(){return i},addABRCustomRule:function(e,t,n){if("string"!=typeof e||e!==s.default.ABANDON_FRAGMENT_RULES&&e!==s.default.QUALITY_SWITCH_RULES||"string"!=typeof t)throw a.default.BAD_ARGUMENT_ERROR;var r=d(t);-1===r?i.push({type:e,rulename:t,rule:n}):(i[r].type=e,i[r].rule=n)},removeABRCustomRule:function(e){if(e){var t=d(e);-1!==t&&i.splice(t,1)}else i=[]},getStableBufferTime:function(){if(u.get().streaming.lowLatencyEnabled)return.6*c();var e=u.get().streaming.stableBufferTime;return e>-1?e:u.get().streaming.fastSwitchEnabled?20:12},getRetryAttemptsForType:function(e){var t=isNaN(u.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:u.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return u.get().streaming.lowLatencyEnabled?u.get().streaming.retryAttempts[e]*t:u.get().streaming.retryAttempts[e]},getRetryIntervalsForType:function(e){var t=isNaN(u.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:u.get().streaming.retryIntervals.lowLatencyReductionFactor;return u.get().streaming.lowLatencyEnabled?u.get().streaming.retryIntervals[e]/t:u.get().streaming.retryIntervals[e]},getLiveDelay:c,getLiveCatchupLatencyThreshold:function(){try{var e=u.get().streaming.liveCatchup.latencyThreshold,t=c();if(null!==e&&!isNaN(e))return Math.max(e,t);var n=u.get().streaming.liveCatchup.minDrift,r=!isNaN(t)&&t?isNaN(n)?c():u.get().streaming.liveCatchup.minDrift+c():NaN;return r&&!isNaN(r)?Math.max(4*r,5):NaN}catch(e){return NaN}},addUTCTimingSource:f,removeUTCTimingSource:h,getUTCTimingSources:function(){return t},clearDefaultUTCTimingSources:function(){t=[]},restoreDefaultUTCTimingSources:function(){var e=u.get().streaming.utcSynchronization.defaultTimingSource;f(e.scheme,e.value)},setXHRWithCredentialsForType:function e(t,n){t?r[t]=!!n:Object.keys(r).forEach((function(t){e(t,n)}))},getXHRWithCredentialsForType:function(e){var t=r[e];return void 0===t?r.default:t},getDefaultUtcTimingSource:function(){return u.get().streaming.utcSynchronization.defaultTimingSource},reset:function(){}},t=[],r={default:!1},i=[],e}d.__dashjs_factory_name="MediaPlayerModel",t.default=r.default.getSingletonFactory(d)}));t(Zi);var Ji=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(u),r=s(f),i=s(g),a=s(p);function s(e){return e&&e.__esModule?e:{default:e}}function o(){var e=void 0,t=void 0,n=void 0,s=void 0,o=void 0,l=this.context,u=(0,r.default)(l).getInstance(),d=[];function c(){n&&(n.playbackRate=o||1,n.removeEventListener("canplay",c))}function f(e){n&&(n.readyState<=2&&e>0?n.addEventListener("canplay",c):n.playbackRate=e)}function h(){return d.length>0}function g(e){var t=d.indexOf(e),r=void 0;null!==e&&(-1!==t&&d.splice(t,1),n&&!1===h()&&0===n.playbackRate&&(f(o||1),n.paused||((r=document.createEvent("Event")).initEvent("playing",!0,!1),n.dispatchEvent(r))))}function p(){if(n&&h()&&0===n.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),n.dispatchEvent(e)}}function m(){return n?n.buffered:null}function v(e,t,r,i,a){if(n)for(var s=0;s<n.textTracks.length;s++)if(n.textTracks[s].kind===e&&(!t||n.textTracks[s].label==t)&&n.textTracks[s].language===r&&n.textTracks[s].isTTML===i&&n.textTracks[s].isEmbedded===a)return n.textTracks[s];return null}return e={initialize:function(){u.on(i.default.PLAYBACK_PLAYING,p,this)},setCurrentTime:function(e,t){if(n){if(n.currentTime==e)return;try{e=t?function(e){var t=m(),n=e,r=9999999999;if(t)for(var i=0;i<t.length;i++){var a=t.start(i),s=t.end(i),o=Math.abs(a-e),l=Math.abs(s-e);if(e>=a&&e<=s)return e;o<r&&(r=o,n=a),l<r&&(r=l,n=s)}return n}(e):e,n.currentTime=e}catch(t){0===n.readyState&&t.code===t.INVALID_STATE_ERR&&setTimeout((function(){n.currentTime=e}),400)}}},play:function(){if(n){n.autoplay=!0;var e=n.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch((function(e){"NotAllowedError"===e.name&&u.trigger(i.default.PLAYBACK_NOT_ALLOWED),t.warn("Caught pending play exception - continuing ("+e+")")}))}},isPaused:function(){return n?n.paused:null},pause:function(){n&&(n.pause(),n.autoplay=!1)},isStalled:h,isSeeking:function(){return n?n.seeking:null},getTime:function(){return n?n.currentTime:null},getPlaybackRate:function(){return n?n.playbackRate:null},setPlaybackRate:f,getPlayedRanges:function(){return n?n.played:null},getEnded:function(){return n?n.ended:null},setStallState:function(e,t){!function(e,t){t?function(e){var t=void 0;if(null===e||!n||n.seeking||-1!==d.indexOf(e))return;d.push(e),n&&1===d.length&&((t=document.createEvent("Event")).initEvent("waiting",!0,!1),o=n.playbackRate,f(0),n.dispatchEvent(t))}(e):g(e)}(e,t)},getElement:function(){return n},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw"element is not video or audio DOM type!";(n=e)&&(n.preload="auto")},setSource:function(e){n&&(e?n.src=e:(n.removeAttribute("src"),n.load()))},getSource:function(){return n?n.src:null},getTTMLRenderingDiv:function(){return s},setTTMLRenderingDiv:function(e){(s=e).style.position="absolute",s.style.display="flex",s.style.overflow="hidden",s.style.pointerEvents="none",s.style.top=0,s.style.left=0},getPlaybackQuality:function(){if(!n)return null;var e="webkitDroppedFrameCount"in n&&"webkitDecodedFrameCount"in n,t=null;return"getVideoPlaybackQuality"in n?t=n.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:n.webkitDroppedFrameCount,totalVideoFrames:n.webkitDroppedFrameCount+n.webkitDecodedFrameCount,creationTime:new Date}),t},addEventListener:function(e,t){n&&n.addEventListener(e,t)},removeEventListener:function(e,t){n&&n.removeEventListener(e,t)},getReadyState:function(){return n?n.readyState:NaN},getBufferRange:m,getClientWidth:function(){return n?n.clientWidth:NaN},getClientHeight:function(){return n?n.clientHeight:NaN},getTextTracks:function(){return n?n.textTracks:[]},getTextTrack:v,addTextTrack:function(e,t,r,i,a){if(!n)return null;var s=v(e,t,r,i,a);return s||((s=n.addTextTrack(e,t,r)).isEmbedded=a,s.isTTML=i),s},appendChild:function(e){n&&(n.appendChild(e),void 0!==e.isTTML&&(n.textTracks[n.textTracks.length-1].isTTML=e.isTTML,n.textTracks[n.textTracks.length-1].isEmbedded=e.isEmbedded))},removeChild:function(e){n&&n.removeChild(e)},getVideoWidth:function(){return n?n.videoWidth:NaN},getVideoHeight:function(){return n?n.videoHeight:NaN},getVideoRelativeOffsetTop:function(){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN},getVideoRelativeOffsetLeft:function(){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN},reset:function(){u.off(i.default.PLAYBACK_PLAYING,p,this)}},t=(0,a.default)(l).getInstance().getLogger(e),e}o.__dashjs_factory_name="VideoModel",t.default=n.default.getSingletonFactory(o)}));t(Ji);var ea=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(u),r=s(p),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var o=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],l="dashjs_?_bitrate",d="dashjs_?_settings",c="localStorage",f="lastBitrate",h="lastMediaSettings";function g(e){e=e||{};var t=this.context,n=e.settings,i=void 0,s=void 0,u=void 0;function g(e){if(void 0!==u)return u;u=!1;var t=void 0;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return s.warn("DOMStorage access denied: "+e.message),u}if(!t||e!==c&&"sessionStorage"!==e)return u;try{t.setItem("1","1"),t.removeItem("1"),u=!0}catch(e){s.warn("DOMStorage is supported, but cannot be used: "+e.message)}return u}function p(){var e=6e5;return Math.round((new Date).getTime()/e)*e}function m(e,t){return g(e)&&n.get().streaming[t+"CachingInfo"].enabled}function v(){if(!n)throw new Error(a.default.MISSING_CONFIG_ERROR)}return i={getSavedBitrateSettings:function(e){var t=NaN;if(v(),m(c,f)){var r=l.replace(/\?/,e);try{var i=JSON.parse(localStorage.getItem(r))||{},a=(new Date).getTime()-parseInt(i.timestamp,10)>=n.get().streaming.lastBitrateCachingInfo.ttl||!1,o=parseFloat(i.bitrate);isNaN(o)||a?a&&localStorage.removeItem(r):(t=o,s.debug("Last saved bitrate for "+e+" was "+o))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(m(c,f)&&t){var n=l.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({bitrate:t.toFixed(3),timestamp:p()}))}catch(e){s.error(e.message)}}},getSavedMediaSettings:function(e){var t=null;if(v(),m(c,h)){var r=d.replace(/\?/,e);try{var i=JSON.parse(localStorage.getItem(r))||{},a=(new Date).getTime()-parseInt(i.timestamp,10)>=n.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=i.settings,a&&(localStorage.removeItem(r),t=null)}catch(e){return null}}return t},setSavedMediaSettings:function(e,t){if(m(c,h)){var n=d.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({settings:t,timestamp:p()}))}catch(e){s.error(e.message)}}}},s=(0,r.default)(t).getInstance().getLogger(i),g(c)&&o.forEach((function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){s.error(e.message)}}})),i}g.__dashjs_factory_name="DOMStorage";var m=n.default.getSingletonFactory(g);t.default=m}));t(ea);var ta=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getVersionString=function(){return"3.2.2"}}));t(ta),ta.getVersionString;var na=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(Ir),r=o(_),i=o(u),a=o(y),s=o(di);function o(e){return e&&e.__esModule?e:{default:e}}function l(){var e=this.context,t=void 0,i=void 0,o=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0;function T(){if(!_||!_.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function b(e){if(e.url){var t=new a.default;return t.setInfo(e),t}}function S(e,t,n,i){p.trigger(g.SEGMENTS_LOADED,{segments:n,representation:i,error:n?void 0:new r.default(m.SEGMENT_BASE_LOADER_ERROR_CODE,m.SEGMENT_BASE_LOADER_ERROR_MESSAGE)},{streamId:e,mediaType:t})}return t={setConfig:function(e){e.baseURLController&&(_=e.baseURLController),e.dashMetrics&&(d=e.dashMetrics),e.mediaPlayerModel&&(f=e.mediaPlayerModel),e.errHandler&&(o=e.errHandler),e.settings&&(c=e.settings),e.boxParser&&(l=e.boxParser),e.events&&(g=e.events),e.eventBus&&(p=e.eventBus),e.debug&&(i=e.debug.getLogger(t)),e.requestModifier&&(u=e.requestModifier),e.errors&&(m=e.errors),e.urlUtils&&(E=e.urlUtils),e.constants&&(v=e.constants),e.dashConstants&&(y=e.dashConstants)},initialize:function(){h=(0,s.default)(e).create({errHandler:o,dashMetrics:d,mediaPlayerModel:f,requestModifier:u,useFetch:c?c.get().streaming.lowLatencyEnabled:null,boxParser:l,errors:m,urlUtils:E,constants:v,dashConstants:y})},loadInitialization:function e(t,n,r,a){T();var s=null,o=r?_.resolve(r.path):null,u=a||{init:!0,url:o?o.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:n};i.debug("Start searching for initialization.");var d=b(u);h.load({request:d,success:function(i){u.bytesLoaded=u.range.end,(s=l.findInitRange(i))?(r.range=s,p.trigger(g.INITIALIZATION_LOADED,{representation:r},{streamId:t,mediaType:n})):(u.range.end=u.bytesLoaded+u.bytesToLoad,e(t,n,r,u))},error:function(){p.trigger(g.INITIALIZATION_LOADED,{representation:r},{streamId:t,mediaType:n})}}),i.debug("Perform init search: "+u.url)},loadSegments:function e(t,r,a,s,o,u){if(T(),s&&(void 0===s.start||void 0===s.end)){var d=s?s.toString().split("-"):null;s=d?{start:parseFloat(d[0]),end:parseFloat(d[1])}:null}o=o||S;var c=null,f=null,g=!!s,p=a?_.resolve(a.path):null,m={init:!1,url:p?p.url:void 0,range:g?s:{start:0,end:1500},searching:!g,bytesLoaded:u?u.bytesLoaded:0,bytesToLoad:1500,mediaType:r},v=b(m);h.load({request:v,success:function(s){var u=m.bytesToLoad,d=s.byteLength;if(m.bytesLoaded=m.range.end-m.range.start,c=l.parse(s),(f=c.getBox("sidx"))&&f.isComplete){var h=f.references,g=void 0,p=void 0;if(null!=h&&h.length>0&&(g=1===h[0].reference_type),g){i.debug("Initiate multiple SIDX load."),m.range.end=m.range.start+f.size;var v=void 0,y=void 0,E=void 0,_=void 0,T=[],b=0,S=(f.offset||m.range.start)+f.size,A=function(e,t,n){n?(T=T.concat(n),++b>=y&&(T.sort((function(e,t){return e.startTime-t.startTime<0?-1:0})),o(e,t,T,a))):o(e,t,null,a)};for(v=0,y=h.length;v<y;v++)E=S,_=S+h[v].referenced_size-1,S+=h[v].referenced_size,e(t,r,a,{start:E,end:_},A,m)}else i.debug("Parsing segments from SIDX. representation "+r+" - id: "+a.id+" for range : "+m.range.start+" - "+m.range.end),p=function(e,t){for(var r=e.references,i=r.length,a=e.timescale,s=e.earliest_presentation_time,o=t.range.start+e.offset+e.first_offset+e.size,l=[],u=void 0,d=void 0,c=void 0,f=void 0,h=0;h<i;h++)c=r[h].subsegment_duration,f=r[h].referenced_size,(u=new n.default).duration=c,u.startTime=s,u.timescale=a,d=o+f-1,u.mediaRange=o+"-"+d,l.push(u),s+=c,o+=f;return l}(f,m),o(t,r,p,a)}else{if(f)m.range.start=f.offset||m.range.start,m.range.end=m.range.start+(f.size||u);else{if(d<m.bytesLoaded)return void o(t,r,null,a);var R=c.getLastBox();R&&R.size?(m.range.start=R.offset+R.size,m.range.end=m.range.start+u):m.range.end+=u}e(t,r,a,m.range,o,m)}},error:function(){o(t,r,null,a)}}),i.debug("Perform SIDX load: "+m.url+" with range : "+m.range.start+" - "+m.range.end)},reset:function(){h.abort(),h=null,o=null,l=null,u=null}},t}l.__dashjs_factory_name="SegmentBaseLoader",t.default=i.default.getSingletonFactory(l)}));t(na);var ra=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=u)&&n.__esModule?n:{default:n};function i(e){e=e||{};var t=void 0,n=new DataView(e.data),r=0;function i(e,t){var i=!0,a=0;if(void 0===t&&(t=!1),e.tag>16777215?(n.getUint32(r)!==e.tag&&(i=!1),a=4):e.tag>65535?(256*n.getUint16(r)+n.getUint8(r+2)!==e.tag&&(i=!1),a=3):e.tag>255?(n.getUint16(r)!==e.tag&&(i=!1),a=2):(n.getUint8(r)!==e.tag&&(i=!1),a=1),!i&&e.required&&!t)throw new Error("required tag not found");return i&&(r+=a),i}function a(e){var t=1,i=128,a=-1,s=0,o=n.getUint8(r),l=0;for(l=0;l<8;l+=1){if((o&i)===i){s=void 0===e?o&~i:o,a=l;break}i>>=1}for(l=0;l<a;l+=1,t+=1)s=s<<8|255&n.getUint8(r+t);return r+=t,s}return t={getPos:function(){return r},setPos:function(e){r=e},consumeTag:i,consumeTagAndSize:function(e,t){var n=i(e,t);return n&&a(),n},parseTag:function(e){var n;return i(e),n=a(),t[e.parse](n)},skipOverElement:function(e,t){var n=i(e,t),s=void 0;return n&&(s=a(),r+=s),n},getMatroskaCodedNum:a,getMatroskaFloat:function(e){var t=void 0;switch(e){case 4:t=n.getFloat32(r),r+=4;break;case 8:t=n.getFloat64(r),r+=8}return t},getMatroskaUint:function(e){for(var t=0,i=0;i<e;i+=1)t<<=8,t|=255&n.getUint8(r+i);return r+=e,t},moreData:function(){return r<n.byteLength}}}i.__dashjs_factory_name="EBMLParser",t.default=r.default.getClassFactory(i)}));t(ra);var ia=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(ra),r=c(i),a=c(u),s=c(Ir),o=c(y),l=c(di),d=c(_);function c(e){return e&&e.__esModule?e:{default:e}}function f(){var e=this.context,t=void 0,i=void 0,a=void 0,u=void 0,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0;function _(t,r,o,l){var u,d,c=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0;for(f=[],g=0,d=(u=function(t){var r=[],i=(0,n.default)(e).create({data:t}),s=void 0,o=void 0;for(i.consumeTagAndSize(a.Segment.Cues);i.moreData()&&i.consumeTagAndSize(a.Segment.Cues.CuePoint,!0);){for((s={}).CueTime=i.parseTag(a.Segment.Cues.CuePoint.CueTime),s.CueTracks=[];i.moreData()&&i.consumeTag(a.Segment.Cues.CuePoint.CueTrackPositions,!0);){var l=i.getMatroskaCodedNum(),u=i.getPos();if((o={}).Track=i.parseTag(a.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===o.Track)throw new Error("Cue track cannot be 0");o.ClusterPosition=i.parseTag(a.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),s.CueTracks.push(o),i.setPos(u+l)}if(0===s.CueTracks.length)throw new Error("Mandatory cuetrack not found");r.push(s)}if(0===r.length)throw new Error("mandatory cuepoint not found");return r}(t)).length;g<d;g+=1)h=new s.default,c=0,c=g<u.length-1?u[g+1].CueTime-u[g].CueTime:l-u[g].CueTime,h.duration=c,h.startTime=u[g].CueTime,h.timescale=1e3,p=u[g].CueTracks[0].ClusterPosition+r,m=g<u.length-1?u[g+1].CueTracks[0].ClusterPosition+r-1:o-1,h.mediaRange=p+"-"+m,f.push(h);return i.debug("Parsed cues: "+f.length+" cues."),f}function T(){if(!E||!E.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function b(e,t,n,r){m.trigger(v.SEGMENTS_LOADED,{segments:n,representation:r,error:n?void 0:new d.default(y.SEGMENT_BASE_LOADER_ERROR_CODE,y.SEGMENT_BASE_LOADER_ERROR_MESSAGE)},{streamId:e,mediaType:t})}function S(e){var t=new o.default;return t.setInfo(e),t}return t={setConfig:function(e){if(!(e.baseURLController&&e.dashMetrics&&e.mediaPlayerModel&&e.errHandler))throw new Error(r.default.MISSING_CONFIG_ERROR);E=e.baseURLController,f=e.dashMetrics,h=e.mediaPlayerModel,u=e.errHandler,p=e.settings,v=e.events,m=e.eventBus,y=e.errors,i=e.debug.getLogger(t),c=e.requestModifier},initialize:function(){g=(0,l.default)(e).create({errHandler:u,dashMetrics:f,mediaPlayerModel:h,requestModifier:c,useFetch:p?p.get().streaming.lowLatencyEnabled:null,errors:y})},loadInitialization:function(e,t,n,r){T();var a=null,s=n?E.resolve(n.path):null,o=n?n.range.split("-"):null,l=r||{range:{start:o?parseFloat(o[0]):null,end:o?parseFloat(o[1]):null},request:a,url:s?s.url:void 0,init:!0,mediaType:t};i.info("Start loading initialization."),a=S(l),g.load({request:a,success:function(){m.trigger(v.INITIALIZATION_LOADED,{representation:n},{streamId:e,mediaType:t})},error:function(){m.trigger(v.INITIALIZATION_LOADED,{representation:n},{streamId:e,mediaType:t})}}),i.debug("Perform init load: "+l.url)},loadSegments:function(t,r,s,o,l){T();var u=null,d=s?E.resolve(s.path):null,c=d?d.url:void 0;l=l||b,u=S({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:u,url:c,init:!1,mediaType:r}),i.debug("Parsing ebml header"),g.load({request:u,success:function(u){!function(t,r,s,o){if(t&&0!==t.byteLength){var l,u=(0,n.default)(e).create({data:t}),d=void 0,c=void 0,f=void 0,h=s?s.split("-"):null,p=null,m={url:r,range:{start:h?parseFloat(h[0]):null,end:h?parseFloat(h[1]):null},request:p};for(i.debug("Parse EBML header: "+m.url),u.skipOverElement(a.EBML),u.consumeTag(a.Segment),f=u.getMatroskaCodedNum(),f+=u.getPos(),l=u.getPos();u.moreData()&&!u.consumeTagAndSize(a.Segment.Info,!0);)if(!(u.skipOverElement(a.Segment.SeekHead,!0)||u.skipOverElement(a.Segment.Tracks,!0)||u.skipOverElement(a.Segment.Cues,!0)||u.skipOverElement(a.Void,!0)))throw new Error("no valid top level element found");for(;void 0===d;){var v=u.getMatroskaCodedNum(!0),y=u.getMatroskaCodedNum();v===a.Segment.Info.Duration.tag?d=u[a.Segment.Info.Duration.parse](y):u.setPos(u.getPos()+y)}p=S(m),g.load({request:p,success:function(e){c=_(e,l,f,d),o(c)},error:function(){i.error("Download Error: Cues "+m.url),o(null)}}),i.debug("Perform cues load: "+m.url+" bytes="+m.range.start+"-"+m.range.end)}else o(null)}(u,c,o,(function(e){l(t,r,e,s)}))},error:function(){l(t,r,null,s)}})},reset:function(){u=null,c=null}},a={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},t}f.__dashjs_factory_name="WebmSegmentBaseLoader",t.default=a.default.getSingletonFactory(f)}));t(ia);var aa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(u),r=a(na),i=a(ia);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){e=e||{};var t=this.context,n=e.eventBus,a=e.events,s=e.dashMetrics,o=e.mediaPlayerModel,l=e.errHandler,u=e.baseURLController,d=e.debug,c=e.boxParser,f=e.requestModifier,h=e.errors,g=void 0,p=void 0,m=void 0;function v(e){return"webm"===(e?e.split("/")[1]:"").toLowerCase()}function y(e){v(e.mimeType)?m.loadInitialization(e.streamId,e.mediaType,e.representation):p.loadInitialization(e.streamId,e.mediaType,e.representation)}function E(e){v(e.mimeType)?m.loadSegments(e.streamId,e.mediaType,e.representation,e.representation?e.representation.indexRange:null,e.callback):p.loadSegments(e.streamId,e.mediaType,e.representation,e.representation?e.representation.indexRange:null,e.callback)}return g={initialize:function(){n.on(a.SEGMENTBASE_INIT_REQUEST_NEEDED,y,g),n.on(a.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,E,g),p.initialize(),m.initialize()},reset:function(){n.off(a.SEGMENTBASE_INIT_REQUEST_NEEDED,y,g),n.off(a.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,E,g)}},p=(0,r.default)(t).getInstance(),m=(0,i.default)(t).getInstance(),p.setConfig({baseURLController:u,dashMetrics:s,mediaPlayerModel:o,errHandler:l,eventBus:n,events:a,errors:h,debug:d,boxParser:c,requestModifier:f}),m.setConfig({baseURLController:u,dashMetrics:s,mediaPlayerModel:o,errHandler:l,eventBus:n,events:a,errors:h,debug:d,requestModifier:f}),g}s.__dashjs_factory_name="SegmentBaseController";var o=n.default.getSingletonFactory(s);t.default=o}));t(aa);var sa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null}}));t(sa);var oa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null}}));t(oa);var la=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0}}));t(la);var ua=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null}}));t(ua);var da=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.valid="/"==t[0],this.path=t.split("/").filter((function(e){return 0!==e.length})).map((function(e){var t={name:e},r=e.indexOf("[");if(-1!=r){t.name=e.substring(0,r);var i=e.substring(r+1,e.length-1);n.valid=n.valid&&-1==i.indexOf("[");var a=i.indexOf("=");-1!=a?(t.attribute={name:i.substring(1,a),value:i.substring(a+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(i,10)-1}return t}))}return n(e,[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"getMpdTarget",value:function(e,t){for(var n=null,r=e,i=1,a="MPD";i<this.path.length&&null!==r;){n=r;var s=this.path[i];if(a=s.name,i!==this.path.length-1||!a.startsWith("@")){var o=n[a+"_asArray"]||[];0===o.length&&n[a]&&o.push(n[a]),s.position?r=o[s.position]||null:s.attribute?function(){var e=s.attribute;r=o.filter((function(t){return t[e.name]==e.value}))[0]||null}():r=o[0]||null}i++}return null===r?null:a.startsWith("@")?{name:a.substring(1),leaf:r,target:r}:{name:a,leaf:r,target:t?n:r}}}]),e}();t.default=r}));t(da);var ca=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t,this.xpath=n,this.value=r,this.position=null}return n(e,[{key:"getMpdTarget",value:function(e){var t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}]),e}();t.default=r}));t(ca);var fa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(o),r=l(u),i=l(p),a=l(da),s=l(ca);function l(e){return e&&e.__esModule?e:{default:e}}function d(){var e=void 0,t=void 0,r=this.context;return e={getIsPatch:function(e){return e&&e.hasOwnProperty(n.default.ORIGINAL_MPD_ID)||!1},getPublishTime:function(e){return e&&e.hasOwnProperty(n.default.PUBLISH_TIME)?new Date(e[n.default.PUBLISH_TIME]):null},getOriginalPublishTime:function(e){return e&&e.hasOwnProperty(n.default.ORIGINAL_PUBLISH_TIME)?new Date(e[n.default.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(e){return e&&e[n.default.ORIGINAL_MPD_ID]||null},getPatchOperations:function(e){return e?(e.__children||[]).map((function(e){var n=Object.keys(e)[0];if("add"!==n&&"remove"!==n&&"replace"!==n)return t.warn("Ignoring node of invalid action: "+n),null;var r=e[n],i=r.sel;if("add"===n&&r.type){if(!r.type.startsWith("@"))return t.warn("Ignoring add action for prefixed namespace declaration: "+r.type+"="+r.__text),null;i=i+"/"+r.type}var o=new a.default(i);if(!o.isValid())return t.warn("Ignoring action with invalid selector: "+n+" - "+i),null;var l=null;o.findsAttribute()?l=r.__text||"":"remove"!==n&&(l=r.__children.reduce((function(e,t){var n=Object.keys(t)[0];return"#text"!==n&&(e[n]=e[n]||[],e[n].push(t[n])),e}),{}));var u=new s.default(n,o,l);return"add"===n&&(u.position=r.pos),u})).filter((function(e){return!!e})):[]}},t=(0,i.default)(r).getInstance().getLogger(e),e}d.__dashjs_factory_name="PatchManifestModel",t.default=r.default.getSingletonFactory(d)}));t(fa);var ha=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=h(o),r=h(sa),i=h(oa),a=h(la),s=h(ua),l=h(Qr),d=h(u),c=h(si),f=h(fa);function h(e){return e&&e.__esModule?e:{default:e}}function g(){var e,t=void 0,o=void 0,u=void 0,d=void 0,h=void 0,g=void 0,p=void 0,m=this.context;function v(e,r,i){var a,s=t.getAdaptationsForType(u[0].mpd.manifest,e,r);if(!s||0===s.length)return null;if(s.length>1&&i){var o=E(i,r);if(h[i.id]&&h[i.id][r])for(var l=0,d=s.length;l<d;l++)if(y(h[i.id][r],o[l]))return s[l];for(var c=0,f=s.length;c<f;c++)if(a=s[c],t.getRolesForAdaptation(a).filter((function(e){return e.value===n.default.MAIN}))[0])return s[c]}return s[0]}function y(e,t){if(!e||!t)return!1;var n=e.id===t.id,r=e.viewpoint===t.viewpoint,i=e.lang===t.lang,a=e.roles.toString()===t.roles.toString(),s=e.accessibility.toString()===t.accessibility.toString(),o=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&r&&i&&a&&s&&o}function E(e,n,r){var i,a=u,s=r,o=[],l=void 0,c=void 0,f=void 0,h=void 0,p=void 0,m=void 0;if(s)D(),a=_(s);else{if(!(u.length>0))return o;s=u[0].mpd.manifest}var v=R(e,a);v&&(m=v.id);var y=t.getAdaptationsForType(s,e?e.index:null,n!==g.EMBEDDED_TEXT?n:g.VIDEO);if(!y||0===y.length)return o;for(d[m]=d[m]||t.getAdaptationsForPeriod(v),h=0,i=y.length;h<i;h++)if(l=y[h],f=t.getIndexForAdaptation(l,s,e.index),c=I(d[m][f]),n===g.EMBEDDED_TEXT){var E=c.accessibility.length;for(p=0;p<E;p++)if(c){var T=c.accessibility[p];if(0===T.indexOf("cea-608:")){var b=T.substring(8).split(";");if("CC"===b[0].substring(0,2))for(p=0;p<b.length;p++)c||(c=I.call(this,d[m][f])),w(c,b[p].substring(0,3),b[p].substring(4)),o.push(c),c=null;else for(p=0;p<b.length;p++)c||(c=I.call(this,d[m][f])),w(c,"CC"+(p+1),b[p]),o.push(c),c=null}else 0===T.indexOf("cea-608")&&(w(c,g.CC1,"eng"),o.push(c),c=null)}}else n===g.IMAGE?(c.type=g.IMAGE,o.push(c),c=null):c&&o.push(c);return o}function _(e){var n=T(e);return t.getRegularPeriods(n)}function T(e){var n=S(e);return t.getMpd(n)}function b(){u=[],d={},h={}}function S(e){return e||(u.length>0?u[0].mpd.manifest:null)}function A(e){return e&&e.streamInfo&&void 0!==e.streamInfo.id&&d[e.streamInfo.id]?d[e.streamInfo.id][e.index]:null}function R(e,t){for(var n=t.length,r=0;r<n;r++){var i=t[r];if(e&&e.id===i.id)return i}return null}function I(e){if(!e)return null;var n,r=new i.default,a=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];return r.id=e.id,r.index=e.index,r.type=e.type,r.streamInfo=C(e.period),r.representationCount=t.getRepresentationCount(a),r.labels=t.getLabelsForAdaptation(a),r.lang=t.getLanguageForAdaptation(a),n=t.getViewpointForAdaptation(a),r.viewpoint=n?n.value:void 0,r.accessibility=t.getAccessibilityForAdaptation(a).map((function(e){var t=e.value,n=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==p&&(n=t?"cea-608:"+t:"cea-608",r.embeddedCaptions=!0),n})),r.audioChannelConfiguration=t.getAudioChannelConfigurationForAdaptation(a).map((function(e){return e.value})),0===r.audioChannelConfiguration.length&&Array.isArray(a.Representation_asArray)&&a.Representation_asArray.length>0&&(r.audioChannelConfiguration=t.getAudioChannelConfigurationForRepresentation(a.Representation_asArray[0]).map((function(e){return e.value}))),r.roles=t.getRolesForAdaptation(a).map((function(e){return e.value})),r.codec=t.getCodec(a),r.mimeType=t.getMimeType(a),r.contentProtection=t.getContentProtectionData(a),r.bitrateList=t.getBitrateListForAdaptation(a),r.contentProtection&&r.contentProtection.forEach((function(e){e.KID=t.getKID(e)})),r.isText=t.getIsTextTrack(r.mimeType),r.supplementalProperties=t.getSupplementalPropperties(a),r}function w(e,t,n){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=g.EMBEDDED_TEXT,e.codec="cea-608-in-SEI",e.isText=!0,e.isEmbedded=!0,e.lang=n,e.roles=["caption"]}function C(e){var n,r,i=new a.default;return i.id=e.id,i.index=e.index,i.start=e.start,i.duration=e.duration,i.manifestInfo=(n=e.mpd,(r=new s.default).DVRWindowSize=n.timeShiftBufferDepth,r.loadedTime=n.manifest.loadedTime,r.availableFrom=n.availabilityStartTime,r.minBufferTime=n.manifest.minBufferTime,r.maxFragmentDuration=n.maxSegmentDuration,r.duration=t.getDuration(n.manifest),r.isDynamic=t.getIsDynamic(n.manifest),r.serviceDescriptions=t.getServiceDescriptions(n.manifest),r.protocol=n.manifest.protocol,r),i.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<1,i}function D(){if(!g)throw new Error("setConfig function has to be called previously")}function M(e){return u.length>0?u[0].mpd.manifest.Period_asArray[e]:null}function N(e,t,n){var r=void 0,i=void 0,a=void 0,s=void 0,o=void 0;if(e)for(r=e.AdaptationSet_asArray,s=0;s<r.length;s+=1)for(a=r[s].Representation_asArray,o=0;o<a.length;o+=1)if(t===(i=a[o]).id)return n?o:i;return null}return e={getBandwidthForRepresentation:function(e,t){var n;return(n=N(M(t),e))?n.bandwidth:null},getIndexForRepresentation:function(e,t){return function(e,t){var n=N(e,t,!0);return null!==n?n:-1}(M(t),e)},getMaxIndexForBufferType:function(e,n){return function(e,n){var r=void 0,i=void 0,a=void 0,s=void 0;if(!e||!n)return-1;for(i=e.AdaptationSet_asArray,s=0;s<i.length;s+=1)if(a=(r=i[s]).Representation_asArray,t.getIsTypeOf(r,n))return a.length;return-1}(M(n),e)},convertDataToRepresentationInfo:function(e){if(e){var n=new r.default,i=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],a=t.getRepresentationFor(e.index,i);return n.id=e.id,n.quality=e.index,n.bandwidth=t.getBandwidth(a),n.DVRWindow=e.segmentAvailabilityRange,n.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),n.MSETimeOffset=e.MSETimeOffset,n.mediaInfo=I(e.adaptation),n}return null},getDataForMedia:A,getStreamsInfo:function(e,t){var n=[],r=u;if(e&&(D(),r=_(e)),r.length>0){(!t||t>r.length)&&(t=r.length);for(var i=0;i<t;i++)n.push(C(r[i]))}return n},getMediaInfoForType:function(e,n){if(0===u.length||!e)return null;var r=R(e,u);if(!r)return null;var i=r.id;d[i]=d[i]||t.getAdaptationsForPeriod(r);var a=v(e.index,n,e);if(!a)return null;var s=t.getIndexForAdaptation(a,u[0].mpd.manifest,e.index);return I(d[i][s])},getAllMediaInfoForType:E,getAdaptationForType:v,getRealAdaptation:function(e,n){var r,i=void 0,a=R(e,u);return r=n?n.id:null,u.length>0&&a&&(i=r?t.getAdaptationForId(r,u[0].mpd.manifest,a.index):t.getAdaptationForIndex(n?n.index:null,u[0].mpd.manifest,a.index)),i},getRealPeriodByIndex:function(e){return t.getRealPeriodForIndex(e,u[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(e){try{return t.getEssentialPropertiesForRepresentation(e)}catch(e){return[]}},getVoRepresentations:function(e){var n=A(e);return t.getRepresentationsForAdaptation(n)},getEventsFor:function(e,n){var s=[];if(u.length>0){var o=u[0].mpd.manifest;e instanceof a.default?s=t.getEventsForPeriod(R(e,u)):e instanceof i.default?s=t.getEventStreamForAdaptationSet(o,A(e)):e instanceof r.default&&(s=t.getEventStreamForRepresentation(o,n))}return s},getEvent:function(e,t,n,r){try{if(!e||!t||isNaN(n)||!r)return null;var i=e.scheme_id_uri,a=e.value;if(!t[i+"/"+a])return null;var s=new l.default,o=e.timescale||1,u=r.adaptation.period.start,d=t[i+"/"+a],c=isNaN(r.presentationTimeOffset)?isNaN(d.presentationTimeOffset)?0:d.presentationTimeOffset:r.presentationTimeOffset,f=e.presentation_time_delta/o,h=void 0;h=0===e.version?u+n-c+f:u-c+f;var g=e.event_duration,p=e.id,m=e.message_data;return s.eventStream=d,s.eventStream.value=a,s.eventStream.timescale=o,s.duration=g,s.id=p,s.calculatedPresentationTime=h,s.messageData=m,s.presentationTimeDelta=f,s}catch(e){return null}},getMpd:T,setConfig:function(e){e&&(e.constants&&(g=e.constants),e.cea608parser&&(p=e.cea608parser),e.errHandler&&t.setConfig({errHandler:e.errHandler}),e.BASE64&&t.setConfig({BASE64:e.BASE64}))},updatePeriods:function(e){if(!e)return null;D(),u=_(e),d={}},getIsTextTrack:function(e){return t.getIsTextTrack(e)},getUTCTimingSources:function(){var e=S();return t.getUTCTimingSources(e)},getSuggestedPresentationDelay:function(){var e=u.length>0?u[0].mpd:null;return t.getSuggestedPresentationDelay(e)},getAvailabilityStartTime:function(e){var n=T(e);return t.getAvailabilityStartTime(n)},getIsTypeOf:function(e,n){return t.getIsTypeOf(e,n)},getIsDynamic:function(e){var n=S(e);return t.getIsDynamic(n)},getDuration:function(e){var n=S(e);return t.getDuration(n)},getRegularPeriods:_,getLocation:function(e){return t.getLocation(e)},getPatchLocation:function(e){var n=t.getPatchLocation(e),r=t.getPublishTime(e);if(!n||!r)return null;if(n.hasOwnProperty("ttl")&&r){var i=1e3*parseFloat(n.ttl);if(r.getTime()+i<=(new Date).getTime())return null}return n.__text},getManifestUpdatePeriod:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.getManifestUpdatePeriod(e,n)},getPublishTime:function(e){return t.getPublishTime(e)},getIsDVB:function(e){return t.hasProfile(e,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(e){return o.getIsPatch(e)},getBaseURLsFromElement:function(e){return t.getBaseURLsFromElement(e)},getRepresentationSortFunction:function(){return t.getRepresentationSortFunction()},getCodec:function(e,n,r){return t.getCodec(e,n,r)},getVoAdaptations:function(){return d},getVoPeriods:function(){return u},getPeriodById:function(e){if(!e||0===u.length)return null;var t=u.filter((function(t){return t.id===e}));return t&&t.length>0?t[0]:null},setCurrentMediaInfo:function(e,t,n){h[e]=h[e]||{},h[e][t]=h[e][t]||{},h[e][t]=n},isPatchValid:function(e,n){var r=t.getId(e),i=o.getMpdId(n),a=t.getPublishTime(e),s=o.getPublishTime(n),l=o.getOriginalPublishTime(n);return!!(r&&i&&r==i&&a&&l&&a.getTime()==l.getTime()&&s&&a.getTime()<s.getTime())},applyPatchToManifest:function(e,t){o.getPatchOperations(t).forEach((function(t){var n=t.getMpdTarget(e);if(null!==n){var r=n.name,i=n.target,a=n.leaf;if(t.xpath.findsAttribute())switch(t.action){case"add":case"replace":i[r]=t.value;break;case"remove":delete i[r]}else{var s=(i[r+"_asArray"]||[]).indexOf(a),o="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete i[r],-1!=s)){var l=i[r+"_asArray"];l.splice(s,1),l.length>1?i[r]=l:1==l.length?i[r]=l[0]:delete i[r+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach((function(e){var n=t.value[e],a=i[e+"_asArray"]||[];if(0===a.length&&i[e]&&a.push(i[e]),0===a.length)a=n;else{var l=a.length;l=e==r&&-1!=s?s+(o?0:1)+("replace"==t.action?-1:0):o?0:a.length,a.splice.apply(a,[l,0].concat(n))}i[e+"_asArray"]=a,i[e]=1==a.length?a[0]:a}))}}}))},reset:b},t=(0,c.default)(m).getInstance(),o=(0,f.default)(m).getInstance(),b(),e}g.__dashjs_factory_name="DashAdapter",t.default=d.default.getSingletonFactory(g)}));t(ha);var ga=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"round10",value:function(e,t){return function(e,t,n){if(void 0===n||0==+n)return Math[e](t);if(n=+n,null===(t=+t)||isNaN(t)||!("number"==typeof n&&n%1==0))return NaN;return t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))}("round",e,t)}}]),e}();t.default=r}));t(ga);var pa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]}}));t(pa);var ma=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null}}));t(ma);var va=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null}}));t(va);var ya=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=l)&&n.__esModule?n:{default:n};t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=r.default.BUFFER_EMPTY}}));t(ya);var Ea=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null}}));t(Ea);var _a=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null}}));t(_a);var Ta=n((function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.ManifestUpdate=function e(){n(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},t.ManifestUpdateStreamInfo=function e(){n(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},t.ManifestUpdateRepresentationInfo=function e(){n(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}}));t(Ta),Ta.ManifestUpdate,Ta.ManifestUpdateStreamInfo,Ta.ManifestUpdateRepresentationInfo;var ba=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null}}));t(ba);var Sa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]}}));t(Sa);var Aa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=T(i),r=T(l),a=T(pa),s=T(ma),o=T(va),d=T(ya),c=T(Ea),h=T(_a),p=T(ba),m=T(f),y=T(Sa),E=T(g),_=T(u);function T(e){return e&&e.__esModule?e:{default:e}}function b(e){var t,i=(e=e||{}).settings,l=this.context,u=(0,m.default)(l).getInstance(),f=void 0;function g(){u.trigger(E.default.METRICS_CHANGED)}function _(e){u.trigger(E.default.METRIC_CHANGED,{mediaType:e}),g()}function T(e,t,n){u.trigger(E.default.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),_(e)}function b(e,t,n){u.trigger(E.default.METRIC_ADDED,{mediaType:e,metric:t,value:n}),_(e)}function S(e,t){var n=null;return e?(f.hasOwnProperty(e)?n=f[e]:t||(n=new a.default,f[e]=n),n):n}function A(e,t,n){var r=S(e);null!==r&&(r[t].push(n),r[t].length>i.get().streaming.metricsMaxListDepth&&r[t].shift())}function R(e,t,n){A(e,t,n),b(e,t,n)}return t={clearCurrentMetricsForType:function(e){delete f[e],_(e)},clearAllCurrentMetrics:function(){f={},g()},getMetricsFor:S,addHttpRequest:function e(t,n,i,a,s,o,l,u,d,c,f,h,g,p,m){var y=new v.HTTPRequest;o&&o!==a&&(e(t,null,i,a,s,null,null,u,d,null,null,null,g,null,null),y.actualurl=o),y.tcpid=n,y.type=i,y.url=a,y.range=u,y.trequest=d,y.tresponse=c,y.responsecode=h,y._tfinish=f,y._stream=t,y._mediaduration=g,y._quality=s,y._responseHeaders=p,y._serviceLocation=l,m?m.forEach((function(e){!function(e,t,n,r){var i=new v.HTTPRequestTrace;i.s=t,i.d=n,i.b=r,e.trace.push(i),e.interval||(e.interval=0),e.interval+=n}(y,e.s,e.d,e.b)})):(delete y.interval,delete y.trace),R(t,r.default.HTTP_REQUEST,y)},addRepresentationSwitch:function(e,t,n,i,a){var o=new s.default;o.t=t,o.mt=n,o.to=i,a?o.lto=a:delete o.lto,R(e,r.default.TRACK_SWITCH,o)},addBufferLevel:function(e,t,n){var i=new o.default;i.t=t,i.level=n,R(e,r.default.BUFFER_LEVEL,i)},addBufferState:function(e,t,n){var i=new d.default;i.target=n,i.state=t,R(e,r.default.BUFFER_STATE,i)},addDVRInfo:function(e,t,n,i){var a=new c.default;a.time=t,a.range=i,a.manifestInfo=n,R(e,r.default.DVR_INFO,a)},addDroppedFrames:function(e,t){var n=new h.default,i=S(e).DroppedFrames;t&&(n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,i.length>0&&i[i.length-1]==n||R(e,r.default.DROPPED_FRAMES,n))},addSchedulingInfo:function(e,t,n,i,a,s,o,l,u){var d=new p.default;d.mediaType=e,d.t=t,d.type=n,d.startTime=i,d.availabilityStartTime=a,d.duration=s,d.quality=o,d.range=l,d.state=u,R(e,r.default.SCHEDULING_INFO,d)},addRequestsQueue:function(e,t,n){var i=new y.default;i.loadingRequests=t,i.executedRequests=n,S(e).RequestsQueue=i,b(e,r.default.REQUESTS_QUEUE,i)},addManifestUpdate:function(e,t,i,a,s,o,l,u,d,c){var f=new Ta.ManifestUpdate;f.mediaType=e,f.type=t,f.requestTime=i,f.fetchTime=a,f.availabilityStartTime=s,f.presentationStartTime=o,f.clientTimeOffset=l,f.currentTime=u,f.buffered=d,f.latency=c,A(n.default.STREAM,r.default.MANIFEST_UPDATE,f),b(e,r.default.MANIFEST_UPDATE,f)},updateManifestUpdateInfo:function(e,t){if(e){for(var n in t)e[n]=t[n];T(e.mediaType,r.default.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,n,i,a){if(e){var s=new Ta.ManifestUpdateStreamInfo;s.id=t,s.index=n,s.start=i,s.duration=a,e.streamInfo.push(s),T(e.mediaType,r.default.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,n,i,a,s,o,l){if(e&&e.representationInfo){var u=new Ta.ManifestUpdateRepresentationInfo;u.id=t,u.index=n,u.streamIndex=i,u.mediaType=a,u.startNumber=o,u.fragmentInfoType=l,u.presentationTimeOffset=s,e.representationInfo.push(u),T(e.mediaType,r.default.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach((function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,R(n.default.STREAM,r.default.PLAY_LIST,e)},addDVBErrors:function(e){R(n.default.STREAM,r.default.DVB_ERRORS,e)}},f={},t}b.__dashjs_factory_name="MetricsModel",t.default=_.default.getSingletonFactory(b)}));t(Aa);var Ra=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(i),r=c(u),a=c(l),s=c(ga),o=c(Aa),d=c(jr);function c(e){return e&&e.__esModule?e:{default:e}}function f(e){e=e||{};var t,r=this.context,i=void 0,l=void 0,u=void 0,c=e.metricsModel;function f(e){var t=c.getMetricsFor(e,!0);if(!t)return null;var n=t.HttpList,r=null,i=void 0;if(!n||n.length<=0)return null;for(i=n.length-1;i>=0;){if(n[i].responsecode){r=n[i];break}i--}return r}function h(e){var t=c.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function g(e,t){if(!e)return null;var n=e[t];return n&&0!==n.length?n[n.length-1]:null}return t={getCurrentRepresentationSwitch:function(e){return g(c.getMetricsFor(e,!0),a.default.TRACK_SWITCH)},getCurrentBufferState:function(e){return g(c.getMetricsFor(e,!0),a.default.BUFFER_STATE)},getCurrentBufferLevel:function(e){var t=g(c.getMetricsFor(e,!0),a.default.BUFFER_LEVEL);return t?s.default.round10(t.level/1e3,-3):0},getCurrentHttpRequest:f,getHttpRequests:h,getCurrentDroppedFrames:function(){return g(c.getMetricsFor(n.default.VIDEO,!0),a.default.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return g(c.getMetricsFor(e,!0),a.default.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return g(e?c.getMetricsFor(e,!0):c.getMetricsFor(n.default.VIDEO,!0)||c.getMetricsFor(n.default.AUDIO,!0),a.default.DVR_INFO)},getCurrentManifestUpdate:function(){return g(c.getMetricsFor(n.default.STREAM),a.default.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){var n={},r=f(e);return r&&(n=d.default.parseHttpHeaders(r._responseHeaders)),void 0===n[t]?null:n[t]},getLatestMPDRequestHeaderValueByID:function(e){var t,r={},i=void 0,a=void 0;for(a=(t=h(n.default.STREAM)).length-1;a>=0;a--)if((i=t[a]).type===v.HTTPRequest.MPD_TYPE){r=d.default.parseHttpHeaders(i._responseHeaders);break}return void 0===r[e]?null:r[e]},addRepresentationSwitch:function(e,t,n,r,i){c.addRepresentationSwitch(e,t,n,r,i)},addDVRInfo:function(e,t,n,r){c.addDVRInfo(e,t,n,r)},updateManifestUpdateInfo:function(e){var t=this.getCurrentManifestUpdate();c.updateManifestUpdateInfo(t,e)},addManifestUpdateStreamInfo:function(e){if(e){var t=this.getCurrentManifestUpdate();c.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}},addManifestUpdateRepresentationInfo:function(e,t){if(e){var n=this.getCurrentManifestUpdate();c.addManifestUpdateRepresentationInfo(n,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}},addManifestUpdate:function(e){c.addManifestUpdate(n.default.STREAM,e.type,e.requestStartDate,e.requestEndDate)},addHttpRequest:function(e,t,n,r,i){c.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,n,e.duration,r,i)},addSchedulingInfo:function(e,t){c.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)},addRequestsQueue:function(e,t,n){c.addRequestsQueue(e,t,n)},addBufferLevel:function(e,t,n){c.addBufferLevel(e,t,n)},addBufferState:function(e,t,n){c.addBufferState(e,t,n)},addDroppedFrames:function(e){c.addDroppedFrames(n.default.VIDEO,e)},addPlayList:function(){u&&(c.addPlayList(u),u=null)},addDVBErrors:function(e){c.addDVBErrors(e)},createPlaylistMetrics:function(e,t){(u=new Fr.PlayList).start=new Date,u.mstart=e,u.starttype=t},createPlaylistTraceMetrics:function(e,t,n){!0===i&&(i=!1,(l=new Fr.PlayListTrace).representationid=e,l.start=new Date,l.mstart=t,l.playbackspeed=null!==n?n.toString():null)},updatePlayListTraceMetrics:function(e){if(l)for(var t in l)l[t]=e[t]},pushPlayListTraceMetrics:function(e,t){if(!1===i&&u&&l&&l.start){var n=l.start,r=e.getTime()-n.getTime();l.duration=r,l.stopreason=t,u.trace.push(l),i=!0}},clearAllCurrentMetrics:function(){c.clearAllCurrentMetrics()}},c=c||(0,o.default)(r).getInstance({settings:e.settings}),i=!0,l=null,u=null,t}f.__dashjs_factory_name="DashMetrics",t.default=r.default.getSingletonFactory(f)}));t(Ra);var Ia=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=d(f),r=d(g),i=d(u),a=d(o),s=d(si),l=d(Hr);function d(e){return e&&e.__esModule?e:{default:e}}function c(){var e,t=this.context,i=(0,n.default)(t).getInstance(),o=(0,l.default)(t).getInstance(),u=void 0,d=void 0,c=void 0,f=void 0;function h(e){d=e}function g(e,t,n,r){return r?n&&t.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(t.availabilityStartTime.getTime()+1e3*(e+t.timeShiftBufferDepth)):t.availabilityEndTime:n?new Date(t.availabilityStartTime.getTime()+1e3*(e-d)):t.availabilityStartTime}function p(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*d)/1e3}function m(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)}function v(e){void 0!==e.offset&&(h(e.offset/1e3),c=!0)}function y(){d=0,c=!1,f=NaN}function E(){i.off(r.default.UPDATE_TIME_SYNC_OFFSET,v,this),y()}return e={initialize:function(){y(),i.on(r.default.UPDATE_TIME_SYNC_OFFSET,v,this)},getClientTimeOffset:function(){return d},setClientTimeOffset:h,getExpectedLiveEdge:function(){return f},setExpectedLiveEdge:function(e){f=e},calcAvailabilityStartTimeFromPresentationTime:function(e,t,n){return g.call(this,e,t,n)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,n){return g.call(this,e,t,n,!0)},calcPresentationTimeFromWallTime:p,calcPresentationTimeFromMediaTime:m,calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcSegmentAvailabilityRange:function(e,t){var n=e.adaptation.period,r={start:n.start,end:n.start+n.duration};if(!t)return r;if(!c&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;var i=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0);if(e.segmentInfoType===a.default.SEGMENT_TIMELINE&&o.get().streaming.calcSegmentAvailabilityRangeFromTimeline)return function(e){var t=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],n=u.getRepresentationFor(e.index,t),r=n.SegmentTemplate.SegmentTimeline,i=n.SegmentTemplate.timescale,a=r.S_asArray,s={start:0,end:0},o=0,l=void 0,d=void 0,c=void 0,f=void 0;for(s.start=m(a[0].t/i,e),c=0,f=a.length;c<f;c++)d=0,(l=a[c]).hasOwnProperty("r")&&(d=l.r),o+=l.d/i*(1+d);return s.end=s.start+o,s}(e);var s=p(new Date,n),l=n.start+n.duration;r.start=Math.max(s-n.mpd.timeShiftBufferDepth,n.start);var d=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<i?i-e.availabilityTimeOffset:i;return r.end=s>=l&&s-d<l?l:s-d,r},getPeriodEnd:function(e,t){var n=e.adaptation.period;if(!t)return n.start+n.duration;if(!c&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;var r=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0),i=p(new Date,n),a=n.start+n.duration,s=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<r?r-e.availabilityTimeOffset:r;return Math.min(i-s,a)},calcWallTimeForSegment:function(e,t){var n=void 0,r=void 0,i=void 0;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,r=e.presentationStartTime+n,i=new Date(e.availabilityStartTime.getTime()+1e3*r)),i},reset:E},u=(0,s.default)(t).getInstance(),E(),e}c.__dashjs_factory_name="TimelineConverter",t.default=i.default.getSingletonFactory(c)}));t(Ia);var wa=n((function(e,t){var n,r,i,o,l,u={encode:function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},decode:function(e){for(var t=[],n=0;n<e.length;){var r=e[n++];r<128||(r<224?(r=(31&r)<<6,r|=63&e[n++]):r<240?(r=(15&r)<<12,r|=(63&e[n++])<<6,r|=63&e[n++]):(r=(7&r)<<18,r|=(63&e[n++])<<12,r|=(63&e[n++])<<6,r|=63&e[n++])),t.push(String.fromCharCode(r))}return t.join("")}},d={};n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=function(e){for(var t=0,r=[],i=0|e.length/3;0<i--;){var a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,r.push(n.charAt(63&a>>18)),r.push(n.charAt(63&a>>12)),r.push(n.charAt(63&a>>6)),r.push(n.charAt(63&a))}return 2==e.length-t?(a=(e[t]<<16)+(e[t+1]<<8),r.push(n.charAt(63&a>>18)),r.push(n.charAt(63&a>>12)),r.push(n.charAt(63&a>>6)),r.push("=")):1==e.length-t&&(a=e[t]<<16,r.push(n.charAt(63&a>>18)),r.push(n.charAt(63&a>>12)),r.push("==")),r.join("")},i=function(){for(var e=[],t=0;t<n.length;++t)e[n.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),o=function(e){for(var t=0,n=[],r=0|e.length/4;0<r--;){var a=(i[e.charCodeAt(t)]<<18)+(i[e.charCodeAt(t+1)]<<12)+(i[e.charCodeAt(t+2)]<<6)+i[e.charCodeAt(t+3)];n.push(255&a>>16),n.push(255&a>>8),n.push(255&a),t+=4}return n&&("="==e.charAt(t-2)?(n.pop(),n.pop()):"="==e.charAt(t-1)&&n.pop()),n},l={encode:function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},d.decodeArray=function(e){var t=o(e);return new Uint8Array(t)},d.encodeASCII=function(e){var t=l.encode(e);return r(t)},d.decodeASCII=function(e){var t=o(e);return l.decode(t)},d.encode=function(e){var t=u.encode(e);return r(t)},d.decode=function(e){var t=o(e);return u.decode(t)},t.decode=d.decode,t.decodeArray=d.decodeArray,t.encode=d.encode,t.encodeASCII=d.encodeASCII}));wa.decode,wa.decodeArray,wa.encode,wa.encodeASCII;var Ca=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=ie(r),a=ie(i),s=ie(o),d=ie(l),h=ie(m),y=ie(Ti),E=ie(bi),T=ie(Si),b=ie(Di),S=ie(Yi),R=ie(Vi),C=ie(Wi),D=ie(zi),M=ie(jn),N=ie(Lr),O=ie(Xn),P=ie(Qi),L=ie($i),k=ie(Zi),x=ie(vr),F=ie(ui),U=ie(Ji),B=ie(oi),G=ie(ea),j=ie(p),H=ie(Kn),q=ie(f),K=ie(g),Y=ie(c),V=ie(u),W=ie(Hr),z=ie(aa),X=ie(ha),Q=ie(Ra),$=ie(Ia),Z=ie(wa),J=ie(A),ee=ie(_),te=ie(vi),ne=ie(xr),re=ie(I);function ie(e){return e&&e.__esModule?e:{default:e}}function ae(){var e="You must first call initialize() and set a source before calling this method",t="You must first call initialize() and set a valid source and view before calling this method",r="You must first call attachView() to set the video element before calling this method",i="You must first call attachSource() with a valid source before calling this method",o="MediaPlayer not initialized!",l=this.context,u=(0,q.default)(l).getInstance(),c=(0,W.default)(l).getInstance(),f=(0,j.default)(l).getInstance({settings:c}),g=void 0,p=void 0,m=void 0,_=void 0,A=void 0,I=void 0,ie=void 0,ae=void 0,se=void 0,oe=void 0,le=void 0,ue=void 0,de=void 0,ce=void 0,fe=void 0,he=void 0,ge=void 0,pe=void 0,me=void 0,ve=void 0,ye=void 0,Ee=void 0,_e=void 0,Te=void 0,be=void 0,Se=void 0,Ae=void 0,Re=void 0,Ie=void 0,we=void 0,Ce=void 0,De=void 0,Me=void 0,Ne=void 0,Oe=void 0,Pe=void 0;function Le(){ze(null),Ye(null),_=null,de&&(de.reset(),de=null),ce&&(ce.reset(),ce=null),Me.reset(),c.reset(),he&&(he.reset(),he=null)}function ke(){return!!m&&!!Ie.getElement()}function xe(){return(0,ta.getVersionString)()}function Fe(){if(!ie)throw t;return be.isPaused()}function Ue(e){var t=Se.getCurrentDVRInfo();if(!t)return 0;var n=be.getLiveDelay(),r=t.range.start+e;return r>t.range.end-n&&(r=t.range.end-n),r}function Be(e){if(!ie)throw t;var n=Ke().currentTime;if(void 0!==e)n=_e.getTimeRelativeToStreamId(n,e);else if(be.getIsDynamic()){var r=Se.getCurrentDVRInfo();n=null===r||0===n?0:Math.max(0,n-r.range.start)}return n}function Ge(){if(!ie)throw t;var e=Ke().duration;if(be.getIsDynamic()){var n=Se.getCurrentDVRInfo();e=n?n.range.end-n.range.start:0}return e}function je(e){(0,w.checkParameterType)(e,"boolean"),ae=e}function He(){pe.restoreDefaultUTCTimingSources()}function qe(){return Se}function Ke(){if(!Ie.getElement())throw r;return Ie.getElement()}function Ye(e){if(!A)throw o;Ie.setElement(e),e&&(Ze(),function(){if(ce)return;var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(l).create();ce=t.createMetricsReporting({debug:f,eventBus:u,mediaElement:Ke(),adapter:ge,dashMetrics:Se,events:K.default,constants:a.default,metricsConstants:d.default})}}(),function(){if(fe)return;var e=dashjs.MssHandler;"function"==typeof e&&(H.default.extend(e.errors),fe=e(l).create({eventBus:u,mediaPlayerModel:pe,dashMetrics:Se,manifestModel:Ae,playbackController:be,streamController:_e,protectionController:de,baseURLController:ve,errHandler:me,events:K.default,constants:a.default,debug:f,initSegmentType:v.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:Z.default,ISOBoxer:J.default,settings:c}))}(),_e&&_e.switchToVideoElement()),ie&&Qe(),tt()}function Ve(t){if(!I)throw e;var n=_e.getActiveStreamInfo();return ue.getTracksFor(t,n)}function We(e,t){var n=-1;e.some((function(e,r){if(e===t)return n=r,!0})),n<0||e.splice(n,1)}function ze(e){if(!A)throw o;"string"==typeof e&&Ce.initialize(e),m=e,(I||ie)&&Qe(),ke()&&tt()}function Xe(){if(!I)throw e;var t=_e.getActiveStreamInfo();return t?_e.getStreamById(t.id):null}function Qe(){ie=!1,I=!1,ge.reset(),_e.reset(),Te.reset(),be.reset(),se.reset(),ue.reset(),we.reset(),de&&(c.get().streaming.keepProtectionMediaKeys?de.stop():(de.reset(),de=null,Ze())),Re.reset()}function $e(){return(0,S.default)(l).create({debug:f,errHandler:me,dashMetrics:Se,mediaPlayerModel:pe,requestModifier:(0,N.default)(l).getInstance(),mssHandler:fe,settings:c})}function Ze(){if(de)return de;var e=dashjs.Protection;if("function"==typeof e){var t=e(l).create();return K.default.extend(e.events),Y.default.extend(e.events,{publicOnly:!0}),H.default.extend(e.errors),ye||(ye=(0,C.default)(l).getInstance()),(de=t.createProtectionSystem({debug:f,errHandler:me,videoModel:Ie,capabilities:ye,eventBus:u,events:K.default,BASE64:Z.default,constants:a.default,cmcdModel:Re,settings:c}))&&(de.setLicenseRequestFilters(Ne),de.setLicenseResponseFilters(Oe)),de}return null}function Je(){if(!A)throw o;if(he)return he;var e=dashjs.OfflineController;if("function"==typeof e){K.default.extend(e.events),Y.default.extend(e.events,{publicOnly:!0}),H.default.extend(e.errors);var t=$e(),n=(0,te.default)(l).create();return n.setConfig({manifestModel:Ae,adapter:ge,manifestLoader:t,errHandler:me}),he=e(l).create({debug:f,manifestUpdater:n,baseURLController:ve,manifestLoader:t,manifestModel:Ae,mediaPlayerModel:pe,abrController:se,playbackController:be,adapter:ge,errHandler:me,dashMetrics:Se,timelineConverter:le,schemeLoaderFactory:oe,eventBus:u,events:K.default,errors:H.default,constants:a.default,settings:c,dashConstants:s.default,urlUtils:(0,ne.default)(l).getInstance()})}return null}function et(e){var t=Se.getCurrentDVRInfo();return t?e+(t.manifestInfo.availableFrom.getTime()/1e3+t.range.start):0}function tt(){var e;he&&he.resetRecords(),!I&&m&&(I=!0,p.info("Streaming Initialized"),e=$e(),_e||(_e=(0,y.default)(l).getInstance()),Ee.setConfig({capabilities:ye,adapter:ge,settings:c}),Ee.setCustomCapabilitiesFilters(Pe),_e.setConfig({capabilities:ye,capabilitiesFilter:Ee,manifestLoader:e,manifestModel:Ae,mediaPlayerModel:pe,protectionController:de,adapter:ge,dashMetrics:Se,errHandler:me,timelineConverter:le,videoModel:Ie,playbackController:be,abrController:se,mediaController:ue,textController:we,settings:c,baseURLController:ve}),Te.setConfig({settings:c,playbackController:be,streamController:_e,videoModel:Ie,timelineConverter:le,adapter:ge}),be.setConfig({streamController:_e,dashMetrics:Se,mediaPlayerModel:pe,adapter:ge,videoModel:Ie,timelineConverter:le,uriFragmentModel:Ce,settings:c}),se.setConfig({streamController:_e,domStorage:De,mediaPlayerModel:pe,dashMetrics:Se,adapter:ge,videoModel:Ie,settings:c}),we.setConfig({errHandler:me,manifestModel:Ae,adapter:ge,mediaController:ue,streamController:_e,videoModel:Ie}),Re.setConfig({abrController:se,dashMetrics:Se,playbackController:be}),_e.initialize(ae,_),Te.initialize(),Re.initialize(),"string"==typeof m?_e.load(m):_e.loadWithManifest(m)),!ie&&ke()&&(ie=!0,p.info("Playback Initialized"))}return g={initialize:function(e,t,r){ye||(ye=(0,C.default)(l).getInstance()),me=(0,R.default)(l).getInstance(),ye.supportsMediaSource()?A||(A=!0,le=(0,$.default)(l).getInstance(),se||(se=(0,x.default)(l).getInstance()).setConfig({settings:c}),oe||(oe=(0,F.default)(l).getInstance()),be||(be=(0,h.default)(l).getInstance()),ue||(ue=(0,T.default)(l).getInstance()),_e||(_e=(0,y.default)(l).getInstance()),Te||(Te=(0,E.default)(l).getInstance()),Ee||(Ee=(0,D.default)(l).getInstance()),ge=(0,X.default)(l).getInstance(),Ae=(0,L.default)(l).getInstance(),Re=(0,B.default)(l).getInstance(),Se=(0,Q.default)(l).getInstance({settings:c}),we=(0,O.default)(l).getInstance(),De=(0,G.default)(l).getInstance({settings:c}),ge.setConfig({constants:a.default,cea608parser:n.default,errHandler:me,BASE64:Z.default}),ve||(ve=(0,b.default)(l).create()),ve.setConfig({adapter:ge}),(Me=(0,z.default)(l).getInstance({dashMetrics:Se,mediaPlayerModel:pe,errHandler:me,baseURLController:ve,events:K.default,eventBus:u,debug:f,boxParser:(0,re.default)(l).getInstance(),requestModifier:(0,N.default)(l).getInstance(),errors:H.default})).initialize(),ue.setConfig({domStorage:De,settings:c}),He(),je(void 0===r||r),Je(),e&&Ye(e),t&&ze(t),p.info("[dash.js "+xe()+"] MediaPlayer has been initialized")):me.error(new ee.default(H.default.CAPABILITY_MEDIASOURCE_ERROR_CODE,H.default.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(e){e&&(e.capabilities&&(ye=e.capabilities),e.capabilitiesFilter&&(Ee=e.capabilitiesFilter),e.streamController&&(_e=e.streamController),e.gapController&&(Te=e.gapController),e.playbackController&&(be=e.playbackController),e.mediaPlayerModel&&(pe=e.mediaPlayerModel),e.abrController&&(se=e.abrController),e.schemeLoaderFactory&&(oe=e.schemeLoaderFactory),e.mediaController&&(ue=e.mediaController),e.settings&&(c=e.settings))},on:function(e,t,n,r){u.on(e,t,n,r)},off:function(e,t,n){u.off(e,t,n)},extend:function(e,t,n){V.default.extend(e,t,n,l)},attachView:Ye,attachSource:ze,isReady:ke,preload:function(){if(Ie.getElement()||I)return!1;if(!m)throw i;tt()},play:function(){if(!ie)throw t;(!ae||Fe()&&ie)&&be.play()},isPaused:Fe,pause:function(){if(!ie)throw t;be.pause()},isSeeking:function(){if(!ie)throw t;return be.isSeeking()},isDynamic:function(){if(!ie)throw t;return be.getIsDynamic()},seek:function(e){if(!ie)throw t;if((0,w.checkParameterType)(e,"number"),isNaN(e))throw a.default.BAD_ARGUMENT_ERROR;var n=be.getIsDynamic()?Ue(e):e;be.seek(n)},setPlaybackRate:function(e){Ke().playbackRate=e},getPlaybackRate:function(){return Ke().playbackRate},setMute:function(e){(0,w.checkParameterType)(e,"boolean"),Ke().muted=e},isMuted:function(){return Ke().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw a.default.BAD_ARGUMENT_ERROR;Ke().volume=e},getVolume:function(){return Ke().volume},time:Be,duration:Ge,timeAsUTC:function(){if(!ie)throw t;return Be()<0?NaN:et(Be())},durationAsUTC:function(){if(!ie)throw t;return et(Ge())},getActiveStream:Xe,getDVRWindowSize:function(){var e=Se.getCurrentDVRInfo();return e?e.manifestInfo.DVRWindowSize:0},getDVRSeekOffset:Ue,convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(r<10?"0"+r.toString():r.toString())},formatUTC:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=new Date(1e3*e),a=i.toLocaleDateString(t),s=i.toLocaleTimeString(t,{hour12:n});return r?s+" "+a:s},getVersion:xe,getDebug:function(){return f},getBufferLength:function(e){var t=[a.default.VIDEO,a.default.AUDIO,a.default.FRAGMENTED_TEXT];if(e){if(-1!==t.indexOf(e)){var n=qe().getCurrentBufferLevel(e);return n||NaN}return p.warn("getBufferLength requested for invalid type"),NaN}var r=t.map((function(e){return Ve(e).length>0?qe().getCurrentBufferLevel(e):Number.MAX_VALUE})).reduce((function(e,t){return Math.min(e,t)}));return r===Number.MAX_VALUE?NaN:r},getTTMLRenderingDiv:function(){return Ie?Ie.getTTMLRenderingDiv():null},getVideoElement:Ke,getSource:function(){if(!m)throw i;return m},getCurrentLiveLatency:function(){if(!A)throw o;return ie?be.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(t){if(!I)throw e;return se.getTopBitrateInfoFor(t)},setAutoPlay:je,getAutoPlay:function(){return ae},getDashMetrics:qe,getQualityFor:function(t){if(!I)throw e;if(t===a.default.IMAGE){var n=Xe();if(!n)return-1;var r=n.getThumbnailController();return r?r.getCurrentTrackIndex():-1}return se.getQualityFor(t)},setQualityFor:function(t,n){if(!I)throw e;if(t===a.default.IMAGE){var r=Xe();if(!r)return;var i=r.getThumbnailController();i&&i.setTrackByIndex(n)}se.setPlaybackQuality(t,_e.getActiveStreamInfo(),n)},updatePortalSize:function(){se.setElementSize(),se.setWindowResizeEventCalled(!0)},setTextDefaultLanguage:function(e){p.warn('setTextDefaultLanguage is deprecated and will be removed in version 3.2.0. Please use setInitialMediaSettingsFor("fragmentedText", { lang: lang }) instead'),void 0===we&&(we=(0,O.default)(l).getInstance()),we.setTextDefaultLanguage(e)},getTextDefaultLanguage:function(){return p.warn('getTextDefaultLanguage is deprecated and will be removed in version 3.2.0. Please use getInitialMediaSettingsFor("fragmentedText").lang instead'),void 0===we&&(we=(0,O.default)(l).getInstance()),we.getTextDefaultLanguage()},setTextDefaultEnabled:function(e){void 0===we&&(we=(0,O.default)(l).getInstance()),we.setTextDefaultEnabled(e)},getTextDefaultEnabled:function(){return void 0===we&&(we=(0,O.default)(l).getInstance()),we.getTextDefaultEnabled()},enableText:function(e){void 0===we&&(we=(0,O.default)(l).getInstance()),we.enableText(e)},enableForcedTextStreaming:function(e){void 0===we&&(we=(0,O.default)(l).getInstance()),we.enableForcedTextStreaming(e)},isTextEnabled:function(){return void 0===we&&(we=(0,O.default)(l).getInstance()),we.isTextEnabled()},setTextTrack:function(e){if(!ie)throw t;void 0===we&&(we=(0,O.default)(l).getInstance()),we.setTextTrack(e)},getBitrateInfoListFor:function(t){if(!I)throw e;var n=Xe();return n?n.getBitrateListFor(t):[]},getStreamsFromManifest:function(t){if(!I)throw e;return ge.getStreamsInfo(t)},getTracksFor:Ve,getTracksForTypeFromManifest:function(t,n,r){if(!I)throw e;return(r=r||ge.getStreamsInfo(n,1)[0])?ge.getAllMediaInfoForType(r,t,n):[]},getCurrentTrackFor:function(t){if(!I)throw e;var n=_e.getActiveStreamInfo();return ue.getCurrentTrackFor(t,n)},setInitialMediaSettingsFor:function(e,t){if(!A)throw o;ue.setInitialSettings(e,t),e===a.default.FRAGMENTED_TEXT&&we.setInitialSettings(t)},getInitialMediaSettingsFor:function(e){if(!A)throw o;return ue.getInitialSettings(e)},setCurrentTrack:function(t){if(!I)throw e;ue.setTrack(t)},getTrackSwitchModeFor:function(e){if(!A)throw o;return ue.getSwitchMode(e)},setTrackSwitchModeFor:function(e,t){if(!A)throw o;ue.setSwitchMode(e,t)},setSelectionModeForInitialTrack:function(e){if(!A)throw o;ue.setSelectionModeForInitialTrack(e)},getSelectionModeForInitialTrack:function(){if(!A)throw o;return ue.getSelectionModeForInitialTrack()},addABRCustomRule:function(e,t,n){pe.addABRCustomRule(e,t,n)},removeABRCustomRule:function(e){pe.removeABRCustomRule(e)},removeAllABRCustomRule:function(){pe.removeABRCustomRule()},getAverageThroughput:function(e){var t=se.getThroughputHistory();return t?t.getAverageThroughput(e):0},retrieveManifest:function(e,t){var n=$e(),r=this;u.on(K.default.INTERNAL_MANIFEST_LOADED,(function e(i){i.error?t(null,i.error):t(i.manifest),u.off(K.default.INTERNAL_MANIFEST_LOADED,e,r),n.reset()}),r),Ce.initialize(e),n.load(e)},addUTCTimingSource:function(e,t){pe.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){pe.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){pe.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:He,setXHRWithCredentialsForType:function(e,t){pe.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return pe.getXHRWithCredentialsForType(e)},getProtectionController:function(){return Ze()},attachProtectionController:function(e){de=e},setProtectionData:function(e){_=e,_e&&_e.setProtectionData(_)},registerLicenseRequestFilter:function(e){Ne.push(e),de&&de.setLicenseRequestFilters(Ne)},registerLicenseResponseFilter:function(e){Oe.push(e),de&&de.setLicenseResponseFilters(Oe)},unregisterLicenseRequestFilter:function(e){We(Ne,e),de&&de.setLicenseRequestFilters(Ne)},unregisterLicenseResponseFilter:function(e){We(Oe,e),de&&de.setLicenseResponseFilters(Oe)},registerCustomCapabilitiesFilter:function(e){Pe.push(e),Ee&&Ee.setCustomCapabilitiesFilters(Pe)},unregisterCustomCapabilitiesFilter:function(e){We(Pe,e),Ee&&Ee.setCustomCapabilitiesFilters(Pe)},displayCaptionsOnTop:function(e){var t=(0,M.default)(l).getInstance();t.setConfig({videoModel:Ie}),t.initialize(),t.setDisplayCConTop(e)},attachTTMLRenderingDiv:function(e){if(!Ie.getElement())throw r;Ie.setTTMLRenderingDiv(e)},getCurrentTextTrackIndex:function(){var e=NaN;return we&&(e=we.getCurrentTrackIdx()),e},provideThumbnail:function(e,t){if("function"==typeof t)if(e<0)t(null);else{var n=be.getIsDynamic()?Ue(e):e,r=_e.getStreamForTime(n);if(null!==r){var i=r.getThumbnailController();if(i){var a=_e.getTimeRelativeToStreamId(n,r.getId());return i.provide(a,t)}t(null)}else t(null)}},getDashAdapter:function(){return ge},getOfflineController:function(){return Je()},getSettings:function(){return c.get()},updateSettings:function(e){c.update(e)},resetSettings:function(){c.reset()},reset:Le,destroy:function(){Le(),Ne=[],Oe=[],Pe=[],V.default.deleteSingletonInstances(l)}},p=f.getLogger(g),A=!1,ie=!1,I=!1,ae=!0,de=null,he=null,_=null,ge=null,Me=null,K.default.extend(Y.default),pe=(0,k.default)(l).getInstance(),Ie=(0,U.default)(l).getInstance(),Ce=(0,P.default)(l).getInstance(),Ne=[],Oe=[],Pe=[],g}ae.__dashjs_factory_name="MediaPlayer";var se=V.default.getClassFactory(ae);se.events=Y.default,se.errors=H.default,V.default.updateClassFactory(ae.__dashjs_factory_name,se),t.default=se}));t(Ca);var Da=n((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Debug=n.FactoryMaker=n.MediaPlayer=void 0;var r=s(Ca),i=s(u),a=s(p);function s(e){return e&&e.__esModule?e:{default:e}}var o="undefined"!=typeof window&&window||e,l=o.dashjs;l||(l=o.dashjs={}),l.MediaPlayer=r.default,l.FactoryMaker=i.default,l.Debug=a.default,l.Version=(0,ta.getVersionString)(),n.default=l,n.MediaPlayer=r.default,n.FactoryMaker=i.default,n.Debug=a.default}));t(Da),Da.Debug,Da.FactoryMaker,Da.MediaPlayer;var Ma=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};n.SSL_CONNECTION_FAILED_PREFIX="SSL",n.DNS_RESOLUTION_FAILED="C00",n.HOST_UNREACHABLE="C01",n.CONNECTION_REFUSED="C02",n.CONNECTION_ERROR="C03",n.CORRUPT_MEDIA_ISOBMFF="M00",n.CORRUPT_MEDIA_OTHER="M01",n.BASE_URL_CHANGED="F00",n.BECAME_REPORTER="S00",t.default=n}));t(Ma);var Na=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(Ma),r=i(Kr);function i(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=void 0,i=void 0,a=(e=e||{}).eventBus,s=e.dashMetrics,o=e.metricsConstants,l=e.events;function u(e){var t=new n.default;if(i){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.mpdurl||(t.mpdurl=i.originalUrl||i.url),t.terror||(t.terror=new Date),s.addDVBErrors(t)}}function d(e){e.error||(i=e.manifest)}function c(e){u({errorcode:n.default.BASE_URL_CHANGED,servicelocation:e.entry})}function f(){u({errorcode:n.default.BECAME_REPORTER})}function h(e){if(e.metric===o.HTTP_REQUEST)(0===(t=e.value).responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&u({errorcode:t.responsecode||n.default.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation});var t}function g(e){var t=void 0;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=n.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=n.default.CORRUPT_MEDIA_OTHER;break;default:return}u({errorcode:t})}function p(){a.on(l.MANIFEST_UPDATED,d,t),a.on(l.SERVICE_LOCATION_BLACKLIST_CHANGED,c,t),a.on(l.METRIC_ADDED,h,t),a.on(l.METRIC_UPDATED,h,t),a.on(l.PLAYBACK_ERROR,g,t),a.on(r.default.BECAME_REPORTING_PLAYER,f,t)}return t={initialise:p,reset:function(){a.off(l.MANIFEST_UPDATED,d,t),a.off(l.SERVICE_LOCATION_BLACKLIST_CHANGED,c,t),a.off(l.METRIC_ADDED,h,t),a.off(l.METRIC_UPDATED,h,t),a.off(l.PLAYBACK_ERROR,g,t),a.off(r.default.BECAME_REPORTING_PLAYER,f,t)}},p(),t}a.__dashjs_factory_name="DVBErrorsTranslator",t.default=dashjs.FactoryMaker.getSingletonFactory(a)}));t(Na);var Oa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=C)&&n.__esModule?n:{default:n};function i(e){e=e||{};var t,n=!1,i=this.context,a=void 0,s=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach((function(e){var t=e.starttime,n=t+e.duration;a.add(t,n)})),n=!!e[0]._useWallClockTime)},reset:function(){a.clear()},isEnabled:function(){var e,t=a.length;if(!t)return!0;e=n?(new Date).getTime()/1e3:s.currentTime;for(var r=0;r<t;r+=1){var i=a.start(r),o=a.end(r);if(i<=e&&e<o)return!0}return!1}},a=(0,r.default)(i).create(),t}i.__dashjs_factory_name="RangeController",t.default=dashjs.FactoryMaker.getClassFactory(i)}));t(Oa);var Pa=n((function(e,t){function n(){return{serialise:function e(t){var n=[],r=[],i=void 0,a=void 0;for(i in t)if(t.hasOwnProperty(i)&&0!==i.indexOf("_")){if(null==(a=t[i])&&(a=""),Array.isArray(a)){if(!a.length)continue;r=[],a.forEach((function(t){var n="Object"!==Object.prototype.toString.call(t).slice(8,-1);r.push(n?t:e(t))})),a=r.map(encodeURIComponent).join(",")}else"string"==typeof a?a=encodeURIComponent(a):a instanceof Date?a=a.toISOString():"number"==typeof a&&(a=Math.round(a));n.push(i+"="+a)}return n.join("&")}}}Object.defineProperty(t,"__esModule",{value:!0}),n.__dashjs_factory_name="MetricSerialiser",t.default=dashjs.FactoryMaker.getSingletonFactory(n)}));t(Pa);var La=n((function(e,t){function n(){var e,t=window.crypto||window.msCrypto,n=Uint32Array,r=Math.pow(2,8*n.BYTES_PER_ELEMENT)-1,i=void 0,a=void 0;function s(){t&&(i||(i=new n(10)),t.getRandomValues(i),a=0)}return e={random:function(e,n){var o=void 0;return e||(e=0),n||(n=1),t?(a===i.length&&s(),o=i[a]/r,a+=1):o=Math.random(),o*(n-e)+e}},s(),e}Object.defineProperty(t,"__esModule",{value:!0}),n.__dashjs_factory_name="RNG",t.default=dashjs.FactoryMaker.getSingletonFactory(n)}));t(La);var ka=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(Pa),r=i(La);function i(e){return e&&e.__esModule?e:{default:e}}function a(e){e=e||{};var t,i=this.context,a=void 0,s=void 0,o=void 0,l=void 0,u=void 0,d=void 0,c=[],f=e.metricsConstants;function h(){o=!1,l=!1,u=null,d=null}return t={report:function(e,t){Array.isArray(t)||(t=[t]),l&&d.isEnabled()&&t.forEach((function(t){var n=a.serialise(t);e!==f.DVB_ERRORS&&(n="metricname="+e+"&"+n),function(e,t,n){var r=new XMLHttpRequest,i=function(){var e=c.indexOf(r);-1!==e&&(c.splice(e,1),r.status>=200&&r.status<300?t&&t():n&&n())};c.push(r);try{r.open("GET",e),r.onloadend=i,r.onerror=i,r.send()}catch(e){r.onerror()}}(n=u+"?"+n,null,(function(){l=!1}))}))},initialize:function(e,t){var n=void 0;if(d=t,!(u=e.dvb_reportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");o||((n=e.dvb_probability)&&(1e3===n||n/1e3>=s.random())&&(l=!0),o=!0)},reset:function(){h()}},a=(0,n.default)(i).getInstance(),s=(0,r.default)(i).getInstance(),h(),t}a.__dashjs_factory_name="DVBReporting",t.default=dashjs.FactoryMaker.getClassFactory(a)}));t(ka);var xa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=ka)&&n.__esModule?n:{default:n};function i(e){e=e||{};var t={"urn:dvb:dash:reporting:2014":r.default},n=this.context,i=void 0,a=e.debug?e.debug.getLogger(i):{},s=e.metricsConstants;return i={create:function(e,r){var i=void 0;try{(i=t[e.schemeIdUri](n).create({metricsConstants:s})).initialize(e,r)}catch(t){i=null,a.error("ReportingFactory: could not create Reporting with schemeIdUri "+e.schemeIdUri+" ("+t.message+")")}return i},register:function(e,n){t[e]=n},unregister:function(e){delete t[e]}}}i.__dashjs_factory_name="ReportingFactory",t.default=dashjs.FactoryMaker.getSingletonFactory(i)}));t(xa);var Fa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=xa)&&n.__esModule?n:{default:n};function i(e){var t=[],n=(0,r.default)(this.context).getInstance(e);return{initialize:function(e,r){e.some((function(e){var i=n.create(e,r);if(i)return t.push(i),!0}))},reset:function(){t.forEach((function(e){return e.reset()})),t=[]},report:function(e,n){t.forEach((function(t){return t.report(e,n)}))}}}i.__dashjs_factory_name="ReportingController",t.default=dashjs.FactoryMaker.getClassFactory(i)}));t(Fa);var Ua=n((function(e,t){function n(){return{reconstructFullMetricName:function(e,t,n){var r=e;return t&&(r+="("+t,n&&n.length&&(r+=","+n),r+=")"),r},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}Object.defineProperty(t,"__esModule",{value:!0}),n.__dashjs_factory_name="HandlerHelpers",t.default=dashjs.FactoryMaker.getSingletonFactory(n)}));t(Ua);var Ba=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=Ua)&&n.__esModule?n:{default:n};function i(e){e=e||{};var t=void 0,n=void 0,i=void 0,a=void 0,s=void 0,o=this.context,l=(0,r.default)(o).getInstance(),u=[],d=e.metricsConstants;function c(){var e=function(){try{return Object.keys(u).map((function(e){return u[e]})).reduce((function(e,t){return e.level<t.level?e:t}))}catch(e){return}}();e&&s!==e.t&&(s=e.t,t.report(i,e))}return{initialize:function(e,r,s){r&&(n=l.validateN(s),t=r,i=l.reconstructFullMetricName(e,s),a=setInterval(c,n))},reset:function(){clearInterval(a),a=null,n=0,t=null,s=null},handleNewMetric:function(e,t,n){e===d.BUFFER_LEVEL&&(u[n]=t)}}}i.__dashjs_factory_name="BufferLevelHandler",t.default=dashjs.FactoryMaker.getClassFactory(i)}));t(Ba);var Ga=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=Kr)&&n.__esModule?n:{default:n};t.default=dashjs.FactoryMaker.getClassFactory((function(e){var t=void 0,n=(e=e||{}).eventBus,i=e.metricsConstants;function a(){n.off(r.default.METRICS_INITIALISATION_COMPLETE,a,this),n.trigger(r.default.BECAME_REPORTING_PLAYER)}return{initialize:function(e,i){i&&(t=i,n.on(r.default.METRICS_INITIALISATION_COMPLETE,a,this))},reset:function(){t=null},handleNewMetric:function(e,n){e===i.DVB_ERRORS&&t&&t.report(e,n)}}}))}));t(Ga);var ja=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=Ua)&&n.__esModule?n:{default:n};function i(e){e=e||{};var t=void 0,n=void 0,i=void 0,a=void 0,s=void 0,o=[],l=(0,r.default)(this.context).getInstance(),u=e.metricsConstants;function d(){var e=o;e.length&&t&&t.report(a,e),o=[]}return{initialize:function(e,r,o,u){r&&(n=l.validateN(o),t=r,u&&u.length&&(i=u),a=l.reconstructFullMetricName(e,o,u),s=setInterval(d,n))},reset:function(){clearInterval(s),s=null,n=null,i=null,o=[],t=null},handleNewMetric:function(e,t){e===u.HTTP_REQUEST&&(i&&i!==t.type||o.push(t))}}}i.__dashjs_factory_name="HttpListHandler",t.default=dashjs.FactoryMaker.getClassFactory(i)}));t(ja);var Ha=n((function(e,t){function n(){var e=void 0,t=void 0;return{initialize:function(n,r){e=n,t=r},reset:function(){t=null,e=void 0},handleNewMetric:function(n,r){n===e&&t&&t.report(e,r)}}}Object.defineProperty(t,"__esModule",{value:!0}),n.__dashjs_factory_name="GenericMetricHandler",t.default=dashjs.FactoryMaker.getClassFactory(n)}));t(Ha);var qa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(Ba),r=s(Ga),i=s(ja),a=s(Ha);function s(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=void 0,s=(e=e||{}).debug?e.debug.getLogger(t):{},o=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,l=this.context,u={BufferLevel:n.default,DVBErrors:r.default,HttpList:i.default,PlayList:a.default,RepSwitchList:a.default,TcpList:a.default};return t={create:function(t,n){var r,i=t.match(o);if(i){try{(r=u[i[1]](l).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants})).initialize(i[1],n,i[3],i[5])}catch(e){r=null,s.error("MetricsHandlerFactory: Could not create handler for type "+i[1]+" with args "+i[3]+", "+i[5]+" ("+e.message+")")}return r}},register:function(e,t){u[e]=t},unregister:function(e){delete u[e]}},t}o.__dashjs_factory_name="MetricsHandlerFactory",t.default=dashjs.FactoryMaker.getSingletonFactory(o)}));t(qa);var Ka=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=qa)&&n.__esModule?n:{default:n};function i(e){e=e||{};var t=[],n=void 0,i=this.context,a=e.eventBus,s=e.events,o=(0,r.default)(i).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function l(e){t.forEach((function(t){t.handleNewMetric(e.metric,e.value,e.mediaType)}))}return n={initialize:function(e,r){e.split(",").forEach((function(e,n,i){var a;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var s=i[n+1];s&&-1===s.indexOf("(")&&-1!==s.indexOf(")")&&(e+=","+s,delete i[n+1])}(a=o.create(e,r))&&t.push(a)})),a.on(s.METRIC_ADDED,l,n),a.on(s.METRIC_UPDATED,l,n)},reset:function(){a.off(s.METRIC_ADDED,l,n),a.off(s.METRIC_UPDATED,l,n),t.forEach((function(e){return e.reset()})),t=[]}}}i.__dashjs_factory_name="MetricsHandlersController",t.default=dashjs.FactoryMaker.getClassFactory(i)}));t(Ka);var Ya=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(Oa),r=a(Fa),i=a(Ka);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){e=e||{};var t=void 0,a=void 0,s=void 0,o=this.context;function l(){t&&t.reset(),a&&a.reset(),s&&s.reset()}return{initialize:function(u){try{(s=(0,n.default)(o).create({mediaElement:e.mediaElement})).initialize(u.Range),(a=(0,r.default)(o).create({debug:e.debug,metricsConstants:e.metricsConstants})).initialize(u.Reporting,s),(t=(0,i.default)(o).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events})).initialize(u.metrics,a)}catch(e){throw l(),e}},reset:l}}s.__dashjs_factory_name="MetricsController",t.default=dashjs.FactoryMaker.getClassFactory(s)}));t(Ya);var Va=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metrics="",this.Range=[],this.Reporting=[]}}));t(Va);var Wa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1}}));t(Wa);var za=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value="",this.dvb_reportingUrl="",this.dvb_probability=1e3}}));t(za);var Xa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(Va),r=a(Wa),i=a(za);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=(e=e||{}).adapter,a=e.constants;return{getMetrics:function(e){var s=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach((function(o){var l=new n.default,u=t.getIsDynamic(e);o.hasOwnProperty("metrics")&&(l.metrics=o.metrics,o.Range_asArray&&o.Range_asArray.forEach((function(n){var i=new r.default;i.starttime=function(e,n,r){var i=void 0,s=void 0,o=0;return n?o=t.getAvailabilityStartTime(e)/1e3:(i=t.getRegularPeriods(e)).length&&(o=i[0].start),s=o,r&&r.hasOwnProperty(a.START_TIME)&&(s+=r.starttime),s}(e,u,n),n.hasOwnProperty("duration")?i.duration=n.duration:i.duration=t.getDuration(e),i._useWallClockTime=u,l.Range.push(i)})),o.Reporting_asArray&&(o.Reporting_asArray.forEach((function(e){var t=new i.default;e.hasOwnProperty(a.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(a.DVB_REPORTING_URL)&&(t.dvb_reportingUrl=e[a.DVB_REPORTING_URL]),e.hasOwnProperty(a.DVB_PROBABILITY)&&(t.dvb_probability=e[a.DVB_PROBABILITY]),l.Reporting.push(t))})),s.push(l)))})),s}}}s.__dashjs_factory_name="ManifestParsing",t.default=dashjs.FactoryMaker.getSingletonFactory(s)}));t(Xa);var Qa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(Ya),r=a(Xa),i=a(Kr);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){e=e||{};var t=void 0,a={},s=this.context,o=e.eventBus,l=e.events;function u(t){if(!t.error){var l=Object.keys(a);(0,r.default)(s).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest).forEach((function(t){var r=JSON.stringify(t);if(a.hasOwnProperty(r))l.splice(r,1);else try{var i=(0,n.default)(s).create(e);i.initialize(t),a[r]=i}catch(e){}})),l.forEach((function(e){a[e].reset(),delete a[e]})),o.trigger(i.default.METRICS_INITIALISATION_COMPLETE)}}function d(){Object.keys(a).forEach((function(e){a[e].reset()})),a={}}return t={reset:function(){o.off(l.MANIFEST_UPDATED,u,t),o.off(l.STREAM_TEARDOWN_COMPLETE,d,t)}},o.on(l.MANIFEST_UPDATED,u,t),o.on(l.STREAM_TEARDOWN_COMPLETE,d,t),t}s.__dashjs_factory_name="MetricsCollectionController",t.default=dashjs.FactoryMaker.getClassFactory(s)}));t(Qa);var $a=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(Na),r=o(Kr),i=o(Qa),a=o(qa),s=o(xa);function o(e){return e&&e.__esModule?e:{default:e}}function l(){var e,t=this.context;return e={createMetricsReporting:function(e){return(0,n.default)(t).getInstance({eventBus:e.eventBus,dashMetrics:e.dashMetrics,metricsConstants:e.metricsConstants,events:e.events}),(0,i.default)(t).create(e)},getReportingFactory:function(){return(0,s.default)(t).getInstance()},getMetricsHandlerFactory:function(){return(0,a.default)(t).getInstance()}},e}l.__dashjs_factory_name="MetricsReporting";var u=dashjs.FactoryMaker.getClassFactory(l);u.events=r.default,dashjs.FactoryMaker.updateClassFactory(l.__dashjs_factory_name,u),t.default=u}));t($a);var Za=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"findCencContentProtection",value:function(e){for(var t=null,n=0;n<e.length;++n){var r=e[n];"urn:mpeg:dash:mp4protection:2011"!==r.schemeIdUri.toLowerCase()||"cenc"!==r.value.toLowerCase()&&"cbcs"!==r.value.toLowerCase()||(t=r)}return t}},{key:"getPSSHData",value:function(e){var t=8,n=new DataView(e),r=n.getUint8(t);return t+=20,r>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,n){var r=e.parsePSSHList(n);return t&&r.hasOwnProperty(t.uuid.toLowerCase())?r[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),n={},r=0;;){var i,a,s=void 0,o=r;if(r>=t.buffer.byteLength)break;if(i=r+t.getUint32(r),r+=4,1886614376===t.getUint32(r))if(r+=4,0===(a=t.getUint8(r))||1===a){r++,r+=3,s="";var l=void 0,u=void 0;for(l=0;l<4;l++)s+=1===(u=t.getUint8(r+l).toString(16)).length?"0"+u:u;for(r+=4,s+="-",l=0;l<2;l++)s+=1===(u=t.getUint8(r+l).toString(16)).length?"0"+u:u;for(r+=2,s+="-",l=0;l<2;l++)s+=1===(u=t.getUint8(r+l).toString(16)).length?"0"+u:u;for(r+=2,s+="-",l=0;l<2;l++)s+=1===(u=t.getUint8(r+l).toString(16)).length?"0"+u:u;for(r+=2,s+="-",l=0;l<6;l++)s+=1===(u=t.getUint8(r+l).toString(16)).length?"0"+u:u;r+=6,s=s.toLowerCase(),t.getUint32(r),r+=4,n[s]=t.buffer.slice(o,i),r=i}else r=i;else r=i}return n}}]),e}();t.default=r}));t(Za);var Ja=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=n}}));t(Ja);var es=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),n&&n.length&&(this.videoCapabilities=n),this.distinctiveIdentifier=r,this.persistentState=i,this.sessionTypes=a}}));t(es);var ts=n((function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=qn)&&n.__esModule?n:{default:n}).default));t.default=r}));t(ts);var ns=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n,r,i,a,s,o,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.method=n,this.responseType=r,this.headers=i,this.withCredentials=a,this.messageType=s,this.sessionId=o,this.data=l}}));t(ns);var rs=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.headers=n,this.data=r}}));t(rs);var is=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=h(Za),a=h(Ja),s=h(es),o=h(ts),l=h(_),u=h(ns),d=h(rs),c=h(jr),f=h(i);function h(e){return e&&e.__esModule?e:{default:e}}function g(e){var t=(e=e||{}).protectionKeyController,i=e.protectionModel,h=e.eventBus,g=e.events,p=e.debug,m=e.BASE64,y=e.constants,E=[],_=e.cmcdModel,T=e.settings,b=void 0,S=void 0,A=void 0,R=void 0,I=void 0,w=void 0,C=void 0,D=void 0,M=void 0,N=void 0;function O(){if(!(h&&h.hasOwnProperty("on")&&t&&t.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function P(e,t){var n=r.default.getPSSHForKeySystem(D,e),a=F(D);if(n){if(L(n))return;try{i.createKeySession(n,a,B(D),t)}catch(e){h.trigger(g.KEY_SESSION_CREATED,{data:null,error:new l.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e?i.createKeySession(e,a,B(D),t):h.trigger(g.KEY_SESSION_CREATED,{data:null,error:new l.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(D?D.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function L(e){if(!e)return!1;try{for(var n=i.getAllInitData(),r=0;r<n.length;r++)if(t.initDataEquals(e,n[r]))return S.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function k(e,t){O(),i.loadKeySession(e,t,B(D))}function x(e){O(),e?(i.setMediaElement(e),h.on(g.NEED_KEY,Y,this)):null===e&&(i.setMediaElement(e),h.off(g.NEED_KEY,Y,this))}function F(e){var t=null;if(e){var n=e.systemString;I&&(t=n in I?I[n]:null)}return t}function U(e){var t=F(e),n=[],r=[],i=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:C,o=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:C,l=B(e),u=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",d=t&&t.persistentState?t.persistentState:"temporary"===l?"optional":"required";return R.forEach((function(e){e.type===y.AUDIO?n.push(new a.default(e.codec,i)):e.type===y.VIDEO&&r.push(new a.default(e.codec,o))})),new s.default(n,r,u,d,[l])}function B(e){var t=F(e);return t&&t.sessionType?t.sessionType:w}function G(e,n){e=e.sort((function(t,n){return(I&&I[t.ks.systemString]&&I[t.ks.systemString].priority>=0?I[t.ks.systemString].priority:e.length)-(I&&I[n.ks.systemString]&&I[n.ks.systemString].priority>=0?I[n.ks.systemString].priority:e.length)})),void 0===D?function(e,n){var r=this,a=[],s=void 0;D=null,A.push(e);for(var u=0;u<e.length;u++)a.push({ks:e[u].ks,configs:[U(e[u].ks)]});var d=void 0,c=function e(t){h.off(g.KEY_SYSTEM_ACCESS_COMPLETE,e,r),t.error?(D=void 0,h.off(g.INTERNAL_KEY_SYSTEM_SELECTED,f,r),n||h.trigger(g.KEY_SYSTEM_SELECTED,{data:null,error:new l.default(o.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,o.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+t.error)})):(d=t.data,S.info("DRM: KeySystem Access Granted ("+d.keySystem.systemString+")!  Selecting key system..."),i.selectKeySystem(d))},f=function e(a){if(h.off(g.INTERNAL_KEY_SYSTEM_SELECTED,e,r),h.off(g.KEY_SYSTEM_ACCESS_COMPLETE,c,r),a.error)D=void 0,n||h.trigger(g.KEY_SYSTEM_SELECTED,{data:null,error:new l.default(o.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,o.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+a.error)});else{if(!i)return;D=i.getKeySystem(),h.trigger(g.KEY_SYSTEM_SELECTED,{data:d});var u=F(D);u&&u.serverCertificate&&u.serverCertificate.length>0&&i.setServerCertificate(m.decodeArray(u.serverCertificate).buffer);for(var f=0;f<A.length;f++)for(s=0;s<A[f].length;s++)if(D===A[f][s].ks){if(t.isClearKey(D)&&u&&u.hasOwnProperty("clearkeys")){var p={kids:Object.keys(u.clearkeys)};A[f][s].initData=(new TextEncoder).encode(JSON.stringify(p))}A[f][s].sessionId?k(A[f][s].sessionId,A[f][s].initData):null!==A[f][s].initData&&P(A[f][s].initData,A[f][s].cdmData);break}}};h.on(g.INTERNAL_KEY_SYSTEM_SELECTED,f,r),h.on(g.KEY_SYSTEM_ACCESS_COMPLETE,c,r),i.requestKeySystemAccess(a)}(e,n):D?function(e,n){var a=this,s=[],u=e.findIndex((function(e){return e.ks===D}));if(-1===u||!e[u].initData)return;if(L(r.default.getPSSHForKeySystem(D,e[u].initData)))return;s.push({ks:e[u].ks,configs:[U(D)]});var d=function r(i){if(h.off(g.KEY_SYSTEM_ACCESS_COMPLETE,r,a),i.error)n||h.trigger(g.KEY_SYSTEM_SELECTED,{error:new l.default(o.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,o.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+i.error)});else{S.info("DRM: KeySystem Access Granted"),h.trigger(g.KEY_SYSTEM_SELECTED,{data:i.data});var s=F(D);if(t.isClearKey(D)&&s&&s.hasOwnProperty("clearkeys")){var d={kids:Object.keys(s.clearkeys)};e[u].initData=(new TextEncoder).encode(JSON.stringify(d))}e[u].sessionId?k(e[u].sessionId,e[u].initData):e[u].initData&&P(e[u].initData,e[u].cdmData)}};h.on(g.KEY_SYSTEM_ACCESS_COMPLETE,d,a),i.requestKeySystemAccess(s)}(e,n):A.push(e)}function j(e,t){h.trigger(g.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function H(e){e.error?h.trigger(g.KEY_STATUSES_CHANGED,{data:null,error:e.error}):S.debug("DRM: key status = "+e.status)}function q(e){S.debug("DRM: onKeyMessage");var a=e.data;h.trigger(g.KEY_MESSAGE,{data:a});var s=a.messageType?a.messageType:"license-request",f=a.message,p=a.sessionToken,m=F(D),v=D?D.systemString:null,y=t.getLicenseServer(D,m,s),E={sessionToken:p,messageType:s};if(f&&0!==f.byteLength){if(!y)return S.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+p.getSessionID()),void j(E);if(t.isClearKey(D)){var _=t.processClearKeyLicenseRequest(D,m,f);if(_)return S.debug("DRM: ClearKey license request handled by application!"),j(E),void i.updateKeySession(p,_)}var T=null;if(m&&m.serverURL){var b=m.serverURL;"string"==typeof b&&""!==b?T=b:"object"===(void 0===b?"undefined":n(b))&&b.hasOwnProperty(s)&&(T=b[s])}else if(m&&m.laURL&&""!==m.laURL)T=m.laURL;else if(t.isClearKey(D))T=D.getLicenseServerUrlFromMediaInfo(R);else{var A=r.default.getPSSHData(p.initData);(T=D.getLicenseServerURLFromInitData(A))||(T=e.data.laURL)}if(T=y.getServerURLFromMessage(T,f,s)){var I={},w=!1,C=function(e){if(e)for(var t in e)"authorization"===t.toLowerCase()&&(w=!0),I[t]=e[t]};m&&C(m.httpRequestHeaders),C(D.getRequestHeadersFromMessage(f)),m&&"boolean"==typeof m.withCredentials&&(w=m.withCredentials);var O=function(e,t,n,r){var i=e.response?y.getErrorResponse(e.response,n,r):"NONE";j(t,new l.default(o.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,o.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+i))},P=function(e){if(i)if(200===e.status){var t=new d.default(e.responseURL,c.default.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),e.response);V(N,t).then((function(){var n=y.getLicenseMessage(t.data,v,s);null!==n?(j(E),i.updateKeySession(p,n)):O(e,E,v,s)}))}else O(e,E,v,s)},L=function(e){j(E,new l.default(o.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,o.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+v+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},k=function(e){j(E,new l.default(o.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,o.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+v+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},x=D.getLicenseRequestFromMessage(f),U=y.getHTTPMethod(s),B=y.getResponseType(v,s),G=m&&!isNaN(m.httpTimeout)?m.httpTimeout:8e3,H=p.getSessionID()||null,q=new u.default(T,U,B,I,w,s,H,x);V(M,q).then((function(){K(q,3,G,P,L,k)}))}else j(E,new l.default(o.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,o.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}else j(E,new l.default(o.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,o.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function K(e,t,n,r,i,a){var s=new XMLHttpRequest;if(T.get().streaming.cmcd&&T.get().streaming.cmcd.enabled&&T.get().streaming.cmcd.mode===f.default.CMCD_MODE_QUERY){var o=_.getQueryParameter({url:e.url,type:v.HTTPRequest.LICENSE});o&&(e.url=c.default.addAditionalQueryParameterToUrl(e.url,[o]))}for(var l in s.open(e.method,e.url,!0),s.responseType=e.responseType,s.withCredentials=e.withCredentials,n>0&&(s.timeout=n),e.headers)s.setRequestHeader(l,e.headers[l]);if(T.get().streaming.cmcd&&T.get().streaming.cmcd.enabled&&T.get().streaming.cmcd.mode===f.default.CMCD_MODE_HEADER){var u=_.getHeaderParameters({url:e.url,type:v.HTTPRequest.LICENSE});if(u)for(var d in u){var p=u[d];p&&s.setRequestHeader(d,p)}}var m=function(){t--,setTimeout((function(){K(e,t,n,r,i,a)}),1e3)};s.onload=function(){200===this.status||t<=0?r(this):(S.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+t),m())},s.ontimeout=s.onerror=function(){t<=0?a(this):(S.warn("License request network request failed . Retrying it... Pending retries: "+t),m())},s.onabort=function(){i(this)},h.trigger(g.LICENSE_REQUEST_SENDING,{url:e.url,headers:e.headers,payload:e.data,sessionId:e.sessionId}),s.send(e.data)}function Y(e,n){if(S.debug("DRM: onNeedKey"),"cenc"===e.key.initDataType)if(0===R.length&&(S.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(n=void 0===n?1:n+1)<5))E.push(setTimeout((function(){Y(e,n)}),500));else{var i=e.key.initData;if(ArrayBuffer.isView(i)&&(i=i.buffer),D){var a=r.default.getPSSHForKeySystem(D,i);if(a&&L(a))return}S.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(i)));var s=t.getSupportedKeySystems(i,I);0!==s.length?G(s,!1):S.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!")}else S.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType)}function V(e,t){return e?e.reduce((function(e,n){return e.then((function(){return n(t)}))}),Promise.resolve()):Promise.resolve()}return b={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");O(),h.on(g.INTERNAL_KEY_MESSAGE,q,this),h.on(g.INTERNAL_KEY_STATUS_CHANGED,H,this),R.push(e);var n=t.getSupportedKeySystemsFromContentProtection(e.contentProtection);n&&n.length>0&&G(n,!0)},clearMediaInfoArrayByStreamId:function(e){R=R.filter((function(t){return t.streamInfo.id!==e}))},createKeySession:P,loadKeySession:k,removeKeySession:function(e){O(),i.removeKeySession(e)},closeKeySession:function(e){O(),i.closeKeySession(e)},setServerCertificate:function(e){O(),i.setServerCertificate(e)},setMediaElement:x,setSessionType:function(e){w=e},setRobustnessLevel:function(e){C=e},setProtectionData:function(e){I=e,t.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return O(),t.getSupportedKeySystemsFromContentProtection(e)},getKeySystems:function(){return t?t.getKeySystems():[]},setKeySystems:function(e){t&&t.setKeySystems(e)},setLicenseRequestFilters:function(e){M=e},setLicenseResponseFilters:function(e){N=e},stop:function(){i&&i.stop()},reset:function(){O(),M=[],N=[],h.off(g.INTERNAL_KEY_MESSAGE,q,this),h.off(g.INTERNAL_KEY_STATUS_CHANGED,H,this),x(null),D=void 0,i&&(i.reset(),i=null),E.forEach((function(e){return clearTimeout(e)})),E=[],R=[]}},S=p.getLogger(b),A=[],R=[],w="temporary",C="",M=[],N=[],b}g.__dashjs_factory_name="ProtectionController",t.default=dashjs.FactoryMaker.getClassFactory(g)}));t(is);var as=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=n}}));t(as);var ss=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=n}return n(e,[{key:"toJWK",value:function(){var e=void 0,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){var r={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(r)}this.type&&(n.type=this.type);var i=JSON.stringify(n),a=i.length,s=new ArrayBuffer(a),o=new Uint8Array(s);for(e=0;e<a;e++)o[e]=i.charCodeAt(e);return s}}]),e}();t.default=r}));t(ss);var os=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return n(e,[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"}}]),e}());t.default=r}));t(os);var ls=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(as),r=s(ss),i=s(Za),a=s(os);function s(e){return e&&e.__esModule?e:{default:e}}var o="e2719d58-a985-b3c9-781a-b030af78d30e",l=a.default.CLEARKEY_KEYSTEM_STRING,u="urn:uuid:"+o;function d(e){var t=(e=e||{}).BASE64,a={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]};return{uuid:o,schemeIdURI:u,systemString:l,getInitData:function(e,n){try{var r=i.default.parseInitDataFromContentProtection(e,t);if(!r&&n){var a={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))).replace(/=/g,"")}catch(e){return null}}(n["cenc:default_KID"])]};r=(new TextEncoder).encode(JSON.stringify(a))}return r}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getLicenseServerUrlFromMediaInfo:function(e){try{if(!e||0===e.length)return null;for(var t=0,n=null;t<e.length&&!n;){var r=e[t];if(r&&r.contentProtection&&r.contentProtection.length>0){var i=r.contentProtection.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===u}));if(i&&i.length>0)for(var s=0;s<i.length&&!n;){for(var o=i[s],l=0;l<a.attributes.length&&!n;){for(var d=0,c=a.attributes[l];d<a.prefixes.length&&!n;){var f=a.prefixes[d];o[c]&&o[c].__prefix&&o[c].__prefix===f&&o[c].__text&&(n=o[c].__text),d+=1}l+=1}s+=1}}t+=1}return n}catch(e){return null}},getClearKeysFromProtectionData:function(e,t){var i=null;if(e){for(var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),s=[],o=0;o<a.kids.length;o++){var l=a.kids[o],u=e.clearkeys&&e.clearkeys.hasOwnProperty(l)?e.clearkeys[l]:null;if(!u)throw new Error("DRM: ClearKey keyID ("+l+") is not known!");s.push(new n.default(l,u))}i=new r.default(s)}return i}}}d.__dashjs_factory_name="KeySystemClearKey",t.default=dashjs.FactoryMaker.getSingletonFactory(d)}));t(ls);var us=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(as),r=s(ss),i=s(Za),a=s(os);function s(e){return e&&e.__esModule?e:{default:e}}var o="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",l=a.default.CLEARKEY_KEYSTEM_STRING;function u(e){var t=void 0,a=e.BASE64,s=e.debug.getLogger(t);return t={uuid:o,schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:l,getInitData:function(e){return i.default.parseInitDataFromContentProtection(e,a)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var i=null;if(e){for(var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),o=[],l=0;l<a.kids.length;l++){var u=a.kids[l],d=e.clearkeys&&e.clearkeys.hasOwnProperty(u)?e.clearkeys[u]:null;if(!d)throw new Error("DRM: ClearKey keyID ("+u+") is not known!");o.push(new n.default(u,d))}i=new r.default(o),s.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return i}}}u.__dashjs_factory_name="KeySystemW3CClearKey",t.default=dashjs.FactoryMaker.getSingletonFactory(u)}));t(us);var ds=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(Za),r=i(os);function i(e){return e&&e.__esModule?e:{default:e}}var a="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",s=r.default.WIDEVINE_KEYSTEM_STRING;function o(e){var t=null,r=(e=e||{}).BASE64;return{uuid:a,schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:s,init:function(e){e&&(t=e)},getInitData:function(e){return n.default.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(e){return t&&t.sessionId?t.sessionId:e&&e.sessionId?e.sessionId:null}}}o.__dashjs_factory_name="KeySystemWidevine",t.default=dashjs.FactoryMaker.getSingletonFactory(o)}));t(ds);var cs=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(Za),r=i(os);function i(e){return e&&e.__esModule?e:{default:e}}var a="9a04f079-9840-4286-ab92-e65be0885f95",s=r.default.PLAYREADY_KEYSTEM_STRING,o=void 0;function l(e){var t,r="utf-16",i=(e=e||{}).BASE64;function l(){if(!i||!i.hasOwnProperty("decodeArray")||!i.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return t={uuid:a,schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:s,getInitData:function(e){var t,r,a,s=new Uint8Array([112,115,115,104,0,0,0,0]),o=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),u=0,d=null,c=void 0,f=void 0;if(l(),!e)return null;if("pssh"in e)return n.default.parseInitDataFromContentProtection(e,i);if("pro"in e)d=i.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;d=i.decodeArray(e.prheader.__text)}return t=d.length,r=4+s.length+o.length+4+t,a=new ArrayBuffer(r),c=new Uint8Array(a),(f=new DataView(a)).setUint32(u,r),u+=4,c.set(s,u),u+=s.length,c.set(o,u),u+=o.length,f.setUint32(u,t),u+=4,c.set(d,u),u+=t,c.buffer},getRequestHeadersFromMessage:function(e){var t,n=void 0,i={},a=new DOMParser,s="utf-16"===r?new Uint16Array(e):new Uint8Array(e);t=String.fromCharCode.apply(null,s);for(var o=(n=a.parseFromString(t,"application/xml")).getElementsByTagName("name"),l=n.getElementsByTagName("value"),u=0;u<o.length;u++)i[o[u].childNodes[0].nodeValue]=l[u].childNodes[0].nodeValue;return i.hasOwnProperty("Content")&&(i["Content-Type"]=i.Content,delete i.Content),i.hasOwnProperty("Content-Type")||(i["Content-Type"]="text/xml; charset=utf-8"),i},getLicenseRequestFromMessage:function(e){var t=null,n=new DOMParser,a="utf-16"===r?new Uint16Array(e):new Uint8Array(e);l();var s=String.fromCharCode.apply(null,a),o=n.parseFromString(s,"application/xml");if(!o.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var u=o.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return u&&(t=i.decode(u)),t},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),n=t.getUint16(4,!0),r=6,i=new DOMParser,a=0;a<n;a++){var s=t.getUint16(r,!0);r+=2;var o=t.getUint16(r,!0);if(r+=2,1===s){var l=e.slice(r,r+o),u=String.fromCharCode.apply(null,new Uint16Array(l)),d=i.parseFromString(u,"application/xml");if(d.getElementsByTagName("LA_URL")[0]){var c=d.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(c)return c}if(d.getElementsByTagName("LUI_URL")[0]){var f=d.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(f)return f}}else r+=o}return null},getCDMData:function(){var e=void 0,t=void 0,n=void 0,r=void 0;if(l(),o&&o.cdmData){for(e=[],r=0;r<o.cdmData.length;++r)e.push(o.cdmData.charCodeAt(r)),e.push(0);for(e=String.fromCharCode.apply(null,e),e=i.encode(e),t='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",e),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r)),n.push(0);return new Uint8Array(n).buffer}return null},getSessionId:function(e){return o&&o.sessionId?o.sessionId:e&&e.sessionId?e.sessionId:null},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');r=e},init:function(e){e&&(o=e)}},t}l.__dashjs_factory_name="KeySystemPlayReady",t.default=dashjs.FactoryMaker.getSingletonFactory(l)}));t(cs);var fs=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=os)&&n.__esModule?n:{default:n};function i(e){var t=(e=e||{}).BASE64,n={};n[r.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[r.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}};return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,r){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[r].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}}}i.__dashjs_factory_name="DRMToday",t.default=dashjs.FactoryMaker.getSingletonFactory(i)}));t(fs);var hs=n((function(e,t){function n(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function n(n){if(window.DOMParser){var r=t(n),i=(new window.DOMParser).parseFromString(r,"text/xml"),a=i?i.getElementsByTagNameNS(e,"Envelope")[0]:null,s=a?a.getElementsByTagNameNS(e,"Body")[0]:null;if(s?s.getElementsByTagNameNS(e,"Fault")[0]:null)return null}return n}function r(n){var r="",i="",a="",s=-1,o=-1;if(window.DOMParser){var l=t(n),u=(new window.DOMParser).parseFromString(l,"text/xml"),d=u?u.getElementsByTagNameNS(e,"Envelope")[0]:null,c=d?d.getElementsByTagNameNS(e,"Body")[0]:null,f=c?c.getElementsByTagNameNS(e,"Fault")[0]:null,h=f?f.getElementsByTagName("detail")[0]:null,g=h?h.getElementsByTagName("Exception")[0]:null,p=null;if(null===f)return l;r=(p=f.getElementsByTagName("faultstring")[0].firstChild)?p.nodeValue:null,null!==g&&(i=(p=g.getElementsByTagName("StatusCode")[0])?p.firstChild.nodeValue:null,s=(a=(p=g.getElementsByTagName("Message")[0])?p.firstChild.nodeValue:null)?a.lastIndexOf("[")+1:-1,o=a?a.indexOf("]"):-1,a=a?a.substring(s,o):"")}var m="code: "+i+", name: "+r;return a&&(m+=", message: "+a),m}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return n.call(this,e)},getErrorResponse:function(e){return r.call(this,e)}}}Object.defineProperty(t,"__esModule",{value:!0}),n.__dashjs_factory_name="PlayReady",t.default=dashjs.FactoryMaker.getSingletonFactory(n)}));t(hs);var gs=n((function(e,t){function n(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}Object.defineProperty(t,"__esModule",{value:!0}),n.__dashjs_factory_name="Widevine",t.default=dashjs.FactoryMaker.getSingletonFactory(n)}));t(gs);var ps=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(as),r=i(ss);function i(e){return e&&e.__esModule?e:{default:e}}function a(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],i=0;i<e.keys.length;i++){var a=e.keys[i],s=a.kid.replace(/=/g,""),o=a.k.replace(/=/g,"");t.push(new n.default(s,o))}return new r.default(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}a.__dashjs_factory_name="ClearKey",t.default=dashjs.FactoryMaker.getSingletonFactory(a)}));t(ps);var ms=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f(Za),r=f(ls),i=f(us),a=f(ds),s=f(cs),o=f(fs),l=f(hs),u=f(gs),d=f(ps),c=f(os);function f(e){return e&&e.__esModule?e:{default:e}}function h(){var e=this.context,t=void 0,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0;return t={initialize:function(){g=[];var t=void 0;t=(0,s.default)(e).getInstance({BASE64:p}),g.push(t),t=(0,a.default)(e).getInstance({BASE64:p}),g.push(t),t=(0,r.default)(e).getInstance({BASE64:p}),g.push(t),m=t,t=(0,i.default)(e).getInstance({BASE64:p,debug:f}),g.push(t),v=t},setProtectionData:function(e){for(var t,n,r=0;r<g.length;r++){var i=g[r];i.hasOwnProperty("init")&&i.init((t=i.systemString,n=void 0,n=null,e&&(n=t in e?e[t]:null),n))}},isClearKey:function(e){return e===m||e===v},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),r=new Uint8Array(t),i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}return!1},getKeySystems:function(){return g},setKeySystems:function(e){g=e},getKeySystemBySystemString:function(e){for(var t=0;t<g.length;t++)if(g[t].systemString===e)return g[t];return null},getSupportedKeySystemsFromContentProtection:function(e){var t=void 0,r=void 0,i=void 0,a=void 0,s=[];if(e){var o=n.default.findCencContentProtection(e);for(i=0;i<g.length;++i)for(r=g[i],a=0;a<e.length;++a)if((t=e[a]).schemeIdUri.toLowerCase()===r.schemeIdURI){var l=r.getInitData(t,o);s.push({ks:g[i],initData:l,cdmData:r.getCDMData(),sessionId:r.getSessionId(t)})}}return s},getSupportedKeySystems:function(e,t){for(var r=[],i=n.default.parsePSSHList(e),a=void 0,s=void 0,o=void 0,l=0;l<g.length;++l)s=(a=g[l]).systemString,o=!t||s in t,a.uuid in i&&o&&r.push({ks:a,initData:i[a.uuid],cdmData:a.getCDMData(),sessionId:a.getSessionId()});return r},getLicenseServer:function(t,n,r){if("license-release"===r||"individualization-request"===r)return null;var i=null;return n&&n.hasOwnProperty("drmtoday")?i=(0,o.default)(e).getInstance({BASE64:p}):t.systemString===c.default.WIDEVINE_KEYSTEM_STRING?i=(0,u.default)(e).getInstance():t.systemString===c.default.PLAYREADY_KEYSTEM_STRING?i=(0,l.default)(e).getInstance():t.systemString===c.default.CLEARKEY_KEYSTEM_STRING&&(i=(0,d.default)(e).getInstance()),i},processClearKeyLicenseRequest:function(e,t,n){try{return e.getClearKeysFromProtectionData(t,n)}catch(e){return h.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(e){e&&(e.debug&&(f=e.debug,h=f.getLogger(t)),e.BASE64&&(p=e.BASE64))}},t}h.__dashjs_factory_name="ProtectionKeyController",t.default=dashjs.FactoryMaker.getSingletonFactory(h)}));t(ms);var vs=n((function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(((n=d)&&n.__esModule?n:{default:n}).default));t.default=r}));t(vs);var ys=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=n}}));t(ys);var Es=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=n,this.defaultURL=r,this.messageType=i||"license-request"}}));t(Es);var _s=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=n}}));t(_s);var Ts=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(ms),r=u(ys),i=u(ts),a=u(_),s=u(Es),o=u(_s),l=u(os);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){e=e||{};var t=this.context,u=e.eventBus,d=e.events,c=e.debug,f=void 0,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0;function _(e,t){void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess?function(t){var n=e[t].ks,r=e[t].configs,i=n.systemString;i===l.default.PLAYREADY_KEYSTEM_STRING&&"required"===r[0].persistentState&&(i+=".recommendation"),navigator.requestMediaKeySystemAccess(i,r).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,r=new o.default(n,t);r.mksa=e,u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{data:r})})).catch((function(n){++t<e.length?_(e,t):u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+n.message})}))}(t):u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Insecure origins are not allowed"})}function T(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function b(e){for(var t=0;t<v.length;t++)if(v[t]===e){v.splice(t,1);break}}function S(e){var t=void 0,n=void 0;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function A(e,t,n,r){var o={session:e,initData:t,sessionId:r,handleEvent:function(e){switch(e.type){case"keystatuseschange":u.trigger(d.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=S(arguments);if("expired"===e.status)u.trigger(d.INTERNAL_KEY_STATUS_CHANGED,{error:new a.default(i.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,i.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});else u.trigger(d.INTERNAL_KEY_STATUS_CHANGED,e)}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;u.trigger(d.INTERNAL_KEY_MESSAGE,{data:new s.default(this,t,void 0,e.messageType)})}},getSessionID:function(){return e.sessionId},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach((function(){var e=S(arguments);"usable"===e.status&&(t=!0)})),t},getSessionType:function(){return n}};return e.addEventListener("keystatuseschange",o),e.addEventListener("message",o),e.closed.then((function(){b(o),h.debug("DRM: Session closed.  SessionID = "+o.getSessionID()),u.trigger(d.KEY_SESSION_CLOSED,{data:o.getSessionID()})})),v.push(o),o}return f={getAllInitData:function(){for(var e=[],t=0;t<v.length;t++)v[t].initData&&e.push(v[t].initData);return e},requestKeySystemAccess:function(e){_(e,0)},getKeySystem:function(){return g},selectKeySystem:function(e){e.mksa.createMediaKeys().then((function(t){g=e.keySystem,m=t,p?p.setMediaKeys(m).then((function(){u.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED)})):u.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED)})).catch((function(){u.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))},setMediaElement:function(e){p!==e&&(p&&(p.removeEventListener("encrypted",y),p.setMediaKeys&&p.setMediaKeys(null)),(p=e)&&(p.addEventListener("encrypted",y),p.setMediaKeys&&m&&p.setMediaKeys(m)))},setServerCertificate:function(e){if(!g||!m)throw new Error("Can not set server certificate until you have selected a key system");m.setServerCertificate(e).then((function(){h.info("DRM: License server certificate successfully updated."),u.trigger(d.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){u.trigger(d.SERVER_CERTIFICATE_UPDATED,{error:new a.default(i.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,i.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})}))},createKeySession:function(e,t,n){if(!g||!m)throw new Error("Can not create sessions until you have selected a key system");var r=m.createSession(n),s=A(r,e,n),o=this.getKeySystem().systemString===l.default.CLEARKEY_KEYSTEM_STRING&&(e||t&&t.clearkeys)?"keyids":"cenc";r.generateRequest(o,e).then((function(){h.debug("DRM: Session created.  SessionID = "+s.getSessionID()),u.trigger(d.KEY_SESSION_CREATED,{data:s})})).catch((function(e){b(s),u.trigger(d.KEY_SESSION_CREATED,{data:null,error:new a.default(i.default.KEY_SESSION_CREATED_ERROR_CODE,i.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})}))},updateKeySession:function(e,t){var n=e.session;E.isClearKey(g)&&(t=t.toJWK()),n.update(t).catch((function(t){u.trigger(d.KEY_ERROR,{data:new a.default(i.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})}))},loadKeySession:function(e,t,n){if(!g||!m)throw new Error("Can not load sessions until you have selected a key system");for(var r=0;r<v.length;r++)if(e===v[r].sessionId)return void h.warn("DRM: Ignoring session ID because we have already seen it!");var s=m.createSession(n),o=A(s,t,n,e);s.load(e).then((function(t){t?(h.debug("DRM: Session loaded.  SessionID = "+o.getSessionID()),u.trigger(d.KEY_SESSION_CREATED,{data:o})):(b(o),u.trigger(d.KEY_SESSION_CREATED,{data:null,error:new a.default(i.default.KEY_SESSION_CREATED_ERROR_CODE,i.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+e+")")}))})).catch((function(t){b(o),u.trigger(d.KEY_SESSION_CREATED,{data:null,error:new a.default(i.default.KEY_SESSION_CREATED_ERROR_CODE,i.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+e+")! "+t.name)})}))},removeKeySession:function(e){e.session.remove().then((function(){h.debug("DRM: Session removed.  SessionID = "+e.getSessionID()),u.trigger(d.KEY_SESSION_REMOVED,{data:e.getSessionID()})}),(function(t){u.trigger(d.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionID()+"). "+t.name})}))},closeKeySession:function(e){T(e).catch((function(t){b(e),u.trigger(d.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionID()+") "+t.name})}))},stop:function(){for(var e=void 0,t=0;t<v.length;t++)(e=v[t]).getUsable()||T(e).catch((function(){b(e)}))},reset:function(){var e=v.length,t=void 0;0!==e?function(){for(var n=function(e){b(e),0===v.length&&(p?(p.removeEventListener("encrypted",y),p.setMediaKeys(null).then((function(){u.trigger(d.TEARDOWN_COMPLETE)}))):u.trigger(d.TEARDOWN_COMPLETE))},r=0;r<e;r++)!function(e){t.session.closed.then((function(){n(e)})),T(t).catch((function(){n(e)}))}(t=v[r])}():u.trigger(d.TEARDOWN_COMPLETE)}},h=c.getLogger(f),g=null,p=null,m=null,v=[],E=(0,n.default)(t).getInstance(),y={handleEvent:function(e){if("encrypted"===e.type&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;u.trigger(d.NEED_KEY,{key:new r.default(t,e.initDataType)})}}},f}d.__dashjs_factory_name="ProtectionModel_21Jan2015",t.default=dashjs.FactoryMaker.getClassFactory(d)}));t(Ts);var bs=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(ms),r=u(ys),i=u(_),a=u(ts),s=u(Es),o=u(es),l=u(_s);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){e=e||{};var t=this.context,u=e.eventBus,d=e.events,c=e.debug,f=e.api,h=void 0,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0,T=void 0;function b(){try{for(var e=0;e<E.length;e++)S(E[e]);p&&p.removeEventListener(f.needkey,_),u.trigger(d.TEARDOWN_COMPLETE)}catch(e){u.trigger(d.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function S(e){var t=e.session;t.removeEventListener(f.error,e),t.removeEventListener(f.message,e),t.removeEventListener(f.ready,e),t.removeEventListener(f.close,e);for(var n=0;n<E.length;n++)if(E[n]===e){E.splice(n,1);break}t[f.release]()}function A(){var e=null,t=function(){p.removeEventListener("loadedmetadata",e),p[f.setMediaKeys](v),u.trigger(d.VIDEO_ELEMENT_SELECTED)};p.readyState>=1?t():(e=t.bind(this),p.addEventListener("loadedmetadata",e))}return h={getAllInitData:function(){for(var e=[],t=0;t<E.length;t++)e.push(E[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,n=0;n<e.length;n++)for(var r=e[n].ks.systemString,i=e[n].configs,a=null,s=null,c=0;c<i.length;c++){var h=i[c].audioCapabilities,g=i[c].videoCapabilities;if(h&&0!==h.length){a=[];for(var p=0;p<h.length;p++)window[f.MediaKeys].isTypeSupported(r,h[p].contentType)&&a.push(h[p])}if(g&&0!==g.length){s=[];for(var m=0;m<g.length;m++)window[f.MediaKeys].isTypeSupported(r,g[m].contentType)&&s.push(g[m])}if(!(!a&&!s||a&&0===a.length||s&&0===s.length)){t=!0;var v=new o.default(a,s),y=T.getKeySystemBySystemString(r);u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{data:new l.default(y,v)});break}}t||u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return m},selectKeySystem:function(e){try{v=e.mediaKeys=new window[f.MediaKeys](e.keySystem.systemString),m=e.keySystem,y=e,p&&A(),u.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED)}catch(e){u.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+m.systemString+")! Could not create MediaKeys -- TODO"})}},setMediaElement:function(e){p!==e&&(p&&p.removeEventListener(f.needkey,_),(p=e)&&(p.addEventListener(f.needkey,_),v&&A()))},createKeySession:function(e,t,n,r){if(!m||!v||!y)throw new Error("Can not create sessions until you have selected a key system");var o=null;if(y.ksConfiguration.videoCapabilities&&y.ksConfiguration.videoCapabilities.length>0&&(o=y.ksConfiguration.videoCapabilities[0]),null===o&&y.ksConfiguration.audioCapabilities&&y.ksConfiguration.audioCapabilities.length>0&&(o=y.ksConfiguration.audioCapabilities[0]),null===o)throw new Error("Can not create sessions for unknown content types.");var l=o.contentType,c=v.createSession(l,new Uint8Array(e),r?new Uint8Array(r):null),h=function(e,t){return{session:e,initData:t,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case f.error:var t="KeyError";u.trigger(d.KEY_ERROR,{data:new i.default(a.default.MEDIA_KEYERR_CODE,t,this)});break;case f.message:var n=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;u.trigger(d.INTERNAL_KEY_MESSAGE,{data:new s.default(this,n,e.destinationURL)});break;case f.ready:g.debug("DRM: Key added."),u.trigger(d.KEY_ADDED);break;case f.close:g.debug("DRM: Session closed.  SessionID = "+this.getSessionID()),u.trigger(d.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(c,e);c.addEventListener(f.error,h),c.addEventListener(f.message,h),c.addEventListener(f.ready,h),c.addEventListener(f.close,h),E.push(h),g.debug("DRM: Session created.  SessionID = "+h.getSessionID()),u.trigger(d.KEY_SESSION_CREATED,{data:h})},updateKeySession:function(e,t){var n=e.session;T.isClearKey(m)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t))},closeKeySession:S,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:b,reset:b},g=c.getLogger(h),p=null,m=null,v=null,y=null,E=[],T=(0,n.default)(t).getInstance(),_={handleEvent:function(e){if(e.type===f.needkey&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;u.trigger(d.NEED_KEY,{key:new r.default(t,"cenc")})}}},h}d.__dashjs_factory_name="ProtectionModel_3Feb2014",t.default=dashjs.FactoryMaker.getClassFactory(d)}));t(bs);var Ss=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(ms),r=u(ys),i=u(_),a=u(Es),s=u(es),o=u(_s),l=u(ts);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){e=e||{};var t=this.context,u=e.eventBus,d=e.events,c=e.debug,f=e.api,h=e.errHandler,g=void 0,p=void 0,m=void 0,v=void 0,y=void 0,E=void 0,_=void 0,T=void 0,b=void 0;function S(){m&&I();for(var e=0;e<_.length;e++)A(_[e]);u.trigger(d.TEARDOWN_COMPLETE)}function A(e){try{m[f.cancelKeyRequest](v.systemString,e.sessionID)}catch(t){u.trigger(d.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionID+") "+t.message})}}function R(e,t){if(t&&e){for(var n=e.length,r=0;r<n;r++)if(e[r].sessionID==t)return e[r];return null}return null}function I(){m.removeEventListener(f.keyerror,b),m.removeEventListener(f.needkey,b),m.removeEventListener(f.keymessage,b),m.removeEventListener(f.keyadded,b)}return g={getAllInitData:function(){for(var e=[],t=0;t<E.length;t++)e.push(E[t].initData);for(var n=0;n<_.length;n++)e.push(_[n].initData);return e},requestKeySystemAccess:function(e){var t=m;t||(t=document.createElement("video"));for(var n=!1,r=0;r<e.length;r++)for(var i=e[r].ks.systemString,a=e[r].configs,l=null,c=null,f=0;f<a.length;f++){var h=a[f].videoCapabilities;if(h&&0!==h.length){c=[];for(var g=0;g<h.length;g++)""!==t.canPlayType(h[g].contentType,i)&&c.push(h[g])}if(c&&(!c||0!==c.length)){n=!0;var p=new s.default(l,c),v=y.getKeySystemBySystemString(i);u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{data:new o.default(v,p)});break}}n||u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return v},selectKeySystem:function(e){v=e.keySystem,u.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){if(m!==e){if(m){I();for(var t=0;t<_.length;t++)A(_[t]);_=[]}(m=e)&&(m.addEventListener(f.keyerror,b),m.addEventListener(f.needkey,b),m.addEventListener(f.keymessage,b),m.addEventListener(f.keyadded,b),u.trigger(d.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!v)throw new Error("Can not create sessions until you have selected a key system");if(T||0===_.length){var t={sessionID:null,initData:e,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return E.push(t),m[f.generateKeyRequest](v.systemString,new Uint8Array(e)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var n=e.sessionID;if(y.isClearKey(v))for(var r=0;r<t.keyPairs.length;r++)m[f.addKey](v.systemString,t.keyPairs[r].key,t.keyPairs[r].keyID,n);else m[f.addKey](v.systemString,new Uint8Array(t),new Uint8Array(e.initData),n)},closeKeySession:A,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:S,reset:S},p=c.getLogger(g),m=null,v=null,E=[],_=[],y=(0,n.default)(t).getInstance(),b={handleEvent:function(e){var t=null;switch(e.type){case f.needkey:var n=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;u.trigger(d.NEED_KEY,{key:new r.default(n,"cenc")});break;case f.keyerror:if((t=R(_,e.sessionId))||(t=R(E,e.sessionId)),t){var s=l.default.MEDIA_KEYERR_CODE,o="";switch(e.errorCode.code){case 1:s=l.default.MEDIA_KEYERR_UNKNOWN_CODE,o+="MEDIA_KEYERR_UNKNOWN - "+l.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:s=l.default.MEDIA_KEYERR_CLIENT_CODE,o+="MEDIA_KEYERR_CLIENT - "+l.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:s=l.default.MEDIA_KEYERR_SERVICE_CODE,o+="MEDIA_KEYERR_SERVICE - "+l.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:s=l.default.MEDIA_KEYERR_OUTPUT_CODE,o+="MEDIA_KEYERR_OUTPUT - "+l.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:s=l.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,o+="MEDIA_KEYERR_HARDWARECHANGE - "+l.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:s=l.default.MEDIA_KEYERR_DOMAIN_CODE,o+="MEDIA_KEYERR_DOMAIN - "+l.default.MEDIA_KEYERR_DOMAIN_MESSAGE}o+="  System Code = "+e.systemCode,u.trigger(d.KEY_ERROR,{data:new i.default(s,o,t)})}else p.error("No session token found for key error");break;case f.keyadded:(t=R(_,e.sessionId))||(t=R(E,e.sessionId)),t?(p.debug("DRM: Key added."),u.trigger(d.KEY_ADDED,{data:t})):p.debug("No session token found for key added");break;case f.keymessage:if((T=null!==e.sessionId&&void 0!==e.sessionId)?!(t=R(_,e.sessionId))&&E.length>0&&(t=E.shift(),_.push(t),t.sessionID=e.sessionId,u.trigger(d.KEY_SESSION_CREATED,{data:t})):E.length>0&&(t=E.shift(),_.push(t),0!==E.length&&h.error(new i.default(l.default.MEDIA_KEY_MESSAGE_ERROR_CODE,l.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var c=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=c,u.trigger(d.INTERNAL_KEY_MESSAGE,{data:new a.default(t,c,e.defaultURL)})}else p.warn("No session token found for key message")}}},g}d.__dashjs_factory_name="ProtectionModel_01b",t.default=dashjs.FactoryMaker.getClassFactory(d)}));t(Ss);var As=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(is),r=u(ms),i=u(vs),a=u(ts),s=u(Ts),o=u(bs),l=u(Ss);function u(e){return e&&e.__esModule?e:{default:e}}var d=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],c=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function f(){var e=void 0,t=this.context;function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];if("function"==typeof e[r[Object.keys(r)[0]]])return r}return null}return e={createProtectionSystem:function(a){var u=null,f=(0,r.default)(t).getInstance();f.setConfig({debug:a.debug,BASE64:a.BASE64}),f.initialize();var h=function(n){var r=n.debug,a=r.getLogger(e),u=n.eventBus,f=n.errHandler,h=n.videoModel?n.videoModel.getElement():null;return h&&void 0===h.onencrypted||h&&void 0===h.mediaKeys?i(h,c)?(a.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,o.default)(t).create({debug:r,eventBus:u,events:n.events,api:i(h,c)})):i(h,d)?(a.info("EME detected on this user agent! (ProtectionModel_01b)"),(0,l.default)(t).create({debug:r,eventBus:u,errHandler:f,events:n.events,api:i(h,d)})):(a.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(a.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,s.default)(t).create({debug:r,eventBus:u,events:n.events}))}(a);return!u&&h&&(u=(0,n.default)(t).create({protectionModel:h,protectionKeyController:f,eventBus:a.eventBus,debug:a.debug,events:a.events,BASE64:a.BASE64,constants:a.constants,cmcdModel:a.cmcdModel,settings:a.settings}),a.capabilities.setEncryptedMediaSupported(!0)),u}},e}f.__dashjs_factory_name="Protection";var h=dashjs.FactoryMaker.getClassFactory(f);h.events=i.default,h.errors=a.default,dashjs.FactoryMaker.updateClassFactory(f.__dashjs_factory_name,h),t.default=h}));t(As);var Rs=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=Ca)&&n.__esModule?n:{default:n};var i=function(){var e="application/dash+xml",t=void 0;function n(n,i,a){if(!n||!/^VIDEO$/i.test(n.nodeName))return null;if(n._dashjs_player)return n._dashjs_player;var s=void 0,o=n.id||n.name||"video element";if(!(i=i||[].slice.call(n.querySelectorAll("source")).filter((function(t){return t.type==e}))[0])&&n.src)(i=document.createElement("source")).src=n.src;else if(!i&&!n.src)return null;return a=a||{},(s=(0,r.default)(a).create()).initialize(n,i.src,n.autoplay),t||(t=s.getDebug().getLogger()),t.debug("Converted "+o+" to dash.js player and added content: "+i.src),n._dashjs_player=s,s}function i(e){return/^VIDEO$/i.test(e.nodeName)?e:i(e.parentNode)}return{create:n,createAll:function(e,t){var r=[];e=e||"[data-dashjs-player]";for(var a=(t=t||document).querySelectorAll(e),s=0;s<a.length;s++){var o=n(a[s],null);r.push(o)}for(var l=t.querySelectorAll('source[type="application/dash+xml"]'),u=0;u<l.length;u++){var d=n(i(l[u]),null);r.push(d)}return r}}}(),a=void 0;!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?i.createAll():a=window.setInterval((function(){window.dashjs&&(window.clearInterval(a),i.createAll())}),500):window.addEventListener("load",(function e(){window.removeEventListener("load",e),i.createAll()}))),t.default=i}));t(Rs);var Is=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.supportsMediaSource=t.Debug=t.MediaPlayerFactory=t.MetricsReporting=t.Protection=t.MediaPlayer=void 0;var n=s($a),r=s(As),i=s(Rs),a=s(p);function s(e){return e&&e.__esModule?e:{default:e}}dashjs.Protection=r.default,dashjs.MetricsReporting=n.default,dashjs.MediaPlayerFactory=i.default,dashjs.Debug=a.default,dashjs.supportsMediaSource=Wi.supportsMediaSource,t.default=dashjs,t.MediaPlayer=Da.MediaPlayer,t.Protection=r.default,t.MetricsReporting=n.default,t.MediaPlayerFactory=i.default,t.Debug=a.default,t.supportsMediaSource=Wi.supportsMediaSource})),ws=t(Is);Is.supportsMediaSource,Is.Debug,Is.MediaPlayerFactory,Is.MetricsReporting,Is.Protection,Is.MediaPlayer;var Cs=n((function(e,t){var n;"undefined"!=typeof window&&(n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,n){var r=Object.prototype.hasOwnProperty,i="~";function a(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,r,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new s(n,r||e,a),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,a=n.length,s=new Array(a);r<a;r++)s[r]=n[r].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,r,a,s){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,d=this._events[o],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,r),!0;case 5:return d.fn.call(d.context,t,n,r,a),!0;case 6:return d.fn.call(d.context,t,n,r,a,s),!0}for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];d.fn.apply(d.context,l)}else{var f,h=d.length;for(u=0;u<h;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),c){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,r);break;default:if(!l)for(f=1,l=new Array(c-1);f<c;f++)l[f-1]=arguments[f];d[u].fn.apply(d[u].context,l)}}return!0},u.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,r){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||l(this,a);else{for(var o=0,u=[],d=s.length;o<d;o++)(s[o].fn!==t||r&&!s[o].once||n&&s[o].context!==n)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,e.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,n){var r,i,a,s,o;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=o.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=o.normalizePath(r.path),o.buildURLFromParts(r)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var d=s.path,c=d.substring(0,d.lastIndexOf("/")+1)+a.path;u.path=o.normalizePath(c)}else u.path=s.path,a.params||(u.params=s.params,a.query||(u.query=s.query));return null===u.path&&(u.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(u)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/webworkify-webpack/index.js":function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e){return!isNaN(1*e)}function l(e,t,r){var l={};l[r]=[];var u=t.toString(),d=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return l;for(var c,f=d[1],h=new RegExp("(\\\\n|\\W)"+s(f)+a,"g");c=h.exec(u);)"dll-reference"!==c[3]&&l[r].push(c[3]);for(h=new RegExp("\\("+s(f)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+a,"g");c=h.exec(u);)e[c[2]]||(l[r].push(c[1]),e[c[2]]=n(c[1]).m),l[c[2]]=l[c[2]]||[],l[c[2]].push(c[4]);for(var g=Object.keys(l),p=0;p<g.length;p++)for(var m=0;m<l[g[p]].length;m++)o(l[g[p]][m])&&(l[g[p]][m]=1*l[g[p]][m]);return l}function u(e){return Object.keys(e).reduce((function(t,n){return t||e[n].length>0}),!1)}e.exports=function(e,t){t=t||{};var i={main:n.m},a=t.all?{main:Object.keys(i.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};u(n);)for(var a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],d=n[o].pop();if(i[o]=i[o]||{},!i[o][d]&&e[o][d]){i[o][d]=!0,r[o]=r[o]||[],r[o].push(d);for(var c=l(e,e[o][d],o),f=Object.keys(c),h=0;h<f.length;h++)n[f[h]]=n[f[h]]||[],n[f[h]]=n[f[h]].concat(c[f[h]])}}return r}(i,e),s="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);";var o=new window.Blob([s],{type:"text/javascript"});if(t.bare)return o;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(o),c=new window.Worker(d);return c.objectURL=d,c}},"./src/crypt/decrypter.js":function(e,t,n){n.r(t);var r=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),i=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],a=n[2],s=n[3],o=this.invSubMix,l=o[0],u=o[1],d=o[2],c=o[3],f=new Uint32Array(256),h=0,g=0,p=0;for(p=0;p<256;p++)f[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var m=g^g<<1^g<<2^g<<3^g<<4;m=m>>>8^255&m^99,e[h]=m,t[m]=h;var v=f[h],y=f[v],E=f[y],_=257*f[m]^16843008*m;r[h]=_<<24|_>>>8,i[h]=_<<16|_>>>16,a[h]=_<<8|_>>>24,s[h]=_,_=16843009*E^65537*y^257*v^16843008*h,l[m]=_<<24|_>>>8,u[m]=_<<16|_>>>16,d[m]=_<<8|_>>>24,c[m]=_,h?(h=v^f[f[f[E^v]]],g^=f[f[g]]):h=g=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,s,o,l,u=this.ksRows=4*(i+6+1),d=this.keySchedule=new Uint32Array(u),c=this.invKeySchedule=new Uint32Array(u),f=this.sBox,h=this.rcon,g=this.invSubMix,p=g[0],m=g[1],v=g[2],y=g[3];for(a=0;a<u;a++)a<i?o=d[a]=t[a]:(l=o,a%i==0?(l=f[(l=l<<8|l>>>24)>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l],l^=h[a/i|0]<<24):i>6&&a%i==4&&(l=f[l>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l]),d[a]=o=(d[a-i]^l)>>>0);for(s=0;s<u;s++)a=u-s,l=3&s?d[a]:d[a-4],c[s]=s<4||a<=4?l:p[f[l>>>24]]^m[f[l>>>16&255]]^v[f[l>>>8&255]]^y[f[255&l]],c[s]=c[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n,r){for(var i,a,s,o,l,u,d,c,f,h,g,p,m,v,y,E,_,T=this.keySize+6,b=this.invKeySchedule,S=this.invSBox,A=this.invSubMix,R=A[0],I=A[1],w=A[2],C=A[3],D=this.uint8ArrayToUint32Array_(n),M=D[0],N=D[1],O=D[2],P=D[3],L=new Int32Array(e),k=new Int32Array(L.length),x=this.networkToHostOrderSwap;t<L.length;){for(f=x(L[t]),h=x(L[t+1]),g=x(L[t+2]),p=x(L[t+3]),l=f^b[0],u=p^b[1],d=g^b[2],c=h^b[3],m=4,v=1;v<T;v++)i=R[l>>>24]^I[u>>16&255]^w[d>>8&255]^C[255&c]^b[m],a=R[u>>>24]^I[d>>16&255]^w[c>>8&255]^C[255&l]^b[m+1],s=R[d>>>24]^I[c>>16&255]^w[l>>8&255]^C[255&u]^b[m+2],o=R[c>>>24]^I[l>>16&255]^w[u>>8&255]^C[255&d]^b[m+3],l=i,u=a,d=s,c=o,m+=4;i=S[l>>>24]<<24^S[u>>16&255]<<16^S[d>>8&255]<<8^S[255&c]^b[m],a=S[u>>>24]<<24^S[d>>16&255]<<16^S[c>>8&255]<<8^S[255&l]^b[m+1],s=S[d>>>24]<<24^S[c>>16&255]<<16^S[l>>8&255]<<8^S[255&u]^b[m+2],o=S[c>>>24]<<24^S[l>>16&255]<<16^S[u>>8&255]<<8^S[255&d]^b[m+3],m+=3,k[t]=x(i^M),k[t+1]=x(o^N),k[t+2]=x(s^O),k[t+3]=x(a^P),M=f,N=h,O=g,P=p,t+=4}return r?(y=k.buffer,E=y.byteLength,(_=E&&new DataView(y).getUint8(E-1))?y.slice(0,E-_):y):k.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),s=n("./src/errors.ts"),o=n("./src/utils/logger.js"),l=n("./src/events.js"),u=n("./src/utils/get-self-scope.js"),d=Object(u.getSelfScope)(),c=function(){function e(e,t,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=i,i)try{var a=d.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,n,s){var l=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.logger.log("JS AES decrypt"),this.logEnabled=!1);var u=this.decryptor;u||(this.decryptor=u=new a),u.expandKey(t),s(u.decrypt(e,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(o.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var d=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new i(d,t)),this.fastAesKey.expandKey().then((function(i){new r(d,n).decrypt(e,i).catch((function(r){l.onWebCryptoError(r,e,t,n,s)})).then((function(e){s(e)}))})).catch((function(r){l.onWebCryptoError(r,e,t,n,s)}))}},t.onWebCryptoError=function(e,t,n,r,i){this.config.enableSoftwareAES?(o.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,r,i)):(o.logger.error("decrypting error : "+e.message),this.observer.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=c},"./src/demux/demuxer-inline.js":function(e,t,n){n.r(t);var r=n("./src/events.js"),i=n("./src/errors.ts"),a=n("./src/crypt/decrypter.js"),s=n("./src/polyfills/number.js"),o=n("./src/utils/logger.js"),l=n("./src/utils/get-self-scope.js");function u(e,t){return 255===e[t]&&240==(246&e[t+1])}function d(e,t){return 1&e[t+1]?7:9}function c(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function f(e,t){return!!(t+1<e.length&&u(e,t))}function h(e,t){if(f(e,t)){var n=d(e,t);if(t+n>=e.length)return!1;var r=c(e,t);if(r<=n)return!1;var i=t+r;if(i===e.length||i+1<e.length&&u(e,i))return!0}return!1}function g(e,t,n,a,s){if(!e.samplerate){var l=function(e,t,n,a){var s,l,u,d,c,f=navigator.userAgent.toLowerCase(),h=a,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(s=1+((192&t[n+2])>>>6),!((l=(60&t[n+2])>>>2)>g.length-1))return d=(1&t[n+2])<<2,d|=(192&t[n+3])>>>6,o.logger.log("manifest codec:"+a+",ADTS data:type:"+s+",sampleingIndex:"+l+"["+g[l]+"Hz],channelConfig:"+d),/firefox/i.test(f)?l>=6?(s=5,c=new Array(4),u=l-3):(s=2,c=new Array(2),u=l):-1!==f.indexOf("android")?(s=2,c=new Array(2),u=l):(s=5,c=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&l>=6?u=l-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(l>=6&&1===d||/vivaldi/i.test(f))||!a&&1===d)&&(s=2,c=new Array(2)),u=l)),c[0]=s<<3,c[0]|=(14&l)>>1,c[1]|=(1&l)<<7,c[1]|=d<<3,5===s&&(c[1]|=(14&u)>>1,c[2]=(1&u)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:g[l],channelCount:d,codec:"mp4a.40."+s,manifestCodec:h};e.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l})}(t,n,a,s);e.config=l.config,e.samplerate=l.samplerate,e.channelCount=l.channelCount,e.codec=l.codec,e.manifestCodec=l.manifestCodec,o.logger.log("parsed codec:"+e.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)}}function p(e){return 9216e4/e}function m(e,t,n,r,i){var a=function(e,t,n,r,i){var a,s,o=e.length;if(a=d(e,t),s=c(e,t),(s-=a)>0&&t+a+s<=o)return{headerLength:a,frameLength:s,stamp:n+r*i}}(t,n,r,i,p(e.samplerate));if(a){var s=a.stamp,o=a.headerLength,l=a.frameLength,u={unit:t.subarray(n+o,n+o+l),pts:s,dts:s};return e.samples.push(u),{sample:u,length:l+o}}}var v=n("./src/demux/id3.js"),y=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(v.default.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(h(e,t))return o.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=this._audioTrack,a=v.default.getID3Data(e,0)||[],l=v.default.getTimeStamp(a),u=Object(s.isFiniteNumber)(l)?90*l:9e4*t,d=0,c=u,h=e.length,p=a.length,y=[{pts:c,dts:c,data:a}];p<h-1;)if(f(e,p)&&p+5<h){g(i,this.observer,e,p,i.manifestCodec);var E=m(i,e,p,u,d);if(!E){o.logger.log("Unable to parse AAC frame");break}p+=E.length,c=E.sample.pts,d++}else v.default.isHeader(e,p)?(a=v.default.getID3Data(e,p),y.push({pts:c,dts:c,data:a}),p+=a.length):p++;this.remuxer.remux(i,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),E=y,_=n("./src/demux/mp4demuxer.js"),T={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,r,i){if(!(n+24>t.length)){var a=this.parseHeader(t,n);if(a&&n+a.frameLength<=t.length){var s=r+i*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(n,n+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength}}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==n&&0!==i&&15!==i&&3!==a){var o=3===n?3-r:3===r?3:4,l=1e3*T.BitratesMap[14*o+i-1],u=3===n?0:2===n?1:2,d=T.SamplingRateMap[3*u+a],c=e[t+3]>>6==3?1:2,f=T.SamplesCoefficients[n][r],h=T.BytesInSlot[r],g=8*f*h;return{sampleRate:d,channelCount:c,frameLength:parseInt(f*l/d+s,10)*h,samplesPerFrame:g}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n=this.parseHeader(e,t),r=4;n&&n.frameLength&&(r=n.frameLength);var i=t+r;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}},b=T,S=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&o.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){var t,n=8,r=8;for(t=0;t<e;t++)0!==r&&(r=(n+this.readEG()+256)%256),n=0===r?n:r},t.readSPS=function(){var e,t,n,r,i,a,s,o=0,l=0,u=0,d=0,c=this.readUByte.bind(this),f=this.readBits.bind(this),h=this.readUEG.bind(this),g=this.readBoolean.bind(this),p=this.skipBits.bind(this),m=this.skipEG.bind(this),v=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(c(),e=c(),f(5),p(3),c(),v(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=h();if(3===E&&p(1),v(),v(),p(1),g())for(a=3!==E?8:12,s=0;s<a;s++)g()&&y(s<6?16:64)}v();var _=h();if(0===_)h();else if(1===_)for(p(1),m(),m(),t=h(),s=0;s<t;s++)m();v(),p(1),n=h(),r=h(),0===(i=f(1))&&p(1),p(1),g()&&(o=h(),l=h(),u=h(),d=h());var T=[1,1];if(g()&&g())switch(c()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(n+1)-2*o-2*l),height:(2-i)*(r+1)*16-(i?2:4)*(u+d),pixelRatio:T}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),A=function(){function e(e,t,n,r){this.decryptdata=n,this.discardEPB=r,this.decrypter=new a.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,n,r){var i=e[t].unit,a=i.subarray(16,i.length-i.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,(function(a){a=new Uint8Array(a),i.set(a,16),r||o.decryptAacSamples(e,t+1,n)}))},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<=e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(t.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,n,r,i,a){var s=this.discardEPB(i.data),o=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(o.buffer,(function(o){i.data=l.getAvcDecryptedUnit(s,o),a||l.decryptAvcSamples(e,t,n+1,r)}))},t.decryptAvcSamples=function(e,t,n,r){for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var a=i[n];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,a,s),!s)return}}}},e}(),R=A,I={video:1,audio:2,id3:3,text:4},w=function(){function e(e,t,n,r){this.observer=e,this.config=n,this.typeSupported=r,this.remuxer=t,this.sampleAes=null,this.pmtUnknownTypes={}}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new R(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var n=e._syncOffset(t);return!(n<0||(n&&o.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:I[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.append=function(t,n,a,s){var l,u,d,c,f,h=t.length,g=!1;this.pmtUnknownTypes={},this.contiguous=a;var p=this.pmtParsed,m=this._avcTrack,v=this._audioTrack,y=this._id3Track,E=m.pid,_=v.pid,T=y.pid,b=this._pmtId,S=m.pesData,A=v.pesData,R=y.pesData,I=this._parsePAT,w=this._parsePMT.bind(this),C=this._parsePES,D=this._parseAVCPES.bind(this),M=this._parseAACPES.bind(this),N=this._parseMPEGPES.bind(this),O=this._parseID3PES.bind(this),P=e._syncOffset(t);for(h-=(h+P)%188,l=P;l<h;l+=188)if(71===t[l]){if(u=!!(64&t[l+1]),d=((31&t[l+1])<<8)+t[l+2],(48&t[l+3])>>4>1){if((c=l+5+t[l+4])===l+188)continue}else c=l+4;switch(d){case E:u&&(S&&(f=C(S))&&D(f,!1),S={data:[],size:0}),S&&(S.data.push(t.subarray(c,l+188)),S.size+=l+188-c);break;case _:u&&(A&&(f=C(A))&&(v.isAAC?M(f):N(f)),A={data:[],size:0}),A&&(A.data.push(t.subarray(c,l+188)),A.size+=l+188-c);break;case T:u&&(R&&(f=C(R))&&O(f),R={data:[],size:0}),R&&(R.data.push(t.subarray(c,l+188)),R.size+=l+188-c);break;case 0:u&&(c+=t[c]+1),b=this._pmtId=I(t,c);break;case b:u&&(c+=t[c]+1);var L=w(t,c,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(E=L.avc)>0&&(m.pid=E),(_=L.audio)>0&&(v.pid=_,v.isAAC=L.isAAC),(T=L.id3)>0&&(y.pid=T),g&&!p&&(o.logger.log("reparse from beginning"),g=!1,l=P-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});S&&(f=C(S))?(D(f,!0),m.pesData=null):m.pesData=S,A&&(f=C(A))?(v.isAAC?M(f):N(f),v.pesData=null):(A&&A.size&&o.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=A),R&&(f=C(R))?(O(f),y.pesData=null):y.pesData=R,null==this.sampleAes?this.remuxer.remux(v,m,y,this._txtTrack,n,a,s):this.decryptAndRemux(v,m,y,this._txtTrack,n,a,s)},t.decryptAndRemux=function(e,t,n,r,i,a,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,(function(){o.decryptAndRemuxAvc(e,t,n,r,i,a,s)}))}else this.decryptAndRemuxAvc(e,t,n,r,i,a,s)},t.decryptAndRemuxAvc=function(e,t,n,r,i,a,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,(function(){o.remuxer.remux(e,t,n,r,i,a,s)}))}else this.remuxer.remux(e,t,n,r,i,a,s)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._trackUnknownPmt=function(e,t,n){var r=this.pmtUnknownTypes[e]||0;return 0===r&&(this.pmtUnknownTypes[e]=0,t.call(o.logger,n)),this.pmtUnknownTypes[e]++,r},t._parsePMT=function(e,t,n,r){var i,a,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){this._trackUnknownPmt(e[t],o.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=a);break;case 21:-1===s.id3&&(s.id3=a);break;case 219:if(!r){this._trackUnknownPmt(e[t],o.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=a);break;case 3:case 4:n?-1===s.audio&&(s.audio=a,s.isAAC=!1):this._trackUnknownPmt(e[t],o.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(e[t],o.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(e[t],o.logger.log,"Unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s},t._parsePES=function(e){var t,n,r,i,a,s,l,u,d=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var f=new Uint8Array(c[0].length+c[1].length);f.set(c[0]),f.set(c[1],c[0].length),c[0]=f,c.splice(1,1)}if(1===((t=c[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;if(192&(n=t[7])&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&n?s-(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(o.logger.warn(Math.round((s-l)/9e4)+"s delta between PTS and DTS, align them"),s=l):l=s),u=(i=t[8])+9,e.size<=u)return null;e.size-=u,a=new Uint8Array(e.size);for(var h=0,g=c.length;h<g;h++){var p=(t=c[h]).byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}a.set(t,d),d+=p}return r&&(r-=i+3),{data:a,pts:s,dts:l,len:r}}return null},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var n=t.samples,r=n.length;if(isNaN(e.pts)){if(!r)return void t.dropped++;var i=n[r-1];e.pts=i.pts,e.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,n.push(e)):t.dropped++}e.debug.length&&o.logger.log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){var n,r,i,a=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),l=this.avcSample,u=!1,d=this.pushAccesUnit.bind(this),c=function(e,t,n,r){return{key:e,pts:t,dts:n,units:[],debug:r}};e.data=null,l&&o.length&&!s.audFound&&(d(l,s),l=this.avcSample=c(!1,e.pts,e.dts,"")),o.forEach((function(t){switch(t.type){case 1:r=!0,l||(l=a.avcSample=c(!0,e.pts,e.dts,"")),l.frame=!0;var o=t.data;if(u&&o.length>4){var f=new S(o).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(l.key=!0)}break;case 5:r=!0,l||(l=a.avcSample=c(!0,e.pts,e.dts,"")),l.key=!0,l.frame=!0;break;case 6:r=!0,(n=new S(a.discardEPB(t.data))).readUByte();for(var h=0,g=0,p=!1,m=0;!p&&n.bytesAvailable>1;){h=0;do{h+=m=n.readUByte()}while(255===m);g=0;do{g+=m=n.readUByte()}while(255===m);if(4===h&&0!==n.bytesAvailable){if(p=!0,181===n.readUByte()&&49===n.readUShort()&&1195456820===n.readUInt()&&3===n.readUByte()){var y=n.readUByte(),E=31&y,_=[y,n.readUByte()];for(i=0;i<E;i++)_.push(n.readUByte()),_.push(n.readUByte()),_.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:_})}}else if(5===h&&0!==n.bytesAvailable){if(p=!0,g>16){var T=[];for(i=0;i<16;i++)T.push(n.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||T.push("-");var b=g-16,A=new Uint8Array(b);for(i=0;i<b;i++)A[i]=n.readUByte();a._insertSampleInOrder(a._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:T.join(""),userDataBytes:A,userData:Object(v.utf8ArrayToStr)(A.buffer)})}}else if(g<n.bytesAvailable)for(i=0;i<g;i++)n.readUByte()}break;case 7:if(r=!0,u=!0,!s.sps){var R=(n=new S(t.data)).readSPS();s.width=R.width,s.height=R.height,s.pixelRatio=R.pixelRatio,s.sps=[t.data],s.duration=a._duration;var I=t.data.subarray(1,4),w="avc1.";for(i=0;i<3;i++){var C=I[i].toString(16);C.length<2&&(C="0"+C),w+=C}s.codec=w}break;case 8:r=!0,s.pps||(s.pps=[t.data]);break;case 9:r=!1,s.audFound=!0,l&&d(l,s),l=a.avcSample=c(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,l&&(l.debug+="unknown NAL "+t.type+" ")}l&&r&&l.units.push(t)})),t&&l&&(d(l,s),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var n=this._avcTrack.samples;t=n[n.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},t._parseAVCNALu=function(e){var t,n,r,i,a=0,s=e.byteLength,o=this._avcTrack,l=o.naluState||0,u=l,d=[],c=-1;for(-1===l&&(c=0,i=31&e[0],l=0,a=1);a<s;)if(t=e[a++],l)if(1!==l)if(t)if(1===t){if(c>=0)r={data:e.subarray(c,a-l-1),type:i},d.push(r);else{var f=this._getLastNalUnit();if(f&&(u&&a<=4-u&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-u)),(n=a-l-1)>0)){var h=new Uint8Array(f.data.byteLength+n);h.set(f.data,0),h.set(e.subarray(0,n),f.data.byteLength),f.data=h}}a<s?(c=a,i=31&e[a],l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(c>=0&&l>=0&&(r={data:e.subarray(c,s),type:i,state:l},d.push(r)),0===d.length){var g=this._getLastNalUnit();if(g){var p=new Uint8Array(g.data.byteLength+e.byteLength);p.set(g.data,0),p.set(e,g.data.byteLength),g.data=p}}return o.naluState=l,d},t.discardEPB=function(e){for(var t,n,r=e.byteLength,i=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===i[0]&&(s++,i.shift()),n[a]=e[s];return n},t._parseAACPES=function(e){var t,n,a,s,l,u,d,c=this._audioTrack,h=e.data,v=e.pts,y=this.aacOverFlow,E=this.aacLastPTS;if(y){var _=new Uint8Array(y.byteLength+h.byteLength);_.set(y,0),_.set(h,y.byteLength),h=_}for(a=0,l=h.length;a<l-1&&!f(h,a);a++);if(!a||(a<l-1?(u="AAC PES did not start with ADTS header,offset:"+a,d=!1):(u="no ADTS header found in AAC PES",d=!0),o.logger.warn("parsing error:"+u),this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:d,reason:u}),!d)){if(g(c,this.observer,h,a,this.audioCodec),n=0,t=p(c.samplerate),y&&E){var T=E+t;Math.abs(T-v)>1&&(o.logger.log("AAC: align PTS for overlapping frames by "+Math.round((T-v)/90)),v=T)}for(;a<l;){if(f(h,a)){if(a+5<l){var b=m(c,h,a,v,n);if(b){a+=b.length,s=b.sample.pts,n++;continue}}break}a++}y=a<l?h.subarray(a,l):null,this.aacOverFlow=y,this.aacLastPTS=s}},t._parseMPEGPES=function(e){for(var t=e.data,n=t.length,r=0,i=0,a=e.pts;i<n;)if(b.isHeader(t,i)){var s=b.appendFrame(this._audioTrack,t,i,a,r);if(!s)break;i+=s.length,r++}else i++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),C=w,D=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,n,r=v.default.getID3Data(e,0);if(r&&void 0!==v.default.getTimeStamp(r))for(t=r.length,n=Math.min(e.length-1,t+100);t<n;t++)if(b.probe(e,t))return o.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=v.default.getID3Data(e,0)||[],a=v.default.getTimeStamp(i),s=void 0!==a?90*a:9e4*t,o=i.length,l=e.length,u=0,d=0,c=this._audioTrack,f=[{pts:s,dts:s,data:i}];o<l;)if(b.isHeader(e,o)){var h=b.appendFrame(c,e,o,s,u);if(!h)break;o+=h.length,d=h.sample.pts,u++}else v.default.isHeader(e,o)?(i=v.default.getID3Data(e,o),f.push({pts:d,dts:d,data:i}),o+=i.length):o++;this.remuxer.remux(c,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),M=D,N=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),O=Math.pow(2,32)-1,P=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;i--;)r+=n[i].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<a;i++)t.set(n[i],r),r+=n[i].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var r=Math.floor(n/(O+1)),i=Math.floor(n%(O+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var r=Math.floor(n/(O+1)),i=Math.floor(n%(O+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n,r,i,a=[],s=[];for(n=0;n<t.sps.length;n++)i=(r=t.sps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)i=(r=t.pps[n]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(r));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,d=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,c>>24,c>>16&255,c>>8&255,255&c])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,a=t.height,s=Math.floor(r/(O+1)),o=Math.floor(r%(O+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,n){var r=e.sdtp(t),i=t.id,a=Math.floor(n/(O+1)),s=Math.floor(n%(O+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,a,s,o,l,u=t.samples||[],d=u.length,c=12+16*d,f=new Uint8Array(c);for(n+=8+c,f.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<d;r++)a=(i=u[r]).duration,s=i.size,o=i.flags,l=i.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*r);return e.box(e.types.trun,f)},e.initSegment=function(t){e.types||e.init();var n,r=e.moov(t);return(n=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}(),L=P;function k(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=e*t*n;return r?Math.round(i):i}function x(e,t){return void 0===t&&(t=!1),k(e,1e3,1/9e4,t)}function F(e,t){return void 0===t&&(t=1),k(e,9e4,1/t)}var U=F(10),B=F(.2),G=null,j=function(){function e(e,t,n,r){if(this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===G){var i=navigator.userAgent.match(/Chrome\/(\d+)/i);G=i?parseInt(i[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,n=e.reduce((function(e,n){var r=n.pts-e;return r<-4294967296?(t=!0,H(e,n.pts)):r>0?e:n.pts}),e[0].pts);return t&&o.logger.debug("PTS rollover detected"),n},t.remux=function(e,t,n,i,a,s,l){if(this.ISGenerated||this.generateIS(e,t,a),this.ISGenerated){var u=e.samples.length,d=t.samples.length,c=a,f=a;if(u&&d){var h=this.getVideoStartPts(t.samples),g=(H(e.samples[0].pts,h)-h)/t.inputTimeScale;c+=Math.max(0,g),f+=Math.max(0,-g)}if(u){e.timescale||(o.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,a));var p,m=this.remuxAudio(e,c,s,l);d&&(m&&(p=m.endPTS-m.startPTS),t.timescale||(o.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,a)),this.remuxVideo(t,f,s,p))}else if(d){var v=this.remuxVideo(t,f,s,0,l);v&&e.codec&&this.remuxEmptyAudio(e,c,s,v)}}n.samples.length&&this.remuxID3(n,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(r.default.FRAG_PARSED)},t.generateIS=function(e,t,n){var a,s,l=this.observer,u=e.samples,d=t.samples,c=this.typeSupported,f="audio/mp4",h={},g={tracks:h},p=void 0===this._initPTS;if(p&&(a=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,o.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(c.mpeg?(f="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),h.audio={container:f,codec:e.codec,initSegment:!e.isAAC&&c.mpeg?new Uint8Array:L.initSegment([e]),metadata:{channelCount:e.channelCount}},p&&(a=s=u[0].pts-Math.round(e.inputTimeScale*n))),t.sps&&t.pps&&d.length){var m=t.inputTimeScale;if(t.timescale=m,h.video={container:"video/mp4",codec:t.codec,initSegment:L.initSegment([t]),metadata:{width:t.width,height:t.height}},p){var v=this.getVideoStartPts(d),y=Math.round(m*n);s=Math.min(s,H(d[0].dts,v)-y),a=Math.min(a,v-y),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:a})}}else p&&h.audio&&this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:a});Object.keys(h).length?(l.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,g),this.ISGenerated=!0,p&&(this._initPTS=a,this._initDTS=s)):l.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,n,a){var s,l,u,d,c,f=e.timescale,h=e.samples,g=[],p=h.length,m=this._initPTS,v=8,y=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,_=0,T=!1,b=this.nextAvcDts;if(0!==p){n||(b=t*f-(h[0].pts-H(h[0].dts,h[0].pts)));for(var S=0;S<p;S++){var A=h[S];A.pts=H(A.pts-m,b),A.dts=H(A.dts-m,b),A.dts>A.pts&&(_=Math.max(Math.min(_,A.pts-A.dts),-1*B)),A.dts<h[S>0?S-1:S].dts&&(T=!0)}T&&h.sort((function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r||e.id-t.id})),d=h[0].dts,c=h[p-1].dts;var R=Math.round((c-d)/(p-1));if(_<0){if(_<-2*R){o.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+x(-R,!0)+" ms");for(var I=_,w=0;w<p;w++)h[w].dts=I=Math.max(I,h[w].pts-R),h[w].pts=Math.max(I,h[w].pts)}else{o.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+x(_,!0)+" ms to overcome this issue");for(var C=0;C<p;C++)h[C].dts=h[C].dts+_}d=h[0].dts,c=h[p-1].dts}if(n){var D=d-b,M=D>R;if(M||D<-1){M?o.logger.warn("AVC: "+x(D,!0)+" ms ("+D+"dts) hole between fragments detected, filling it"):o.logger.warn("AVC: "+x(-D,!0)+" ms ("+D+"dts) overlapping between fragments detected"),d=b;var N=h[0].pts-D;h[0].dts=d,h[0].pts=N,o.logger.log("Video: First PTS/DTS adjusted: "+x(N,!0)+"/"+x(d,!0)+", delta: "+x(D,!0)+" ms")}}G&&G<75&&(d=Math.max(0,d));for(var O=0,P=0,k=0;k<p;k++){for(var F=h[k],U=F.units,j=U.length,q=0,K=0;K<j;K++)q+=U[K].data.length;P+=q,O+=j,F.length=q,F.dts=Math.max(F.dts,d),F.pts=Math.max(F.pts,F.dts,0),y=Math.min(F.pts,y),E=Math.max(F.pts,E)}c=h[p-1].dts;var Y=P+4*O+8;try{l=new Uint8Array(Y)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Y,reason:"fail allocating video mdat "+Y})}var V=new DataView(l.buffer);V.setUint32(0,Y),l.set(L.types.mdat,4);for(var W=0;W<p;W++){for(var z,X=h[W],Q=X.units,$=0,Z=0,J=Q.length;Z<J;Z++){var ee=Q[Z],te=ee.data,ne=ee.data.byteLength;V.setUint32(v,ne),v+=4,l.set(te,v),v+=ne,$+=4+ne}if(W<p-1)s=h[W+1].dts-X.dts;else{var re=this.config,ie=X.dts-h[W>0?W-1:W].dts;if(re.stretchShortVideoTrack){var ae=re.maxBufferHole,se=Math.floor(ae*f),oe=(a?y+a*f:this.nextAudioPts)-X.pts;oe>se?((s=oe-ie)<0&&(s=ie),o.logger.log("It is approximately "+x(oe,!1)+" ms to the next segment; using duration "+x(s,!1)+" ms for the last video frame.")):s=ie}else s=ie}z=Math.round(X.pts-X.dts),g.push({size:$,duration:s,cts:z,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:X.key?2:1,isNonSync:X.key?0:1}})}this.nextAvcDts=c+s;var le=e.dropped;if(e.nbNalu=0,e.dropped=0,g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ue=g[0].flags;ue.dependsOn=2,ue.isNonSync=0}e.samples=g,u=L.moof(e.sequenceNumber++,d,e),e.samples=[];var de={data1:u,data2:l,startPTS:y/f,endPTS:(E+s)/f,startDTS:d/f,endDTS:this.nextAvcDts/f,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:le};return this.observer.trigger(r.default.FRAG_PARSING_DATA,de),de}},t.remuxAudio=function(e,t,n,a){var s,l,u,d,c,f,h=e.inputTimeScale,g=e.timescale,p=h/g,m=(e.isAAC?1024:1152)*p,v=this._initPTS,y=!e.isAAC&&this.typeSupported.mpeg,E=y?0:8,_=e.samples,T=[],b=this.nextAudioPts;if(n|=_.length&&b&&(a&&Math.abs(t-b/h)<.1||Math.abs(_[0].pts-b-v)<20*m),_.forEach((function(e){e.pts=e.dts=H(e.pts-v,t*h)})),_=_.filter((function(e){return e.pts>=0})),0!==_.length){if(n||(b=a?Math.max(0,t*h):_[0].pts),e.isAAC)for(var S=this.config.maxAudioFramesDrift,A=0,R=b;A<_.length;){var I=_[A],w=I.pts,C=w-R;if(C<=-S*m)n||A>0?(o.logger.warn("Dropping 1 audio frame @ "+x(R,!0)/1e3+"s due to "+x(C,!0)+" ms overlap."),_.splice(A,1)):(o.logger.warn("Audio frame @ "+x(w,!0)/1e3+"s overlaps nextAudioPts by "+x(C,!0)+" ms."),R=w+m,A++);else if(C>=S*m&&C<U&&R){var D=Math.round(C/m);o.logger.warn("Injecting "+D+" audio frames @ "+x(R,!0)/1e3+"s due to "+x(C,!0)+" ms gap.");for(var M=0;M<D;M++){var O=Math.max(R,0);(l=N.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),l=I.unit.subarray()),_.splice(A,0,{unit:l,pts:O,dts:O}),R+=m,A++}I.pts=I.dts=R,R+=m,A++}else I.pts=I.dts=R,R+=m,A++}for(var P=_.length,k=0;P--;)k+=_[P].unit.byteLength;for(var F=0,B=_.length;F<B;F++){var G=_[F],j=G.unit,q=G.pts;if(void 0!==f&&s)s.duration=Math.round((q-f)/p);else{var K=q-b,Y=0;if(n&&e.isAAC&&K){if(K>0&&K<U)Y=Math.round((q-b)/m),o.logger.log(x(K,!0)+" ms hole between AAC samples detected,filling it"),Y>0&&((l=N.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(l=j.subarray()),k+=Y*l.length);else if(K<-12){o.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+x(b,!0)+" ms / "+x(q,!0)+" ms / "+x(-K,!0)+" ms"),k-=j.byteLength;continue}q=b}if(c=q,!(k>0))return;k+=E;try{u=new Uint8Array(k)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:k,reason:"fail allocating audio mdat "+k})}y||(new DataView(u.buffer).setUint32(0,k),u.set(L.types.mdat,4));for(var V=0;V<Y;V++)(l=N.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),l=j.subarray()),u.set(l,E),E+=l.byteLength,s={size:l.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(s)}u.set(j,E);var W=j.byteLength;E+=W,s={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(s),f=q}var z=0;if((P=T.length)>=2&&(z=T[P-2].duration,s.duration=z),P){this.nextAudioPts=b=f+p*z,e.samples=T,d=y?new Uint8Array:L.moof(e.sequenceNumber++,c/p,e),e.samples=[];var X=c/h,Q=b/h,$={data1:d,data2:u,startPTS:X,endPTS:Q,startDTS:X,endDTS:Q,type:"audio",hasAudio:!0,hasVideo:!1,nb:P};return this.observer.trigger(r.default.FRAG_PARSING_DATA,$),$}return null}},t.remuxEmptyAudio=function(e,t,n,r){var i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),s=this.nextAudioPts,l=(void 0!==s?s:r.startDTS*i)+this._initDTS,u=r.endDTS*i+this._initDTS,d=1024*a,c=Math.ceil((u-l)/d),f=N.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(o.logger.warn("remux empty Audio"),f){for(var h=[],g=0;g<c;g++){var p=l+g*d;h.push({unit:f,pts:p,dts:p})}e.samples=h,this.remuxAudio(e,t,n)}else o.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e,t){var n=e.samples.length;if(n){for(var i=e.inputTimeScale,a=this._initPTS,s=this._initDTS,o=0;o<n;o++){var l=e.samples[o];l.pts=H(l.pts-a,t*i)/i,l.dts=H(l.dts-s,t*i)/i}this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:e.samples}),e.samples=[]}},t.remuxText=function(e,t){var n=e.samples.length,i=e.inputTimeScale,a=this._initPTS;if(n){for(var s=0;s<n;s++){var o=e.samples[s];o.pts=H(o.pts-a,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts})),this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e}();function H(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}var q,K=j,Y=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,n,i,a,s,o,l){var u=this.observer,d="";e&&(d+="audio"),t&&(d+="video"),u.trigger(r.default.FRAG_PARSING_DATA,{data1:l,startPTS:a,startDTS:a,type:d,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(r.default.FRAG_PARSED)},e}(),V=Object(l.getSelfScope)();try{q=V.performance.now.bind(V.performance)}catch(e){o.logger.debug("Unable to use Performance API on this environment"),q=V.Date.now}var W=function(){function e(e,t,n,r){this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,n,i,s,o,l,u,d,c,f,h){var g=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var p=this.decrypter;null==p&&(p=this.decrypter=new a.default(this.observer,this.config));var m=q();p.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var a=q();g.observer.trigger(r.default.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:a}}),g.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,s,o,l,u,d,c,f,h)}))}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,s,o,l,u,d,c,f,h)},t.pushDecrypted=function(e,t,n,a,s,o,l,u,d,c,f,h){var g=this.demuxer,p=this.remuxer;if(!g||l||u){for(var m,v=this.observer,y=this.typeSupported,T=this.config,b=[{demux:C,remux:K},{demux:_.default,remux:Y},{demux:E,remux:K},{demux:M,remux:K}],S=0,A=b.length;S<A&&!(m=b[S]).demux.probe(e);S++);if(!m)return void v.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});p&&p instanceof m.remux||(p=new m.remux(v,T,y,this.vendor)),g&&g instanceof m.demux||(g=new m.demux(v,p,T,y),this.probe=m.demux.probe),this.demuxer=g,this.remuxer=p}(l||u)&&(g.resetInitSegment(n,a,s,c),p.resetInitSegment()),l&&(g.resetTimeStamp(h),p.resetTimeStamp(h)),"function"==typeof g.setDecryptData&&g.setDecryptData(t),g.append(e,o,d,f)},e}();t.default=W},"./src/demux/demuxer-worker.js":function(e,t,n){n.r(t);var r=n(/*! ../demux/demuxer-inline */"./src/demux/demuxer-inline.js"),i=n(/*! ../events */"./src/events.js"),a=n(/*! ../utils/logger */"./src/utils/logger.js"),s=n(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");t.default=function(e){var t=new s.EventEmitter;t.trigger=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",(function(i){var s=i.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.demuxer=new r.default(t,s.typeSupported,o,s.vendor),Object(a.enableLogs)(o.debug),n("init",null);break;case"demux":e.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS)}})),t.on(i.default.FRAG_DECRYPTED,n),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(i.default.FRAG_PARSED,n),t.on(i.default.ERROR,n),t.on(i.default.FRAG_PARSING_METADATA,n),t.on(i.default.FRAG_PARSING_USERDATA,n),t.on(i.default.INIT_PTS_FOUND,n),t.on(i.default.FRAG_PARSING_DATA,(function(t,n){var r=[],i={event:t,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),e.postMessage(i,r)}))}},"./src/demux/id3.js":function(e,t,n){n.r(t),n.d(t,"utf8ArrayToStr",(function(){return o}));var r,i=n(/*! ../utils/get-self-scope */"./src/utils/get-self-scope.js"),a=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,n){for(var r=n,i=0;e.isHeader(t,n);)i+=10,i+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(i+=10),n+=i;if(i>0)return t.subarray(r,r+i)},e._readSize=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]},e.getTimeStamp=function(t){for(var n=e.getID3Frames(t),r=0;r<n.length;r++){var i=n[r];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:n,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var n=0,r=[];e.isHeader(t,n);){for(var i=e._readSize(t,n+6),a=(n+=10)+i;n+8<a;){var s=e._getFrameData(t.subarray(n)),o=e._decodeFrame(s);o&&r.push(o),n+=s.size+10}e.isFooter(t,n)&&(n+=10)}return r},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):e._decodeTextFrame(t)},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var a=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:a}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var a=e._utf8ArrayToStr(t.data);return{key:t.type,data:a}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var n=s();if(n){var r=n.decode(e);if(t){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var a,o,l,u=e.length,d="",c=0;c<u;){if(0===(a=e[c++])&&t)return d;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(a);break;case 12:case 13:o=e[c++],d+=String.fromCharCode((31&a)<<6|63&o);break;case 14:o=e[c++],l=e[c++],d+=String.fromCharCode((15&a)<<12|(63&o)<<6|(63&l)<<0)}}return d},e}();function s(){var e=Object(i.getSelfScope)();return r||void 0===e.TextDecoder||(r=new e.TextDecoder("utf-8")),r}var o=a._utf8ArrayToStr;t.default=a},"./src/demux/mp4demuxer.js":function(e,t,n){n.r(t);var r=n(/*! ../utils/logger */"./src/utils/logger.js"),i=n(/*! ../events */"./src/events.js"),a=Math.pow(2,32)-1,s=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,n,r,a){if(t&&t.byteLength){var s=this.initData=e.parseInitSegment(t);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var o={};s.audio&&s.video?o.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:a?t:null}:(s.audio&&(o.audio={container:"audio/mp4",codec:n,initSegment:a?t:null}),s.video&&(o.video={container:"video/mp4",codec:r,initSegment:a?t:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n},e.writeUint32=function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},e.findBox=function(t,n){var r,i,a,s,o,l,u=[];if(t.data?(o=t.start,a=t.end,t=t.data):(o=0,a=t.byteLength),!n.length)return null;for(r=o;r<a;)l=(i=e.readUint32(t,r))>1?r+i:a,e.bin2str(t.subarray(r+4,r+8))===n[0]&&(1===n.length?u.push({data:t,start:r+8,end:l}):(s=e.findBox({data:t,start:r+8,end:l},n.slice(1))).length&&(u=u.concat(s))),r=l;return u},e.parseSegmentIndex=function(t){var n,r=e.findBox(t,["moov"])[0],i=r?r.end:null,a=0,s=e.findBox(t,["sidx"]);if(!s||!s[0])return null;n=[];var o=(s=s[0]).data[0];a=0===o?8:16;var l=e.readUint32(s,a);a+=4,a+=0===o?8:16,a+=2;var u=s.end+0,d=e.readUint16(s,a);a+=2;for(var c=0;c<d;c++){var f=a,h=e.readUint32(s,f);f+=4;var g=2147483647&h;if(1==(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var p=e.readUint32(s,f);f+=4,n.push({referenceSize:g,subsegmentDuration:p,info:{duration:p/l,start:u,end:u+g-1}}),u+=g,a=f+=4}return{earliestPresentationTime:0,timescale:l,version:o,referencesCount:d,references:n,moovEndOffset:i}},e.parseInitSegment=function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach((function(t){var i=e.findBox(t,["tkhd"])[0];if(i){var a=i.data[i.start],s=0===a?12:20,o=e.readUint32(i,s),l=e.findBox(t,["mdia","mdhd"])[0];if(l){s=0===(a=l.data[l.start])?12:20;var u=e.readUint32(l,s),d=e.findBox(t,["mdia","hdlr"])[0];if(d){var c={soun:"audio",vide:"video"}[e.bin2str(d.data.subarray(d.start+8,d.start+12))];if(c){var f=e.findBox(t,["mdia","minf","stbl","stsd"]);if(f.length){f=f[0];var h=e.bin2str(f.data.subarray(f.start+12,f.start+16));r.logger.log("MP4Demuxer:"+c+":"+h+" found")}n[o]={timescale:u,type:c},n[c]={timescale:u,id:o}}}}}})),n},e.getStartDTS=function(t,n){var r,i,a;return r=e.findBox(n,["moof","traf"]),i=[].concat.apply([],r.map((function(n){return e.findBox(n,["tfhd"]).map((function(r){var i,a,s;return i=e.readUint32(r,4),a=t[i].timescale||9e4,s=e.findBox(n,["tfdt"]).map((function(t){var n,r;return n=t.data[t.start],r=e.readUint32(t,4),1===n&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r}))[0],s/a}))}))),a=Math.min.apply(null,i),isFinite(a)?a:0},e.offsetStartDTS=function(t,n,r){e.findBox(n,["moof","traf"]).map((function(n){return e.findBox(n,["tfhd"]).map((function(i){var s=e.readUint32(i,4),o=t[s].timescale||9e4;e.findBox(n,["tfdt"]).map((function(t){var n=t.data[t.start],i=e.readUint32(t,4);if(0===n)e.writeUint32(t,4,i-r*o);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=r*o,i=Math.max(i,0);var s=Math.floor(i/(a+1)),l=Math.floor(i%(a+1));e.writeUint32(t,4,s),e.writeUint32(t,8,l)}}))}))}))},t.append=function(t,n,r,a){var s=this.initData;s||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),s=this.initData);var o,l=this.initPTS;if(void 0===l){var u=e.getStartDTS(s,t);this.initPTS=l=u-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:l})}e.offsetStartDTS(s,t,l),o=e.getStartDTS(s,t),this.remuxer.remux(s.audio,s.video,null,null,o,r,a,t)},t.destroy=function(){},e}();t.default=s},"./src/errors.ts":function(e,t,n){var r,i;n.r(t),n.d(t,"ErrorTypes",(function(){return r})),n.d(t,"ErrorDetails",(function(){return i})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(r||(r={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException"}(i||(i={}))},"./src/events.js":function(e,t,n){n.r(t),t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(e,t,n){n.r(t),n.d(t,"default",(function(){return wn}));var r={};n.r(r),n.d(r,"newCue",(function(){return Ct}));var i,a,s=n("./node_modules/url-toolkit/src/url-toolkit.js"),o=n("./src/errors.ts"),l=n("./src/polyfills/number.js"),u=n("./src/events.js"),d=n("./src/utils/logger.js"),c={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},f=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if(c[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)}),this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}),this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){try{(function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)}).call(this,e,t).call()}catch(t){d.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}(),h=f;!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(a||(a={}));var g=n("./src/demux/mp4demuxer.js");function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m,v=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}var t,n,r;return t=e,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(s.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&p(t.prototype,n),r&&p(t,r),e}();function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.AUDIO="audio",e.VIDEO="video"}(m||(m={}));var E=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[m.AUDIO]=!1,e[m.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t,n,r,i=e.prototype;return i.setByteRange=function(e,t){var n=e.split("@",2),r=[];1===n.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},i.addElementaryStream=function(e){this._elementaryStreams[e]=!0},i.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},i.createInitializationVector=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},i.setDecryptDataFromLevelKey=function(e,t){var n=e;return(null==e?void 0:e.method)&&e.uri&&!e.iv&&((n=new v(e.baseuri,e.reluri)).method=e.method,n.iv=this.createInitializationVector(t)),n},t=e,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&d.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(l.isFiniteNumber)(this.programDateTime))return null;var e=Object(l.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&y(t.prototype,n),r&&y(t,r),e}();function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}var t,n,r;return t=e,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(l.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&_(t.prototype,n),r&&_(t,r),e}(),b=/^(\d+)x(\d+)$/,S=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function e(t){for(var n in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){var t=b.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n={};for(S.lastIndex=0;null!==(t=S.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}(),R={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function I(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var w=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,C=/#EXT-X-MEDIA:(.*)/g,D=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),M=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,N=/\.(mp4|m4s|m4v|m4a)$/i,O=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return s.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i=[],a={},s=!1;function o(e,t){["video","audio"].forEach((function(n){var r=e.filter((function(e){return function(e,t){var n=R[t];return!!n&&!0===n[e.slice(0,4)]}(e,n)}));if(r.length){var i=r.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter((function(e){return-1===r.indexOf(e)}))}})),t.unknownCodecs=e}for(w.lastIndex=0;null!=(r=w.exec(t));)if(r[1]){var l={},u=l.attrs=new A(r[1]);l.url=e.resolve(r[2],n);var d=u.decimalResolution("RESOLUTION");d&&(l.width=d.width,l.height=d.height),l.bitrate=u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),l.name=u.NAME,o([].concat((u.CODECS||"").split(/[ ,]+/)),l),l.videoCodec&&-1!==l.videoCodec.indexOf("avc1")&&(l.videoCodec=e.convertAVC1ToAVCOTI(l.videoCodec)),i.push(l)}else if(r[3]){var c=new A(r[3]);c["DATA-ID"]&&(s=!0,a[c["DATA-ID"]]=c)}return{levels:i,sessionData:s?a:null}},e.parseMasterPlaylistMedia=function(t,n,r,i){var a;void 0===i&&(i=[]);var s=[],o=0;for(C.lastIndex=0;null!==(a=C.exec(t));){var l=new A(a[1]);if(l.TYPE===r){var u={attrs:l,id:o++,groupId:l["GROUP-ID"],instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE,type:r,default:"YES"===l.DEFAULT,autoselect:"YES"===l.AUTOSELECT,forced:"YES"===l.FORCED,lang:l.LANGUAGE};if(l.URI&&(u.url=e.resolve(l.URI,n)),i.length){var d=e.findGroup(i,u.groupId);u.audioCodec=d?d.codec:i[0].codec}s.push(u)}}return s},e.parseLevelPlaylist=function(e,t,n,r,i){var a,s,o,u=0,c=0,f=new T(t),h=0,g=null,p=new E,m=null;for(D.lastIndex=0;null!==(a=D.exec(e));){var y=a[1];if(y){p.duration=parseFloat(y);var _=(" "+a[2]).slice(1);p.title=_||null,p.tagList.push(_?["INF",y,_]:["INF",y])}else if(a[3]){if(Object(l.isFiniteNumber)(p.duration)){var b=u++;p.type=r,p.start=c,o&&(p.levelkey=o),p.sn=b,p.level=n,p.cc=h,p.urlId=i,p.baseurl=t,p.relurl=(" "+a[3]).slice(1),P(p,g),f.fragments.push(p),g=p,c+=p.duration,p=new E}}else if(a[4]){var S=(" "+a[4]).slice(1);g?p.setByteRange(S,g):p.setByteRange(S)}else if(a[5])p.rawProgramDateTime=(" "+a[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),null===m&&(m=f.fragments.length);else{if(!(a=a[0].match(M))){d.logger.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<a.length&&void 0===a[s];s++);var R=(" "+a[s+1]).slice(1),I=(" "+a[s+2]).slice(1);switch(a[s]){case"#":p.tagList.push(I?[R,I]:[R]);break;case"PLAYLIST-TYPE":f.type=R.toUpperCase();break;case"MEDIA-SEQUENCE":u=f.startSN=parseInt(R);break;case"TARGETDURATION":f.targetduration=parseFloat(R);break;case"VERSION":f.version=parseInt(R);break;case"EXTM3U":break;case"ENDLIST":f.live=!1;break;case"DIS":h++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":h=parseInt(R);break;case"KEY":var w=new A(R),C=w.enumeratedString("METHOD"),O=w.URI,L=w.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(w.KEYFORMAT||"identity")){d.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}C&&(o=new v(t,O),O&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(C)>=0&&(o.method=C,o.key=null,o.iv=L));break;case"START":var k=new A(R).decimalFloatingPoint("TIME-OFFSET");Object(l.isFiniteNumber)(k)&&(f.startTimeOffset=k);break;case"MAP":var x=new A(R);p.relurl=x.URI,x.BYTERANGE&&p.setByteRange(x.BYTERANGE),p.baseurl=t,p.level=n,p.type=r,p.sn="initSegment",f.initSegment=p,(p=new E).rawProgramDateTime=f.initSegment.rawProgramDateTime;break;default:d.logger.warn("line parsed but not handled: "+a)}}}return(p=g)&&!p.relurl&&(f.fragments.pop(),c-=p.duration),f.totalduration=c,f.averagetargetduration=c/f.fragments.length,f.endSN=u-1,f.startCC=f.fragments[0]?f.fragments[0].cc:0,f.endCC=h,!f.initSegment&&f.fragments.length&&f.fragments.every((function(e){return N.test(e.relurl)}))&&(d.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(p=new E).relurl=f.fragments[0].relurl,p.baseurl=t,p.level=n,p.type=r,p.sn="initSegment",f.initSegment=p,f.needSidxRanges=!0),m&&function(e,t){for(var n=e[t],r=t-1;r>=0;r--){var i=e[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(f.fragments,m),f},e}();function P(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):(null==t?void 0:t.programDateTime)&&(e.programDateTime=t.endProgramDateTime),Object(l.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var L=window.performance,k=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADING,u.default.LEVEL_LOADING,u.default.AUDIO_TRACK_LOADING,u.default.SUBTITLE_TRACK_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.canHaveQualityLevels=function(e){return e!==i.AUDIO_TRACK&&e!==i.SUBTITLE_TRACK},r.mapContextToLevelType=function(e){switch(e.type){case i.AUDIO_TRACK:return a.AUDIO;case i.SUBTITLE_TRACK:return a.SUBTITLE;default:return a.MAIN}},r.getResponseUrl=function(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n};var s=r.prototype;return s.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i},s.getInternalLoader=function(e){return this.loaders[e.type]},s.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},s.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},s.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},s.onManifestLoading=function(e){this.load({url:e.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},s.onLevelLoading=function(e){this.load({url:e.url,type:i.LEVEL,level:e.level,id:e.id,responseType:"text"})},s.onAudioTrackLoading=function(e){this.load({url:e.url,type:i.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},s.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:i.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},s.load=function(e){var t=this.hls.config;d.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var n,r,a,s,o=this.getInternalLoader(e);if(o){var l=o.context;if(l&&l.url===e.url)return d.logger.trace("playlist request ongoing"),!1;d.logger.warn("aborting previous loader for type: "+e.type),o.abort()}switch(e.type){case i.MANIFEST:n=t.manifestLoadingMaxRetry,r=t.manifestLoadingTimeOut,a=t.manifestLoadingRetryDelay,s=t.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:n=0,s=0,a=0,r=t.levelLoadingTimeOut;break;default:n=t.levelLoadingMaxRetry,r=t.levelLoadingTimeOut,a=t.levelLoadingRetryDelay,s=t.levelLoadingMaxRetryTimeout}o=this.createInternalLoader(e);var u={timeout:r,maxRetry:n,retryDelay:a,maxRetryDelay:s},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return d.logger.debug("Calling internal loader delegate for URL: "+e.url),o.load(e,u,c),!0},s.loadsuccess=function(e,t,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,r);if(this.resetInternalLoader(n.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=e.data;t.tload=L.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,r):this._handleMasterPlaylist(e,t,n,r):this._handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},s.loaderror=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!1,e)},s.loadtimeout=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!0)},s._handleMasterPlaylist=function(e,t,n,i){var a=this.hls,s=e.data,o=r.getResponseUrl(e,n),l=O.parseMasterPlaylist(s,o),c=l.levels,f=l.sessionData;if(c.length){var h=c.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),g=O.parseMasterPlaylistMedia(s,o,"AUDIO",h),p=O.parseMasterPlaylistMedia(s,o,"SUBTITLES"),m=O.parseMasterPlaylistMedia(s,o,"CLOSED-CAPTIONS");if(g.length){var v=!1;g.forEach((function(e){e.url||(v=!0)})),!1===v&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(d.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}a.trigger(u.default.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:p,captions:m,url:o,stats:t,networkDetails:i,sessionData:f})}else this._handleManifestParsingError(e,n,"no level found in manifest",i)},s._handleTrackOrLevelPlaylist=function(e,t,n,a){var s=this.hls,d=n.id,c=n.level,f=n.type,h=r.getResponseUrl(e,n),g=Object(l.isFiniteNumber)(d)?d:0,p=Object(l.isFiniteNumber)(c)?c:g,m=r.mapContextToLevelType(n),v=O.parseLevelPlaylist(e.data,h,p,m,g);if(v.tload=t.tload,v.fragments.length){if(f===i.MANIFEST){var y={url:h,details:v};s.trigger(u.default.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:h,stats:t,networkDetails:a,sessionData:null})}if(t.tparsed=L.now(),v.needSidxRanges){var E=v.initSegment.url;this.load({url:E,isSidxRequest:!0,type:f,level:c,levelDetails:v,id:d,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=v,this._handlePlaylistLoaded(e,t,n,a)}else s.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},s._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var n=g.default.parseSegmentIndex(new Uint8Array(e.data));if(n){var r=n.references,i=t.levelDetails;r.forEach((function(e,t){var n=e.info;if(i){var r=i.fragments[t];0===r.byteRange.length&&r.setByteRange(String(1+n.end-n.start)+"@"+String(n.start))}})),i&&i.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},s._handleManifestParsingError=function(e,t,n,r){this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:r})},s._handleNetworkError=function(e,t,n,r){var a,s;void 0===n&&(n=!1),void 0===r&&(r=null),d.logger.info("A network error occured while loading a "+e.type+"-type playlist");var l=this.getInternalLoader(e);switch(e.type){case i.MANIFEST:a=n?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case i.LEVEL:a=n?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case i.AUDIO_TRACK:a=n?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;default:s=!1}l&&(l.abort(),this.resetInternalLoader(e.type));var c={type:o.ErrorTypes.NETWORK_ERROR,details:a,fatal:s,url:e.url,loader:l,context:e,networkDetails:t};r&&(c.response=r),this.hls.trigger(u.default.ERROR,c)},s._handlePlaylistLoaded=function(e,t,n,a){var s=n.type,o=n.level,l=n.id,d=n.levelDetails;if(d&&d.targetduration)if(r.canHaveQualityLevels(n.type))this.hls.trigger(u.default.LEVEL_LOADED,{details:d,level:o||0,id:l||0,stats:t,networkDetails:a});else switch(s){case i.AUDIO_TRACK:this.hls.trigger(u.default.AUDIO_TRACK_LOADED,{details:d,id:l,stats:t,networkDetails:a});break;case i.SUBTITLE_TRACK:this.hls.trigger(u.default.SUBTITLE_TRACK_LOADED,{details:d,id:l,stats:t,networkDetails:a})}else this._handleManifestParsingError(e,n,"invalid target duration",a)},r}(h),x=k,F=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FRAG_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){var t=this.loaders;for(var n in t){var r=t[n];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,n=t.type,r=this.loaders,i=this.hls.config,a=i.fLoader,s=i.loader;t.loaded=0;var o,u,c,f=r[n];f&&(d.logger.warn("abort previous fragment loader for type: "+n),f.abort()),f=r[n]=t.loader=i.fLoader?new a(i):new s(i),o={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var h=t.byteRangeStartOffset,g=t.byteRangeEndOffset;Object(l.isFiniteNumber)(h)&&Object(l.isFiniteNumber)(g)&&(o.rangeStart=h,o.rangeEnd=g),u={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},f.load(o,u,c)},i.loadsuccess=function(e,t,n,r){void 0===r&&(r=null);var i=e.data,a=n.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:a,stats:t,networkDetails:r})},i.loaderror=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})},i.loadtimeout=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})},i.loadprogress=function(e,t,n,r){void 0===r&&(r=null);var i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e,networkDetails:r})},r}(h),U=F,B=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.KEY_LOADING)||this).loaders={},n.decryptkey=null,n.decrypturl=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){for(var t in this.loaders){var n=this.loaders[t];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,n=t.type,r=this.loaders[n];if(t.decryptdata){var i=t.decryptdata.uri;if(i!==this.decrypturl||null===this.decryptkey){var a=this.hls.config;if(r&&(d.logger.warn("abort previous key loader for type:"+n),r.abort()),!i)return void d.logger.warn("key uri is falsy");t.loader=this.loaders[n]=new a.loader(a),this.decrypturl=i,this.decryptkey=null;var s={url:i,frag:t,responseType:"arraybuffer"},o={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(s,o,l)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}else d.logger.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(e,t,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,delete this.loaders[r.type],this.hls.trigger(u.default.KEY_LOADED,{frag:r})):d.logger.error("after key load, decryptdata unset")},i.loaderror=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},i.loadtimeout=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},r}(h),G=B,j="NOT_LOADED",H="APPENDING",q="PARTIAL",K="OK",Y=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.BUFFER_APPENDED,u.default.FRAG_BUFFERED,u.default.FRAG_LOADED)||this).bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,h.prototype.destroy.call(this),e.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var n=this.fragments,r=Object.keys(n).filter((function(r){var i=n[r];if(i.body.type!==t)return!1;if(!i.buffered)return!1;var a=i.body;return a.startPTS<=e&&e<=a.endPTS}));if(0===r.length)return null;var i=r.pop();return n[i].body},i.detectEvictedFragments=function(e,t){var n=this;Object.keys(this.fragments).forEach((function(r){var i=n.fragments[r];if(i&&i.buffered){var a=i.range[e];if(a)for(var s=a.time,o=0;o<s.length;o++){var l=s[o];if(!n.isTimeBuffered(l.startPTS,l.endPTS,t)){n.removeFragment(i.body);break}}}}))},i.detectPartialFragments=function(e){var t=this,n=this.getFragmentKey(e),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach((function(n){if(e.hasElementaryStream(n)){var i=t.timeRanges[n];r.range[n]=t.getBufferedTimes(e.startPTS,e.endPTS,i)}})))},i.getBufferedTimes=function(e,t,n){for(var r,i,a=[],s=!1,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=r&&t<=i){a.push({startPTS:Math.max(e,n.start(o)),endPTS:Math.min(t,n.end(o))});break}if(e<i&&t>r)a.push({startPTS:Math.max(e,n.start(o)),endPTS:Math.min(t,n.end(o))}),s=!0;else if(t<=r)break}return{time:a,partial:s}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t,n,r,i=this,a=null,s=0;return Object.keys(this.fragments).forEach((function(o){var l=i.fragments[o];i.isPartial(l)&&(n=l.body.startPTS-i.bufferPadding,r=l.body.endPTS+i.bufferPadding,e>=n&&e<=r&&(t=Math.min(e-n,r-e),s<=t&&(a=l.body,s=t)))})),a},i.getState=function(e){var t=this.getFragmentKey(e),n=this.fragments[t],r=j;return void 0!==n&&(r=n.buffered?!0===this.isPartial(n)?q:K:H),r},i.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},i.isTimeBuffered=function(e,t,n){for(var r,i,a=0;a<n.length;a++){if(r=n.start(a)-this.bufferPadding,i=n.end(a)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;Object(l.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)}))},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},r}(h),V={search:function(e,t){for(var n=0,r=e.length-1,i=null,a=null;n<=r;){var s=t(a=e[i=(n+r)/2|0]);if(s>0)n=i+1;else{if(!(s<0))return a;r=i-1}}return null}},W=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,n){try{if(e){var r,i=e.buffered,a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,n){e.sort((function(e,t){var n=e.start-t.start;return n||t.end-e.end}));var r=[];if(n)for(var i=0;i<e.length;i++){var a=r.length;if(a){var s=r[a-1].end;e[i].start-s<n?e[i].end>s&&(r[a-1].end=e[i].end):r.push(e[i])}else r.push(e[i])}else r=e;for(var o,l=0,u=t,d=t,c=0;c<r.length;c++){var f=r[c].start,h=r[c].end;if(t+n>=f&&t<h)u=f,l=(d=h)-t;else if(t+n<f){o=f;break}}return{len:l,start:u,end:d,nextStart:o}},e}(),z=n("./node_modules/eventemitter3/index.js"),X=n("./node_modules/webworkify-webpack/index.js"),Q=n("./src/demux/demuxer-inline.js");function $(){return window.MediaSource||window.WebKitMediaSource}var Z=n("./src/utils/get-self-scope.js"),J=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.prototype.trigger=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(n))},r}(z.EventEmitter),ee=Object(Z.getSelfScope)(),te=$()||{isTypeSupported:function(){return!1}},ne=function(){function e(e,t){var n=this;this.hls=e,this.id=t;var r=this.observer=new J,i=e.config,a=function(t,r){(r=r||{}).frag=n.frag,r.id=n.id,e.trigger(t,r)};r.on(u.default.FRAG_DECRYPTED,a),r.on(u.default.FRAG_PARSING_INIT_SEGMENT,a),r.on(u.default.FRAG_PARSING_DATA,a),r.on(u.default.FRAG_PARSED,a),r.on(u.default.ERROR,a),r.on(u.default.FRAG_PARSING_METADATA,a),r.on(u.default.FRAG_PARSING_USERDATA,a),r.on(u.default.INIT_PTS_FOUND,a);var s={mp4:te.isTypeSupported("video/mp4"),mpeg:te.isTypeSupported("audio/mpeg"),mp3:te.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var c;d.logger.log("demuxing in webworker");try{c=this.w=X(/*! ../demux/demuxer-worker.js */"./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),c.addEventListener("message",this.onwmsg),c.onerror=function(t){e.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},c.postMessage({cmd:"init",typeSupported:s,vendor:l,id:t,config:JSON.stringify(i)})}catch(e){d.logger.warn("Error in worker:",e),d.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),c&&ee.URL.revokeObjectURL(c.objectURL),this.demuxer=new Q.default(r,s,i,l),this.w=void 0}}else this.demuxer=new Q.default(r,s,i,l)}var t=e.prototype;return t.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},t.push=function(e,t,n,r,i,a,s,o){var u=this.w,c=Object(l.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,f=i.decryptdata,h=this.frag,g=!(h&&i.cc===h.cc),p=!(h&&i.level===h.level),m=h&&i.sn===h.sn+1,v=!p&&m;if(g&&d.logger.log(this.id+":discontinuity detected"),p&&d.logger.log(this.id+":switch detected"),this.frag=i,u)u.postMessage({cmd:"demux",data:e,decryptdata:f,initSegment:t,audioCodec:n,videoCodec:r,timeOffset:c,discontinuity:g,trackSwitch:p,contiguous:v,duration:a,accurateTimeOffset:s,defaultInitPTS:o},e instanceof ArrayBuffer?[e]:[]);else{var y=this.demuxer;y&&y.push(e,f,t,n,r,c,g,p,v,a,s,o)}},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":ee.URL.revokeObjectURL(this.w.objectURL);break;case u.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},e}(),re=ne;function ie(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function ae(e,t,n){var r=e[t],i=e[n],a=i.startPTS;if(Object(l.isFiniteNumber)(a))n>t?(r.duration=a-r.start,r.duration<0&&d.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-a,i.duration<0&&d.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"));else if(n>t){var s=r.cc===i.cc;i.start=r.start+(s&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else i.start=Math.max(r.start-i.duration,0)}function se(e,t,n,r,i,a){var s=n,o=r;if(Object(l.isFiniteNumber)(t.startPTS)){var u=Math.abs(t.startPTS-n);Object(l.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(u,t.deltaPTS):t.deltaPTS=u,s=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),o=Math.min(r,t.endPTS),r=Math.max(r,t.endPTS),i=Math.min(i,t.startDTS),a=Math.max(a,t.endDTS)}var d=n-t.start;t.start=t.startPTS=n,t.maxStartPTS=s,t.endPTS=r,t.minEndPTS=o,t.startDTS=i,t.endDTS=a,t.duration=r-n;var c,f,h,g=t.sn;if(!e||g<e.startSN||g>e.endSN)return 0;for(c=g-e.startSN,(f=e.fragments)[c]=t,h=c;h>0;h--)ae(f,h,h-1);for(h=c;h<f.length-1;h++)ae(f,h,h+1);return e.PTSKnown=!0,d}function oe(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var n,r=0;if(le(e,t,(function(e,i){r=e.cc-i.cc,Object(l.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,n=i),t.PTSKnown=!0})),t.PTSKnown){if(r){d.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=t.fragments,a=0;a<i.length;a++)i[a].cc+=r}n?se(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(e,t){var n=t.startSN-e.startSN,r=e.fragments,i=t.fragments;if(!(n<0||n>r.length))for(var a=0;a<i.length;a++)i[a].start+=r[n].start}(e,t),t.PTSKnown=e.PTSKnown}}function le(e,t,n){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,s=r;s<=i;s++){var o=e.fragments[a+s],l=t.fragments[s];if(!o||!l)break;n(o,l,s)}}function ue(e,t,n){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),i=r/2;return e&&t.endSN===e.endSN&&(r=i),n&&(r=Math.max(i,r-(window.performance.now()-n))),Math.round(r)}var de={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}};function ce(e,t){t.fragments.forEach((function(t){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}})),t.PTSKnown=!0}function fe(e,t,n){!function(e,t,n){if(function(e,t,n){var r=!1;return t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC)&&(r=!0),r}(e,n,t)){var r=function(e,t){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var i=function(e,t){for(var n=null,r=0;r<e.length;r+=1){var i=e[r];if(i&&i.cc===t){n=i;break}}return n}(n,r[0].cc);if(i&&(!i||i.startPTS))return i;d.logger.log("No frag in previous level to align on")}else d.logger.log("No fragments to align")}(n.details,t);r&&(d.logger.log("Adjusting PTS using last level due to CC increase within current level"),ce(r.start,t))}}(e,n,t),!n.PTSKnown&&t&&function(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var n=t.fragments[0].programDateTime,r=(e.fragments[0].programDateTime-n)/1e3+t.fragments[0].start;Object(l.isFiniteNumber)(r)&&(d.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),ce(r,e))}}(n,t.details)}function he(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Object(l.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<e.length;++r){var i=e[r];if(me(t,n,i))return i}return null}function ge(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null;if(e?i=t[e.sn-t[0].sn+1]:0===n&&0===t[0].start&&(i=t[0]),i&&0===pe(n,r,i))return i;var a=V.search(t,pe.bind(null,n,r));return a||i}function pe(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0);var r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function me(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}var ve=function(){function e(e,t,n,r){this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,n=this.media,r=this.stalled,i=n.currentTime,a=n.seeking,s=this.seeking&&!a,o=!this.seeking&&a;if(this.seeking=a,i===e){if((o||s)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var l=W.bufferInfo(n,i,0),u=l.len>0,c=l.nextStart||0;if(u||c){if(a){var f=l.len>2,h=!c||c-i>2&&!this.fragmentTracker.getPartialFragment(i);if(f||h)return;this.moved=!1}if(!this.moved&&this.stalled){var g=Math.max(c,l.start||0)-i;if(g>0&&g<=2)return void this._trySkipBufferHole(null)}var p=self.performance.now();if(null!==r){var m=p-r;!a&&m>=250&&this._reportStall(l.len);var v=W.bufferInfo(n,i,t.maxBufferHole);this._tryFixBufferStall(v,m)}else this.stalled=p}}}else if(this.moved=!0,null!==r){if(this.stallReported){var y=self.performance.now()-r;d.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,a=r.getPartialFragment(i);a&&this._trySkipBufferHole(a)||e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(d.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,d.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,n=this.hls,r=this.media,i=r.currentTime,a=0,s=0;s<r.buffered.length;s++){var l=r.buffered.start(s);if(i+t.maxBufferHole>=a&&i<l){var c=Math.max(l+.05,r.currentTime+.1);return d.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+c),this.moved=!0,this.stalled=null,r.currentTime=c,e&&n.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+c,frag:e}),c}a=r.buffered.end(s)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<e.nudgeMaxRetry){var a=r+i*e.nudgeOffset;d.logger.warn("Nudging 'currentTime' from "+r+" to "+a),n.currentTime=a,t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else d.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();function ye(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ee=function(e){var t,n;function r(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(n=e.call.apply(e,[this,t].concat(i))||this)._boundTick=void 0,n._tickTimer=null,n._tickInterval=null,n._tickCallCount=0,n._boundTick=n.tick.bind(ye(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},r}(h),_e="STOPPED",Te="STARTING",be="IDLE",Se="PAUSED",Ae="KEY_LOADING",Re="FRAG_LOADING",Ie="FRAG_LOADING_WAITING_RETRY",we="WAITING_TRACK",Ce="PARSING",De="PARSED",Me="BUFFER_FLUSHING",Ne="ENDED",Oe="ERROR",Pe="WAITING_INIT_PTS",Le="WAITING_LEVEL",ke=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=_e},i._streamEnded=function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;if(!t.live&&n&&!n.backtracked&&n.sn===t.endSN&&!e.nextStart){var i=r.getState(n);return i===q||i===K}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,n=this.mediaBuffer,r=this.state,i=t?t.currentTime:null,a=W.bufferInfo(n||t,i,this.config.maxBufferHole);if(d.logger.log("media seeking to "+(Object(l.isFiniteNumber)(i)?i.toFixed(3):i)),r===Re){var s=this.fragCurrent;if(0===a.len&&s){var o=e.maxFragLookUpTolerance,u=s.start-o,c=s.start+s.duration+o;i<u||i>c?(s.loader&&(d.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=be):d.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===Ne&&(0===a.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=be);t&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=_e,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},r}(Ee);function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Fe,Ue=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.LEVEL_LOADED,u.default.LEVELS_UPDATED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_LOAD_EMERGENCY_ABORTED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_SWITCHED,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=_e,r.stallReported=!1,r.gapController=null,r.altAudio=!1,r.audioOnly=!1,r.bitrateTest=!1,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,s,c,f=r.prototype;return f.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(d.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=be,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=_e},f.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},f.doTick=function(){switch(this.state){case Me:this.fragLoadError=0;break;case be:this._doTickIdle();break;case Le:var e=this.levels[this.level];e&&e.details&&(this.state=be);break;case Ie:var t=window.performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(d.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=be)}this._checkBuffer(),this._checkFragmentChanged()},f._doTickIdle=function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&t.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var r;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,a=this.levels[i];if(a){var s,o=a.bitrate;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=r<t.maxBufferHole?Math.max(2,t.maxBufferHole):t.maxBufferHole,c=W.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,l),f=c.len;if(!(f>=s)){d.logger.trace("buffer length of "+f.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var h=a.details;if(!h||h.live&&this.levelLastLoaded!==i)this.state=Le;else{if(this._streamEnded(c,h)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(u.default.BUFFER_EOS,g),void(this.state=Ne)}this._fetchPayloadOrEos(r,c,h)}}}}},f._fetchPayloadOrEos=function(e,t,n){var r=this.fragPrevious;this.level;var i=n.fragments,a=i.length;if(0!==a){var s,o=i[0].start,l=i[a-1].start+i[a-1].duration,u=t.end;if(n.initSegment&&!n.initSegment.data)s=n.initSegment;else if(n.live){var c=this.config.initialLiveManifestSize;if(a<c)return void d.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+c);if(null===(s=this._ensureFragmentAtLivePoint(n,u,o,l,r,i)))return}else u<o&&(s=i[0]);s||(s=this._findFragment(o,r,a,i,u,l,n)),s&&(s.encrypted?this._loadKey(s,n):this._loadFragment(s,n,e,u))}},f._ensureFragmentAtLivePoint=function(e,t,n,r,i,a){var s,o=this.hls.config,u=this.media,c=1/0;if(void 0!==o.liveMaxLatencyDuration?c=o.liveMaxLatencyDuration:Object(l.isFiniteNumber)(o.liveMaxLatencyDurationCount)&&(c=o.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(n-o.maxFragLookUpTolerance,r-c)){var f=this.liveSyncPosition=this.computeLivePosition(n,e);t=f,u&&!u.paused&&u.readyState&&u.duration>f&&f>u.currentTime&&(d.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),u.currentTime=f),this.nextLoadPosition=f}if(e.PTSKnown&&t>r&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&i)if(e.hasProgramDateTime)d.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=he(a,i.endProgramDateTime,o.maxFragLookUpTolerance);else{var h=i.sn+1;if(h>=e.startSN&&h<=e.endSN){var g=a[h-e.startSN];i.cc===g.cc&&(s=g,d.logger.log("live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=V.search(a,(function(e){return i.cc-e.cc})))&&d.logger.log("live playlist, switching playlist, load frag with same CC: "+s.sn)}return s},f._findFragment=function(e,t,n,r,i,a,s){var o,l=this.hls.config;if(o=i<a?ge(t,r,i,i>a-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance):r[n-1]){var u=o.sn-s.startSN,c=t&&o.level===t.level,f=r[u-1],h=r[u+1];if(t&&o.sn===t.sn)if(c&&!o.backtracked)if(o.sn<s.endSN){var g=t.deltaPTS;g&&g>l.maxBufferHole&&t.dropped&&u?(o=f,d.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(o=h,this.fragmentTracker.getState(o)!==K&&d.logger.log("Re-loading fragment with SN: "+o.sn))}else o=null;else o.backtracked&&(h&&h.backtracked?(d.logger.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+h.sn),o=h):(d.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,f?(o=f).backtracked=!0:u&&(o=null)))}return o},f._loadKey=function(e,t){d.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=Ae,this.hls.trigger(u.default.KEY_LOADING,{frag:e})},f._loadFragment=function(e,t,n,r){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,"initSegment"!==e.sn&&(this.startFragRequested=!0),Object(l.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===j||i===q?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,d.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(r.toFixed(3))),this.hls.trigger(u.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new re(this.hls,"main")),this.state=Re):i===H&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},f.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,a.MAIN)},f.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},f._checkFragmentChanged=function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((t=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),W.isBuffered(n,t)?e=this.getBufferedFrag(t):W.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(u.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(u.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}},f.immediateLevelSwitch=function(){if(d.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media;t?(e=t.paused)||t.pause():e=!0,this.previouslyPaused=e}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},f.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&W.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},f.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,n=this.getBufferedFrag(e.currentTime);if(n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),e.paused)t=0;else{var r=this.hls.nextLoadLevel,i=this.levels[r],a=this.fragLastKbps;t=a&&this.fragCurrent?this.fragCurrent.duration*i.bitrate/(1e3*a)+1:0}var s=this.getBufferedFrag(e.currentTime+t);if(s){var o=this.followingBufferedFrag(s);if(o){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null;var u=Math.max(s.endPTS,o.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,o.duration));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},f.flushMainBuffer=function(e,t){this.state=Me;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(u.default.BUFFER_FLUSHING,n)},f.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new ve(n,t,this.fragmentTracker,this.hls)},f.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(d.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach((function(e){e.details&&e.details.fragments.forEach((function(e){e.backtracked=void 0}))})),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},f.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(l.isFiniteNumber)(t)&&d.logger.log("media seeked to "+t.toFixed(3)),this.tick()},f.onManifestLoading=function(){d.logger.log("trigger BUFFER_RESET"),this.hls.trigger(u.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},f.onManifestParsed=function(e){var t,n=!1,r=!1;e.levels.forEach((function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&d.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},f.onLevelLoaded=function(e){var t=e.details,n=e.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],a=t.totalduration,s=0;if(d.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live||i.details&&i.details.live){var o=i.details;o&&t.fragments.length>0?(oe(o,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,o),t.PTSKnown&&Object(l.isFiniteNumber)(s)?d.logger.log("live playlist sliding:"+s.toFixed(3)):(d.logger.log("live playlist - outdated PTS, unknown sliding"),fe(this.fragPrevious,r,t))):(d.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,fe(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=n,this.hls.trigger(u.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var c=t.startTimeOffset;Object(l.isFiniteNumber)(c)?(c<0&&(d.logger.log("negative start time offset "+c+", count from end of last fragment"),c=s+a+c),d.logger.log("start time offset found in playlist, adjust startPosition to "+c),this.startPosition=c):t.live?(this.startPosition=this.computeLivePosition(s,t),d.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Le&&(this.state=be),this.tick()},f.onKeyLoaded=function(){this.state===Ae&&(this.state=be,this.tick())},f.onFragLoaded=function(e){var t=this.fragCurrent,n=this.hls,r=this.levels,i=this.media,a=e.frag;if(this.state===Re&&t&&"main"===a.type&&a.level===t.level&&a.sn===t.sn){var s=e.stats,o=r[t.level],l=o.details;if(this.bitrateTest=!1,this.stats=s,d.logger.log("Loaded "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level),a.bitrateTest&&n.nextLoadLevel)this.state=be,this.startFragRequested=!1,s.tparsed=s.tbuffered=window.performance.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=be,s.tparsed=s.tbuffered=window.performance.now(),l.initSegment.data=e.payload,n.trigger(u.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else{d.logger.log("Parsing "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level+", cc "+t.cc),this.state=Ce,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var c=!(i&&i.seeking)&&(l.PTSKnown||!l.live),f=l.initSegment?l.initSegment.data:[],h=this._getAudioCodec(o);(this.demuxer=this.demuxer||new re(this.hls,"main")).push(e.payload,f,h,o.videoCodec,t,l.totalduration,c)}}this.fragLoadError=0},f.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Ce){var r,i,a=e.tracks;if(this.audioOnly=a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio,i=a.audio){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(d.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==i.container&&(s="mp4a.40.2",d.logger.log("Android: force audio codec to "+s)),i.levelCodec=s,i.id=e.id}for(r in(i=a.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),this.hls.trigger(u.default.BUFFER_CODECS,a),a){i=a[r],d.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var l=i.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,{type:r,data:l,parent:"main",content:"initSegment"}))}this.tick()}},f.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"main"===e.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===Ce){var i=this.levels[this.level],a=n;if(Object(l.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&a.addElementaryStream(m.AUDIO),!0===e.hasVideo&&a.addElementaryStream(m.VIDEO),d.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(a.dropped=e.dropped,a.dropped)if(a.backtracked)d.logger.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var s=i.details;if(!s||a.sn!==s.startSN)return d.logger.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=be,this.fragPrevious=a,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();d.logger.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var o=se(i.details,a,e.startPTS,e.endPTS,e.startDTS,e.endDTS),c=this.hls;c.trigger(u.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:o,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach((function(n){n&&n.length&&t.state===Ce&&(t.appended=!0,t.pendingBuffering=!0,c.trigger(u.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))})),this.tick()}},f.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Ce&&(this.stats.tparsed=window.performance.now(),this.state=De,this._checkAppendedParsed())},f.onAudioTrackSwitching=function(e){var t=this.altAudio,n=!!e.url,r=e.id;if(!n){if(this.mediaBuffer!==this.media){d.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(d.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=be}var a=this.hls;t&&a.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:r})}},f.onAudioTrackSwitched=function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(d.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},f.onBufferCreated=function(e){var t,n,r=e.tracks,i=!1;for(var a in r){var s=r[a];"main"===s.id?(n=a,t=s,"video"===a&&(this.videoBuffer=r[a].buffer)):i=!0}i&&t?(d.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},f.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==Ce&&t!==De||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},f._checkAppendedParsed=function(){if(!(this.state!==De||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;d.logger.log("main buffered : "+de.toString(t.buffered)),this.fragPrevious=e;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(u.default.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.state=be}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},f.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=!!this.media&&W.isBuffered(this.media,this.media.currentTime)&&W.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);d.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=Ie}else d.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Oe;break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Oe&&(e.fatal?(this.state=Oe,d.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==Le||(this.state=be));break;case o.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==Ce&&this.state!==De||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=be):(d.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},f._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,d.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},f._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},f.onFragLoadEmergencyAborted=function(){this.state=be,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},f.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?m.AUDIO:m.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=be,this.fragPrevious=null},f.onLevelsUpdated=function(e){this.levels=e.levels},f.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},f._seekToStartPos=function(){var e=this.media,t=e.currentTime,n=this.startPosition;if(t!==n&&n>=0){if(e.seeking)return void d.logger.log("could not seek to "+n+", already seeking at "+t);var r=(e.buffered.length?e.buffered.start(0):0)-n;r>0&&r<this.config.maxBufferHole&&(d.logger.log("adjusting start position by "+r+" to match buffer start"),n+=r,this.startPosition=n),d.logger.log("seek to target start position "+n+" from current time "+t+". ready state "+e.readyState),e.currentTime=n}},f._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(d.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},i=r,s=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,d.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(u.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}],s&&xe(i.prototype,s),c&&xe(i,c),r}(ke),Be=Ue;function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var je=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this).canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,Fe=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,l=r.prototype;return l.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},l.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},l.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach((function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)})),null!==this.timer&&this.loadLevel()},l.stopLoad=function(){this.canload=!1},l.onManifestLoaded=function(e){var t,n=[],r=[],i={},a=null,s=!1,l=!1;if(e.levels.forEach((function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,s=s||!!e.videoCodec,l=l||!!e.audioCodec,Fe&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=i[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,n.push(e)),t&&(t.AUDIO&&ie(a||e,"audio",t.AUDIO),t.SUBTITLES&&ie(a||e,"text",t.SUBTITLES))})),s&&l&&(n=n.filter((function(e){return!!e.videoCodec}))),n=n.filter((function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||I(t,"audio"))&&(!n||I(n,"video"))})),e.audioTracks&&(r=e.audioTracks.filter((function(e){return!e.audioCodec||I(e.audioCodec,"audio")}))).forEach((function(e,t){e.id=t})),n.length>0){t=n[0].bitrate,n.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=n;for(var c=0;c<n.length;c++)if(n[c].bitrate===t){this._firstLevel=c,d.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+t);break}var f=l&&!s;this.hls.trigger(u.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:e.stats,audio:l,video:s,altAudio:!f&&r.some((function(e){return!!e.url}))})}else this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},l.setLevelInternal=function(e){var t=this._levels,n=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){d.logger.log("switching to level "+e),this.currentLevelIndex=e;var r=t[e];r.level=e,n.trigger(u.default.LEVEL_SWITCHING,r)}var i=t[e],a=i.details;if(!a||a.live){var s=i.urlId;n.trigger(u.default.LEVEL_LOADING,{url:i.url[s],level:e,id:s})}}else n.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},l.onError=function(e){if(e.fatal)e.type===o.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,n=!1,r=!1;switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,r=!0;break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,n=!0;break;case o.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,n=!0}void 0!==t&&this.recoverLevel(e,t,n,r)}},l.recoverLevel=function(e,t,n,r){var i,a,s,o=this,l=this.hls.config,u=e.details,c=this._levels[t];if(c.loadError++,c.fragmentError=r,n){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return d.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return o.loadLevel()}),a),e.levelRetry=!0,this.levelRetryCount++,d.logger.warn("level controller, "+u+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&((i=c.url.length)>1&&c.loadError<i?(c.urlId=(c.urlId+1)%i,c.details=void 0,d.logger.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+c.urlId)):-1===this.manualLevelIndex?(s=0===t?this._levels.length-1:t-1,d.logger.warn("level controller, "+u+": switch to "+s),this.hls.nextAutoLevel=this.currentLevelIndex=s):r&&(d.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},l.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var n=this._levels[t.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},l.onLevelLoaded=function(e){var t=this,n=e.level,r=e.details;if(n===this.currentLevelIndex){var i=this._levels[n];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),r.live){var a=ue(i.details,r,e.stats.trequest);d.logger.log("live playlist, reload in "+Math.round(a)+" ms"),this.timer=setTimeout((function(){return t.loadLevel()}),a)}else this.clearTimer()}},l.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===t){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},l.loadLevel=function(){if(d.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&e.url.length>0){var t=this.currentLevelIndex,n=e.urlId,r=e.url[n];d.logger.log("Attempt loading level index "+t+" with URL-id "+n),this.hls.trigger(u.default.LEVEL_LOADING,{url:r,level:t,id:n})}}},l.removeLevel=function(e,t){var n=this.levels.filter((function(n,r){return r!==e||n.url.length>1&&void 0!==t&&(n.url=n.url.filter((function(e,n){return n!==t})),n.urlId=0,!0)})).map((function(e,t){var n=e.details;return n&&n.fragments&&n.fragments.forEach((function(e){e.level=t})),e}));this._levels=n,this.hls.trigger(u.default.LEVELS_UPDATED,{levels:n})},i=r,(a=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&Ge(i.prototype,a),s&&Ge(i,s),r}(h),He=n("./src/demux/id3.js");function qe(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function Ke(e){if(null==e?void 0:e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}var Ye=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA,u.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,n.media=void 0,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){Ke(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return qe(n,this.media),n}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var a=He.default.getID3Frames(n[i].data);if(a){var s=Math.max(n[i].pts,0),o=i<n.length-1?n[i+1].pts:t.endPTS;o||(o=t.start+t.duration),o-s<=0&&(o=s+.25);for(var l=0;l<a.length;l++){var u=a[l];if(!He.default.isTimeStampFrame(u)){var d=new r(s,o,"");d.value=u,this.id3Track.addCue(d)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,n=this.id3Track;if(n&&n.cues&&n.cues.length){var r=function(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var n=0,r=e.length-1;n<=r;){var i=Math.floor((r+n)/2);if(t<e[i].endTime)r=i-1;else{if(!(t>e[i].endTime))return e[i];n=i+1}}return e[n].endTime-t<t-e[r].endTime?e[n]:e[r]}(n.cues,t);if(r)for(;n.cues[0]!==r;)n.removeCue(n.cues[0])}},r}(h),Ve=Ye,We=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),ze=function(){function e(e,t,n,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new We(t),this.fast_=new We(n)}var t=e.prototype;return t.sample=function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}(),Xe=ze;function Qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $e=window.performance,Ze=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR)||this).lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,c=r.prototype;return c.destroy=function(){this.clearTimer(),h.prototype.destroy.call(this)},c.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n,r,i=this.hls,a=i.config,s=t.level;i.levels[s].details.live?(n=a.abrEwmaFastLive,r=a.abrEwmaSlowLive):(n=a.abrEwmaFastVoD,r=a.abrEwmaSlowVoD),this._bwEstimator=new Xe(i,r,n,a.abrEwmaDefaultEstimate)}},c._abandonRulesCheck=function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var r=n.loader;if(!r||r.stats&&r.stats.aborted)return d.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var i=r.stats;if(t&&i&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var a=$e.now()-i.trequest,s=Math.abs(t.playbackRate);if(a>500*n.duration/s){var o=e.levels,l=Math.max(1,i.bw?i.bw/8:1e3*i.loaded/a),c=o[n.level];if(!c)return;var f=c.realBitrate?Math.max(c.realBitrate,c.bitrate):c.bitrate,h=i.total?i.total:Math.max(i.loaded,Math.round(n.duration*f/8)),g=t.currentTime,p=(h-i.loaded)/l,m=(W.bufferInfo(t,g,e.config.maxBufferHole).end-g)/s;if(m<2*n.duration/s&&p>m){var v,y,E=e.minAutoLevel;for(y=n.level-1;y>E;y--){var _=o[y].realBitrate?Math.max(o[y].realBitrate,o[y].bitrate):o[y].bitrate;if(n.duration*_/(6.4*l)<m)break}v<p&&(d.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+v.toFixed(1)+"<"+p.toFixed(1)+":"+m.toFixed(1)),e.nextLoadLevel=y,this._bwEstimator.sample(a,i.loaded),r.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:i}))}}}}},c.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(l.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i)}if(e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}},c.onFragBuffered=function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&"main"===n.type&&Object(l.isFiniteNumber)(n.sn)&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;d.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},c.onError=function(e){switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},c.clearTimer=function(){clearInterval(this.timer),this.timer=null},c._findBestLevel=function(e,t,n,r,i,a,s,o,l){for(var u=i;u>=r;u--){var c=l[u];if(c){var f=c.details,h=f?f.totalduration/f.fragments.length:t,g=!!f&&f.live,p=void 0;p=u<=e?s*n:o*n;var m=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,v=m*h/p;if(d.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+m+"/"+h+"/"+a+"/"+v),p>m&&(!v||g&&!this.bitrateTestDelay||v<a))return u}}return-1},i=r,a=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var n=this._nextABRAutoLevel;return-1!==e&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,r=e.config,i=e.minAutoLevel,a=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,f=(W.bufferInfo(a,l,r.maxBufferHole).end-l)/u,h=this._findBestLevel(s,o,c,i,t,f,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(h>=0)return h;d.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===f){var v=this.bitrateTestDelay;v&&(g=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-v,d.logger.trace("bitrate test took "+Math.round(1e3*v)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=m=1)}return h=this._findBestLevel(s,o,c,i,t,f+g,p,m,n),Math.max(h,0)}}],a&&Qe(i.prototype,a),s&&Qe(i,s),r}(h),Je=Ze,et=$(),tt=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED)||this)._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){d.logger.log("media source opened"),n.hls.trigger(u.default.MEDIA_ATTACHED,{media:n.media});var e=n.mediaSource;e&&e.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){d.logger.log("media source closed")},n._onMediaSourceEnded=function(){d.logger.log("media source ended")},n._onSBUpdateEnd=function(){if(n.audioTimestampOffset&&n.sourceBuffer.audio){var e=n.sourceBuffer.audio;d.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+n.audioTimestampOffset),e.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset}n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var t=n.parent,r=n.segments.reduce((function(e,n){return n.parent===t?e+1:e}),0),i={},a=n.sourceBuffer;for(var s in a){var o=a[s];if(!o)throw Error("handling source buffer update end error: source buffer for "+s+" uninitilized and unable to update buffered TimeRanges.");i[s]=o.buffered}n.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:i}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===r&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(e){d.logger.error("sourceBuffer error:",e),n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(!r)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){d.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(d.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}},i.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,d.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&et){var n=this.mediaSource=new et;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(n),this._objectUrl=t.src}},i.onMediaDetaching=function(){d.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){d.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):d.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(u.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||2===n)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach((function(n){t.pendingTracks[n]=e[n]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var r in e)if(!t[r]){var i=e[r];if(!i)throw Error("source buffer exists for track "+r+", however track does not");var a=i.levelCodec||i.codec,s=i.container+";codecs="+a;d.logger.log("creating sourceBuffer("+s+")");try{var l=t[r]=n.addSourceBuffer(s);l.addEventListener("updateend",this._onSBUpdateEnd),l.addEventListener("error",this._onSBUpdateError),this.tracks[r]={buffer:l,codec:a,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(e){d.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var n=this.sourceBuffer[t];n&&!n.ended&&(n.ended=!0,d.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){var r=e[n];if(r){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}}d.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){d.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=t-Math.max(e,this._levelTargetDuration),a=r.length-1;a>=0;a--){var s=r[a],o=n[s];if(o){var l=o.buffered;l.length>0&&i>l.start(0)&&this.removeBufferRange(s,o,0,i)&&this.hls.trigger(u.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}}else d.logger.error("flushLiveBackBuffer called without attaching media")}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer){var r=this.sourceBuffer[n];if(r&&!0===r.updating)return}e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(d.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(l.isFiniteNumber)(e))&&(d.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n){var i=n[r];i&&(t+=i.buffered.length)}}catch(e){d.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,n=this.segments,r=this.sourceBuffer;if(Object.keys(r).length){if(!this.media||this.media.error)return this.segments=[],void d.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=n.shift();if(i)try{var a=r[i.type];if(!a)return void this._onSBUpdateEnd();if(a.updating)return void n.unshift(i);a.ended=!1,this.parent=i.parent,a.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(r){d.logger.error("error while trying to append buffer:"+r.message),n.unshift(i);var s={type:o.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1};22===r.code?(this.segments=[],s.details=o.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,s.details=o.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(d.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],s.fatal=!0)),t.trigger(u.default.ERROR,s)}}}},i.flushBuffer=function(e,t,n){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),d.logger.log("flushBuffer,pos/start/end: "+i+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return d.logger.warn("abort flushing too many retries"),!0;var a=r[n];if(a){if(a.ended=!1,a.updating)return d.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,a,e,t))return this.flushBufferCounter++,!1}return d.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,n,r){try{for(var i=0;i<t.buffered.length;i++){var a=t.buffered.start(i),s=t.buffered.end(i),o=Math.max(a,n),l=Math.min(s,r);if(Math.min(l,s)-o>.5){var u="null";return this.media&&(u=this.media.currentTime.toString()),d.logger.log("sb remove "+e+" ["+o+","+l+"], of ["+a+","+s+"], pos:"+u),t.remove(o,l),!0}}}catch(e){d.logger.warn("removeBufferRange failed",e)}return!1},r}(h),nt=tt;function rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var it=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED,u.default.LEVELS_UPDATED,u.default.BUFFER_CODECS,u.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n.clientRect=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,o=r.prototype;return o.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},o.onFpsDropLevelCapping=function(e){r.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},o.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},o.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onLevelsUpdated=function(e){this.levels=e.levels},o.onMediaDetaching=function(){this.stopCapping()},o.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},o.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var n=this.levels.filter((function(n,i){return r.isLevelAllowed(i,t.restrictedLevels)&&i<=e}));return this.clientRect=null,r.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t},r.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},r.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var r,i,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=n)&&(r=o,!(i=e[s+1])||r.width!==i.width||r.height!==i.height)){a=s;break}}return a},i=r,s=[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}],(a=[{key:"mediaWidth",get:function(){return this.getDimensions().width*r.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*r.contentScaleFactor}}])&&rt(i.prototype,a),s&&rt(i,s),r}(h),at=it,st=window.performance,ot=function(e){var t,n;function r(t){return e.call(this,t,u.default.MEDIA_ATTACHING)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},i.checkFPS=function(e,t,n){var r=st.now();if(t){if(this.lastTime){var i=r-this.lastTime,a=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/i,l=this.hls;if(l.trigger(u.default.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:n}),o>0&&a>l.config.fpsDroppedMonitoringThreshold*s){var c=l.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=c)&&(c-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,l.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},r}(h),lt=ot,ut=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e,t=this.context;e=this.loader=new window.XMLHttpRequest;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(e,t.url)}catch(n){e.open("GET",t.url,!0),r(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(n){return void this.callbacks.onError({code:e.status,text:n.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},t.readystatechange=function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,a=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(window.performance.now(),r.trequest)),4===n){var s=t.status;if(s>=200&&s<300){var o,l;r.tload=Math.max(r.tfirst,window.performance.now()),l="arraybuffer"===i.responseType?(o=t.response).byteLength:(o=t.responseText).length,r.loaded=r.total=l;var u={url:t.responseURL,data:o};this.callbacks.onSuccess(u,r,i,t)}else r.retry>=a.maxRetry||s>=400&&s<499?(d.logger.error(s+" while loading "+i.url),this.callbacks.onError({code:s,text:t.statusText},i,t)):(d.logger.warn(s+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},t.loadtimeout=function(){d.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,t)},e}(),dt=ut;function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ft=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.AUDIO_TRACK_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.LEVEL_LOADED,u.default.ERROR)||this)._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,l=r.prototype;return l.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},l.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},l.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)d.logger.warn("Invalid audio track id:",e.id);else{if(d.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},l.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},l.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},l.onError=function(e){e.type===o.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(d.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},l._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)d.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)d.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];d.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var n=t.url,r=t.type,i=t.id;this.hls.trigger(u.default.AUDIO_TRACK_SWITCHING,{id:i,type:r,url:n}),this._loadTrackDetailsIfNeeded(t)}},l.doTick=function(){this._updateTrack(this._trackId)},l._selectAudioGroup=function(e){var t=this.hls.levels[e];if(t&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},l._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var i=t.filter((function(e){return e.default}));i.length?t=i:d.logger.warn("No default audio tracks defined")}var a=!1,s=function(){t.forEach((function(t){a||e.audioGroupId&&t.groupId!==e.audioGroupId||r&&r!==t.name||(e._setAudioTrack(t.id),a=!0)}))};s(),a||(r=null,s()),a||(d.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},l._needsTrackLoading=function(e){var t=e.details,n=e.url;return!(t&&!t.live||!n)},l._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,n=e.id;d.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:t,id:n})}},l._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,d.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},l._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],n=t.name,r=t.language,i=t.groupId;d.logger.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var a=e,s=0;s<this.tracks.length;s++)if(!this.trackIdBlacklist[s]&&this.tracks[s].name===n){a=s;break}a!==e?(d.logger.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)):d.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"')},i=r,(a=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}])&&ct(i.prototype,a),s&&ct(i,s),r}(Ee),ht=ft;function gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var pt=window.performance,mt=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.AUDIO_TRACKS_UPDATED,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_LOADED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.BUFFER_RESET,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED,u.default.INIT_PTS_FOUND)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=_e,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r.waitingVideoCC=null,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,c=r.prototype;return c.onInitPtsFound=function(e){var t=e.id,n=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,this.videoTrackCC=n,d.logger.log("InitPTS for cc: "+n+" found from main: "+r),this.state===Pe&&this.tick())},c.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(d.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=be):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=Te),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=_e},c.doTick=function(){var e,t,n,r=this.hls,i=r.config;switch(this.state){case Oe:case Se:case Me:break;case Te:this.state=we,this.loadedmetadata=!1;break;case be:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var s=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,c=e<i.maxBufferHole?Math.max(2,i.maxBufferHole):i.maxBufferHole,f=W.bufferInfo(s,e,c),h=W.bufferInfo(o,e,c),g=f.len,p=f.end,m=this.fragPrevious,v=Math.min(i.maxBufferLength,i.maxMaxBufferLength),y=Math.max(v,h.len),E=this.audioSwitch,_=this.trackId;if((g<y||E)&&_<a.length){if(void 0===(n=a[_].details)){this.state=we;break}if(!E&&this._streamEnded(f,n))return this.hls.trigger(u.default.BUFFER_EOS,{type:"audio"}),void(this.state=Ne);var T,b=n.fragments,S=b.length,A=b[0].start,R=b[S-1].start+b[S-1].duration;if(E)if(n.live&&!n.PTSKnown)d.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),p=0;else if(p=e,n.PTSKnown&&e<A){if(!(f.end>A||f.nextStart))return;d.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=A+.05}if(n.initSegment&&!n.initSegment.data)T=n.initSegment;else if(p<=A){if(T=b[0],null!==this.videoTrackCC&&T.cc!==this.videoTrackCC&&(T=function(e,t){return V.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(b,this.videoTrackCC)),n.live&&T.loadIdx&&T.loadIdx===this.fragLoadIdx){var I=f.nextStart?f.nextStart:A;return d.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(I+.05)),void(this.media.currentTime=I+.05)}}else{var w,C=i.maxFragLookUpTolerance,D=m?b[m.sn-b[0].sn+1]:void 0;p<R?(p>R-C&&(C=0),w=D&&!pe(p,C,D)?D:V.search(b,(function(e){return pe(p,C,e)}))):w=b[S-1],w&&(T=w,A=w.start,m&&T.level===m.level&&T.sn===m.sn&&(T.sn<n.endSN?(T=b[T.sn+1-n.startSN],this.fragmentTracker.getState(T)!==K&&d.logger.log("SN just loaded, load next one: "+T.sn)):T=null))}T&&(T.encrypted?(d.logger.log("Loading key for "+T.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+_),this.state=Ae,r.trigger(u.default.KEY_LOADING,{frag:T})):(this.fragCurrent=T,(E||this.fragmentTracker.getState(T)===j)&&(d.logger.log("Loading "+T.sn+", cc: "+T.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+_+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+p.toFixed(3)),"initSegment"!==T.sn&&(this.startFragRequested=!0),Object(l.isFiniteNumber)(T.sn)&&(this.nextLoadPosition=T.start+T.duration),r.trigger(u.default.FRAG_LOADING,{frag:T}),this.state=Re)))}break;case we:(t=this.tracks[this.trackId])&&t.details&&(this.state=be);break;case Ie:var M=pt.now(),N=this.retryDate,O=(s=this.media)&&s.seeking;(!N||M>=N||O)&&(d.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=be);break;case Pe:var P=this.waitingFragment;if(P){var L=P.frag.cc;if(void 0!==this.initPTS[L])this.waitingFragment=null,this.state=Re,this.onFragLoaded(P);else if(this.videoTrackCC!==this.waitingVideoCC)d.logger.log("Waiting fragment cc ("+L+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var k=W.bufferInfo(this.mediaBuffer,this.media.currentTime,i.maxBufferHole);pe(k.end,i.maxFragLookUpTolerance,P.frag)<0&&(d.logger.log("Waiting fragment cc ("+L+") @ "+P.frag.start+" cancelled because another fragment at "+k.end+" is needed"),this.clearWaitingFragment())}}else this.state=be}},c.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=be)},c.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},c.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(d.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},c.onAudioTracksUpdated=function(e){d.logger.log("audio tracks updated"),this.tracks=e.audioTracks},c.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=Se,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=be),this.tick()},c.onAudioTrackLoaded=function(e){var t=e.details,n=e.id,r=this.tracks[n],i=r.details,a=t.totalduration,s=0;if(d.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live||i&&i.live?i&&t.fragments.length>0?(oe(i,t),s=t.fragments[0].start,t.PTSKnown?d.logger.log("live audio playlist sliding:"+s.toFixed(3)):d.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,d.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,r.details=t,!this.startFragRequested){if(-1===this.startPosition){var o=t.startTimeOffset;Object(l.isFiniteNumber)(o)?(d.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o):t.live?(this.startPosition=this.computeLivePosition(s,t),d.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===we&&(this.state=be),this.tick()},c.onKeyLoaded=function(){this.state===Ae&&(this.state=be,this.tick())},c.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag;if(this.state===Re&&t&&"audio"===n.type&&n.level===t.level&&n.sn===t.sn){var r=this.tracks[this.trackId],i=r.details,a=i.totalduration,s=t.level,o=t.sn,l=t.cc,c=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",f=this.stats=e.stats;if("initSegment"===o)this.state=be,f.tparsed=f.tbuffered=pt.now(),i.initSegment.data=e.payload,this.hls.trigger(u.default.FRAG_BUFFERED,{stats:f,frag:t,id:"audio"}),this.tick();else{this.state=Ce,this.appended=!1,this.demuxer||(this.demuxer=new re(this.hls,"audio"));var h=this.initPTS[l],g=i.initSegment?i.initSegment.data:[];void 0!==h?(this.pendingBuffering=!0,d.logger.log("Demuxing "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s),this.demuxer.push(e.payload,g,c,null,t,a,!1,h)):(d.logger.log("Unknown video PTS for cc "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=Pe)}}this.fragLoadError=0},c.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Ce){var r,i=e.tracks;if(i.video&&delete i.video,r=i.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(u.default.BUFFER_CODECS,i),d.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var a=r.initSegment;if(a){var s={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,s))}this.tick()}}},c.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"audio"===e.id&&"audio"===e.type&&r.sn===n.sn&&r.level===n.level&&this.state===Ce){var i=this.trackId,a=this.tracks[i],s=this.hls;Object(l.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(m.AUDIO),d.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),se(a.details,n,e.startPTS,e.endPTS);var c=this.media,f=!1;if(this.audioSwitch)if(c&&c.readyState){var h=c.currentTime;d.logger.log("switching audio track : currentTime:"+h),h>=e.startPTS&&(d.logger.log("switching audio track : flushing all audio"),this.state=Me,s.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),f=!0,this.audioSwitch=!1,s.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,s.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i});var g=this.pendingData;if(!g)return d.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void s.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach((function(t){t&&t.length&&g.push({type:e.type,data:t,parent:"audio",content:"data"})})),!f&&g.length&&(g.forEach((function(e){t.state===Ce&&(t.pendingBuffering=!0,t.hls.trigger(u.default.BUFFER_APPENDING,e))})),this.pendingData=[],this.appended=!0)),this.tick()}},c.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Ce&&(this.stats.tparsed=pt.now(),this.state=De,this._checkAppendedParsed())},c.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},c.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},c.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==Ce&&t!==De||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},c._checkAppendedParsed=function(){if(!(this.state!==De||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=pt.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;r&&d.logger.log("audio buffered : "+de.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=be}this.tick()}},c.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=e.frag;if(n&&"audio"!==n.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);d.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=pt.now()+a,this.state=Ie}else d.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Oe}break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==Oe&&(this.state=e.fatal?Oe:be,d.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===Ce||this.state===De)){var s=this.mediaBuffer,l=this.media.currentTime;if(s&&W.isBuffered(s,l)&&W.isBuffered(s,l+.5)){var c=this.config;c.maxMaxBufferLength>=c.maxBufferLength&&(c.maxMaxBufferLength/=2,d.logger.warn("AudioStreamController: reduce max buffer length to "+c.maxMaxBufferLength+"s")),this.state=be}else d.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Me,this.hls.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},c.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(d.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach((function(t){e.hls.trigger(u.default.BUFFER_APPENDING,t)})),this.appended=!0,this.pendingData=[],this.state=De):(this.state=be,this.fragPrevious=null,this.tick())},i=r,(a=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,d.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}])&&gt(i.prototype,a),s&&gt(i,s),r}(ke),vt=mt,yt=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}function r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function i(t,i,a){var s=this,o={enumerable:!0};s.hasBeenReset=!1;var l="",u=!1,d=t,c=i,f=a,h=null,g="",p=!0,m="auto",v="start",y=50,E="middle",_=50,T="middle";Object.defineProperty(s,"id",r({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(s,"pauseOnExit",r({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(s,"startTime",r({},o,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",r({},o,{get:function(){return c},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",r({},o,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",r({},o,{get:function(){return h},set:function(e){h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",r({},o,{get:function(){return g},set:function(t){var n=function(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");g=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",r({},o,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",r({},o,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",r({},o,{get:function(){return v},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",r({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",r({},o,{get:function(){return E},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",r({},o,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",r({},o,{get:function(){return T},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),s.displayState=void 0}return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),Et=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function _t(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Et,this.regionList=[]}function Tt(){this.values=Object.create(null)}function bt(e,t,n,r){var i=r?e.split(r):[e];for(var a in i)if("string"==typeof i[a]){var s=i[a].split(n);2===s.length&&t(s[0],s[1])}}Tt.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var St=new yt(0,0,0),At="middle"===St.align?"middle":"center";function Rt(e,t,n){var r=e;function i(){var t=function(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=i(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),a(),t.endTime=i(),a(),function(e,t){var r=new Tt;bt(e,(function(e,t){switch(e){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),s=a[0];r.integer(e,s),r.percent(e,s)&&r.set("snapToLines",!1),r.alt(e,s,["auto"]),2===a.length&&r.alt("lineAlign",a[1],["start",At,"end"]);break;case"position":a=t.split(","),r.percent(e,a[0]),2===a.length&&r.alt("positionAlign",a[1],["start",At,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",At,"end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===St.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",At);var a=r.get("position","auto");"auto"===a&&50===St.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function It(e){return e.replace(/<br(?: \/)?>/gi,"\n")}_t.prototype={parse:function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=It(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=n(),t.state){case"HEADER":/:/.test(r)?bt(r,(function(e,t){}),/:/):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new yt(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{Rt(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(a=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return e.onflush&&e.onflush(),this}};var wt=_t;function Ct(e,t,n,r){for(var i,a,s,o,l,u=[],d=window.VTTCue||TextTrackCue,c=0;c<r.rows.length;c++)if(s=!0,o=0,l="",!(i=r.rows[c]).isEmpty()){for(var f=0;f<i.chars.length;f++)i.chars[f].uchar.match(/\s/)&&s?o++:(l+=i.chars[f].uchar,s=!1);i.cueStartTime=t,t===n&&(n+=1e-4),a=new d(t,n,It(l.trim())),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=c+1:a.line=c>7?c-2:c+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100)),u.push(a),e&&e.addCue(a)}return u}var Dt,Mt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Nt=function(e){var t=e;return Mt.hasOwnProperty(e)&&(t=Mt[e]),String.fromCharCode(t)},Ot=15,Pt=100,Lt={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},kt={17:2,18:4,21:6,22:8,23:10,19:13,20:15},xt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ft={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ut=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(Dt||(Dt={}));var Bt=function(){function e(){this.time=null,this.verboseLevel=Dt.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&d.logger.log(this.time+" ["+e+"] "+t)},e}(),Gt=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},jt=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),Ht=function(){function e(e,t,n,r,i,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new jt(t,n,r,i,a)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),qt=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<Pt;t++)this.chars.push(new Ht);this.logger=e,this.pos=0,this.currPenState=new jt}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<Pt;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<Pt;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<Pt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(Dt.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>Pt&&(this.logger.log(Dt.DEBUG,"Too large cursor position "+this.pos),this.pos=Pt)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=Nt(e);this.pos>=Pt?this.logger.log(Dt.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<Pt;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<Pt;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),Kt=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Ot;t++)this.rows.push(new qt(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<Ot;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,n=0;n<Ot;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<Ot;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<Ot;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(Dt.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(Dt.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<Ot;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var a=i.rows[r].cueStartTime,s=this.logger.time;if(a&&null!==s&&a<s)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(i.rows[r+o])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,d=Math.max(u-1,0);l.setCursor(e.indent),e.color=l.chars[d].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)},t.setBkgData=function(e){this.logger.log(Dt.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(Dt.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(Dt.INFO,"Rolling up")}else this.logger.log(Dt.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<Ot;i++){var a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},t.getTextAndFormat=function(){return this.rows},e}(),Yt=function(){function e(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Kt(n),this.nonDisplayedMemory=new Kt(n),this.lastOutputScreen=new Kt(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(Dt.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Dt.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(Dt.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(Dt.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(Dt.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(Dt.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(Dt.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(Dt.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(Dt.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(Dt.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(Dt.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(Dt.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(Dt.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(Dt.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(this.logger.log(Dt.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Dt.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(Dt.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(Dt.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),Vt=function(){function e(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Bt;this.channels=[null,new Yt(e,t,r),new Yt(e+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,r,i,a=!1;this.logger.time=e;for(var s=0;s<t.length;s+=2)if(r=127&t[s],i=127&t[s+1],0!==r||0!==i){if(this.logger.log(Dt.DATA,"["+Gt([t[s],t[s+1]])+"] -> ("+Gt([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(a=this.parseChars(r,i))){var o=this.currentChannel;o&&o>0?this.channels[o].insertChars(a):this.logger.log(Dt.WARNING,"No channel found yet. TEXT-MODE?")}n||a||this.logger.log(Dt.WARNING,"Couldn't parse cleaned data "+Gt([r,i])+" orig: "+Gt([t[s],t[s+1]]))}},t.parseCmd=function(e,t){var n=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(zt(e,t,n))return Wt(null,null,n),this.logger.log(Dt.DEBUG,"Repeated command ("+Gt([e,t])+") is dropped"),!0;var r=20===e||21===e||23===e?1:2,i=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),Wt(e,t,n),this.currentChannel=r,!0},t.parseMidrow=function(e,t){var n=0;if((17===e||25===e)&&t>=32&&t<=47){if((n=17===e?1:2)!==this.currentChannel)return this.logger.log(Dt.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(Dt.DEBUG,"MIDROW ("+Gt([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var n,r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(zt(e,t,r))return Wt(null,null,r),!0;var i=e<=23?1:2;n=t>=64&&t<=95?1===i?Lt[e]:xt[e]:1===i?kt[e]:Ft[e];var a=this.channels[i];return!!a&&(a.setPAC(this.interpretPAC(n,t)),Wt(e,t,r),this.currentChannel=i,!0)},t.interpretPAC=function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.parseChars=function(e,t){var n,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){var a=t;a=17===i?t+80:18===i?t+112:t+144,this.logger.log(Dt.INFO,"Special char '"+Nt(a)+"' in channel "+n),r=[a]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=Gt(r);this.logger.log(Dt.DEBUG,"Char codes =  "+s.join(",")),Wt(e,t,this.cmdHistory)}return r},t.parseBackgroundAttributes=function(e,t){var n;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=Ut[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(r),Wt(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}},e}();function Wt(e,t,n){n.a=e,n.b=t}function zt(e,t,n){return n.a===e&&n.b===t}var Xt=Vt,Qt=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[]},e}(),$t=function(e,t,n){return e.substr(n||0,t.length)===t},Zt=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},Jt={parse:function(e,t,n,r,i,a){var s,o=Object(He.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),u="00:00.000",d=0,c=0,f=0,h=[],g=!0,p=!1,m=new wt;m.oncue=function(e){var t=n[r],i=n.ccOffset;t&&t.new&&(void 0!==c?i=n.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC];e.presentationOffset=n}(n,r,f)),f&&(i=f-n.presentationOffset),p&&(e.startTime+=i-c,e.endTime+=i-c),e.id=Zt(e.startTime.toString())+Zt(e.endTime.toString())+Zt(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&h.push(e)},m.onparsingerror=function(e){s=e},m.onflush=function(){s&&a?a(s):i(h)},o.forEach((function(e){if(g){if($t(e,"X-TIMESTAMP-MAP=")){g=!1,p=!0,e.substr(16).split(",").forEach((function(e){$t(e,"LOCAL:")?u=e.substr(6):$t(e,"MPEGTS:")&&(d=parseInt(e.substr(7)))}));try{t+(9e4*n[r].start||0)<0&&(t+=8589934592),d-=t,c=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),i=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(l.isFiniteNumber)(t)&&Object(l.isFiniteNumber)(n)&&Object(l.isFiniteNumber)(r)&&Object(l.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,(t+=6e4*r)+36e5*i}(u)/1e3,f=d/9e4}catch(e){p=!1,s=e}return}""===e&&(g=!1)}m.parse(e+"\n")})),m.flush()}};function en(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var tn=function(e){var t,n;function r(t){var n;if((n=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.FRAG_DECRYPTED,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.FRAG_LOADED,u.default.INIT_PTS_FOUND)||this).media=null,n.config=void 0,n.enabled=!0,n.Cues=void 0,n.textTracks=[],n.tracks=[],n.initPTS=[],n.unparsedVttFrags=[],n.captionsTracks={},n.nonNativeCaptionsTracks={},n.captionsProperties=void 0,n.cea608Parser1=void 0,n.cea608Parser2=void 0,n.lastSn=-1,n.prevCC=-1,n.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},n.hls=t,n.config=t.config,n.Cues=t.config.cueHandler,n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode},textTrack3:{label:n.config.captionsTextTrack3Label,languageCode:n.config.captionsTextTrack3LanguageCode},textTrack4:{label:n.config.captionsTextTrack4Label,languageCode:n.config.captionsTextTrack4LanguageCode}},n.config.enableCEA708Captions){var r=new Qt(en(n),"textTrack1"),i=new Qt(en(n),"textTrack2"),a=new Qt(en(n),"textTrack3"),s=new Qt(en(n),"textTrack4");n.cea608Parser1=new Xt(1,r,i),n.cea608Parser2=new Xt(3,a,s)}return n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.addCues=function(e,t,n,r,i){for(var a,s,o,l,d=!1,c=i.length;c--;){var f=i[c],h=(a=f[0],s=f[1],o=t,l=n,Math.min(s,l)-Math.max(a,o));if(h>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],n),d=!0,h/(n-t)>.5))return}if(d||i.push([t,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,n,r);else{var g=this.Cues.newCue(null,t,n,r);this.hls.trigger(u.default.CUES_PARSED,{type:"captions",cues:g,track:e})}},i.onInitPtsFound=function(e){var t=this,n=e.frag,r=e.id,i=e.initPTS,a=this.unparsedVttFrags;"main"===r&&(this.initPTS[n.cc]=i),a.length&&(this.unparsedVttFrags=[],a.forEach((function(e){t.onFragLoaded(e)})))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},i.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},i.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,r=this.media,i=t[e],a=i.label,s=i.languageCode,o=this.getExistingTrack(e);if(o)n[e]=o,Ke(n[e]),qe(n[e],r);else{var l=this.createTextTrack("captions",a,s);l&&(l[e]=!0,n[e]=l)}}},i.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},i.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},i.destroy=function(){e.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Ke(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Ke(t[n])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var n=e.subtitles||[],r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var i=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,n){var r;if(n<i.length){for(var a=null,s=0;s<i.length;s++)if(nn(i[s],e)){a=i[s];break}a&&(r=a)}r||(r=t.createTextTrack("subtitles",e.name,e.lang)),e.default?r.mode=t.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",t.textTracks.push(r)}))}else if(!r&&this.tracks&&this.tracks.length){var a=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(e){var n=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(n){var r="textTrack"+n[1],i=t.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}}))},i.onFragLoaded=function(e){var t=e.frag,n=e.payload,r=this.cea608Parser1,i=this.cea608Parser2,a=this.initPTS,s=this.lastSn,o=this.unparsedVttFrags;if("main"===t.type){var d=t.sn;t.sn!==s+1&&r&&i&&(r.reset(),i.reset()),this.lastSn=d}else if("subtitle"===t.type)if(n.byteLength){if(!Object(l.isFiniteNumber)(a[t.cc]))return o.push(e),void(a.length&&this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var c=t.decryptdata;null!=c&&null!=c.key&&"AES-128"===c.method||this._parseVTTs(t,n)}else this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var n=this,r=this.hls,i=this.prevCC,a=this.textTracks,s=this.vttCCs;s[e.cc]||(s[e.cc]={start:e.start,prevCC:i,new:!0},this.prevCC=e.cc),Jt.parse(t,this.initPTS[e.cc],s,e.cc,(function(t){if(n.config.renderTextTracksNatively){var i=a[e.level];if("disabled"===i.mode)return void r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach((function(e){if(!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(n){d.logger.debug("Failed occurred on adding cues: "+n);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}))}else{var s=n.tracks[e.level].default?"default":"subtitles"+e.level;r.trigger(u.default.CUES_PARSED,{type:"subtitles",cues:t,track:s})}r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){d.logger.log("Failed to parse VTT cue: "+t),r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}))},i.onFragDecrypted=function(e){var t=e.frag,n=e.payload;if("subtitle"===t.type){if(!Object(l.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(t,n)}},i.onFragParsingUserdata=function(e){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var r=0;r<e.samples.length;r++){var i=e.samples[r].bytes;if(i){var a=this.extractCea608Data(i);t.addData(e.samples[r].pts,a[0]),n.addData(e.samples[r].pts,a[1])}}},i.extractCea608Data=function(e){for(var t=31&e[0],n=2,r=[[],[]],i=0;i<t;i++){var a=e[n++],s=127&e[n++],o=127&e[n++],l=3&a;0===s&&0===o||0!=(4&a)&&(0!==l&&1!==l||(r[l].push(s),r[l].push(o)))}return r},r}(h);function nn(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var rn=tn;function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var sn=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADED,u.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n.queuedDefaultTrack=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,o=r.prototype;return o.destroy=function(){h.prototype.destroy.call(this)},o.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(l.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){t.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},o.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(l.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),on(this.media.textTracks).forEach((function(e){Ke(e)})),this.subtitleTrack=-1,this.media=null)},o.onManifestLoaded=function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.hls.trigger(u.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach((function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)}))},o.onSubtitleTrackLoaded=function(e){var t=this,n=e.id,r=e.details,i=this.trackId,a=this.tracks,s=a[i];if(n>=a.length||n!==i||!s||this.stopped)this._clearReloadTimer();else if(d.logger.log("subtitle track "+n+" loaded"),r.live){var o=ue(s.details,r,e.stats.trequest);d.logger.log("Reloading live subtitle playlist in "+o+"ms"),this.timer=setTimeout((function(){t._loadCurrentTrack()}),o)}else this._clearReloadTimer()},o.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},o.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},o._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},o._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,n=this.hls,r=t[e];e<0||!r||r.details&&!r.details.live||(d.logger.log("Loading subtitle track "+e),n.trigger(u.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))},o._toggleTrackModes=function(e){var t=this.media,n=this.subtitleDisplay,r=this.trackId;if(t){var i=on(t.textTracks);if(-1===e)[].slice.call(i).forEach((function(e){e.mode="disabled"}));else{var a=i[r];a&&(a.mode="disabled")}var s=i[e];s&&(s.mode=n?"showing":"hidden")}},o._setSubtitleTrackInternal=function(e){var t=this.hls,n=this.tracks;!Object(l.isFiniteNumber)(e)||e<-1||e>=n.length||(this.trackId=e,d.logger.log("Switching to subtitle track "+e),t.trigger(u.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},o._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=on(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack=e}},i=r,(a=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}])&&an(i.prototype,a),s&&an(i,s),r}(h);function on(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}var ln,un=sn,dn=n("./src/crypt/decrypter.js"),cn=window.performance,fn=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.ERROR,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED,u.default.LEVEL_UPDATED)||this).fragmentTracker=n,r.config=t.config,r.state=_e,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new dn.default(t,t.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.startLoad=function(){this.stopLoad(),this.state=be;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(500),this.tick())},i.onSubtitleFragProcessed=function(e){var t=e.frag,n=e.success;if(this.fragPrevious=t,this.state=be,n){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i,a=t.start,s=0;s<r.length;s++)if(a>=r[s].start&&a<=r[s].end){i=r[s];break}var o=t.start+t.duration;i?i.end=o:(i={start:a,end:o},r.push(i))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=be},i.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]})),this.media=null,this.state=_e)},i.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=be)},i.onSubtitleTracksUpdated=function(e){var t=this;d.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]}))},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},i.onSubtitleTrackLoaded=function(e){var t=e.id,n=e.details,r=this.currentTrackId,i=this.tracks,a=i[r];t>=i.length||t!==r||!a||(n.live&&function(e,t,n){void 0===n&&(n=0);var r=-1;le(e,t,(function(e,t,n){t.start=e.start,r=n}));var i=t.fragments;if(r<0)i.forEach((function(e){e.start+=n}));else for(var a=r+1;a<i.length;a++)i[a].start=i[a-1].start+i[a-1].duration}(a.details,n,this.lastAVStart),a.details=n,this.setInterval(500))},i.onKeyLoaded=function(){this.state===Ae&&(this.state=be)},i.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag.decryptdata,r=e.frag,i=this.hls;if(this.state===Re&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var a=cn.now();this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,(function(e){var t=cn.now();i.trigger(u.default.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:a,tdecrypt:t}})}))}},i.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},i.doTick=function(){if(this.media)switch(this.state){case be:var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,r=this.media,i=this.tracks;if(!i||!i[t]||!i[t].details)break;var a,s=e.maxBufferHole,o=e.maxFragLookUpTolerance,l=Math.min(e.maxBufferLength,e.maxMaxBufferLength),c=W.bufferedInfo(this._getBuffered(),r.currentTime,s),f=c.end,h=c.len,g=i[t].details,p=g.fragments,m=p.length,v=p[m-1].start+p[m-1].duration;if(h>l)return;var y=this.fragPrevious;f<v?(y&&g.hasProgramDateTime&&(a=he(p,y.endProgramDateTime,o)),a||(a=ge(y,p,f,o))):a=p[m-1],a&&a.encrypted?(d.logger.log("Loading key for "+a.sn),this.state=Ae,this.hls.trigger(u.default.KEY_LOADING,{frag:a})):a&&n.getState(a)===j&&(this.fragCurrent=a,this.state=Re,this.hls.trigger(u.default.FRAG_LOADING,{frag:a}))}else this.state=be},i.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,e.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){if(this.fragCurrent){var e=this.media?this.media.currentTime:0,t=this.config.maxFragLookUpTolerance,n=this.fragCurrent.start-t,r=this.fragCurrent.start+this.fragCurrent.duration+t;(e<n||e>r)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=be,this.tick())}},r}(ke);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(ln||(ln={}));var hn="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var pn=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHED,u.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._drmSystemOptions=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n.mediaKeysPromise=null,n._onMediaEncrypted=function(e){if(d.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!n.mediaKeysPromise)return d.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var t=function(t){n._media&&(n._attemptSetMediaKeys(t),n._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};n.mediaKeysPromise.then(t).catch(t)},n._config=t.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n._drmSystemOptions=t.config.drmSystemOptions,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,l=r.prototype;return l.getLicenseServerUrl=function(e){switch(e){case ln.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},l._attemptKeySystemAccess=function(e,t,n){var r=this,i=function(e,t,n,r){if(e===ln.WIDEVINE)return function(e,t,n){var r={audioCapabilities:[],videoCapabilities:[]};return e.forEach((function(e){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:n.audioRobustness||""})})),t.forEach((function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:n.videoRobustness||""})})),[r]}(t,n,r);throw new Error("Unknown key-system: "+e)}(e,t,n,this._drmSystemOptions);d.logger.log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(e,i);this.mediaKeysPromise=a.then((function(t){return r._onMediaKeySystemAccessObtained(e,t)})),a.catch((function(t){d.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},l._onMediaKeySystemAccessObtained=function(e,t){var n=this;d.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r);var i=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(t){return r.mediaKeys=t,d.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated(),t}));return i.catch((function(e){d.logger.error("Failed to create media-keys:",e)})),i},l._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},l._onNewMediaKeySession=function(e){var t=this;d.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(n){t._onKeySessionMessage(e,n.message)}),!1)},l._onKeySessionMessage=function(e,t){d.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){d.logger.log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)}))},l._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return d.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});d.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},l._generateRequestWithPreferredKeySession=function(e,t){var n=this,r=this._mediaKeysList[0];if(!r)return d.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)d.logger.warn("Key-Session already initialized but requested again");else{var i=r.mediaKeysSession;if(!i)return d.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return d.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});d.logger.log('Generating key-session request for "'+e+'" init data type'),r.mediaKeysSessionInitialized=!0,i.generateRequest(e,t).then((function(){d.logger.debug("Key-session generation succeeded")})).catch((function(e){d.logger.error("Error generating key-session request:",e),n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},l._createLicenseXhr=function(e,t,n){var r=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(r,e)}catch(t){r.open("POST",e,!0),i(r,e)}r.readyState||r.open("POST",e,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n),r},l._onLicenseRequestReadyStageChange=function(e,t,n,r){if(4===e.readyState)if(200===e.status)this._requestLicenseFailureCount=0,d.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&d.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(e.response);else{if(d.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var i=3-this._requestLicenseFailureCount+1;d.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(n,r)}},l._generateLicenseRequestChallenge=function(e,t){if(e.mediaKeySystemDomain===ln.WIDEVINE)return t;throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},l._requestLicense=function(e,t){d.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return d.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,e,t);d.logger.log("Sending license request to URL: "+r);var a=this._generateLicenseRequestChallenge(n,e);i.send(a)}catch(e){d.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},l.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},l.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch((function(){}))}))).then((function(){return e.setMediaKeys(null)})).catch((function(){})))},l.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map((function(e){return e.audioCodec})),n=e.levels.map((function(e){return e.videoCodec}));this._attemptKeySystemAccess(ln.WIDEVINE,t,n)}},i=r,(a=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&gn(i.prototype,a),s&&gn(i,s),r}(h),mn=pn;function vn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vn(Object(n),!0).forEach((function(t){En(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function En(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _n=yn(yn({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:dt,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Je,bufferController:nt,capLevelController:at,fpsController:lt,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:hn,testBandwidth:!0},{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:fn,subtitleTrackController:un,timelineController:rn,audioStreamController:vt,audioTrackController:ht,emeController:mn});function Tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tn(Object(n),!0).forEach((function(t){Sn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function An(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function In(e,t,n){return t&&Rn(e.prototype,t),n&&Rn(e,n),e}var wn=function(e){var t,n;function r(t){var n;void 0===t&&(t={}),(n=e.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var i=r.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=bn(bn({},i),t);var a=An(n).config;if(void 0!==a.liveMaxLatencyDurationCount&&a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==a.liveMaxLatencyDuration&&(void 0===a.liveSyncDuration||a.liveMaxLatencyDuration<=a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(d.enableLogs)(a.debug),n._autoLevelCapping=-1;var s=n.abrController=new a.abrController(An(n)),o=new a.bufferController(An(n)),l=n.capLevelController=new a.capLevelController(An(n)),u=new a.fpsController(An(n)),c=new x(An(n)),f=new U(An(n)),h=new G(An(n)),g=new Ve(An(n)),p=n.levelController=new je(An(n)),m=new Y(An(n)),v=[p,n.streamController=new Be(An(n),m)],y=a.audioStreamController;y&&v.push(new y(An(n),m)),n.networkControllers=v;var E=[c,f,h,s,o,l,u,g,m];if(y=a.audioTrackController){var _=new y(An(n));n.audioTrackController=_,E.push(_)}if(y=a.subtitleTrackController){var T=new y(An(n));n.subtitleTrackController=T,v.push(T)}if(y=a.emeController){var b=new y(An(n));n.emeController=b,E.push(b)}return(y=a.subtitleStreamController)&&v.push(new y(An(n),m)),(y=a.timelineController)&&E.push(new y(An(n))),n.coreComponents=E,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.isSupported=function(){return function(){var e=$();if(!e)return!1;var t=self.SourceBuffer||self.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!r}()},In(r,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return u.default}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:_n},set:function(e){r.defaultConfig=e}}]);var i=r.prototype;return i.destroy=function(){d.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(e){e.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){d.logger.log("attachMedia"),this.media=e,this.trigger(u.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){d.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=s.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),d.logger.log("loadSource:"+e),this.url=e,this.trigger(u.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){void 0===e&&(e=-1),d.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},i.stopLoad=function(){d.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},i.swapAudioCodec=function(){d.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){d.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},i.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},In(r,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){d.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){d.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){d.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){d.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){d.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){d.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,r=0;r<n;r++)if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>t)return r;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),r}(J);wn.defaultConfig=void 0},"./src/polyfills/number.js":function(e,t,n){n.r(t),n.d(t,"isFiniteNumber",(function(){return r})),n.d(t,"MAX_SAFE_INTEGER",(function(){return i}));var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(e,t,n){function r(){return"undefined"==typeof window?self:window}n.r(t),n.d(t,"getSelfScope",(function(){return r}))},"./src/utils/logger.js":function(e,t,n){n.r(t),n.d(t,"enableLogs",(function(){return d})),n.d(t,"logger",(function(){return c}));var r=n(/*! ./get-self-scope */"./src/utils/get-self-scope.js");function i(){}var a={trace:i,debug:i,log:i,warn:i,info:i,error:i},s=a;function o(e,t){return t="["+e+"] > "+t}var l=Object(r.getSelfScope)();function u(e){var t=l.console[e];return t?function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=o(e,r[0])),t.apply(l.console,r)}:i}var d=function(e){if(l.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){s[t]=e[t]?e[t].bind(e):u(t)}))}(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=a}}else s=a},c=s}}).default},e.exports=n())})),Ds=t(Cs);function Ms(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ns(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Os(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ps(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Os(Object(n),!0).forEach((function(t){Ns(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Os(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ls={addCSS:!0,thumbWidth:15,watch:!0};function ks(e,t){return function(){return Array.from(document.querySelectorAll(t)).includes(this)}.call(e,t)}var xs=function(e){return null!=e?e.constructor:null},Fs=function(e,t){return!!(e&&t&&e instanceof t)},Us=function(e){return null==e},Bs=function(e){return xs(e)===Object},Gs=function(e){return xs(e)===String},js=function(e){return Array.isArray(e)},Hs=function(e){return Fs(e,NodeList)},qs=Gs,Ks=js,Ys=Hs,Vs=function(e){return Fs(e,Element)},Ws=function(e){return Fs(e,Event)},zs=function(e){return Us(e)||(Gs(e)||js(e)||Hs(e))&&!e.length||Bs(e)&&!Object.keys(e).length};function Xs(e,t){if(1>t){var n=function(e){var t="".concat(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}(t);return parseFloat(e.toFixed(n))}return Math.round(e/t)*t}var Qs=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),Vs(t)?this.element=t:qs(t)&&(this.element=document.querySelector(t)),Vs(this.element)&&zs(this.element.rangeTouch)&&(this.config=Ps({},Ls,{},n),this.init())}return function(e,t,n){t&&Ms(e.prototype,t),n&&Ms(e,n)}(e,[{key:"init",value:function(){e.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){e.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(e){var t=this,n=e?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach((function(e){t.element[n](e,(function(e){return t.set(e)}),!1)}))}},{key:"get",value:function(t){if(!e.enabled||!Ws(t))return null;var n,r=t.target,i=t.changedTouches[0],a=parseFloat(r.getAttribute("min"))||0,s=parseFloat(r.getAttribute("max"))||100,o=parseFloat(r.getAttribute("step"))||1,l=r.getBoundingClientRect(),u=100/l.width*(this.config.thumbWidth/2)/100;return 0>(n=100/l.width*(i.clientX-l.left))?n=0:100<n&&(n=100),50>n?n-=(100-2*n)*u:50<n&&(n+=2*(n-50)*u),a+Xs(n/100*(s-a),o)}},{key:"set",value:function(t){e.enabled&&Ws(t)&&!t.target.disabled&&(t.preventDefault(),t.target.value=this.get(t),function(e,t){if(e&&t){var n=new Event(t,{bubbles:!0});e.dispatchEvent(n)}}(t.target,"touchend"===t.type?"change":"input"))}}],[{key:"setup",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=null;if(zs(t)||qs(t)?r=Array.from(document.querySelectorAll(qs(t)?t:'input[type="range"]')):Vs(t)?r=[t]:Ys(t)?r=Array.from(t):Ks(t)&&(r=t.filter(Vs)),zs(r))return null;var i=Ps({},Ls,{},n);if(qs(t)&&i.watch){var a=new MutationObserver((function(n){Array.from(n).forEach((function(n){Array.from(n.addedNodes).forEach((function(n){Vs(n)&&ks(n,t)&&new e(n,i)}))}))}));a.observe(document.body,{childList:!0,subtree:!0})}return r.map((function(t){return new e(t,n)}))}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),e}();const $s=()=>{};class Zs{constructor(e=!1){this.enabled=window.console&&e,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):$s}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):$s}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):$s}}const Js=e=>null!=e?e.constructor:null,eo=(e,t)=>Boolean(e&&t&&e instanceof t),to=e=>null==e,no=e=>Js(e)===Object,ro=e=>Js(e)===String,io=e=>Js(e)===Function,ao=e=>Array.isArray(e),so=e=>eo(e,NodeList),oo=e=>to(e)||(ro(e)||ao(e)||so(e))&&!e.length||no(e)&&!Object.keys(e).length;var lo=to,uo=no,co=e=>Js(e)===Number&&!Number.isNaN(e),fo=ro,ho=e=>Js(e)===Boolean,go=io,po=ao,mo=so,vo=e=>eo(e,Element),yo=e=>eo(e,Event),Eo=e=>eo(e,KeyboardEvent),_o=e=>eo(e,TextTrack)||!to(e)&&ro(e.kind),To=e=>eo(e,Promise)&&io(e.then),bo=e=>{if(eo(e,window.URL))return!0;if(!ro(e))return!1;let t=e;e.startsWith("http://")&&e.startsWith("https://")||(t=`http://${e}`);try{return!oo(new URL(t).hostname)}catch(e){return!1}},So=oo;const Ao=(()=>{const e=document.createElement("span"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n=Object.keys(t).find((t=>void 0!==e.style[t]));return!!fo(n)&&t[n]})();function Ro(e,t){setTimeout((()=>{try{e.hidden=!0,e.offsetHeight,e.hidden=!1}catch(e){}}),t)}const Io={isIE:
/* @cc_on!@ */
!!document.documentMode,isEdge:window.navigator.userAgent.includes("Edge"),isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform)};function wo(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function Co(e={},...t){if(!t.length)return e;const n=t.shift();return uo(n)?(Object.keys(n).forEach((t=>{uo(n[t])?(Object.keys(e).includes(t)||Object.assign(e,{[t]:{}}),Co(e[t],n[t])):Object.assign(e,{[t]:n[t]})})),Co(e,...t)):e}function Do(e,t){const n=e.length?e:[e];Array.from(n).reverse().forEach(((e,n)=>{const r=n>0?t.cloneNode(!0):t,i=e.parentNode,a=e.nextSibling;r.appendChild(e),a?i.insertBefore(r,a):i.appendChild(r)}))}function Mo(e,t){vo(e)&&!So(t)&&Object.entries(t).filter((([,e])=>!lo(e))).forEach((([t,n])=>e.setAttribute(t,n)))}function No(e,t,n){const r=document.createElement(e);return uo(t)&&Mo(r,t),fo(n)&&(r.innerText=n),r}function Oo(e,t,n,r){vo(t)&&t.appendChild(No(e,n,r))}function Po(e){mo(e)||po(e)?Array.from(e).forEach(Po):vo(e)&&vo(e.parentNode)&&e.parentNode.removeChild(e)}function Lo(e){if(!vo(e))return;let{length:t}=e.childNodes;for(;t>0;)e.removeChild(e.lastChild),t-=1}function ko(e,t){return vo(t)&&vo(t.parentNode)&&vo(e)?(t.parentNode.replaceChild(e,t),e):null}function xo(e,t){if(!fo(e)||So(e))return{};const n={},r=Co({},t);return e.split(",").forEach((e=>{const t=e.trim(),i=t.replace(".",""),a=t.replace(/[[\]]/g,"").split("="),[s]=a,o=a.length>1?a[1].replace(/["']/g,""):"";switch(t.charAt(0)){case".":fo(r.class)?n.class=`${r.class} ${i}`:n.class=i;break;case"#":n.id=t.replace("#","");break;case"[":n[s]=o}})),Co(r,n)}function Fo(e,t){if(!vo(e))return;let n=t;ho(n)||(n=!e.hidden),e.hidden=n}function Uo(e,t,n){if(mo(e))return Array.from(e).map((e=>Uo(e,t,n)));if(vo(e)){let r="toggle";return void 0!==n&&(r=n?"add":"remove"),e.classList[r](t),e.classList.contains(t)}return!1}function Bo(e,t){return vo(e)&&e.classList.contains(t)}function Go(e,t){const{prototype:n}=Element;return(n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(e,t)}function jo(e){return this.elements.container.querySelectorAll(e)}function Ho(e){return this.elements.container.querySelector(e)}function qo(e=null,t=!1){vo(e)&&(e.focus({preventScroll:!0}),t&&Uo(e,this.config.classNames.tabFocus))}const Ko={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},Yo={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(e,t,n){const r=Io.isIPhone&&n&&Yo.playsinline,i=Yo[e]||"html5"!==t;return{api:i,ui:i&&Yo.rangeInput&&("video"!==e||!Io.isIPhone||r)}},pip:!(Io.isIPhone||!go(No("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||No("video").disablePictureInPicture)),airplay:go(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(e){if(So(e))return!1;const[t]=e.split("/");let n=e;if(!this.isHTML5||t!==this.type)return!1;Object.keys(Ko).includes(n)&&(n+=`; codecs="${Ko[e]}"`);try{return Boolean(n&&this.media.canPlayType(n).replace(/no/,""))}catch(e){return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const e=document.createElement("input");return e.type="range","range"===e.type})(),touch:"ontouchstart"in document.documentElement,transitions:!1!==Ao,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},Vo=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>(e=!0,null)});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e})();function Wo(e,t,n,r=!1,i=!0,a=!1){if(!e||!("addEventListener"in e)||So(t)||!go(n))return;const s=t.split(" ");let o=a;Vo&&(o={passive:i,capture:a}),s.forEach((t=>{this&&this.eventListeners&&r&&this.eventListeners.push({element:e,type:t,callback:n,options:o}),e[r?"addEventListener":"removeEventListener"](t,n,o)}))}function zo(e,t="",n,r=!0,i=!1){Wo.call(this,e,t,n,!0,r,i)}function Xo(e,t="",n,r=!0,i=!1){Wo.call(this,e,t,n,!1,r,i)}function Qo(e,t="",n,r=!0,i=!1){const a=(...s)=>{Xo(e,t,a,r,i),n.apply(this,s)};Wo.call(this,e,t,a,!0,r,i)}function $o(e,t="",n=!1,r={}){if(!vo(e)||So(t))return;const i=new CustomEvent(t,{bubbles:n,detail:{...r,plyr:this}});e.dispatchEvent(i)}function Zo(){this&&this.eventListeners&&(this.eventListeners.forEach((e=>{const{element:t,type:n,callback:r,options:i}=e;t.removeEventListener(n,r,i)})),this.eventListeners=[])}function Jo(){return new Promise((e=>this.ready?setTimeout(e,0):zo.call(this,this.elements.container,"ready",e))).then((()=>{}))}function el(e){To(e)&&e.then(null,(()=>{}))}function tl(e){if(!(po(e)||fo(e)&&e.includes(":")))return!1;return(po(e)?e:e.split(":")).map(Number).every(co)}function nl(e){if(!po(e)||!e.every(co))return null;const[t,n]=e,r=(e,t)=>0===t?e:r(t,e%t),i=r(t,n);return[t/i,n/i]}function rl(e){const t=e=>tl(e)?e.split(":").map(Number):null;let n=t(e);if(null===n&&(n=t(this.config.ratio)),null===n&&!So(this.embed)&&po(this.embed.ratio)&&({ratio:n}=this.embed),null===n&&this.isHTML5){const{videoWidth:e,videoHeight:t}=this.media;n=nl([e,t])}return n}function il(e){if(!this.isVideo)return{};const{wrapper:t}=this.elements,n=rl.call(this,e),[r,i]=po(n)?n:[0,0],a=100/r*i;if(t.style.paddingBottom=`${a}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const e=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),t=(e-a)/(e/50);this.media.style.transform=`translateY(-${t}%)`}else this.isHTML5&&t.classList.toggle(this.config.classNames.videoFixedRatio,null!==n);return{padding:a,ratio:n}}const al={getSources(){if(!this.isHTML5)return[];return Array.from(this.media.querySelectorAll("source")).filter((e=>{const t=e.getAttribute("type");return!!So(t)||Yo.mime.call(this,t)}))},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:al.getSources.call(this).map((e=>Number(e.getAttribute("size")))).filter(Boolean)},setup(){if(!this.isHTML5)return;const e=this;e.options.speed=e.config.speed.options,So(this.config.ratio)||il.call(e),Object.defineProperty(e.media,"quality",{get(){const t=al.getSources.call(e).find((t=>t.getAttribute("src")===e.source));return t&&Number(t.getAttribute("size"))},set(t){if(e.quality!==t){if(e.config.quality.forced&&go(e.config.quality.onChange))e.config.quality.onChange(t);else{const n=al.getSources.call(e).find((e=>Number(e.getAttribute("size"))===t));if(!n)return;const{currentTime:r,paused:i,preload:a,readyState:s,playbackRate:o}=e.media;e.media.src=n.getAttribute("src"),("none"!==a||s)&&(e.once("loadedmetadata",(()=>{e.speed=o,e.currentTime=r,i||el(e.play())})),e.media.load())}$o.call(e,e.media,"qualitychange",!1,{quality:t})}}})},cancelRequests(){this.isHTML5&&(Po(al.getSources.call(this)),this.config.hls.enabled?this.media.setAttribute("src",this.config.hls.source):this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function sl(e){return po(e)?e.filter(((t,n)=>e.indexOf(t)===n)):e}function ol(e,...t){return So(e)?e:e.toString().replace(/{(\d+)}/g,((e,n)=>t[n].toString()))}const ll=(e="",t="",n="")=>e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),n.toString()),ul=(e="")=>e.toString().replace(/\w\S*/g,(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()));function dl(e=""){let t=e.toString();return t=function(e=""){let t=e.toString();return t=ll(t,"-"," "),t=ll(t,"_"," "),t=ul(t),ll(t," ","")}(t),t.charAt(0).toLowerCase()+t.slice(1)}function cl(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML}const fl={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},hl={get(e="",t={}){if(So(e)||So(t))return"";let n=wo(t.i18n,e);if(So(n))return Object.keys(fl).includes(e)?fl[e]:"";const r={"{seektime}":t.seekTime,"{title}":t.title};return Object.entries(r).forEach((([e,t])=>{n=ll(n,e,t)})),n}};class gl{constructor(e){this.enabled=e.config.storage.enabled,this.key=e.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const e="___test";return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}}get(e){if(!gl.supported||!this.enabled)return null;const t=window.localStorage.getItem(this.key);if(So(t))return null;const n=JSON.parse(t);return fo(e)&&e.length?n[e]:n}set(e){if(!gl.supported||!this.enabled)return;if(!uo(e))return;let t=this.get();So(t)&&(t={}),Co(t,e),window.localStorage.setItem(this.key,JSON.stringify(t))}}function pl(e,t="text"){return new Promise(((n,r)=>{try{const r=new XMLHttpRequest;if(!("withCredentials"in r))return;r.addEventListener("load",(()=>{if("text"===t)try{n(JSON.parse(r.responseText))}catch(e){n(r.responseText)}else n(r.response)})),r.addEventListener("error",(()=>{throw new Error(r.status)})),r.open("GET",e,!0),r.responseType=t,r.send()}catch(e){r(e)}}))}function ml(e,t){if(!fo(e))return;const n=fo(t);let r=!1;const i=()=>null!==document.getElementById(t),a=(e,t)=>{e.innerHTML=t,n&&i()||document.body.insertAdjacentElement("afterbegin",e)};if(!n||!i()){const i=gl.supported,s=document.createElement("div");if(s.setAttribute("hidden",""),n&&s.setAttribute("id",t),i){const e=window.localStorage.getItem(`cache-${t}`);if(r=null!==e,r){const t=JSON.parse(e);a(s,t.content)}}pl(e).then((e=>{So(e)||(i&&window.localStorage.setItem(`cache-${t}`,JSON.stringify({content:e})),a(s,e))})).catch((()=>{}))}}const vl=e=>Math.trunc(e/60/60%60,10);function yl(e=0,t=!1,n=!1){if(!co(e))return yl(void 0,t,n);const r=e=>`0${e}`.slice(-2);let i=vl(e);const a=(s=e,Math.trunc(s/60%60,10));var s;const o=(e=>Math.trunc(e%60,10))(e);return i=t||i>0?`${i}:`:"",`${n&&e>0?"-":""}${i}${r(a)}:${r(o)}`}const El={getIconUrl(){const e=new URL(this.config.iconUrl,window.location).host!==window.location.host||Io.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:e}},findElements(){try{return this.elements.controls=Ho.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:jo.call(this,this.config.selectors.buttons.play),pause:Ho.call(this,this.config.selectors.buttons.pause),restart:Ho.call(this,this.config.selectors.buttons.restart),rewind:Ho.call(this,this.config.selectors.buttons.rewind),fastForward:Ho.call(this,this.config.selectors.buttons.fastForward),mute:Ho.call(this,this.config.selectors.buttons.mute),pip:Ho.call(this,this.config.selectors.buttons.pip),airplay:Ho.call(this,this.config.selectors.buttons.airplay),settings:Ho.call(this,this.config.selectors.buttons.settings),captions:Ho.call(this,this.config.selectors.buttons.captions),fullscreen:Ho.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=Ho.call(this,this.config.selectors.progress),this.elements.inputs={seek:Ho.call(this,this.config.selectors.inputs.seek),volume:Ho.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:Ho.call(this,this.config.selectors.display.buffer),currentTime:Ho.call(this,this.config.selectors.display.currentTime),duration:Ho.call(this,this.config.selectors.display.duration)},vo(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),this.toggleNativeControls(!0),!1}},createIcon(e,t){const n="http://www.w3.org/2000/svg",r=El.getIconUrl.call(this),i=`${r.cors?"":r.url}#${this.config.iconPrefix}`,a=document.createElementNS(n,"svg");Mo(a,Co(t,{"aria-hidden":"true",focusable:"false"}));const s=document.createElementNS(n,"use"),o=`${i}-${e}`;return"href"in s&&s.setAttributeNS("http://www.w3.org/1999/xlink","href",o),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o),a.appendChild(s),a},createLabel(e,t={}){const n=hl.get(e,this.config);return No("span",{...t,class:[t.class,this.config.classNames.hidden].filter(Boolean).join(" ")},n)},createBadge(e){if(So(e))return null;const t=No("span",{class:this.config.classNames.menu.value});return t.appendChild(No("span",{class:this.config.classNames.menu.badge},e)),t},createButton(e,t){const n=Co({},t);let r=dl(e);const i={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach((e=>{Object.keys(n).includes(e)&&(i[e]=n[e],delete n[e])})),"button"!==i.element||Object.keys(n).includes("type")||(n.type="button"),Object.keys(n).includes("class")?n.class.split(" ").some((e=>e===this.config.classNames.control))||Co(n,{class:`${n.class} ${this.config.classNames.control}`}):n.class=this.config.classNames.control,e){case"play":i.toggle=!0,i.label="play",i.labelPressed="pause",i.icon="play",i.iconPressed="pause";break;case"mute":i.toggle=!0,i.label="mute",i.labelPressed="unmute",i.icon="volume",i.iconPressed="muted";break;case"fast-forward":i.label="audio"===this.type?"next":"fastForward",i.icon="audio"===this.type?"next":"fast-forward";break;case"rewind":i.label="audio"===this.type?"previous":"rewind",i.icon="audio"===this.type?"previous":"rewind";break;case"captions":i.toggle=!0,i.label="enableCaptions",i.labelPressed="disableCaptions",i.icon="captions-off",i.iconPressed="captions-on";break;case"shuffle":i.toggle=!0,i.label="enableShuffle",i.labelPressed="disableShuffle",i.icon="shuffle-off",i.iconPressed="shuffle-on";break;case"heart":i.toggle=!0,i.label="enableHeart",i.labelPressed="disableHeart",i.icon="heart-off",i.iconPressed="heart-on";break;case"repeataudio":i.toggle=!0,i.label="enableRepeatOne",i.labelPressedRepeatAll="disableRepeat",i.lableRepeatOne="enableRepeatAll",i.icon="repeat-off",i.iconPressedRepeatOne="repeat-one",i.iconPressedRepeatAll="repeat-on";break;case"fullscreen":i.toggle=!0,i.label="enterFullscreen",i.labelPressed="exitFullscreen",i.icon="enter-fullscreen",i.iconPressed="exit-fullscreen";break;case"play-large":n.class+=` ${this.config.classNames.control}--overlaid`,r="play",i.label="play",i.icon="play";break;default:So(i.label)&&(i.label=r),So(i.icon)&&(i.icon=e)}const a=No(i.element);return"repeataudio"===e?(a.appendChild(El.createIcon.call(this,i.iconPressedRepeatAll,{class:"icon--repeatall--pressed"})),a.appendChild(El.createIcon.call(this,i.iconPressedRepeatOne,{class:"icon--repeatone--pressed"})),a.appendChild(El.createIcon.call(this,i.icon,{class:"icon--not-pressed"})),a.appendChild(El.createLabel.call(this,i.labelPressedRepeatAll,{class:"label--repeatall--pressed"})),a.appendChild(El.createLabel.call(this,i.lableRepeatOne,{class:"label--repeatone--pressed"})),a.appendChild(El.createLabel.call(this,i.label,{class:"label--not-pressed"}))):i.toggle?(a.appendChild(El.createIcon.call(this,i.iconPressed,{class:"icon--pressed"})),a.appendChild(El.createIcon.call(this,i.icon,{class:"icon--not-pressed"})),a.appendChild(El.createLabel.call(this,i.labelPressed,{class:"label--pressed"})),a.appendChild(El.createLabel.call(this,i.label,{class:"label--not-pressed"}))):(a.appendChild(El.createIcon.call(this,i.icon)),a.appendChild(El.createLabel.call(this,i.label))),Co(n,xo(this.config.selectors.buttons[r],n)),Mo(a,n),"play"===r?(po(this.elements.buttons[r])||(this.elements.buttons[r]=[]),this.elements.buttons[r].push(a)):this.elements.buttons[r]=a,a},createRange(e,t){const n=No("input",Co(xo(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":hl.get(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));return this.elements.inputs[e]=n,El.updateRangeFill.call(this,n),Qs.setup(n),n},createProgress(e,t){const n=No("progress",Co(xo(this.config.selectors.display[e]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},t));if("volume"!==e){n.appendChild(No("span",null,"0"));const t={played:"played",buffer:"buffered"}[e],r=t?hl.get(t,this.config):"";n.innerText=`% ${r.toLowerCase()}`}return this.elements.display[e]=n,n},createTime(e,t){const n=xo(this.config.selectors.display[e],t),r=No("div",Co(n,{class:`${n.class?n.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":hl.get(e,this.config)}),"00:00");return this.elements.display[e]=r,r},bindMenuItemShortcuts(e,t){zo.call(this,e,"keydown keyup",(n=>{if(![32,38,39,40].includes(n.which))return;if(n.preventDefault(),n.stopPropagation(),"keydown"===n.type)return;const r=Go(e,'[role="menuitemradio"]');if(!r&&[32,39].includes(n.which))El.showMenuPanel.call(this,t,!0);else{let t;32!==n.which&&(40===n.which||r&&39===n.which?(t=e.nextElementSibling,vo(t)||(t=e.parentNode.firstElementChild)):(t=e.previousElementSibling,vo(t)||(t=e.parentNode.lastElementChild)),qo.call(this,t,!0))}}),!1),zo.call(this,e,"keyup",(e=>{13===e.which&&El.focusFirstMenuItem.call(this,null,!0)}))},createMenuItem({value:e,list:t,type:n,title:r,badge:i=null,checked:a=!1,menuPopup:s=!0}){const o=xo(this.config.selectors.inputs[n]),l=No("button",Co(o,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${o.class?o.class:""}`.trim(),"aria-checked":a,value:e})),u=No("span");u.innerHTML=r,vo(i)&&u.appendChild(i),l.appendChild(u),Object.defineProperty(l,"checked",{enumerable:!0,get:()=>"true"===l.getAttribute("aria-checked"),set(e){e&&Array.from(l.parentNode.children).filter((e=>Go(e,'[role="menuitemradio"]'))).forEach((e=>e.setAttribute("aria-checked","false"))),l.setAttribute("aria-checked",e?"true":"false")}}),this.listeners.bind(l,"click keyup",(t=>{if(!Eo(t)||32===t.which){switch(t.preventDefault(),t.stopPropagation(),l.checked=!0,n){case"language":this.currentTrack=Number(e);break;case"quality":this.quality=e;break;case"speed":this.speed=parseFloat(e);break;case"audiolanguage":{const t=bl.getAudioTracks.call(this)[Number(e)];this.config.hls.enabled?this.hls.audioTrack=t.id:this.config.dash.enabled&&this.dash.setCurrentTrack(t),this.currentHlsAudioTrack=Number(e);break}}s&&(document.getElementById(`plyr-settings-${this.id}`).hidden=!0)}}),n,!1),El.bindMenuItemShortcuts.call(this,l,n),t.appendChild(l)},formatTime(e=0,t=!1){if(!co(e))return e;return yl(e,vl(this.duration)>0,t)},updateTimeDisplay(e=null,t=0,n=!1){vo(e)&&co(t)&&(e.innerText=El.formatTime(t,n))},updateVolume(){this.supported.ui&&(vo(this.elements.inputs.volume)&&El.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),vo(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume))},setRange(e,t=0){vo(e)&&(e.value=t,El.updateRangeFill.call(this,e))},updateProgress(e){if(!this.supported.ui||!yo(e))return;let t=0;const n=(e,t)=>{const n=co(t)?t:0,r=vo(e)?e:this.elements.display.buffer;if(vo(r)){r.value=n;const e=r.getElementsByTagName("span")[0];vo(e)&&(e.childNodes[0].nodeValue=n)}};if(e)switch(e.type){case"timeupdate":case"seeking":case"seeked":r=this.currentTime,i=this.duration,t=0===r||0===i||Number.isNaN(r)||Number.isNaN(i)?0:(r/i*100).toFixed(2),"timeupdate"===e.type&&El.setRange.call(this,this.elements.inputs.seek,t);break;case"playing":case"progress":n(this.elements.display.buffer,100*this.buffered)}var r,i},updateRangeFill(e){const t=yo(e)?e.target:e;if(vo(t)&&"range"===t.getAttribute("type")){if(Go(t,this.config.selectors.inputs.seek)){t.setAttribute("aria-valuenow",this.currentTime);const e=El.formatTime(this.currentTime),n=El.formatTime(this.duration),r=hl.get("seekLabel",this.config);t.setAttribute("aria-valuetext",r.replace("{currentTime}",e).replace("{duration}",n))}else if(Go(t,this.config.selectors.inputs.volume)){const e=100*t.value;t.setAttribute("aria-valuenow",e),t.setAttribute("aria-valuetext",`${e.toFixed(1)}%`)}else t.setAttribute("aria-valuenow",t.value);Io.isWebkit&&t.style.setProperty("--value",t.value/t.max*100+"%")}},updateSeekTooltip(e){if(!this.config.tooltips.seek||!vo(this.elements.inputs.seek)||!vo(this.elements.display.seekTooltip)||0===this.duration)return;const t=`${this.config.classNames.tooltip}--visible`,n=e=>Uo(this.elements.display.seekTooltip,t,e);if(this.touch)return void n(!1);let r=0;const i=this.elements.progress.getBoundingClientRect();if(yo(e))r=100/i.width*(e.pageX-i.left);else{if(!Bo(this.elements.display.seekTooltip,t))return;r=parseFloat(this.elements.display.seekTooltip.style.left,10)}r<0?r=0:r>100&&(r=100),El.updateTimeDisplay.call(this,this.elements.display.seekTooltip,this.duration/100*r),this.elements.display.seekTooltip.style.left=`${r}%`,yo(e)&&["mouseenter","mouseleave"].includes(e.type)&&n("mouseenter"===e.type)},timeUpdate(e){const t=!vo(this.elements.display.duration)&&this.config.invertTime;El.updateTimeDisplay.call(this,this.elements.display.currentTime,t?this.duration-this.currentTime:this.currentTime,t),e&&"timeupdate"===e.type&&this.media.seeking||El.updateProgress.call(this,e)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return Fo(this.elements.display.currentTime,!0),void Fo(this.elements.progress,!0);vo(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const e=vo(this.elements.display.duration);!e&&this.config.displayDuration&&this.paused&&El.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),e&&El.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),El.updateSeekTooltip.call(this)},toggleMenuButton(e,t){Fo(this.elements.settings.buttons[e],!t)},toggleTracksMenuButton(e,t){Fo(this.elements.tracksMenu.buttons[e],!t)},updateSetting(e,t,n){const r=this.elements.settings.panels[e];let i=null,a=t;if("captions"===e)i=this.currentTrack;else{if(i=So(n)?this[e]:n,So(i)&&(i=this.config[e].default),!So(this.options[e])&&!this.options[e].includes(i))return void this.debug.warn(`Unsupported value of '${i}' for ${e}`);if(!this.config[e].options.includes(i))return void this.debug.warn(`Disabled value of '${i}' for ${e}`)}if(vo(a)||(a=r&&r.querySelector('[role="menu"]')),!vo(a))return;this.elements.settings.buttons[e].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=El.getLabel.call(this,e,i);const s=a&&a.querySelector(`[value="${i}"]`);vo(s)&&(s.checked=!0)},getLabel(e,t){switch(e){case"speed":return 1===t?hl.get("normal",this.config):`${t}&times;`;case"quality":if(-1===t)return"Auto";if(co(t)){const e=hl.get(`qualityLabel.${t}`,this.config);return e.length?e:`${t}p`}return ul(t);case"captions":return bl.getLabel.call(this);default:return null}},setQualityMenu(e){const t=new Zs(this.config.debug);if(!vo(this.elements.settings.panels.quality))return;const n="quality",r=this.elements.settings.panels.quality.querySelector('[role="menu"]');po(e)&&(this.options.quality=sl(e).filter((e=>this.config.quality.options.includes(e))));const i=!So(this.options.quality)&&this.options.quality.length>1;if(El.toggleMenuButton.call(this,n,i),Lo(r),El.checkMenu.call(this),!i)return;const a=e=>{const n=hl.get(`qualityBadge.${e}`,this.config);return n.length?(t.log("LABEL",n),El.createBadge.call(this,n)):null};this.options.quality.sort(((e,t)=>{const n=this.config.quality.options;return n.indexOf(e)<n.indexOf(t)?1:-1})).forEach((e=>{El.createMenuItem.call(this,{value:e,list:r,type:n,title:El.getLabel.call(this,"quality",e),badge:a(e)})})),El.updateSetting.call(this,n,r)},setCaptionsMenu(){if(!vo(this.elements.settings.panels.captions))return;const e="captions",t=this.elements.settings.panels.captions.querySelector('[role="menu"]'),n=bl.getTracks.call(this),r=Boolean(n.length);El.toggleMenuButton.call(this,e,r),Lo(t),El.checkMenu.call(this);const i=n.map(((e,n)=>({value:n,checked:this.captions.toggled&&this.currentTrack===n,title:bl.getLabel.call(this,e),badge:e.language&&El.createBadge.call(this,e.language.toUpperCase()),list:t,type:"language"})));i.unshift({value:-1,checked:!this.captions.toggled,title:hl.get("disabled",this.config),list:t,type:"language"}),i.forEach(El.createMenuItem.bind(this)),El.updateSetting.call(this,e,t)},setSubTitleMenu(){if(!vo(this.elements.tracksMenu.panels.subtitle))return;const e=this.elements.tracksMenu.panels.subtitle.querySelector('[role="menu"]'),t=bl.getTracks.call(this),n=Boolean(t.length);El.toggleTracksMenuButton.call(this,"captions",n),El.checkTracksMenu.call(this),Lo(e);const r=t.map(((t,n)=>({value:n,checked:this.captions.toggled&&this.currentTrack===n,title:bl.getLabel.call(this,t),list:e,type:"language",menuPopup:!1})));r.unshift({value:-1,checked:!this.captions.toggled,title:hl.get("disabled",this.config),list:e,type:"language",menuPopup:!1}),r.forEach(El.createMenuItem.bind(this))},setSubAudioTrackMenu(){if(!vo(this.elements.tracksMenu.panels.subtrack))return;const e=this.elements.tracksMenu.panels.subtrack.querySelector('[role="menu"]'),t=bl.getAudioTracks.call(this),n=Boolean(t.length);if(El.toggleTracksMenuButton.call(this,"captions",n),El.checkTracksMenu.call(this),Lo(e),!n)return;t.map(((t,n)=>({value:n,checked:this.currentHlsAudioTrack===n,title:t.name||t.lang,list:e,type:"audiolanguage",menuPopup:!1}))).forEach(El.createMenuItem.bind(this))},setSpeedMenu(){if(!vo(this.elements.settings.panels.speed))return;const e="speed",t=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter((e=>e>=this.minimumSpeed&&e<=this.maximumSpeed));const n=!So(this.options.speed)&&this.options.speed.length>1;El.toggleMenuButton.call(this,e,n),Lo(t),El.checkMenu.call(this),n&&(this.options.speed.forEach((n=>{El.createMenuItem.call(this,{value:n,list:t,type:e,title:El.getLabel.call(this,"speed",n)})})),El.updateSetting.call(this,e,t))},checkMenu(){const{buttons:e}=this.elements.settings,t=!So(e)&&Object.values(e).some((e=>!e.hidden));Fo(this.elements.settings.menu,!t)},checkTracksMenu(){this.elements.captions;const e=bl.getAudioTracks.call(this),t=bl.getTracks.call(this);0===e.length&&0===t.length?Fo(this.elements.tracksMenu.menu,!0):Fo(this.elements.tracksMenu.menu,!1)},focusFirstMenuItem(e,t=!1){if(this.elements.settings.popup.hidden)return;let n=e;vo(n)||(n=Object.values(this.elements.settings.panels).find((e=>!e.hidden)));const r=n.querySelector('[role^="menuitem"]');qo.call(this,r,t)},toggleMenu(e){const{popup:t}=this.elements.settings,n=this.elements.buttons.settings;if(!vo(t)||!vo(n))return;const{hidden:r}=t;let i=r;if(ho(e))i=e;else if(Eo(e)&&27===e.which)i=!1;else if(yo(e)){const r=go(e.composedPath)?e.composedPath()[0]:e.target,a=t.contains(r);if(a||!a&&e.target!==n&&i)return}n.setAttribute("aria-expanded",i),Fo(t,!i),Uo(this.elements.container,this.config.classNames.menu.open,i),i&&Eo(e)?El.focusFirstMenuItem.call(this,null,!0):i||r||qo.call(this,n,Eo(e))},toggleTrackMenu(e){const{popup:t}=this.elements.tracksMenu,n=this.elements.buttons.captions;if(!vo(t)||!vo(n))return;const{hidden:r}=t;let i=r;if(ho(e))i=e;else if(Eo(e)&&27===e.which)i=!1;else if(yo(e)){const r=go(e.composedPath)?e.composedPath()[0]:e.target,a=t.contains(r);if(a||!a&&e.target!==n&&i)return}n.setAttribute("aria-expanded",i),Fo(t,!i),Uo(this.elements.container,this.config.classNames.menu.open,i),i&&Eo(e)?El.focusFirstMenuItem.call(this,null,!0):i||r||qo.call(this,n,Eo(e))},getMenuSize(e){const t=e.cloneNode(!0);t.style.position="absolute",t.style.opacity=0,t.removeAttribute("hidden"),e.parentNode.appendChild(t);const n=t.scrollWidth,r=t.scrollHeight;return Po(t),{width:n,height:r}},showMenuPanel(e="",t=!1){const n=this.elements.container.querySelector(`#plyr-settings-${this.id}-${e}`);if(!vo(n))return;const r=n.parentNode,i=Array.from(r.children).find((e=>!e.hidden));if(Yo.transitions&&!Yo.reducedMotion){r.style.width=`${i.scrollWidth}px`,r.style.height=`${i.scrollHeight}px`;const e=El.getMenuSize.call(this,n),t=e=>{e.target===r&&["width","height"].includes(e.propertyName)&&(r.style.width="",r.style.height="",Xo.call(this,r,Ao,t))};zo.call(this,r,Ao,t),r.style.width=`${e.width}px`,r.style.height=`${e.height}px`}Fo(i,!0),Fo(n,!1),El.focusFirstMenuItem.call(this,n,t)},setDownloadUrl(){const e=this.elements.buttons.download;vo(e)&&e.setAttribute("href",this.download)},create(e){const{bindMenuItemShortcuts:t,createButton:n,createProgress:r,createRange:i,createTime:a,setQualityMenu:s,setSpeedMenu:o,showMenuPanel:l}=El;let u;this.elements.controls=null,po(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(n.call(this,"play-large")),u="video"===this.type?No("div",xo(this.config.selectors.controls.gudshoControl)):No("div",xo(this.config.selectors.controls.wrapper)),this.elements.controls=u;const d={class:"plyr__controls__item"},c=No("div",{class:"center_control"}),f=No("div",{class:"center_control forward_backward"}),h=No("button",{class:"plyr__controls__item all-btn plyr__control forward_backward","data-plyr":"fast-forward"}),g=No("button",{class:"plyr__controls__item all-btn plyr__control forward_backward","data-plyr":"rewind"}),p=No("div",{class:"player-logo"}),m=No("div",{class:"buffer-loader"});m.innerHTML+='<svg width="300px" height="200px" viewBox="0 0 187.3 93.7" preserveAspectRatio="xMidYMid meet" style="left: 50%; top: 50%; position: absolute; transform: translate(-50%, -50%) matrix(1, 0, 0, 1, 0, 0);"><path stroke="#ededed" id="outline" fill="none" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"d="M93.9,46.4c9.3,9.5,13.8,17.9,23.5,17.9s17.5-7.8,17.5-17.5s-7.8-17.6-17.5-17.5c-9.7,0.1-13.3,7.2-22.1,17.1c-8.9,8.8-15.7,17.9-25.4,17.9s-17.5-7.8-17.5-17.5s7.8-17.5,17.5-17.5S86.2,38.6,93.9,46.4z" /><path id="outline-bg" opacity="0.05" fill="none" stroke="#ededed" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"d="M93.9,46.4c9.3,9.5,13.8,17.9,23.5,17.9s17.5-7.8,17.5-17.5s-7.8-17.6-17.5-17.5c-9.7,0.1-13.3,7.2-22.1,17.1c-8.9,8.8-15.7,17.9-25.4,17.9s-17.5-7.8-17.5-17.5s7.8-17.5,17.5-17.5S86.2,38.6,93.9,46.4z" /></svg>';const v=No("div",{class:"center_left"}),y=No("div",{class:"center_right"}),E=No("div",{class:"audio_time_duration"});if("audio"===this.type){const e=this.config.playlist[this.playlistIndex],t=No("div",{class:"track-bg"});u.appendChild(t);const n=No("div",{class:"gudsho-music-details"}),r=No("div",{class:"music-bar"}),i=No("div",{class:"music-content"}),a=No("img",{class:"gudsho-author-image"});a.setAttribute("src",e.audio_thumbnail),a.setAttribute("width","75"),a.setAttribute("height","75"),a.setAttribute("alt",e.title||"Unknown");const s=No("div",{class:"gudsho-trackTitle"});s.textContent=e.title||"Unknown";const o=No("div",{class:"gudsho-audio-statistics"}),l=No("div",{class:"gudsho-authorTitle"}),d=No("div",{class:"gudsho-listeners"}),c=No("div",{class:"gudsho-listeners-icon"});c.appendChild(El.createIcon.call(this,"headset",{class:"icon--headset"}));const f=No("div",{class:"gudsho-listeners-count"}),h=hl.get("listeners",this.config),g=e.listeners||0;f.textContent=`${g} ${h}`,d.appendChild(c),d.appendChild(f),l.textContent=e.artist_name||"Unknown",o.appendChild(l),o.appendChild(d),this.elements.audioTrack.image=a,this.elements.audioTrack.panels.name=l,this.elements.audioTrack.panels.listeners=d,this.elements.audioTrack.panels.listeners.count=d,this.elements.audioTrack.title=s,n.appendChild(r),n.appendChild(i),i.appendChild(s),i.appendChild(o),r.appendChild(a),v.appendChild(n),u.appendChild(v)}if("video"===this.type||"audio"===this.type){const e=No("img",{class:"gudsho-logo"});e.setAttribute("src","https://gsvp-dev.s3.ap-south-1.amazonaws.com/static/images/logo-white.png"),p.appendChild(e),"video"===this.type?(u.appendChild(p),u.appendChild(m)):"audio"===this.type&&y.appendChild(p)}if(this.debug.log("THis.nextVideo",this.nextEpisodes),this.debug.log("this.type",this.type),this.nextEpisodes&&"video"===this.type){const e=No("div",{class:`${d.class} plyr__next__episodes`});e.appendChild(n.call(this,"next",d));const t=No("div",{class:"gudsho-next-episodes"});t.textContent=hl.get("nextEpisodes",this.config),e.appendChild(t),this.elements.nextEpisodes=e,y.appendChild(e)}if(this.nextPromo&&"video"===this.type){const e=No("div",{class:`${d.class} plyr__next__promo`});e.appendChild(n.call(this,"next",d));const t=No("div",{class:"gudsho-next-promo"});t.textContent=hl.get("nextPromo",this.config),e.appendChild(t),this.elements.nextPromo=e,y.appendChild(e)}if(sl(po(this.config.controls)?this.config.controls:[]).forEach((s=>{if("heart"===s&&"audio"===this.type&&v.appendChild(n.call(this,"heart",d)),"share"===s&&"audio"===this.type){const e=No("div",{class:"gudsho-share plyr__controls__item"});e.appendChild(n.call(this,"share",d)),v.appendChild(e)}if("hidePlayer"===s){const e=No("div",{class:"gudsho_audio_hide"});e.textContent="Hide",this.elements.hidePlayer=e,u.appendChild(e)}if("restart"===s&&("video"===this.type||"audio"===this.type?c.appendChild(n.call(this,"restart",d)):u.appendChild(n.call(this,"restart",d))),"repeataudio"===s&&"audio"===this.type&&y.appendChild(n.call(this,"repeataudio",d)),"rewind"===s&&("video"===this.type||"audio"===this.type?c.appendChild(n.call(this,"rewind",d)):u.appendChild(n.call(this,"rewind",d))),"play"===s&&("video"===this.type||"audio"===this.type?c.appendChild(n.call(this,"play",d)):u.appendChild(n.call(this,"play",d))),"fast-forward"===s&&("video"===this.type||"audio"===this.type?c.appendChild(n.call(this,"fast-forward",d)):u.appendChild(n.call(this,"fast-forward",d))),"shuffle"===s&&"audio"===this.type&&y.appendChild(n.call(this,"shuffle",d)),"close"===s&&"audio"===this.type&&y.appendChild(n.call(this,"close",d)),"video"!==this.type&&"audio"!==this.type||u.appendChild(c),"progress"===s){const t=No("div",{class:`${d.class} plyr__progress__container`,id:"gudsho-seekbar"}),n=No("div",xo(this.config.selectors.progress));if(n.appendChild(i.call(this,"seek",{id:`plyr-seek-${e.id}`})),n.appendChild(r.call(this,"buffer")),this.config.tooltips.seek){const e=No("span",{class:this.config.classNames.tooltip},"00:00");n.appendChild(e),this.elements.display.seekTooltip=e}this.elements.progress=n,t.appendChild(this.elements.progress),u.appendChild(t)}if("current-time"===s&&("video"===this.type?v.appendChild(a.call(this,"currentTime",d)):"audio"===this.type?(E.appendChild(a.call(this,"currentTime",d)),y.appendChild(E)):u.appendChild(a.call(this,"currentTime",d))),"duration"===s&&("video"===this.type?v.appendChild(a.call(this,"duration",d)):"audio"===this.type?(E.appendChild(a.call(this,"duration",d)),y.appendChild(E)):u.appendChild(a.call(this,"duration",d))),"video"===this.type&&u.appendChild(v),"help"===s&&"video"===this.type&&y.appendChild(n.call(this,"help",d)),"mute"===s||"volume"===s){let{volume:t}=this.elements;if(vo(t)&&u.contains(t)||(t=No("div",Co({},d,{id:"mute-unmute",class:`${d.class} plyr__volume`.trim()})),this.elements.volume=t,"video"===this.type||"audio"===this.type?y.appendChild(t):u.appendChild(t)),"mute"===s&&t.appendChild(n.call(this,"mute")),"volume"===s&&!Io.isIos){const n={max:1,step:.05,value:this.config.volume};t.appendChild(i.call(this,"volume",Co(n,{id:`plyr-volume-${e.id}`,class:"mute-unmute"})))}}if(this.debug.log("seasons",this.seasons),"seasons"===s&&this.seasons&&"video"===this.type){const e=No("div",{class:"gudsho-seasons plyr__controls__item"});e.appendChild(n.call(this,"seasons",d)),y.appendChild(e)}if("captions"===s){this.debug.log("data",e);const t=No("div",Co({},d,{class:`${d.class} plyr__caption__menu`.trim(),hidden:""}));t.appendChild(n.call(this,"captions",{"aria-haspopup":!0,"aria-controls":`plyr-captions-${e.id}`,"aria-expanded":!1}));const r=No("div",{class:"plyr__menu__container",id:`plyr-captions-${e.id}`,hidden:""}),i=No("div"),a=No("div",{id:`plyr-captions-${e.id}-home`});this.elements.tracksMenu.panels.home=a;const s=No("div",{role:"menu",class:"gudsho-menu"}),o=No("span",{class:"caption-close"}),l=No("div",{class:"caption__gudsho__subtitle"}),c=No("span",{class:"caption_inner"},"Caption");l.appendChild(c),l.appendChild(No("div",{role:"menu"}));const f=No("div",{class:"caption__gudsho__subtrack"}),h=No("span",{class:"caption_inner"},"Audio");f.appendChild(h),f.appendChild(No("div",{role:"menu"})),this.elements.tracksMenu.panels.subtitle=l,this.elements.tracksMenu.panels.subtrack=f,this.elements.tracksMenu.panels.close=o,s.appendChild(l),(this.config.hls.enabled||this.config.dash.enabled)&&s.appendChild(f),a.appendChild(s),r.appendChild(o),i.appendChild(a),r.appendChild(i),t.appendChild(r),this.elements.tracksMenu.popup=r,this.elements.tracksMenu.menu=t,Fo(this.elements.tracksMenu.menu,!this.config.captions.active),"video"===this.type?y.appendChild(t):u.appendChild(n.call(this,"captions",d))}if("settings"===s&&!So(this.config.settings)){const r=No("div",Co({},d,{class:`${d.class} plyr__menu`.trim(),hidden:""}));r.appendChild(n.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${e.id}`,"aria-expanded":!1}));const i=No("div",{class:"plyr__menu__container",id:`plyr-settings-${e.id}`,hidden:""}),a=No("div"),s=No("div",{id:`plyr-settings-${e.id}-home`,hidden:""}),o=No("div",{role:"menu"});s.appendChild(o),a.appendChild(s),this.elements.settings.panels.home=s,this.config.settings.forEach((n=>{const r=No("button",Co(xo(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));t.call(this,r,n),zo.call(this,r,"click",(()=>{l.call(this,n,!1)}));const i=No("span",null,hl.get(n,this.config)),s=No("span",{class:this.config.classNames.menu.value});s.innerHTML=e[n],i.appendChild(s),r.appendChild(i),o.appendChild(r);const u={id:`plyr-settings-${e.id}-${n}`};"quality"!==n&&(u.hidden="");const d=No("div",u),c=No("span",{class:"quality-title"});c.appendChild(No("span",{"aria-hidden":!0},hl.get(n,this.config))),c.appendChild(No("span",{class:this.config.classNames.hidden},hl.get("menuBack",this.config))),zo.call(this,d,"keydown",(e=>{37===e.which&&(e.preventDefault(),e.stopPropagation(),l.call(this,"home",!0))}),!1),zo.call(this,c,"click",(()=>{l.call(this,"home",!1)})),d.appendChild(c),d.appendChild(No("div",{role:"menu"})),a.appendChild(d),this.elements.settings.buttons[n]=r,this.elements.settings.panels[n]=d})),i.appendChild(a),r.appendChild(i),"video"===this.type?y.appendChild(r):u.appendChild(r),this.elements.settings.popup=i,this.elements.settings.menu=r}if("pip"===s&&Yo.pip&&("video"===this.type?y.appendChild(n.call(this,"pip",d)):u.appendChild(n.call(this,"pip",d))),"airplay"===s&&Yo.airplay&&("video"===this.type?y.appendChild(n.call(this,"airplay",d)):u.appendChild(n.call(this,"airplay",d))),"download"===s){const e=Co({},d,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(e.download="");const{download:t}=this.config.urls;!bo(t)&&this.isEmbed&&Co(e,{icon:`logo-${this.provider}`,label:this.provider}),"video"===this.type?y.appendChild(n.call(this,"download",e)):u.appendChild(n.call(this,"download",e))}"fullscreen"===s&&("video"===this.type?y.appendChild(n.call(this,"fullscreen",d)):u.appendChild(n.call(this,"fullscreen",d))),"video"!==this.type&&"audio"!==this.type||u.appendChild(y)})),"video"===this.type){const e=No("div",{class:this.config.classNames.selectedQuality.container});hl.get(`qualityBadge.${this.config.quality.selected}`,this.config);const t=No("span",{class:this.config.classNames.selectedQuality.batch}),n=No("span",{class:this.config.classNames.selectedQuality.text});n.textContent=this.config.quality.selected,t.textContent=this.label,e.appendChild(t),this.elements.selectedQuality.container=e,this.elements.selectedQuality.batch=t,this.elements.selectedQuality.text=n,v.appendChild(e),u.appendChild(f),u.appendChild(g),u.appendChild(h)}return this.isHTML5&&s.call(this,al.getQualityOptions.call(this)),o.call(this),u},inject(){if(this.config.loadSprite){const e=El.getIconUrl.call(this);e.cors&&ml(e.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let e=null;this.elements.controls=null;const t={id:this.id,seektime:this.config.seekTime,title:this.config.title};let n=!0;go(this.config.controls)&&(this.config.controls=this.config.controls.call(this,t)),this.config.controls||(this.config.controls=[]),vo(this.config.controls)||fo(this.config.controls)?e=this.config.controls:(e=El.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:bl.getLabel.call(this)}),n=!1);let r;n&&fo(this.config.controls)&&(e=(e=>{let n=e;return Object.entries(t).forEach((([e,t])=>{n=ll(n,`{${e}}`,t)})),n})(e)),fo(this.config.selectors.controls.container)&&(r=document.querySelector(this.config.selectors.controls.container)),vo(r)||(r=this.elements.container);if(r[vo(e)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",e),vo(this.elements.controls)||El.findElements.call(this),!So(this.elements.buttons)){const e=e=>{const t=this.config.classNames.controlPressed;Object.defineProperty(e,"pressed",{enumerable:!0,get:()=>Bo(e,t),set(n=!1){Uo(e,t,n)}})};Object.values(this.elements.buttons).filter(Boolean).forEach((t=>{po(t)||mo(t)?Array.from(t).filter(Boolean).forEach(e):e(t)}))}if(Io.isEdge&&Ro(r),this.config.tooltips.controls){const{classNames:e,selectors:t}=this.config,n=`${t.controls.wrapper} ${t.labels} .${e.hidden}`,r=jo.call(this,n);Array.from(r).forEach((e=>{Uo(e,this.config.classNames.hidden,!1),Uo(e,this.config.classNames.tooltip,!0)}))}}};function _l(e,t=!0){let n=e;if(t){const e=document.createElement("a");e.href=n,n=e.href}try{return new URL(n)}catch(e){return null}}function Tl(e){const t=new URLSearchParams;return uo(e)&&Object.entries(e).forEach((([e,n])=>{t.set(e,n)})),t}const bl={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!Yo.textTracks)return po(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&El.setCaptionsMenu.call(this),El.setSubTitleMenu.call(this),void El.setSubAudioTrackMenu.call(this);var e,t;if(vo(this.elements.captions)||(this.elements.captions=No("div",xo(this.config.selectors.captions)),e=this.elements.captions,t=this.elements.wrapper,vo(e)&&vo(t)&&t.parentNode.insertBefore(e,t.nextSibling)),Io.isIE&&window.URL){const e=this.media.querySelectorAll("track");Array.from(e).forEach((e=>{const t=e.getAttribute("src"),n=_l(t);null!==n&&n.hostname!==window.location.href.hostname&&["http:","https:"].includes(n.protocol)&&pl(t,"blob").then((t=>{e.setAttribute("src",window.URL.createObjectURL(t))})).catch((()=>{Po(e)}))}))}const n=sl((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map((e=>e.split("-")[0])));let r=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();"auto"===r&&([r]=n);let i=this.storage.get("captions");if(ho(i)||({active:i}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:i,language:r,languages:n}),this.isHTML5){const e=this.config.captions.update?"addtrack removetrack":"removetrack";zo.call(this,this.media.textTracks,e,bl.update.bind(this))}setTimeout(bl.update.bind(this),0)},update(){const e=bl.getTracks.call(this,!0),{active:t,language:n,meta:r,currentTrackNode:i}=this.captions,a=Boolean(e.find((e=>e.language===n)));this.isHTML5&&this.isVideo&&e.filter((e=>!r.get(e))).forEach((e=>{this.debug.log("Track added",e),r.set(e,{default:"showing"===e.mode}),"showing"===e.mode&&(e.mode="hidden"),zo.call(this,e,"cuechange",(()=>bl.updateCues.call(this)))})),(a&&this.language!==n||!e.includes(i))&&(bl.setLanguage.call(this,n),bl.toggle.call(this,t&&a)),Uo(this.elements.container,this.config.classNames.captions.enabled,!So(e)),po(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&El.setCaptionsMenu.call(this),El.setSubTitleMenu.call(this),El.setSubAudioTrackMenu.call(this)},toggle(e,t=!0){if(!this.supported.ui)return;const{toggled:n}=this.captions,r=this.config.classNames.captions.active,i=lo(e)?!n:e;if(i!==n){if(t||(this.captions.active=i,this.storage.set({captions:i})),!this.language&&i&&!t){const e=bl.getTracks.call(this),t=bl.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=t.language,void bl.set.call(this,e.indexOf(t))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=i),Uo(this.elements.container,r,i),this.captions.toggled=i,El.updateSetting.call(this,"captions"),$o.call(this,this.media,i?"captionsenabled":"captionsdisabled")}setTimeout((()=>{i&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")}))},set(e,t=!0){const n=bl.getTracks.call(this);if(-1!==e)if(co(e))if(e in n){if(this.captions.currentTrack!==e){this.captions.currentTrack=e;const r=n[e],{language:i}=r||{};this.captions.currentTrackNode=r,El.updateSetting.call(this,"captions"),t||(this.captions.language=i,this.storage.set({language:i})),this.isVimeo&&this.embed.enableTextTrack(i),$o.call(this,this.media,"languagechange")}bl.toggle.call(this,!0,t),this.isHTML5&&this.isVideo&&bl.updateCues.call(this)}else this.debug.warn("Track not found",e);else this.debug.warn("Invalid caption argument",e);else bl.toggle.call(this,!1,t)},setLanguage(e,t=!0){if(!fo(e))return void this.debug.warn("Invalid language argument",e);const n=e.toLowerCase();this.captions.language=n;const r=bl.getTracks.call(this),i=bl.findTrack.call(this,[n]);bl.set.call(this,r.indexOf(i),t)},getTracks(e=!1){return Array.from((this.media||{}).textTracks||[]).filter((t=>!this.isHTML5||e||this.captions.meta.has(t))).filter((e=>["captions","subtitles"].includes(e.kind)))},getAudioTracks(){let e=[];return this.config.hls.enabled?e=Array.from((this.hlsMetaData||{}).audioTracks||[]):this.config.dash.enabled&&(e=this.dash.getTracksFor("audio")),e},findTrack(e,t=!1){const n=bl.getTracks.call(this),r=e=>Number((this.captions.meta.get(e)||{}).default),i=Array.from(n).sort(((e,t)=>r(t)-r(e)));let a;return e.every((e=>(a=i.find((t=>t.language===e)),!a))),a||(t?i[0]:void 0)},getCurrentTrack(){return bl.getTracks.call(this)[this.currentTrack]},getLabel(e){let t=e;return!_o(t)&&Yo.textTracks&&this.captions.toggled&&(t=bl.getCurrentTrack.call(this)),_o(t)?So(t.label)?So(t.language)?hl.get("enabled",this.config):e.language.toUpperCase():t.label:hl.get("disabled",this.config)},updateCues(e){if(!this.supported.ui)return;if(!vo(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!lo(e)&&!Array.isArray(e))return void this.debug.warn("updateCues: Invalid input",e);let t=e;if(!t){const e=bl.getCurrentTrack.call(this);t=Array.from((e||{}).activeCues||[]).map((e=>e.getCueAsHTML())).map(cl)}const n=t.map((e=>e.trim())).join("\n");if(n!==this.elements.captions.innerHTML){Lo(this.elements.captions);const e=No("span",xo(this.config.selectors.caption));e.innerHTML=n,this.elements.captions.appendChild(e),$o.call(this,this.media,"cuechange")}}},Sl={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://gudsho-static.akamaized-stagingtest.net/Images/static/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",hls:{enabled:!1,src:null},dash:{enabled:!1,src:null,widevine:null},playlist:[],quality:{default:-1,options:[1080,720,480,360,240,-1],forced:!1,onChange:null},setNextEpisodes:!1,setNextPromo:!1,seasons:!1,loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!0},storage:{enabled:!0,key:"plyr"},controls:["play-large","restart","repeataudio","play","shuffle","heart","progress","current-time","mute","help","volume","seasons","captions","settings","pip","seasons","share","airplay","close","hidePlayer","fullscreen","repeat"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",previous:"Previous Song",next:"Next Song",nextEpisodes:"Next Episode",nextPromo:"Next Promo",listeners:"Listeners",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Audio & Subtitle",disableCaptions:"Audio & Subtitle",enableShuffle:"Enable shuffle",disableShuffle:"Disable shuffle",help:"Something wrong",seasons:"Seasons",share:"Share",enableHeart:"Add Favorite",disableHeart:"Un Favorite",close:"Close Player",enableRepeatOne:"Repeat this Song",disableRepeat:"Disable Repeat",enableRepeatAll:"Repeat All",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{1080:"HD",720:"HD",480:"SD",360:"SD",240:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/v2/video/{0}.json"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,shuffle:null,help:null,nextEpisodes:null,nextPromo:null,seasons:null,heart:null,repeataudio:null,hidePlayer:null,close:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","restart","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","changeplaylistindex","help","seasons","share","next-episodes","next-promo","heart","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls",gudshoControl:".gudsho__player__center plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',shuffle:'[data-plyr="shuffle"]',help:'[data-plyr="help"]',seasons:'[data-plyr="seasons"]',share:'[data-plyr="share"]',nextEpisodes:'[data-plyr="next-episodes"]',nextPromo:'[data-plyr="next-promo"]',heart:'[data-plyr="heart"]',close:'[data-plyr="close"]',repeataudio:'[data-plyr="repeataudio"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"all-btn plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",ended:"plyr--ended",paused:"plyr--paused",fastForward:"plyr--fastforward",rewind:"plyr--rewind",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isIos:"plyr--is-ios",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},selectedQuality:{container:"gudsho-quality",batch:"quality-batch",text:"quality-text"},shuffle:{enabled:"plyr--shuffle-enabled",active:"plyr--shuffle-active"},help:{enabled:"plyr--help-enabled"},seasons:{enabled:"plyr--seasons-enabled"},share:{enabled:"plyr--share-enabled"},heart:{active:"plyr--heart-favorite"},hidePlayer:{enabled:"gudsho--hide-player-enabled"},repeataudio:{repeatOne:"plyr--repeatone--audio-enabled",repeatAll:"plyr--repeatall--audio-enabled"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},tabFocus:"plyr__tab-focus",previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,premium:!1,referrerPolicy:null},youtube:{noCookie:!0,rel:0,showinfo:0,iv_load_policy:3,modestbranding:1}},Al="picture-in-picture",Rl="inline",Il={html5:"html5",youtube:"youtube",vimeo:"vimeo"},wl="audio",Cl="video";class Dl{constructor(e){this.player=e,this.prefix=Dl.prefix,this.property=Dl.property,this.scrollPosition={x:0,y:0},this.forceFallback="force"===e.config.fullscreen.fallback,this.player.elements.fullscreen=e.config.fullscreen.container&&function(e,t){const{prototype:n}=Element;return(n.closest||function(){let e=this;do{if(Go.matches(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}).call(e,t)}(this.player.elements.container,e.config.fullscreen.container),zo.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":`${this.prefix}fullscreenchange`,(()=>{this.onChange()})),zo.call(this.player,this.player.elements.container,"dblclick",(e=>{vo(this.player.elements.controls)&&this.player.elements.controls.contains(e.target)||this.toggle()})),zo.call(this,this.player.elements.container,"keydown",(e=>this.trapFocus(e))),this.update()}static get native(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get usingNative(){return Dl.native&&!this.forceFallback}static get prefix(){if(go(document.exitFullscreen))return"";let e="";return["webkit","moz","ms"].some((t=>!(!go(document[`${t}ExitFullscreen`])&&!go(document[`${t}CancelFullScreen`]))&&(e=t,!0))),e}static get property(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}get enabled(){return(Dl.native||this.player.config.fullscreen.fallback)&&this.player.config.fullscreen.enabled&&this.player.supported.ui&&this.player.isVideo}get active(){if(!this.enabled)return!1;if(!Dl.native||this.forceFallback)return Bo(this.target,this.player.config.classNames.fullscreen.fallback);const e=this.prefix?document[`${this.prefix}${this.property}Element`]:document.fullscreenElement;return e&&e.shadowRoot?e===this.target.getRootNode().host:e===this.target}get target(){return Io.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen||this.player.elements.container}onChange(){if(!this.enabled)return;const e=this.player.elements.buttons.fullscreen;vo(e)&&(e.pressed=this.active),$o.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",!0)}toggleFallback(e=!1){if(e?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":"",Uo(this.target,this.player.config.classNames.fullscreen.fallback,e),Io.isIos){let t=document.head.querySelector('meta[name="viewport"]');const n="viewport-fit=cover";t||(t=document.createElement("meta"),t.setAttribute("name","viewport"));const r=fo(t.content)&&t.content.includes(n);e?(this.cleanupViewport=!r,r||(t.content+=`,${n}`)):this.cleanupViewport&&(t.content=t.content.split(",").filter((e=>e.trim()!==n)).join(","))}this.onChange()}trapFocus(e){if(Io.isIos||!this.active||"Tab"!==e.key||9!==e.keyCode)return;const t=document.activeElement,n=jo.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[r]=n,i=n[n.length-1];t!==i||e.shiftKey?t===r&&e.shiftKey&&(i.focus(),e.preventDefault()):(r.focus(),e.preventDefault())}update(){if(this.enabled){let e;e=this.forceFallback?"Fallback (forced)":Dl.native?"Native":"Fallback",this.player.debug.log(`${e} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");Uo(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}enter(){this.enabled&&(Io.isIos&&this.player.config.fullscreen.iosNative?this.target.webkitEnterFullscreen():!Dl.native||this.forceFallback?this.toggleFallback(!0):this.prefix?So(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))}exit(){if(this.enabled)if(Io.isIos&&this.player.config.fullscreen.iosNative)this.target.webkitExitFullscreen(),el(this.player.play());else if(!Dl.native||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!So(this.prefix)){const e="moz"===this.prefix?"Cancel":"Exit";document[`${this.prefix}${e}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}toggle(){this.active?this.exit():this.enter()}}function Ml(e,t=1){return new Promise(((n,r)=>{const i=new Image,a=()=>{delete i.onload,delete i.onerror,(i.naturalWidth>=t?n:r)(i)};Object.assign(i,{onload:a,onerror:a,src:e})}))}const Nl={addStyleHook(){Uo(this.elements.container,this.config.selectors.container.replace(".",""),!0),Uo(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(e=!1){e&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void Nl.toggleNativeControls.call(this,!0);vo(this.elements.controls)||(El.inject.call(this),this.listeners.controls()),Nl.toggleNativeControls.call(this),this.isHTML5&&bl.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,El.updateVolume.call(this),El.timeUpdate.call(this),Nl.checkPlaying.call(this),Uo(this.elements.container,this.config.classNames.pip.supported,Yo.pip&&this.isHTML5&&this.isVideo),Uo(this.elements.container,this.config.classNames.airplay.supported,Yo.airplay&&this.isHTML5),Uo(this.elements.container,this.config.classNames.isIos,Io.isIos),Uo(this.elements.container,this.config.classNames.isTouch,this.touch),"audio"===this.type&&(lo(this.elements.buttons.shuffle)||(Uo(this.elements.container,this.config.classNames.shuffle.active,this.shuffle),this.elements.buttons.shuffle.pressed=this.shuffle),lo(this.elements.buttons.heart)||(this.elements.buttons.heart.pressed=this.favorite),lo(this.elements.buttons.repeataudio)||(Uo(this.elements.container,this.config.classNames.repeataudio.repeatOne,this.repeataudio.repeatOne),Uo(this.elements.container,this.config.classNames.repeataudio.repeatAll,this.repeataudio.repeatAll),this.elements.buttons.repeataudio.pressed=this.repeataudio.repeatOne||this.repeataudio.repeatAll.repeatOne||this.repeataudio.repeatAll)),this.ready=!0,setTimeout((()=>{$o.call(this,this.media,"ready")}),0),Nl.setTitle.call(this),this.poster&&Nl.setPoster.call(this,this.poster,!1).catch((()=>{})),this.config.duration&&El.durationUpdate.call(this)},setTitle(){let e=hl.get("play",this.config);if(fo(this.config.title)&&!So(this.config.title)&&(e+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach((t=>{t.setAttribute("aria-label",e)})),this.isEmbed){const e=Ho.call(this,"iframe");if(!vo(e))return;const t=So(this.config.title)?"video":this.config.title,n=hl.get("frameTitle",this.config);e.setAttribute("title",n.replace("{title}",t))}},togglePoster(e){Uo(this.elements.container,this.config.classNames.posterEnabled,e)},setPoster(e,t=!0){return t&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",e),Jo.call(this).then((()=>Ml(e))).catch((t=>{throw e===this.poster&&Nl.togglePoster.call(this,!1),t})).then((()=>{if(e!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")})).then((()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${e}')`,backgroundSize:""}),Nl.togglePoster.call(this,!0),e))))},checkPlaying(e){Uo(this.elements.container,this.config.classNames.ended,this.ended),Uo(this.elements.container,this.config.classNames.playing,this.playing),Uo(this.elements.container,this.config.classNames.paused,this.paused),Uo(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach((e=>{Object.assign(e,{pressed:this.playing}),e.setAttribute("aria-label",hl.get(this.playing?"pause":"play",this.config))})),yo(e)&&"timeupdate"===e.type||Nl.toggleControls.call(this)},checkLoading(e){this.loading=["stalled","waiting"].includes(e.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout((()=>{Uo(this.elements.container,this.config.classNames.loading,this.loading),Nl.toggleControls.call(this)}),this.loading?250:0)},toggleControls(e){const{controls:t}=this.elements;if(t&&this.config.hideControls){const n=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(Boolean(e||this.loading||this.paused||t.pressed||t.hover||n))}},migrateStyles(){Object.values({...this.media.style}).filter((e=>!So(e)&&e.startsWith("--plyr"))).forEach((e=>{this.elements.container.style.setProperty(e,this.media.style.getPropertyValue(e)),this.media.style.removeProperty(e)})),So(this.media.style)&&this.media.removeAttribute("style")}};class Ol{constructor(e){this.player=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.forwardClass=null,this.rewindClass=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(e){const{player:t}=this,{elements:n}=t,r=e.keyCode?e.keyCode:e.which,i="keydown"===e.type,a=i&&r===this.lastKey;if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;if(!co(r))return;if(i){const i=document.activeElement;if(vo(i)){const{editable:r}=t.config.selectors,{seek:a}=n.inputs;if(i!==a&&Go(i,r))return;if(32===e.which&&Go(i,'button, [role^="menuitem"]'))return this.lastKey=null,t.togglePlay(),e.preventDefault(),void e.stopPropagation()}switch([32,37,38,39,40,48,49,50,51,52,53,54,56,57,67,70,73,75,76,77,79].includes(r)&&(e.preventDefault(),e.stopPropagation()),r){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a||(t.currentTime=t.duration/10*(r-48));break;case 32:case 75:a||el(t.togglePlay());break;case 38:t.increaseVolume(.1);break;case 40:t.decreaseVolume(.1);break;case 77:a||(t.muted=!t.muted);break;case 39:t.duration&&t.currentTime&&t.currentTime<t.duration-10&&(this.forwardClass&&(clearTimeout(this.forwardClass),Uo(n.container,t.config.classNames.fastForward,!1)),Uo(n.container,t.config.classNames.fastForward,!0),t.forward(),this.forwardClass=setTimeout((()=>{Uo(n.container,t.config.classNames.fastForward,!1)}),20));break;case 37:t.currentTime&&t.currentTime>10&&(this.rewindClass&&(clearTimeout(this.rewindClass),Uo(n.container,t.config.classNames.rewind,!1)),Uo(n.container,t.config.classNames.rewind,!0),t.rewind(),this.rewindClass=setTimeout((()=>{Uo(n.container,t.config.classNames.rewind,!1)}),20));break;case 70:t.fullscreen.toggle();break;case 67:a||t.toggleCaptions();break;case 76:t.loop=!t.loop}27===r&&!t.fullscreen.usingNative&&t.fullscreen.active&&t.fullscreen.toggle(),this.lastKey=r}else this.lastKey=null}toggleMenu(e){El.toggleMenu.call(this.player,e),El.toggleTrackMenu.call(this.player,e)}firstTouch(){const{player:e}=this,{elements:t}=e;e.touch=!0,Uo(t.container,e.config.classNames.isTouch,!0)}setTabFocus(e){const{player:t}=this,{elements:n}=t;if(clearTimeout(this.focusTimer),"keydown"===e.type&&9!==e.which)return;"keydown"===e.type&&(this.lastKeyDown=e.timeStamp);const r=e.timeStamp-this.lastKeyDown<=20;("focus"!==e.type||r)&&((()=>{const e=t.config.classNames.tabFocus;Uo(jo.call(t,`.${e}`),e,!1)})(),"focusout"!==e.type&&(this.focusTimer=setTimeout((()=>{const e=document.activeElement;n.container.contains(e)&&Uo(document.activeElement,t.config.classNames.tabFocus,!0)}),10)))}global(e=!0){const{player:t}=this;t.config.keyboard.global&&Wo.call(t,window,"keydown keyup",this.handleKey,e,!1),Wo.call(t,document.body,"click",this.toggleMenu,e),Qo.call(t,document.body,"touchstart",this.firstTouch),Wo.call(t,document.body,"keydown focus blur focusout",this.setTabFocus,e,!1,!0)}container(){const{player:e}=this,{config:t,elements:n,timers:r}=e;!t.keyboard.global&&t.keyboard.focused&&zo.call(e,n.container,"keydown keyup",this.handleKey,!1),zo.call(e,n.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",(t=>{const{controls:i}=n;i&&"enterfullscreen"===t.type&&(i.pressed=!1,i.hover=!1);let a=0;["touchstart","touchmove","mousemove"].includes(t.type)&&(Nl.toggleControls.call(e,!0),a=e.touch?3e3:2e3),clearTimeout(r.controls),r.controls=setTimeout((()=>Nl.toggleControls.call(e,!1)),a)}));const i=t=>{if(!t)return il.call(e);const r=n.container.getBoundingClientRect(),{width:i,height:a}=r;return il.call(e,`${i}:${a}`)},a=()=>{clearTimeout(r.resized),r.resized=setTimeout(i,50)};zo.call(e,n.container,"enterfullscreen exitfullscreen",(t=>{const{target:r,usingNative:s}=e.fullscreen;if(r!==n.container)return;if(!e.isEmbed&&So(e.config.ratio))return;const o="enterfullscreen"===t.type,{padding:l,ratio:u}=i(o);((t,n,r)=>{if(!e.isVimeo||e.config.vimeo.premium)return;const i=e.elements.wrapper.firstChild,[,a]=t,[s,o]=rl.call(e);i.style.maxWidth=r?a/o*s+"px":null,i.style.margin=r?"0 auto":null})(u,0,o),s||(o?zo.call(e,window,"resize",a):Xo.call(e,window,"resize",a))}))}media(){const{player:e}=this,{elements:t}=e;if(zo.call(e,e.media,"timeupdate seeking seeked",(t=>El.timeUpdate.call(e,t))),zo.call(e,e.media,"durationchange loadeddata loadedmetadata",(t=>El.durationUpdate.call(e,t))),zo.call(e,e.media,"ended",(()=>{"audio"===e.type&&e.forward(1,!1),Uo(t.container,e.config.classNames.ended,e.ended),e.isHTML5&&e.isVideo&&e.config.resetOnEnd&&(e.restart(),e.pause())})),zo.call(e,e.media,"progress playing seeking seeked",(t=>El.updateProgress.call(e,t))),zo.call(e,e.media,"volumechange",(t=>El.updateVolume.call(e,t))),zo.call(e,e.media,"playing play pause ended emptied timeupdate",(t=>Nl.checkPlaying.call(e,t))),zo.call(e,e.media,"waiting canplay seeked playing",(t=>Nl.checkLoading.call(e,t))),e.supported.ui&&e.config.clickToPlay&&!e.isAudio){const n=Ho.call(e,`.${e.config.classNames.video}`);if(!vo(n))return;zo.call(e,t.container,"click",(r=>{([t.container,n].includes(r.target)||n.contains(r.target))&&(e.touch&&e.config.hideControls||(e.ended?(this.proxy(r,e.restart,"restart"),this.proxy(r,(()=>{el(e.play())}),"play")):this.proxy(r,(()=>{el(e.togglePlay())}),"play")))}))}e.supported.ui&&e.config.disableContextMenu&&zo.call(e,t.wrapper,"contextmenu",(e=>{e.preventDefault()}),!1),zo.call(e,e.media,"volumechange",(()=>{e.storage.set({volume:e.volume,muted:e.muted})})),zo.call(e,e.media,"ratechange",(()=>{El.updateSetting.call(e,"speed"),e.storage.set({speed:e.speed})})),zo.call(e,e.media,"qualitychange",(t=>{El.updateSetting.call(e,"quality",null,t.detail.quality)})),zo.call(e,e.media,"ready qualitychange",(()=>{El.setDownloadUrl.call(e)}));const n=e.config.events.concat(["keyup","keydown"]).join(" ");zo.call(e,e.media,n,(n=>{let{detail:r={}}=n;"error"===n.type&&(r=e.media.error),$o.call(e,t.container,n.type,!0,r)}))}proxy(e,t,n){const{player:r}=this,i=r.config.listeners[n];let a=!0;go(i)&&(a=i.call(r,e)),!1!==a&&go(t)&&t.call(r,e)}bind(e,t,n,r,i=!0){const{player:a}=this,s=a.config.listeners[r],o=go(s);zo.call(a,e,t,(e=>this.proxy(e,n,r)),i&&!o)}controls(){const{player:e}=this,{elements:t}=e,n=Io.isIE?"change":"input";if(t.buttons.play&&Array.from(t.buttons.play).forEach((t=>{this.bind(t,"click",(()=>{el(e.togglePlay())}),"play")})),this.bind(t.buttons.restart,"click",e.restart,"restart"),this.bind(t.buttons.rewind,"click",e.rewind,"rewind"),this.bind(t.buttons.fastForward,"click",e.forward,"fastForward"),this.bind(t.hidePlayer,"click",e.hidePlayer,"hidePlayer"),this.bind(t.buttons.mute,"click",(()=>{e.muted=!e.muted}),"mute"),this.bind(t.buttons.shuffle,"click",(()=>e.toggleShuffle())),this.bind(t.buttons.help,"click",(()=>e.toggleHelp())),this.bind(t.buttons.seasons,"click",(()=>e.toggleSeasons())),this.bind(t.buttons.share,"click",(()=>e.toggleShare())),this.bind(t.nextEpisodes,"click",(()=>e.toggleNextEpisodes())),this.bind(t.nextPromo,"click",(()=>e.toggleNextPromo())),this.bind(t.buttons.heart,"click",(()=>e.toggleFavorite())),this.bind(t.buttons.close,"click",(()=>e.toggleClose())),this.bind(t.buttons.repeataudio,"click",(()=>e.toggleRepeatAudio())),this.bind(t.buttons.download,"click",(()=>{$o.call(e,e.media,"download")}),"download"),this.bind(t.buttons.fullscreen,"click",(()=>{e.fullscreen.toggle()}),"fullscreen"),this.bind(t.buttons.pip,"click",(()=>{e.pip="toggle"}),"pip"),this.bind(t.buttons.airplay,"click",e.airplay,"airplay"),this.bind(t.buttons.settings,"click",(t=>{t.stopPropagation(),t.preventDefault(),El.toggleMenu.call(e,t),El.toggleTrackMenu.call(e,t)}),null,!1),this.bind(t.buttons.settings,"keyup",(t=>{const n=t.which;[13,32].includes(n)&&(13!==n?(t.preventDefault(),t.stopPropagation(),El.toggleMenu.call(e,t)):El.focusFirstMenuItem.call(e,null,!0))}),null,!1),this.bind(t.settings.menu,"keydown",(t=>{27===t.which&&El.toggleMenu.call(e,t)})),this.bind(t.buttons.captions,"click",(t=>{t.stopPropagation(),t.preventDefault(),El.toggleTrackMenu.call(e,t)}),null,!1),this.bind(t.tracksMenu.panels.close,"click",(e=>{e.stopPropagation(),e.preventDefault(),Fo(t.tracksMenu.popup,!0)}),null,!1),this.bind(t.buttons.captions,"keyup",(t=>{const n=t.which;[13,32].includes(n)&&(13!==n?(t.preventDefault(),t.stopPropagation(),El.toggleTrackMenu.call(e,t)):El.focusFirstMenuItem.call(e,null,!0))}),null,!1),this.bind(t.tracksMenu.menu,"keydown",(t=>{27===t.which&&El.toggleTrackMenu.call(e,t)})),this.bind(t.inputs.seek,"mousedown mousemove",(e=>{const n=t.progress.getBoundingClientRect(),r=100/n.width*(e.pageX-n.left);e.currentTarget.setAttribute("seek-value",r)})),this.bind(t.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",(t=>{const n=t.currentTarget,r=t.keyCode?t.keyCode:t.which,i="play-on-seeked";if(Eo(t)&&39!==r&&37!==r)return;e.lastSeekTime=Date.now();const a=n.hasAttribute(i),s=["mouseup","touchend","keyup"].includes(t.type);a&&s?(n.removeAttribute(i),el(e.play())):!s&&e.playing&&(n.setAttribute(i,""),e.pause())})),Io.isIos){const t=jo.call(e,'input[type="range"]');Array.from(t).forEach((e=>this.bind(e,n,(e=>Ro(e.target)))))}this.bind(t.inputs.seek,n,(t=>{const n=t.currentTarget;let r=n.getAttribute("seek-value");So(r)&&(r=n.value),n.removeAttribute("seek-value"),e.currentTime=r/n.max*e.duration}),"seek"),this.bind(t.progress,"mouseenter mouseleave mousemove",(t=>El.updateSeekTooltip.call(e,t))),this.bind(t.progress,"mousemove touchmove",(t=>{const{previewThumbnails:n}=e;n&&n.loaded&&n.startMove(t)})),this.bind(t.progress,"mouseleave touchend click",(()=>{const{previewThumbnails:t}=e;t&&t.loaded&&t.endMove(!1,!0)})),this.bind(t.progress,"mousedown touchstart",(t=>{const{previewThumbnails:n}=e;n&&n.loaded&&n.startScrubbing(t)})),this.bind(t.progress,"mouseup touchend",(t=>{const{previewThumbnails:n}=e;n&&n.loaded&&n.endScrubbing(t)})),Io.isWebkit&&Array.from(jo.call(e,'input[type="range"]')).forEach((t=>{this.bind(t,"input",(t=>El.updateRangeFill.call(e,t.target)))})),e.config.toggleInvert&&!vo(t.display.duration)&&this.bind(t.display.currentTime,"click",(()=>{0!==e.currentTime&&(e.config.invertTime=!e.config.invertTime,El.timeUpdate.call(e))})),this.bind(t.inputs.volume,n,(t=>{e.volume=t.target.value}),"volume"),this.bind(t.controls,"mouseenter mouseleave",(n=>{t.controls.hover=!e.touch&&"mouseenter"===n.type})),t.fullscreen&&Array.from(t.fullscreen.children).filter((e=>!e.contains(t.container))).forEach((n=>{this.bind(n,"mouseenter mouseleave",(n=>{t.controls.hover=!e.touch&&"mouseenter"===n.type}))})),this.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",(e=>{t.controls.pressed=["mousedown","touchstart"].includes(e.type)})),this.bind(t.controls,"focusin",(()=>{const{config:n,timers:r}=e;Uo(t.controls,n.classNames.noTransition,!0),Nl.toggleControls.call(e,!0),setTimeout((()=>{Uo(t.controls,n.classNames.noTransition,!1)}),0);const i=this.touch?3e3:4e3;clearTimeout(r.controls),r.controls=setTimeout((()=>Nl.toggleControls.call(e,!1)),i)})),this.bind(t.inputs.volume,"wheel",(t=>{const n=t.webkitDirectionInvertedFromDevice,[r,i]=[t.deltaX,-t.deltaY].map((e=>n?-e:e)),a=Math.sign(Math.abs(r)>Math.abs(i)?r:i);e.increaseVolume(a/50);const{volume:s}=e.media;(1===a&&s<1||-1===a&&s>0)&&t.preventDefault()}),"volume",!1)}}var Pl=n((function(e,t){e.exports=function(){var e=function(){},t={},n={},r={};function i(e,t){e=e.push?e:[e];var i,a,s,o=[],l=e.length,u=l;for(i=function(e,n){n.length&&o.push(e),--u||t(o)};l--;)a=e[l],(s=n[a])?i(a,s):(r[a]=r[a]||[]).push(i)}function a(e,t){if(e){var i=r[e];if(n[e]=t,i)for(;i.length;)i[0](e,t),i.splice(0,1)}}function s(t,n){t.call&&(t={success:t}),n.length?(t.error||e)(n):(t.success||e)(t)}function o(t,n,r,i){var a,s,l=document,u=r.async,d=(r.numRetries||0)+1,c=r.before||e,f=t.replace(/[\?|#].*$/,""),h=t.replace(/^(css|img)!/,"");i=i||0,/(^css!|\.css$)/.test(f)?((s=l.createElement("link")).rel="stylesheet",s.href=h,(a="hideFocus"in s)&&s.relList&&(a=0,s.rel="preload",s.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(f)?(s=l.createElement("img")).src=h:((s=l.createElement("script")).src=t,s.async=void 0===u||u),s.onload=s.onerror=s.onbeforeload=function(e){var l=e.type[0];if(a)try{s.sheet.cssText.length||(l="e")}catch(e){18!=e.code&&(l="e")}if("e"==l){if((i+=1)<d)return o(t,n,r,i)}else if("preload"==s.rel&&"style"==s.as)return s.rel="stylesheet";n(t,l,e.defaultPrevented)},!1!==c(t,s)&&l.head.appendChild(s)}function l(e,t,n){var r,i,a=(e=e.push?e:[e]).length,s=a,l=[];for(r=function(e,n,r){if("e"==n&&l.push(e),"b"==n){if(!r)return;l.push(e)}--a||t(l)},i=0;i<s;i++)o(e[i],r,n)}function u(e,n,r){var i,o;if(n&&n.trim&&(i=n),o=(i?r:n)||{},i){if(i in t)throw"LoadJS";t[i]=!0}function u(t,n){l(e,(function(e){s(o,e),t&&s({success:t,error:n},e),a(i,e)}),o)}if(o.returnPromise)return new Promise(u);u()}return u.ready=function(e,t){return i(e,(function(e){s(t,e)})),u},u.done=function(e){a(e,[])},u.reset=function(){t={},n={},r={}},u.isDefined=function(e){return e in t},u}()}));function Ll(e){return new Promise(((t,n)=>{Pl(e,{success:t,error:n})}))}function kl(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,$o.call(this,this.media,e?"play":"pause"))}const xl={setup(){const e=this;Uo(e.elements.wrapper,e.config.classNames.embed,!0),e.options.speed=e.config.speed.options,il.call(e),uo(window.Vimeo)?xl.ready.call(e):Ll(e.config.urls.vimeo.sdk).then((()=>{xl.ready.call(e)})).catch((t=>{e.debug.warn("Vimeo SDK (player.js) failed to load",t)}))},ready(){const e=this,t=e.config.vimeo,{premium:n,referrerPolicy:r,...i}=t;n&&Object.assign(i,{controls:!1,sidedock:!1});const a=Tl({loop:e.config.loop.active,autoplay:e.autoplay,muted:e.muted,gesture:"media",playsinline:!this.config.fullscreen.iosNative,...i});let s=e.media.getAttribute("src");So(s)&&(s=e.media.getAttribute(e.config.attributes.embed.id));const o=So(l=s)?null:co(Number(l))?l:l.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:l;var l;const u=No("iframe"),d=ol(e.config.urls.vimeo.iframe,o,a);u.setAttribute("src",d),u.setAttribute("allowfullscreen",""),u.setAttribute("allow","autoplay,fullscreen,picture-in-picture"),So(r)||u.setAttribute("referrerPolicy",r);const{poster:c}=e;if(n)u.setAttribute("data-poster",c),e.media=ko(u,e.media);else{const t=No("div",{class:e.config.classNames.embedContainer,"data-poster":c});t.appendChild(u),e.media=ko(t,e.media)}pl(ol(e.config.urls.vimeo.api,o),"json").then((t=>{if(So(t))return;const n=new URL(t[0].thumbnail_large);n.pathname=`${n.pathname.split("_")[0]}.jpg`,Nl.setPoster.call(e,n.href).catch((()=>{}))})),e.embed=new window.Vimeo.Player(u,{autopause:e.config.autopause,muted:e.muted}),e.media.paused=!0,e.media.currentTime=0,e.supported.ui&&e.embed.disableTextTrack(),e.media.play=()=>(kl.call(e,!0),e.embed.play()),e.media.pause=()=>(kl.call(e,!1),e.embed.pause()),e.media.stop=()=>{e.pause(),e.currentTime=0};let{currentTime:f}=e.media;Object.defineProperty(e.media,"currentTime",{get:()=>f,set(t){const{embed:n,media:r,paused:i,volume:a}=e,s=i&&!n.hasPlayed;r.seeking=!0,$o.call(e,r,"seeking"),Promise.resolve(s&&n.setVolume(0)).then((()=>n.setCurrentTime(t))).then((()=>s&&n.pause())).then((()=>s&&n.setVolume(a))).catch((()=>{}))}});let h=e.config.speed.selected;Object.defineProperty(e.media,"playbackRate",{get:()=>h,set(t){e.embed.setPlaybackRate(t).then((()=>{h=t,$o.call(e,e.media,"ratechange")})).catch((()=>{e.options.speed=[1]}))}});let{volume:g}=e.config;Object.defineProperty(e.media,"volume",{get:()=>g,set(t){e.embed.setVolume(t).then((()=>{g=t,$o.call(e,e.media,"volumechange")}))}});let{muted:p}=e.config;Object.defineProperty(e.media,"muted",{get:()=>p,set(t){const n=!!ho(t)&&t;e.embed.setVolume(n?0:e.config.volume).then((()=>{p=n,$o.call(e,e.media,"volumechange")}))}});let m,{loop:v}=e.config;Object.defineProperty(e.media,"loop",{get:()=>v,set(t){const n=ho(t)?t:e.config.loop.active;e.embed.setLoop(n).then((()=>{v=n}))}}),e.embed.getVideoUrl().then((t=>{m=t,El.setDownloadUrl.call(e)})).catch((e=>{this.debug.warn(e)})),Object.defineProperty(e.media,"currentSrc",{get:()=>m}),Object.defineProperty(e.media,"ended",{get:()=>e.currentTime===e.duration}),Promise.all([e.embed.getVideoWidth(),e.embed.getVideoHeight()]).then((t=>{const[n,r]=t;e.embed.ratio=[n,r],il.call(this)})),e.embed.setAutopause(e.config.autopause).then((t=>{e.config.autopause=t})),e.embed.getVideoTitle().then((t=>{e.config.title=t,Nl.setTitle.call(this)})),e.embed.getCurrentTime().then((t=>{f=t,$o.call(e,e.media,"timeupdate")})),e.embed.getDuration().then((t=>{e.media.duration=t,$o.call(e,e.media,"durationchange")})),e.embed.getTextTracks().then((t=>{e.media.textTracks=t,bl.setup.call(e)})),e.embed.on("cuechange",(({cues:t=[]})=>{const n=t.map((e=>function(e){const t=document.createDocumentFragment(),n=document.createElement("div");return t.appendChild(n),n.innerHTML=e,t.firstChild.innerText}(e.text)));bl.updateCues.call(e,n)})),e.embed.on("loaded",(()=>{if(e.embed.getPaused().then((t=>{kl.call(e,!t),t||$o.call(e,e.media,"playing")})),vo(e.embed.element)&&e.supported.ui){e.embed.element.setAttribute("tabindex",-1)}})),e.embed.on("bufferstart",(()=>{$o.call(e,e.media,"waiting")})),e.embed.on("bufferend",(()=>{$o.call(e,e.media,"playing")})),e.embed.on("play",(()=>{kl.call(e,!0),$o.call(e,e.media,"playing")})),e.embed.on("pause",(()=>{kl.call(e,!1)})),e.embed.on("timeupdate",(t=>{e.media.seeking=!1,f=t.seconds,$o.call(e,e.media,"timeupdate")})),e.embed.on("progress",(t=>{e.media.buffered=t.percent,$o.call(e,e.media,"progress"),1===parseInt(t.percent,10)&&$o.call(e,e.media,"canplaythrough"),e.embed.getDuration().then((t=>{t!==e.media.duration&&(e.media.duration=t,$o.call(e,e.media,"durationchange"))}))})),e.embed.on("seeked",(()=>{e.media.seeking=!1,$o.call(e,e.media,"seeked")})),e.embed.on("ended",(()=>{e.media.paused=!0,$o.call(e,e.media,"ended")})),e.embed.on("error",(t=>{e.media.error=t,$o.call(e,e.media,"error")})),setTimeout((()=>Nl.build.call(e)),0)}};function Fl(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,$o.call(this,this.media,e?"play":"pause"))}function Ul(e){return e.noCookie?"https://www.youtube-nocookie.com":"http:"===window.location.protocol?"http://www.youtube.com":void 0}const Bl={setup(){if(Uo(this.elements.wrapper,this.config.classNames.embed,!0),uo(window.YT)&&go(window.YT.Player))Bl.ready.call(this);else{const e=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{go(e)&&e(),Bl.ready.call(this)},Ll(this.config.urls.youtube.sdk).catch((e=>{this.debug.warn("YouTube API failed to load",e)}))}},getTitle(e){pl(ol(this.config.urls.youtube.api,e)).then((e=>{if(uo(e)){const{title:t,height:n,width:r}=e;this.config.title=t,Nl.setTitle.call(this),this.embed.ratio=[r,n]}il.call(this)})).catch((()=>{il.call(this)}))},ready(){const e=this,t=e.media&&e.media.getAttribute("id");if(!So(t)&&t.startsWith("youtube-"))return;let n=e.media.getAttribute("src");So(n)&&(n=e.media.getAttribute(this.config.attributes.embed.id));const r=So(i=n)?null:i.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:i;var i;const a=`${e.provider}-${Math.floor(1e4*Math.random())}`;const{poster:s}=e,o=No("div",{id:a,"data-poster":s});e.media=ko(o,e.media);const l=e=>`https://i.ytimg.com/vi/${r}/${e}default.jpg`;Ml(l("maxres"),121).catch((()=>Ml(l("sd"),121))).catch((()=>Ml(l("hq")))).then((t=>Nl.setPoster.call(e,t.src))).then((t=>{t.includes("maxres")||(e.elements.poster.style.backgroundSize="cover")})).catch((()=>{}));const u=e.config.youtube;e.embed=new window.YT.Player(a,{videoId:r,host:Ul(u),playerVars:Co({},{autoplay:e.config.autoplay?1:0,hl:e.config.hl,controls:e.supported.ui?0:1,disablekb:1,playsinline:e.config.fullscreen.iosNative?0:1,cc_load_policy:e.captions.active?1:0,cc_lang_pref:e.config.captions.language,widget_referrer:window?window.location.href:null},u),events:{onError(t){if(!e.media.error){const n=t.data,r={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[n]||"An unknown error occured";e.media.error={code:n,message:r},$o.call(e,e.media,"error")}},onPlaybackRateChange(t){const n=t.target;e.media.playbackRate=n.getPlaybackRate(),$o.call(e,e.media,"ratechange")},onReady(t){if(go(e.media.play))return;const n=t.target;Bl.getTitle.call(e,r),e.media.play=()=>{Fl.call(e,!0),n.playVideo()},e.media.pause=()=>{Fl.call(e,!1),n.pauseVideo()},e.media.stop=()=>{n.stopVideo()},e.media.duration=n.getDuration(),e.media.paused=!0,e.media.currentTime=0,Object.defineProperty(e.media,"currentTime",{get:()=>Number(n.getCurrentTime()),set(t){e.paused&&!e.embed.hasPlayed&&e.embed.mute(),e.media.seeking=!0,$o.call(e,e.media,"seeking"),n.seekTo(t)}}),Object.defineProperty(e.media,"playbackRate",{get:()=>n.getPlaybackRate(),set(e){n.setPlaybackRate(e)}});let{volume:i}=e.config;Object.defineProperty(e.media,"volume",{get:()=>i,set(t){i=t,n.setVolume(100*i),$o.call(e,e.media,"volumechange")}});let{muted:a}=e.config;Object.defineProperty(e.media,"muted",{get:()=>a,set(t){const r=ho(t)?t:a;a=r,n[r?"mute":"unMute"](),$o.call(e,e.media,"volumechange")}}),Object.defineProperty(e.media,"currentSrc",{get:()=>n.getVideoUrl()}),Object.defineProperty(e.media,"ended",{get:()=>e.currentTime===e.duration});const s=n.getAvailablePlaybackRates();e.options.speed=s.filter((t=>e.config.speed.options.includes(t))),e.supported.ui&&e.media.setAttribute("tabindex",-1),$o.call(e,e.media,"timeupdate"),$o.call(e,e.media,"durationchange"),clearInterval(e.timers.buffering),e.timers.buffering=setInterval((()=>{e.media.buffered=n.getVideoLoadedFraction(),(null===e.media.lastBuffered||e.media.lastBuffered<e.media.buffered)&&$o.call(e,e.media,"progress"),e.media.lastBuffered=e.media.buffered,1===e.media.buffered&&(clearInterval(e.timers.buffering),$o.call(e,e.media,"canplaythrough"))}),200),setTimeout((()=>Nl.build.call(e)),50)},onStateChange(t){const n=t.target;clearInterval(e.timers.playing);switch(e.media.seeking&&[1,2].includes(t.data)&&(e.media.seeking=!1,$o.call(e,e.media,"seeked")),t.data){case-1:$o.call(e,e.media,"timeupdate"),e.media.buffered=n.getVideoLoadedFraction(),$o.call(e,e.media,"progress");break;case 0:Fl.call(e,!1),e.media.loop?(n.stopVideo(),n.playVideo()):$o.call(e,e.media,"ended");break;case 1:e.config.autoplay||!e.media.paused||e.embed.hasPlayed?(Fl.call(e,!0),$o.call(e,e.media,"playing"),e.timers.playing=setInterval((()=>{$o.call(e,e.media,"timeupdate")}),50),e.media.duration!==n.getDuration()&&(e.media.duration=n.getDuration(),$o.call(e,e.media,"durationchange"))):e.media.pause();break;case 2:e.muted||e.embed.unMute(),Fl.call(e,!1);break;case 3:$o.call(e,e.media,"waiting")}$o.call(e,e.elements.container,"statechange",!1,{code:t.data})}}})}},Gl={setup(){this.media?(Uo(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),Uo(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&Uo(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=No("div",{class:this.config.classNames.video}),Do(this.media,this.elements.wrapper),this.elements.poster=No("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?al.setup.call(this):this.isYouTube?Bl.setup.call(this):this.isVimeo&&xl.setup.call(this)):this.debug.warn("No media element found!")},destroyMedia(){this.isHTML5&&al.cancelRequests.call(this)}};class jl{constructor(e){this.player=e,this.config=e.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise(((e,t)=>{this.on("loaded",e),this.on("error",t)})),this.load()}get enabled(){const{config:e}=this;return this.player.isHTML5&&this.player.isVideo&&e.enabled&&(!So(e.publisherId)||bo(e.tagUrl))}load(){this.enabled&&(uo(window.google)&&uo(window.google.ima)?this.ready():Ll(this.player.config.urls.googleIMA.sdk).then((()=>{this.ready()})).catch((()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))})))}ready(){var e;this.enabled||((e=this).manager&&e.manager.destroy(),e.elements.displayContainer&&e.elements.displayContainer.destroy(),e.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then((()=>{this.clearSafetyTimer("onAdsManagerLoaded()")})),this.listeners(),this.setupIMA()}get tagUrl(){const{config:e}=this;if(bo(e.tagUrl))return e.tagUrl;return`https://go.aniview.com/api/adserver6/vast/?${Tl({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:e.publisherId})}`}setupIMA(){this.elements.container=No("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(e=>this.onAdsManagerLoaded(e)),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,(e=>this.onAdError(e)),!1),this.requestAds()}requestAds(){const{container:e}=this.player.elements;try{const t=new google.ima.AdsRequest;t.adTagUrl=this.tagUrl,t.linearAdSlotWidth=e.offsetWidth,t.linearAdSlotHeight=e.offsetHeight,t.nonLinearAdSlotWidth=e.offsetWidth,t.nonLinearAdSlotHeight=e.offsetHeight,t.forceNonLinearFullSlot=!1,t.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(t)}catch(e){this.onAdError(e)}}pollCountdown(e=!1){if(!e)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval((()=>{const e=yl(Math.max(this.manager.getRemainingTime(),0)),t=`${hl.get("advertisement",this.player.config)} - ${e}`;this.elements.container.setAttribute("data-badge-text",t)}),100)}onAdsManagerLoaded(e){if(!this.enabled)return;const t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.enablePreloading=!0,this.manager=e.getAdsManager(this.player,t),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,(e=>this.onAdError(e))),Object.keys(google.ima.AdEvent.Type).forEach((e=>{this.manager.addEventListener(google.ima.AdEvent.Type[e],(e=>this.onAdEvent(e)))})),this.trigger("loaded")}addCuePoints(){So(this.cuePoints)||this.cuePoints.forEach((e=>{if(0!==e&&-1!==e&&e<this.player.duration){const t=this.player.elements.progress;if(vo(t)){const n=100/this.player.duration*e,r=No("span",{class:this.player.config.classNames.cues});r.style.left=`${n.toString()}%`,t.appendChild(r)}}}))}onAdEvent(e){const{container:t}=this.player.elements,n=e.getAd(),r=e.getAdData();switch((e=>{$o.call(this.player,this.player.media,`ads${e.replace(/_/g,"").toLowerCase()}`)})(e.type),e.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),n.isLinear()||(n.width=t.offsetWidth,n.height=t.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:r.adError&&this.player.debug.warn(`Non-fatal ad error: ${r.adError.getMessage()}`)}}onAdError(e){this.cancel(),this.player.debug.warn("Ads error",e)}listeners(){const{container:e}=this.player.elements;let t;this.player.on("canplay",(()=>{this.addCuePoints()})),this.player.on("ended",(()=>{this.loader.contentComplete()})),this.player.on("timeupdate",(()=>{t=this.player.currentTime})),this.player.on("seeked",(()=>{const e=this.player.currentTime;So(this.cuePoints)||this.cuePoints.forEach(((n,r)=>{t<n&&n<e&&(this.manager.discardAdBreak(),this.cuePoints.splice(r,1))}))})),window.addEventListener("resize",(()=>{this.manager&&this.manager.resize(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL)}))}play(){const{container:e}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then((()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(e){this.onAdError(e)}})).catch((()=>{}))}resumeContent(){this.elements.container.style.zIndex="",this.playing=!1,el(this.player.media.play())}pauseContent(){this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()}cancel(){this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}loadAds(){this.managerPromise.then((()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise((e=>{this.on("loaded",e),this.player.debug.log(this.manager)})),this.initialized=!1,this.requestAds()})).catch((()=>{}))}trigger(e,...t){const n=this.events[e];po(n)&&n.forEach((e=>{go(e)&&e.apply(this,t)}))}on(e,t){return po(this.events[e])||(this.events[e]=[]),this.events[e].push(t),this}startSafetyTimer(e,t){this.player.debug.log(`Safety timer invoked from: ${t}`),this.safetyTimer=setTimeout((()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")}),e)}clearSafetyTimer(e){lo(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${e}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}}const Hl=e=>{const t=[];return e.split(/\r\n\r\n|\n\n|\r\r/).forEach((e=>{const n={};e.split(/\r\n|\n|\r/).forEach((e=>{if(co(n.startTime)){if(!So(e.trim())&&So(n.text)){const t=e.trim().split("#xywh=");[n.text]=t,t[1]&&([n.x,n.y,n.w,n.h]=t[1].split(","))}}else{const t=e.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);t&&(n.startTime=60*Number(t[1]||0)*60+60*Number(t[2])+Number(t[3])+Number(`0.${t[4]}`),n.endTime=60*Number(t[6]||0)*60+60*Number(t[7])+Number(t[8])+Number(`0.${t[9]}`))}})),n.text&&t.push(n)})),t},ql=(e,t)=>{const n={};return e>t.width/t.height?(n.width=t.width,n.height=1/e*t.width):(n.height=t.height,n.width=e*t.height),n};class Kl{constructor(e){this.player=e,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}load(){this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then((()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.loaded=!0)}))}getThumbnails(){return new Promise((e=>{const{src:t}=this.player.config.previewThumbnails;if(So(t))throw new Error("Missing previewThumbnails.src config attribute");const n=()=>{this.thumbnails.sort(((e,t)=>e.height-t.height)),this.player.debug.log("Preview thumbnails",this.thumbnails),e()};if(go(t))t((e=>{this.thumbnails=e,n()}));else{const e=(fo(t)?[t]:t).map((e=>this.getThumbnail(e)));Promise.all(e).then(n)}}))}getThumbnail(e){return new Promise((t=>{pl(e).then((n=>{const r={frames:Hl(n),height:null,urlPrefix:""};r.frames[0].text.startsWith("/")||r.frames[0].text.startsWith("http://")||r.frames[0].text.startsWith("https://")||(r.urlPrefix=e.substring(0,e.lastIndexOf("/")+1));const i=new Image;i.onload=()=>{r.height=i.naturalHeight,r.width=i.naturalWidth,this.thumbnails.push(r),t()},i.src=r.urlPrefix+r.frames[0].text}))}))}startMove(e){if(this.loaded&&yo(e)&&["touchmove","mousemove"].includes(e.type)&&this.player.media.duration){if("touchmove"===e.type)this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{const t=this.player.elements.progress.getBoundingClientRect(),n=100/t.width*(e.pageX-t.left);this.seekTime=this.player.media.duration*(n/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=e.pageX,this.elements.thumb.time.innerText=yl(this.seekTime)}this.showImageAtCurrentTime()}}endMove(){this.toggleThumbContainer(!1,!0)}startScrubbing(e){(lo(e.button)||!1===e.button||0===e.button)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))}endScrubbing(){this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):Qo.call(this.player,this.player.media,"timeupdate",(()=>{this.mouseDown||this.toggleScrubbingContainer(!1)}))}listeners(){this.player.on("play",(()=>{this.toggleThumbContainer(!1,!0)})),this.player.on("seeked",(()=>{this.toggleThumbContainer(!1)})),this.player.on("timeupdate",(()=>{this.lastTime=this.player.media.currentTime}))}render(){this.elements.thumb.container=No("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=No("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const e=No("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=No("span",{},"00:00"),e.appendChild(this.elements.thumb.time),this.elements.thumb.container.appendChild(e),vo(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=No("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)}destroy(){this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()}showImageAtCurrentTime(){this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const e=this.thumbnails[0].frames.findIndex((e=>this.seekTime>=e.startTime&&this.seekTime<=e.endTime)),t=e>=0;let n=0;this.mouseDown||this.toggleThumbContainer(t),t&&(this.thumbnails.forEach(((t,r)=>{this.loadedImages.includes(t.frames[e].text)&&(n=r)})),e!==this.showingThumb&&(this.showingThumb=e,this.loadImage(n)))}loadImage(e=0){const t=this.showingThumb,n=this.thumbnails[e],{urlPrefix:r}=n,i=n.frames[t],a=n.frames[t].text,s=r+a;if(this.currentImageElement&&this.currentImageElement.dataset.filename===a)this.showImage(this.currentImageElement,i,e,t,a,!1),this.currentImageElement.dataset.index=t,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const n=new Image;n.src=s,n.dataset.index=t,n.dataset.filename=a,this.showingThumbFilename=a,this.player.debug.log(`Loading image: ${s}`),n.onload=()=>this.showImage(n,i,e,t,a,!0),this.loadingImage=n,this.removeOldImages(n)}}showImage(e,t,n,r,i,a=!0){this.player.debug.log(`Showing thumb: ${i}. num: ${r}. qual: ${n}. newimg: ${a}`),this.setImageSizeAndOffset(e,t),a&&(this.currentImageContainer.appendChild(e),this.currentImageElement=e,this.loadedImages.includes(i)||this.loadedImages.push(i)),this.preloadNearby(r,!0).then(this.preloadNearby(r,!1)).then(this.getHigherQuality(n,e,t,i))}removeOldImages(e){Array.from(this.currentImageContainer.children).forEach((t=>{if("img"!==t.tagName.toLowerCase())return;const n=this.usingSprites?500:1e3;if(t.dataset.index!==e.dataset.index&&!t.dataset.deleting){t.dataset.deleting=!0;const{currentImageContainer:e}=this;setTimeout((()=>{e.removeChild(t),this.player.debug.log(`Removing thumb: ${t.dataset.filename}`)}),n)}}))}preloadNearby(e,t=!0){return new Promise((n=>{setTimeout((()=>{const r=this.thumbnails[0].frames[e].text;if(this.showingThumbFilename===r){let i;i=t?this.thumbnails[0].frames.slice(e):this.thumbnails[0].frames.slice(0,e).reverse();let a=!1;i.forEach((e=>{const t=e.text;if(t!==r&&!this.loadedImages.includes(t)){a=!0,this.player.debug.log(`Preloading thumb filename: ${t}`);const{urlPrefix:e}=this.thumbnails[0],r=e+t,i=new Image;i.src=r,i.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${t}`),this.loadedImages.includes(t)||this.loadedImages.push(t),n()}}})),a||n()}}),300)}))}getHigherQuality(e,t,n,r){if(e<this.thumbnails.length-1){let i=t.naturalHeight;this.usingSprites&&(i=n.h),i<this.thumbContainerHeight&&setTimeout((()=>{this.showingThumbFilename===r&&(this.player.debug.log(`Showing higher quality thumb for: ${r}`),this.loadImage(e+1))}),300)}}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:e}=ql(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return e}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(e){this.mouseDown?this.currentScrubbingImageElement=e:this.currentThumbnailImageElement=e}toggleThumbContainer(e=!1,t=!1){const n=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(n,e),!e&&t&&(this.showingThumb=null,this.showingThumbFilename=null)}toggleScrubbingContainer(e=!1){const t=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(t,e),e||(this.showingThumb=null,this.showingThumbFilename=null)}determineContainerAutoSizing(){(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)}setThumbContainerSizeAndPos(){if(this.sizeSpecifiedInCSS){if(this.elements.thumb.imageContainer.clientHeight>20&&this.elements.thumb.imageContainer.clientWidth<20){const e=Math.floor(this.elements.thumb.imageContainer.clientHeight*this.thumbAspectRatio);this.elements.thumb.imageContainer.style.width=`${e}px`}else if(this.elements.thumb.imageContainer.clientHeight<20&&this.elements.thumb.imageContainer.clientWidth>20){const e=Math.floor(this.elements.thumb.imageContainer.clientWidth/this.thumbAspectRatio);this.elements.thumb.imageContainer.style.height=`${e}px`}}else{const e=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);this.elements.thumb.imageContainer.style.height=`${this.thumbContainerHeight}px`,this.elements.thumb.imageContainer.style.width=`${e}px`}this.setThumbContainerPos()}setThumbContainerPos(){const e=this.player.elements.progress.getBoundingClientRect(),t=this.player.elements.container.getBoundingClientRect(),{container:n}=this.elements.thumb,r=t.left-e.left+10,i=t.right-e.left-n.clientWidth-10;let a=this.mousePosX-e.left-n.clientWidth/2;a<r&&(a=r),a>i&&(a=i),n.style.left=`${a}px`}setScrubbingContainerSize(){const{width:e,height:t}=ql(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${e}px`,this.elements.scrubbing.container.style.height=`${t}px`}setImageSizeAndOffset(e,t){if(!this.usingSprites)return;const n=this.thumbContainerHeight/t.h;e.style.height=e.naturalHeight*n+"px",e.style.width=e.naturalWidth*n+"px",e.style.left=`-${t.x*n}px`,e.style.top=`-${t.y*n}px`}}const Yl={insertElements(e,t){fo(t)?Oo(e,this.media,{src:t}):po(t)&&t.forEach((t=>{Oo(e,this.media,t)}))},change(e){wo(e,"sources.length")?(al.cancelRequests.call(this),this.destroy.call(this,(()=>{this.options.quality=[],Po(this.media),this.media=null,vo(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:t,type:n}=e,[{provider:r=Il.html5,src:i}]=t,a="html5"===r?n:"div",s="html5"===r?{}:{src:i};Object.assign(this,{provider:r,type:n,supported:Yo.check(n,r,this.config.playsinline),media:No(a,s)}),this.elements.container.appendChild(this.media),ho(e.autoplay)&&(this.config.autoplay=e.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),So(e.poster)||(this.poster=e.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),Nl.addStyleHook.call(this),this.isHTML5&&Yl.insertElements.call(this,"source",t),this.config.title=e.title,Gl.setup.call(this),this.isHTML5&&Object.keys(e).includes("tracks")&&Yl.insertElements.call(this,"track",e.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Nl.build.call(this),this.isHTML5&&this.media.load(),So(e.previewThumbnails)||(Object.assign(this.config.previewThumbnails,e.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Kl(this))),this.fullscreen.update()}),!0)):this.debug.warn("Invalid source format")}};class Vl{constructor(e,t){if(this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=Yo.touch,this.media=e,fo(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||mo(this.media)||po(this.media))&&(this.media=this.media[0]),this.config=Co({},Sl,Vl.defaults,t||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch(e){return{}}})()),this.elements={container:null,fullscreen:null,captions:null,hidePlayer:null,buttons:{},display:{},progress:{},inputs:{},tracksMenu:{popup:null,menu:null,panels:{},buttons:{}},nextEpisodes:null,audioTrack:{image:{},panels:{},title:{}},selectedQuality:{container:null,batch:null,text:null},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.hlsMetaData=null,this.currentHlsAudioTrack=0,this.playlistIndex=0,this.nextEpisodes=!1,this.helpPopup=!1,this.seasonsPopup=!1,this.sharePopup=!1,this.shuffle=!1,this.favorite=!1,this.seasons=!1,this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.repeataudio={repeatOff:!0,repeatOne:!1,repeatAll:!1},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new Zs(this.config.debug),this.debug.log("This.elements",this.elements),this.debug.log("Config",this.config),this.debug.log("Support",Yo),this.config.setNextPromo&&(this.nextPromo=this.config.setNextPromo),this.config.setNextEpisodes&&(this.nextEpisodes=this.config.setNextEpisodes),this.config.seasons&&(this.seasons=this.config.seasons),lo(this.media)||!vo(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!Yo.check().api)return void this.debug.error("Setup failed: no support");const n=this.media.cloneNode(!0);n.autoplay=!1,this.elements.original=n,this.hls=new Ds({capLevelToPlayerSize:!0,enableWorker:!0,liveBackBufferLength:900,xhrSetup:(e,t)=>{t.includes("https://apidev.gudsho.com/mediaview/api/v1/key-auth")&&e.setRequestHeader("x-request-origin",window.location.origin)}}),this.dash=ws.MediaPlayer().create();const r=this.media.tagName.toLowerCase();let i=null,a=null;switch(r){case"div":if(i=this.media.querySelector("iframe"),vo(i)){if(a=_l(i.getAttribute("src")),this.provider=function(e){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(e)?Il.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(e)?Il.vimeo:null}(a.toString()),this.elements.container=this.media,this.media=i,this.elements.container.className="",a.search.length){const e=["1","true"];e.includes(a.searchParams.get("autoplay"))&&(this.config.autoplay=!0),e.includes(a.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=e.includes(a.searchParams.get("playsinline")),this.config.youtube.hl=a.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(So(this.provider)||!Object.keys(Il).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=Cl;break;case"video":case"audio":this.type=r,this.provider=Il.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=Yo.check(this.type,this.provider,this.config.playsinline),this.supported.api?(this.eventListeners=[],this.listeners=new Ol(this),this.storage=new gl(this),this.media.plyr=this,vo(this.elements.container)||(this.elements.container=No("div",{tabindex:0}),Do(this.media,this.elements.container)),Nl.migrateStyles.call(this),Nl.addStyleHook.call(this),Gl.setup.call(this),this.config.debug&&zo.call(this,this.elements.container,this.config.events.join(" "),(e=>{this.debug.log(`event: ${e.type}`)})),this.fullscreen=new Dl(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Nl.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new jl(this)),this.isHTML5&&this.config.autoplay&&setTimeout((()=>el(this.play())),10),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Kl(this)),this.config.hls.enabled&&"video"===this.type?(Gl.destroyMedia.call(this),this.loadHlsSource(this.config.hls.src)):"audio"===this.type&&this.updateSource(),this.config.dash.enabled&&this.loadDashSource()):this.debug.error("Setup failed: no support")}updateQuality(e){this.debug.log("--------------------NEW QUALITY-----------",e),-1===e?(this.debug.log("-----this.hls",this.hls.bandwithEstimate),this.debug.log("--------ADAPTIVE AUTO------------",-1),this.hls.nextLevel=-1):this.hls.levels.forEach(((t,n)=>{this.debug.log("----------------------",t,n),t&&t.height===e&&(this.hls.nextLevel=n)}))}updateDashQuality(e){-1===e?this.hls.currentLevel=-1:this.dash.getBitrateInfoListFor("video").forEach(((t,n)=>{t.height===e&&((this.dash.getSettings().streaming.abr.autoSwitchBitrate.video||this.dash.getSettings().streaming.abr.autoSwitchBitrate.audio)&&this.dash.updateSettings({streaming:{abr:{autoSwitchBitrate:{audio:!1,video:!1}}}}),this.debug.log("Video switched to new"),this.dash.setQualityFor("video",n))}))}updateAudioDetails(){const e=hl.get("listeners",this.config),t=this.config.playlist[this.playlistIndex];this.elements.audioTrack.image.setAttribute("src",t.audio_thumbnail),this.elements.audioTrack.image.setAttribute("width","75"),this.elements.audioTrack.image.setAttribute("height","75"),this.elements.audioTrack.image.setAttribute("alt",t.title||"Unknown"),this.elements.audioTrack.title.textContent=t.title||"Unknown",this.elements.audioTrack.panels.name.textContent=t.artist_name||"Unknown";const n=t.listeners||0;this.elements.audioTrack.panels.listeners.count.textContent=`${n} ${e}`}updateSource(){const e={type:"audio"};e.sources=[this.config.playlist[this.playlistIndex]]||[],this.favorite=this.config.playlist[this.playlistIndex].favorite||!1,this.elements.buttons.heart&&(this.elements.buttons.heart.pressed=this.favorite),this.updateAudioDetails(),this.config.hls.enabled?this.loadHlsSource(this.config.playlist[this.playlistIndex].src):Yl.change.call(this,e),this.media.play()}get isHTML5(){return this.provider===Il.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===Il.youtube}get isVimeo(){return this.provider===Il.vimeo}get isVideo(){return this.type===Cl}get isAudio(){return this.type===wl}play(){return go(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then((()=>this.ads.play())).catch((()=>el(this.media.play()))),this.media.play()):null}pause(){return this.playing&&go(this.media.pause)?this.media.pause():null}close(){return this.media.pause()}get playing(){return Boolean(this.ready&&!this.paused&&!this.ended)}get paused(){return Boolean(this.media.paused)}get stopped(){return Boolean(this.paused&&0===this.currentTime)}get ended(){return Boolean(this.media.ended)}togglePlay(e){return(ho(e)?e:!this.playing)?this.play():this.pause()}stop(){this.isHTML5?this.pause():go(this.media.stop)&&this.media.stop()}restart(){$o.call(this,this.media,"restart"),this.currentTime=0,this.play()}set setPlaylistIndex(e){this.playlistIndex=e,this.updateSource()}get getPlaylistIndex(){return this.playlistIndex}set setNextEpisodes(e){this.debug.log("setNextEpisodes",e),this.nextEpisodes=e}get getNextEpisodes(){return this.nextEpisodes}set setSeason(e){this.seasons=e}get getSeason(){return this.seasons}set setNextPromo(e){this.debug.log("setNextPromo",e),this.nextPromo=e}get getNextPromo(){return this.nextPromo}rewind(e){"audio"===this.type?(this.playlistIndex-=1,this.playlistIndex<0&&(this.playlistIndex=this.config.playlist.length-1),$o.call(this,this.media,"changeplaylistindex"),this.updateSource()):this.currentTime-=co(e)?e:this.config.seekTime}forward(e,t=!0){"audio"===this.type?(this.shuffle?this.playlistIndex=Math.round(Math.random()*(this.config.playlist.length-1-0)+0):this.repeataudio.repeatOne||(this.playlistIndex+=1),this.playlistIndex>=this.config.playlist.length?(this.playlistIndex=0,(this.repeataudio.repeatAll||!0===t)&&($o.call(this,this.media,"changeplaylistindex"),this.updateSource())):($o.call(this,this.media,"changeplaylistindex"),this.updateSource())):this.currentTime+=co(e)?e:this.config.seekTime}set currentTime(e){if(!this.duration)return;const t=co(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:e}=this.media;return co(e)?e:e&&e.length&&this.duration>0?e.end(0)/this.duration:0}get seeking(){return Boolean(this.media.seeking)}get duration(){const e=parseFloat(this.config.duration),t=(this.media||{}).duration,n=co(t)&&t!==1/0?t:0;return e||n}set volume(e){let t=e;fo(t)&&(t=Number(t)),co(t)||(t=this.storage.get("volume")),co(t)||({volume:t}=this.config),t>1&&(t=1),t<0&&(t=0),this.config.volume=t,this.media.volume=t,!So(e)&&this.muted&&t>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}increaseVolume(e){const t=this.media.muted?0:this.volume;this.volume=t+(co(e)?e:0)}decreaseVolume(e){this.increaseVolume(-e)}set muted(e){let t=e;ho(t)||(t=this.storage.get("muted")),ho(t)||(t=this.config.muted),this.config.muted=t,this.media.muted=t}get muted(){return Boolean(this.media.muted)}get hasAudio(){return!this.isHTML5||(!!this.isAudio||(Boolean(this.media.mozHasAudio)||Boolean(this.media.webkitAudioDecodedByteCount)||Boolean(this.media.audioTracks&&this.media.audioTracks.length)))}set speed(e){let t=null;co(e)&&(t=e),co(t)||(t=this.storage.get("speed")),co(t)||(t=this.config.speed.selected);const{minimumSpeed:n,maximumSpeed:r}=this;t=function(e=0,t=0,n=255){return Math.min(Math.max(e,t),n)}(t,n,r),this.config.speed.selected=t,setTimeout((()=>{this.media.playbackRate=t}),0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(e){const t=this.config.quality,n=this.options.quality;if(!n.length)return;let r=[!So(e)&&Number(e),this.storage.get("quality"),t.selected,t.default].find(co),i=!0;if(!n.includes(r)){const e=function(e,t){return po(e)&&e.length?e.reduce(((e,n)=>Math.abs(n-t)<Math.abs(e-t)?n:e)):null}(n,r);this.debug.warn(`Unsupported quality option: ${r}, using ${e} instead`),r=e,i=!1}t.selected=r,this.updateSelectedQuality(r),this.media.quality=r,i&&this.storage.set({quality:r})}updateSelectedQuality(e){const t=hl.get(`qualityBadge.${e}`,this.config);this.elements.selectedQuality.batch.textContent=t,this.elements.selectedQuality.text.textContent=e}get quality(){return this.media.quality}set loop(e){const t=ho(e)?e:this.config.loop.active;this.config.loop.active=t,this.media.loop=t}get loop(){return Boolean(this.media.loop)}set source(e){Yl.change.call(this,e)}get source(){return this.media.currentSrc}get download(){const{download:e}=this.config.urls;return bo(e)?e:this.source}set download(e){bo(e)&&(this.config.urls.download=e,El.setDownloadUrl.call(this))}set poster(e){this.isVideo?Nl.setPoster.call(this,e,!1).catch((()=>{})):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const e=nl(rl.call(this));return po(e)?e.join(":"):e}set ratio(e){this.isVideo?fo(e)&&tl(e)?(this.config.ratio=e,il.call(this)):this.debug.error(`Invalid aspect ratio specified (${e})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(e){const t=ho(e)?e:this.config.autoplay;this.config.autoplay=t}get autoplay(){return Boolean(this.config.autoplay)}toggleCaptions(e){bl.toggle.call(this,e,!1)}toggleShuffle(e){const t=this.shuffle,n=this.config.classNames.shuffle.active,r=lo(e)?!t:e;r!==t&&(this.shuffle=r,this.elements.buttons.shuffle&&(this.elements.buttons.shuffle.pressed=r),Uo(this.elements.container,n,r))}toggleHelp(){const e=this.config.classNames.help.enabled,t=document.getElementsByClassName(e).length>0;this.helpPopup=!t,Uo(this.elements.container,e,!t),$o.call(this,this.media,"help")}toggleSeasons(){const e=this.config.classNames.seasons.enabled,t=document.getElementsByClassName(e).length>0;this.seasonsPopup=!t,Uo(this.elements.container,e,!t),$o.call(this,this.media,"seasons")}toggleShare(){const e=this.config.classNames.share.enabled,t=document.getElementsByClassName(e).length>0;this.sharePopup=t,Uo(this.elements.container,e,!t),$o.call(this,this.media,"share")}toggleFavorite(e){if(null!==localStorage.getItem("gudUser")&&void 0!==localStorage.getItem("gudUser")){const t=this.favorite,n=this.config.classNames.heart.active,r=lo(e)?!t:e;r!==t&&(this.favorite=r,this.elements.buttons.heart&&(this.elements.buttons.heart.pressed=r),"audio"===this.type&&(this.config.playlist[this.playlistIndex].favorite=r),Uo(this.elements.container,n,r),$o.call(this,this.media,"heart"))}else this.media.loginError={code:401,message:"Please login to continue"},$o.call(this,this.media,"error")}toggleNextEpisodes(){$o.call(this,this.media,"next-episodes")}toggleNextPromo(){$o.call(this,this.media,"next-promo")}toggleClose(){$o.call(this,this.media,"close",!0),this.destroy((function(){}))}hidePlayer(){const e=this.config.classNames.hidePlayer.enabled,t=document.getElementsByClassName(e).length>0;Uo(this.elements.container,e,!t)}toggleRepeatAudio(){const e=Object.keys(this.repeataudio).filter((e=>this.repeataudio[e])),t=this.config.classNames.repeataudio.repeatOne,n=this.config.classNames.repeataudio.repeatAll;switch(e[0]){case"repeatOff":this.repeataudio={repeatOff:!1,repeatOne:!0,repeatAll:!1},this.elements.buttons.repeataudio&&(this.elements.buttons.repeataudio.pressed=!0),Uo(this.elements.container,t,!0),Uo(this.elements.container,n,!1);break;case"repeatOne":this.repeataudio={repeatOff:!1,repeatOne:!1,repeatAll:!0},this.elements.buttons.repeataudio&&(this.elements.buttons.repeataudio.pressed=!0),Uo(this.elements.container,t,!1),Uo(this.elements.container,n,!0);break;default:this.repeataudio={repeatOff:!0,repeatOne:!1,repeatAll:!1},this.elements.buttons.repeataudio&&(this.elements.buttons.repeataudio.pressed=!1),Uo(this.elements.container,t,!1),Uo(this.elements.container,n,!1)}}set currentTrack(e){bl.set.call(this,e,!1)}set currentAudioTrack(e){this.currentHlsAudioTrack=e}get currentAudioTrack(){return this.hls.audioTrack}get currentTrack(){const{toggled:e,currentTrack:t}=this.captions;return e?t:-1}set language(e){bl.setLanguage.call(this,e,!1)}get language(){return(bl.getCurrentTrack.call(this)||{}).language}set pip(e){if(!Yo.pip)return;const t=ho(e)?e:!this.pip;go(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(t?Al:Rl),go(this.media.requestPictureInPicture)&&(!this.pip&&t?this.media.requestPictureInPicture():this.pip&&!t&&document.exitPictureInPicture())}get pip(){return Yo.pip?So(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===Al:null}airplay(){Yo.airplay&&this.media.webkitShowPlaybackTargetPicker()}toggleControls(e){if(this.supported.ui&&!this.isAudio){const t=Bo(this.elements.container,this.config.classNames.hideControls),n=void 0===e?void 0:!e,r=Uo(this.elements.container,this.config.classNames.hideControls,n);if(r&&po(this.config.controls)&&this.config.controls.includes("settings")&&this.config.controls.includes("captions")&&!So(this.config.settings)&&(El.toggleMenu.call(this,!1),El.toggleTrackMenu.call(this,!1)),r!==t){const e=r?"controlshidden":"controlsshown";$o.call(this,this.media,e)}return!r}return!1}on(e,t){zo.call(this,this.elements.container,e,t)}once(e,t){Qo.call(this,this.elements.container,e,t)}off(e,t){Xo(this.elements.container,e,t)}destroy(e,t=!1){if(!this.ready)return;const n=()=>{document.body.style.overflow="",this.embed=null,Gl.destroyMedia.call(this),t?(Object.keys(this.elements).length&&(Po(this.elements.buttons.play),Po(this.elements.captions),Po(this.elements.controls),Po(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),go(e)&&e()):(Zo.call(this),ko(this.elements.original,this.elements.container),$o.call(this,this.elements.original,"destroyed",!0),go(e)&&e.call(this.elements.original),this.ready=!1,setTimeout((()=>{this.elements=null,this.media=null}),200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(Nl.toggleNativeControls.call(this,!0),n()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),null!==this.embed&&go(this.embed.destroy)&&this.embed.destroy(),n()):this.isVimeo&&(null!==this.embed&&this.embed.unload().then(n),setTimeout(n,200))}supports(e){return Yo.mime.call(this,e)}static supported(e,t,n){return Yo.check(e,t,n)}static loadSprite(e,t){return ml(e,t)}static setup(e,t={}){let n=null;return fo(e)?n=Array.from(document.querySelectorAll(e)):mo(e)?n=Array.from(e):po(e)&&(n=e.filter(vo)),So(n)?null:n.map((e=>new Vl(e,t)))}loadHlsSource(e){Ds.isSupported()&&(this.hls.attachMedia(this.media),this.hls.on(Ds.Events.MEDIA_ATTACHED,(()=>{this.hls.loadSource(e),this.hls.on(Ds.Events.MANIFEST_PARSED,((e,t)=>{this.hls.startLevel=-1,this.hls.startLoad(),this.hlsMetaData=t,this.hls.audioTrack=this.currentHlsAudioTrack;const n=[-1];t.levels.filter((e=>240!==e.height&&n.push(e.height))),this.options.quality=n,this.config.quality={default:-1,options:n,forced:!0,onChange:e=>this.updateQuality(e)},this.updateSelectedQuality(n[0]),El.setQualityMenu.call(this,n),this.on("languagechange",(()=>{setTimeout((()=>this.hls.subtitleTrack=this.currentTrack),50)}))})),this.hls.on(Ds.Events.AUDIO_TRACK_SWITCHED,(()=>{this.debug.log("Audio switched")}))})),window.hls=this.hls)}loadDashSource(){let e;null!==this.config.dash.widevine?e={"com.widevine.alpha":{serverURL:this.config.dash.widevine}}:void 0!==this.config.dash.clearkeys&&(e={"org.w3.clearkey":{clearkeys:{[this.config.dash.clearkeys.keyId]:this.config.dash.clearkeys.key}}}),this.dash.initialize(this.media,this.config.dash.src,!0),this.dash.setAutoPlay(!0),this.dash.setProtectionData(e),this.dash.on("streamInitialized",(()=>{const e=this.dash.getBitrateInfoListFor("video"),t=[-1];e.map((e=>t.push(e.height))),this.options.quality=t,this.updateSelectedQuality(t[0]),this.config.quality={default:-1,options:t,forced:!0,onChange:e=>this.updateDashQuality(e)},El.setQualityMenu.call(this,t),this.on("languagechange",(()=>{setTimeout((()=>this.dash.setTextTrack(this.currentTrack)),50)}))})),window.dash=this.dash}}var Wl;return Vl.defaults=(Wl=Sl,JSON.parse(JSON.stringify(Wl))),Vl}));
//# sourceMappingURL=plyr.min.js.map
